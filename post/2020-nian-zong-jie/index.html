<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="keywords" content="zhangyao blog">
<meta name="description" content="ç”Ÿæ­»çœ‹æ·¡ï¼Œä¸æœå°±å¹²">
<meta name="theme-color" content="#000">
<title>2020å¹´æ€»ç»“ | will</title>
<link rel="shortcut icon" href="/favicon.ico?v=1638331584367">
<link rel="stylesheet" href="/media/css/pisces.css">
<link rel="stylesheet" href="/media/fonts/font-awesome.css">
<link
  href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Rosario:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext"
  rel="stylesheet" type="text/css">

<link href="/media/hljs/styles/androidstudio.css"
  rel="stylesheet">

<link rel="stylesheet" href="/styles/main.css">

<script src="/media/hljs/highlight.js"></script>
<script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.0/velocity.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.0/velocity.ui.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"
  integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"
  integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"
  integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"
  onload="renderMathInElement(document.body);"></script>





  <meta name="description" content="2020å¹´æ€»ç»“" />
  <meta name="keywords" content="æ€»ç»“" />
</head>

<body>
  <div class="head-top-line"></div>
  <div class="header-box">
    
<div class="pisces">
  <header class="header  ">
    <div class="blog-header box-shadow-wrapper bg-color " id="header">
      <div class="nav-toggle" id="nav_toggle">
        <div class="toggle-box">
          <div class="line line-top"></div>
          <div class="line line-center"></div>
          <div class="line line-bottom"></div>
        </div>
      </div>
      <div class="site-meta">       
        <div class="site-title">
          
            <a href="/" class="brand">
              <span>will</span>
            </a>  
          
        </div>
        
          <p class="subtitle">ç”Ÿæ­»çœ‹æ·¡ï¼Œä¸æœå°±å¹²</p>
        
      </div>
      <nav class="site-nav" id="site_nav">
        <ul id="nav_ul">
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="/" target="_self">
                  <i class="fa fa-home"></i> é¦–é¡µ
                </a>
              
            </li>
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="/archives/" target="_self">
                  <i class="fa fa-archive"></i> å½’æ¡£
                </a>
              
            </li>
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="/tags/" target="_self">
                  <i class="fa fa-tags"></i> æ ‡ç­¾
                </a>
              
            </li>
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="/post/about/" target="_self">
                  <i class="fa fa-user"></i> å…³äº
                </a>
              
            </li>
          
          
            
              <li class="nav-item ">
                <a href="/friends/" target="_self">
                  
                    <i class="fa fa-address-book"></i> å‹æƒ…é“¾æ¥
                  
                </a>
              </li>
            
          
          
            <li id="fa_search" class="nav-item">
              <a href="javascript:void(0);">
                <i class="fa fa-search"></i> <span class="language" data-lan="search">æœç´¢</span>
              </a>
            </li>
          
        </ul>
      </nav>
    </div>
  </header>
</div>

<script type="text/javascript"> 
 
  let showNav = true;

  let navToggle = document.querySelector('#nav_toggle'),
  siteNav = document.querySelector('#site_nav');
  
  function navClick() {
    let sideBar = document.querySelector('.sidebar');
    let navUl = document.querySelector('#nav_ul');
    navToggle.classList.toggle('nav-toggle-active');
    siteNav.classList.toggle('nav-menu-active');
    if (siteNav.classList.contains('nav-menu-active')) {
      siteNav.style = "height: " + (navUl.children.length * 42) +"px !important";
    } else {
      siteNav.style = "";
    }
  }

  navToggle.addEventListener('click',navClick);  
</script>
  </div>
  <div class="main-continer">
    
    <div
      class="section-layout pisces ">
      <div class="section-layout-wrapper">
        

<div class="sidebar">
  
    <div class="sidebar-box box-shadow-wrapper bg-color right-motion" id="sidebar">
      
        <div class="post-list-sidebar">
          <div class="sidebar-title">
            <span id="tocSideBar" class="sidebar-title-item sidebar-title-active language" data-lan="index">æ–‡ç« ç›®å½•</span>
            <span id="metaSideBar" class="sidebar-title-item language" data-lan="preview">ç«™ç‚¹æ¦‚è§ˆ</span>
          </div>
        </div>
      
      <div class="sidebar-body pisces" id="sidebar_body">
        
          
            <div class="post-side-meta" id="post_side_meta">
              
<div class="sidebar-wrapper box-shadow-wrapper bg-color">
  <div class="sidebar-item">
    <img class="site-author-image right-motion" src="/images/avatar.png"/>
    <p class="site-author-name">will</p>
    
  </div>
  <div class="sidebar-item side-item-stat right-motion">
    <div class="sidebar-item-box">
      <a href="/archives/">
        
        <span class="site-item-stat-count">16</span>
        <span class="site-item-stat-name language" data-lan="article">æ–‡ç« </span>
      </a>
    </div>
    <div class="sidebar-item-box">
      <a href="">
        <span class="site-item-stat-count">16</span>
        <span class="site-item-stat-name language" data-lan="category">åˆ†ç±»</span>
      </a>
    </div>
    <div class="sidebar-item-box">
      <a href="/tags/">
        <span class="site-item-stat-count">16</span>
        <span class="site-item-stat-name language" data-lan="tag">æ ‡ç­¾</span>
      </a>
    </div>
  </div>
  
    
      <div class="sidebar-item">
        <span class="site-item-rss">
            <i class="fa fa-rss"></i>
            <a href="https://zhangyaoo.github.io/atom.xml" target="_blank">RSS</a>
        </span>
      </div>
    
  
  



</div>
            </div>
            <div class="post-toc sidebar-body-active" id="post_toc" style="opacity: 1;">
              <div class="toc-box right-motion">
  <div class="toc-wrapper auto-number auto"
    id="toc_wrapper">
    <ul class="markdownIt-TOC">
<li>
<ul>
<li>
<ul>
<li><a href="#%E5%BC%80%E5%A4%B4">å¼€å¤´</a></li>
<li><a href="#%E5%AD%A6%E4%B9%A0">å­¦ä¹ </a></li>
<li><a href="#%E8%BF%90%E5%8A%A8">è¿åŠ¨</a></li>
<li><a href="#%E7%88%B1%E6%83%85">çˆ±æƒ…</a></li>
<li><a href="#2021flag">2021flag</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
</div>

<script>

  let lastTop = 0, lList = [], hList = [], postBody, lastIndex = -1;
  let active = 'active-show', activeClass = 'active-current';
  let tocWrapper = document.querySelector('#toc_wrapper');
  let tocContent = tocWrapper.children[0];
  let autoNumber = tocWrapper && tocWrapper.classList.contains('auto-number');

  function addTocNumber(elem, deep) {
    if (!elem) {
      return;
    }
    let prop = elem.__proto__;

    if (prop === HTMLUListElement.prototype) {
      for (let i = 0; i < elem.children.length; i++) {
        addTocNumber(elem.children[i], deep + (i + 1) + '.');
      }
    } else if (prop === HTMLLIElement.prototype) {
      // ä¿å­˜liå…ƒç´ 
      if (elem.children[0] && elem.children[0].__proto__ === HTMLAnchorElement.prototype) {
        lList.push(elem);
      }
      for (let i = 0; i < elem.children.length; i++) {
        let cur = elem.children[i];
        if (cur.__proto__ === HTMLAnchorElement.prototype) {
          if (autoNumber) {
            cur.text = deep + ' ' + cur.text;
          }
        } else if (cur.__proto__ === HTMLUListElement.prototype) {
          addTocNumber(cur, deep);
        }
      }
    }
  }

  function removeParentActiveClass() {
    let parents = tocContent.querySelectorAll('.' + active)
    parents.forEach(function (elem) {
      elem.classList.remove(active);
    });
  }

  function addActiveClass(index) {
    if (index >= 0 && index < hList.length) {
      lList[index].classList.add(activeClass);
    }
  }

  function removeActiveClass(index) {
    if (index >= 0 && index < hList.length) {
      lList[index].classList.remove(activeClass);
    }
  }

  function addActiveLiElemment(elem, parent) {
    if (!elem || elem === parent) {
      return;
    } else {
      if (elem.__proto__ === HTMLLIElement.prototype) {
        elem.classList.add(active);
      }
      addActiveLiElemment(elem.parentElement, parent);
    }
  }

  function showToc() {
    if (tocWrapper) {
      postBody = document.querySelector('#post_body');
      for (let i = 0; i < postBody.children.length; i++) {
        if (postBody.children[i].__proto__ === HTMLHeadingElement.prototype) {
          hList.push(postBody.children[i]);
        }
      }
      if (tocWrapper.classList.contains('compress')) {
        tocContent.classList.add('closed');
      } else if (tocWrapper.classList.contains('no_compress')) {
        tocContent.classList.add('expanded');
      } else {
        if (hList.length > 10) {
          active = 'active-hidden'
          tocContent.classList.add('closed');
        } else {
          tocContent.classList.add('expanded');
        }
      }
    }
  }

  (function () {
    // å¤„ç†ä¸æ˜¯ä»#ä¸€çº§æ ‡é¢˜å¼€å§‹ç›®å½•
    if (tocContent.children.length === 1 && tocContent.children[0].__proto__ === HTMLLIElement.prototype) {
      let con = tocContent.children[0].children[0];
      tocContent.innerHTML = con.innerHTML;
    }
    let markdownItTOC = document.querySelector('.markdownIt-TOC');
    let innerHeight = window.innerHeight;
    markdownItTOC.style = `max-height: ${innerHeight - 80 > 0 ? innerHeight - 80 : innerHeight}px`
    addTocNumber(tocContent, '');
  })();

  document.addEventListener('scroll', function (e) {
    if (lList.length <= 0) {
      return;
    }
    let scrollTop = document.scrollingElement.scrollTop + 10;
    let dir;

    if (lastTop - scrollTop > 0) {
      dir = 'up';
    } else {
      dir = 'down';
    }

    lastTop = scrollTop;
    if (scrollTop <= 0) {
      if (lastIndex >= 0 && lastIndex < hList.length) {
        lList[lastIndex].classList.remove(activeClass);
      }
      return;
    }

    let current = 0, hasFind = false;
    for (let i = 0; i < hList.length; i++) {
      if (hList[i].offsetTop > scrollTop) {
        current = i;
        hasFind = true;
        break;
      }
    }
    if (!hasFind && scrollTop > lList[lList.length - 1].offsetTop) {
      current = hList.length - 1;
    } else {
      current--;
    }
    if (dir === 'down') {
      if (current > lastIndex) {
        addActiveClass(current);
        removeActiveClass(lastIndex)
        lastIndex = current;
        removeParentActiveClass();
        lList[current] && addActiveLiElemment(lList[current].parentElement, tocContent);
      }
    } else {
      if (current < lastIndex) {
        addActiveClass(current);
        removeActiveClass(lastIndex);
        lastIndex = current;
        removeParentActiveClass();
        lList[current] && addActiveLiElemment(lList[current].parentElement, tocContent);
      }
    }
  });


  window.addEventListener('load', function () {
    showToc();
    document.querySelector('#sidebar').style = 'display: block;';
    tocWrapper.classList.add('toc-active');
    setTimeout(function () {
      if ("createEvent" in document) {
        let evt = document.createEvent("HTMLEvents");
        evt.initEvent("scroll", false, true);
        document.dispatchEvent(evt);
      }
      else {
        document.fireEvent("scroll");
      }
    }, 500)
  })

</script>
            </div>
          
        
      </div>
    </div>
  
</div>
<script>
  const SIDEBAR_TITLE_ACTIVE = 'sidebar-title-active';
  const SIDEBAR_BODY_ACTIVE = 'sidebar-body-active';
  const SLIDE_UP_IN = 'slide-up-in';

  let sidebar = document.querySelector('#sidebar'),
  tocSideBar = document.querySelector('#tocSideBar'),
  metaSideBar = document.querySelector('#metaSideBar'),
  postToc = document.querySelector('#post_toc'),
  postSiteMeta = document.querySelector('#post_side_meta'),
  sidebarTitle = document.querySelector('.sidebar-title'),
  sidebarBody = document.querySelector('#sidebar_body');

  tocSideBar && tocSideBar.addEventListener('click', (e) => {
    toggleSidebar(e);
  });

  metaSideBar && metaSideBar.addEventListener('click', (e) => {
    toggleSidebar(e);
  });

  function toggleSidebar(e) {
    let currentTitle = document.querySelector("."+SIDEBAR_TITLE_ACTIVE);
    if (currentTitle == e.srcElement) {
      return ;
    }
    let current, showElement, hideElement;
    if (e.srcElement == metaSideBar) {
      showElement = postSiteMeta;
      hideElement = postToc;
    } else if (e.srcElement == tocSideBar){
      showElement = postToc;
      hideElement = postSiteMeta;
    }
    currentTitle.classList.remove(SIDEBAR_TITLE_ACTIVE);
    e.srcElement.classList.add(SIDEBAR_TITLE_ACTIVE);

    window.Velocity(hideElement, 'stop');
    window.Velocity(hideElement, 'transition.slideUpOut', {
      display: 'none',
      duration: 200,
      complete: function () {
        window.Velocity(showElement, 'transition.slideDownIn', {
          duration: 200
        });
      }
    })
    hideElement.classList.remove(SIDEBAR_BODY_ACTIVE);
    showElement.classList.add(SIDEBAR_BODY_ACTIVE);
  }

  postToc && postToc.addEventListener('transitionend', function() {
    this.classList.remove(SLIDE_UP_IN);
  });

  if (sidebarBody) {
    if (sidebarBody.classList.contains('pisces') || sidebarBody.classList.contains('gemini')) {
      let hasFix = false;
      let scrollEl = document.querySelector('.main-continer');
      let limitTop = document.querySelector('#nav_ul').children.length * 42 + 162;
      window.addEventListener('scroll', function(e) {
        if (document.scrollingElement.scrollTop >= limitTop) {
          if (!hasFix) {
            sidebar.classList.add('sidebar-fixed');
            hasFix = true;
          }
        } else {
          if (hasFix) {
            sidebar.classList.remove('sidebar-fixed');
            hasFix = false;
          }
        }
      });
    }
  }
  
</script>
        <div class="section-box box-shadow-wrapper">
          <div class="section bg-color post post-page">
            <header class="post-header">
  <h1 class="post-title">
    <a class="post-title-link" href="https://zhangyaoo.github.io/post/2020-nian-zong-jie/">
      2020å¹´æ€»ç»“
    </a>
  </h1>
  <div class="post-meta">
    
    <span class="meta-item pc-show">
      <i class="fa fa-calendar-o"></i>
      <span class="language" data-lan="publish">å‘å¸ƒäº</span>
      <span>2020-12-31</span>
      <span class="post-meta-divider pc-show">|</span>
    </span>
    
    <span class="meta-item">
      <i class="fa fa-folder-o"></i>
      <span class="pc-show language" data-lan="category-in">åˆ†ç±»äº</span>
      
      
      <a href="https://zhangyaoo.github.io/tag/hD1pMQ2Ri/">
        <span>æ€»ç»“</span>
      </a>
      
      
    </span>
    <span class="post-meta-divider">|</span>
    
    <span class="meta-item">
      <i class="fa fa-clock-o"></i>
      <span>5<span class="language" data-lan="minute">åˆ†é’Ÿ</span></span>
    </span>
    <span class="meta-item">
      <span class="post-meta-divider">|</span>
      <i class="fa fa-file-word-o"></i>
      <span>1407<span class="pc-show language" data-lan="words">å­—æ•°</span></span>
    </span>
    
  </div>
</header>
            <div class="post-body next-md-body" id="post_body">
              <figure data-type="image" tabindex="1"><img src="https://zhangyaoo.github.io/post-images/1609517863900.jpg" alt="" loading="lazy"></figure>
<h3 id="å¼€å¤´">å¼€å¤´</h3>
<p>ä»Šå¤©æ˜¯1æœˆ1å·ï¼Œæ–°å¹´ç¬¬ä¸€å¤©ï¼ŒæŠ“ä½2020å¹´çš„å°å°¾å·´ï¼Œéšä¾¿çµ®çµ®å¨å¨ä¸€ä¸‹ï¼Œåšä¸ªå°æ€»ç»“ã€‚å›æƒ³ä¸€ä¸‹ä»Šå¹´ä¸€æ•´å¹´ï¼Œå¼€å¿ƒï¼Œå›°éš¾ï¼Œå¿ƒé…¸ï¼Œå¤§éƒ¨åˆ†éƒ½ç»å†è¿‡ï¼Œæ²¡æœ‰ä»€ä¹ˆå€¼å¾—è¯´çš„ç»å†ï¼Œå€’æ˜¯å°äº‹æŒºå¤šã€‚</p>
<p>å€¼å¾—æçš„äº‹æƒ…å°±æ˜¯ç–«æƒ…äº†ï¼Œä»Šå¹´ç–«æƒ…åœ¨å®¶å‘†äº†2ä¸ªæœˆï¼Œé‚£æ—¶å€™å› ä¸ºå¹´å‰è¢«è£ï¼Œå·²ç»æ˜¯å¤±ä¸šçš„çŠ¶æ€ï¼Œæ²¡æœ‰æ”¶å…¥æ¥æºï¼Œå¼€å§‹åç«‹ä¸å®‰ï¼Œçƒ¦èº ã€‚åé¢æ„è¯†åˆ°äº†åœ¨å®¶ä¹Ÿæœ‰åœ¨å®¶å€¼å¾—åšçš„äº‹æƒ…ï¼Œä¸å¿…å› ä¸ºç–«æƒ…æ‰“ä¹±è‡ªå·±çš„å†…å¿ƒï¼Œå……å®é™ªå®¶äººè¿‡æ¯ä¸€å¤©ã€‚</p>
<p>ä½œä¸ºæˆå¹´äººï¼Œç°åœ¨è®¤ä¸ºæ—¶å¸¸å¼€å¿ƒå¿«ä¹å€’æ˜¯ä¸€ä»¶å¾ˆéš¾çš„äº‹æƒ…ï¼Œæƒ³èµ·ä¸€å¥è¯ï¼Œå°æ—¶å€™å¿«ä¹æ˜¯ä¸€ä»¶ç®€å•çš„äº‹æƒ…ï¼Œé•¿å¤§åï¼Œç®€å•æ˜¯ä¸€ä»¶å¿«ä¹çš„äº‹æƒ…ã€‚ä¸è¿‡åé¢è¿˜æ˜¯è¦æ—¶å¸¸å¼€å¿ƒä¸ºä¸»ï¼Œç„¶åå°±æ˜¯ä»Šå¹´ä»¥åè¦æ²‰é™ä¸‹æ¥ï¼Œç†æ€§æ€è€ƒï¼Œä¸ç®¡å¯¹äººè¿˜æ˜¯å¯¹äº‹ã€‚è¿˜è¦å¤šçœ‹äº›å…³äºç”Ÿæ´»ä¸Šçš„ä¹¦ï¼Œä¸åªæ˜¯ç›¯ç€æŠ€æœ¯ä¹¦æ­»å•ƒï¼Œæé†’ä¸€ä¸‹è‡ªå·±è¦åœä¸‹æ¥å¤šæ€è€ƒï¼Œä½å¤´åšäº‹ï¼ŒæŠ¬å¤´çœ‹è·¯ã€‚</p>
<p>ä»Šå¹´æ€»ç»“æ–¹é¢æœ‰äº›å°‘ï¼Œå› ä¸ºæˆ‘è‡ªå·±è®¤ä¸ºè¿™äº›æ–¹é¢å€¼å¾—å»æ€»ç»“ï¼Œè‡³äºå…¶ä»–çš„ï¼Œå¯èƒ½æˆ‘æ²¡æœ‰æ„è¯†åˆ°æˆ–è€…æ˜¯ä»Šå¹´ç»å†äº‹æƒ…çš„å¤ªå°‘ã€‚</p>
<h3 id="å­¦ä¹ ">å­¦ä¹ </h3>
<p><img src="https://zhangyaoo.github.io/post-images/1609517630829.jpg" alt="" loading="lazy"><br>
å…³äºå­¦ä¹ è¿™ä»¶äº‹ï¼Œè¿˜æ˜¯è¦æ”¾åœ¨ç¬¬ä¸€æ¥è¯´ã€‚å­¦æ— æ­¢å¢ƒï¼Œæ´»åˆ°è€å­¦åˆ°è€ã€‚äººä¸èƒ½æ€»æ˜¯åœç•™åœ¨åŸåœ°ï¼Œè¿˜æ˜¯è¦å¤šçœ‹ä¹¦å¤šå­¦ä¹ ï¼Œå¢é•¿çŸ¥è¯†ã€‚ä¸­å›½äººå¤§éƒ¨åˆ†åŠ³åŠ¨äººæ°‘ä»¥å‰ï¼ˆ80å¹´ä»£ï¼‰æ˜¯åŸºæœ¬é åŠªåŠ›ï¼Œé å‹¤å¥‹ï¼Œè·å¾—å±äºè‡ªå·±çš„åŠ³åŠ¨æœå®ï¼Œç°åœ¨ä¿¡æ¯æ—¶ä»£ï¼Œé™¤äº†é åŠªåŠ›å‹¤å¥‹ä»¥å¤–ï¼Œè¿˜è¦æœ‰æ•ˆåˆ©ç”¨ä¸“ä¸šçŸ¥è¯†å»è§£å†³ç”Ÿæ´»å·¥ä½œä¸­çš„é—®é¢˜ï¼Œäº«å—ç°åœ¨ä¿¡æ¯æ—¶ä»£ç»™ä¸çš„æˆæœã€‚<br>
å°±åƒæ–‡è‡£æ­¦å°†ï¼Œè°‹å£«å½“å‡ºè°‹åˆ’ç­–ï¼Œæ­¦å£«å½“æˆ˜åœºå®æ€ã€‚æ¯ä¸ªäººå½“å»å‘æŒ¥è‡ªå·±çš„ä¸“ä¸šæœ¬é¢†ã€‚ä¸ç®¡æœ€ç»ˆç›®çš„æ˜¯å•¥ï¼Œç²¾å¿ æŠ¥å›½è¿˜æ˜¯å…»å®¶ç³Šå£ï¼Œå°æœ‰å°ä¹‰ï¼Œå¤§æœ‰å¤§ä¹‰ã€‚</p>
<p>æ‰¯è¿œäº†ï¼Œä»Šå¹´å‡†å¤‡è¿˜æ˜¯ä»¥æŠ€æœ¯å­¦ä¹ ä¸ºä¸»ï¼Œç„¶åä»¥å…¬ä¼—å·å’ŒGitHubä¸ºè¾…åŠ©è¿›è¡Œå­¦ä¹ ã€‚<br>
ä»Šå¹´å‡†å¤‡çœ‹å®Œè¿™äº›å­¦ä¹ èµ„æ–™ï¼Œå…¶ä¸­æœ‰ä¹¦ç±ä»¥åŠç½‘ç»œè¯¾ç¨‹<br>
1ã€MySQLæ˜¯å¦‚ä½•è¿è¡Œçš„<br>
2ã€redisè®¾è®¡å’Œå®ç°<br>
3ã€æ¶æ„å¸ˆè§†é¢‘è¯¾<br>
4ã€æå®¢æ—¶é—´MySQL<br>
5ã€Nettyç½‘ç»œç¼–ç¨‹å­¦ä¹ +æŠ€æœ¯ä¹¦ç±+Nettyå®æˆ˜</p>
<p>ä¸å¤šï¼Œåˆ—å¤šäº†å°±çœ‹ä¸å®Œäº†[dog]ã€‚</p>
<p>å…¶ä»–åˆ™æŒ‰æ—¶åŠæ—¶æ€»ç»“å·¥ä½œä¸Šé‡åˆ°çš„é—®é¢˜ï¼Œæå‡è‡ªå·±çš„æŠ€æœ¯æ·±åº¦ã€‚æ¯•ç«Ÿå·¥ä½œä¸­é‡åˆ°çš„æœ€å®¹æ˜“åŠ æ·±ç†è§£çš„å’Œæå‡èƒ½åŠ›çš„ã€‚<br>
é¡ºä¾¿çœ‹ä¸€äº›ä¼˜ç§€çš„åšå®¢åŠæ—¶æ€»ç»“ï¼Œè¾“å‡ºè‡ªå·±çš„ç†è§£ã€‚ç„¶åç»´æŠ¤åˆ°è‡ªå·±çš„ä¸ªäººç½‘ç«™ä¸Šé¢å»ã€‚</p>
<p>ç„¶åå…¶ä»–æ—¶é—´ï¼Œå‡†å¤‡çœ‹ä¸€äº›å…¶ä»–ç±»å‹çš„ä¹¦ç±ï¼Œæ¯”å¦‚äººæ–‡å†å²ï¼Œä»¥åŠå…¶ä»–ä¼˜ç§€çš„å›½å†…å¤–è‘—ä½œï¼Œç°åœ¨å·²ç»æƒ³å¥½çœ‹äº›ä»€ä¹ˆï¼Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ï¼Œä»Šå¹´ä»Šåä¼šæŠ½ç©ºä½™æ—¶é—´å»çœ‹è¿™äº›ï¼Œæå‡è‡ªå·±å¯¹äººå’Œç”Ÿæ´»çš„ä¸€äº›æ€è€ƒã€‚</p>
<p>æœ€åçš„è¯è¦æé†’è‡ªå·±å°‘çœ‹åŠ¨æ¼«äºŒæ¬¡å…ƒå¤šå­¦ä¹ ï¼Œæ—©ç¡æ—©èµ·~~</p>
<h3 id="è¿åŠ¨">è¿åŠ¨</h3>
<p><img src="https://zhangyaoo.github.io/post-images/1609517659211.jpg" alt="" loading="lazy"><br>
è¿åŠ¨è¿™ä»¶äº‹æƒ…ï¼Œç®—æ˜¯æˆ‘ä¸ªäººæ¯å¹´ç«‹çš„flagä¸­ï¼Œè‡ªå·±æœ€æ»¡æ„çš„äº†ã€‚ä¸€å‘¨æœ€å°‘ä¸€æ¬¡è·‘æ­¥+ç¯®çƒã€‚åŸºæœ¬ä¸Šä¹Ÿä¸ç®—å…¨éƒ¨ï¼Œæ¯å‘¨éƒ½åšäº†ã€‚<br>
æˆ‘èº«è¾¹çš„æœ‹å‹æˆ–è€…äº²äººï¼Œæˆ‘ä¼šç»å¸¸æé†’ä»–ä»¬ï¼Œè¦é€‚å½“çš„é”»ç‚¼ã€‚è™½ç„¶æ€»æ˜¯è¢«å½“ä½œè€³è¾¹é£ï¼Œä½†æ˜¯æ¯æ¬¡è¿‡å¹´ç¥åˆ«äººèº«ä½“å¥åº·åªæ˜¯å™±å¤´ï¼Œåªæœ‰çœŸæ­£å…³å¿ƒä½ çš„äººä¼šåœ¨ä¹ä½ çš„å¥åº·ã€‚æˆ‘ä¸ªäººä¸ç®¡æ˜¯ç”Ÿæ—¥è¿˜æ˜¯æ–°å¹´æ„¿æœ›ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯å¸Œæœ›èº«è¾¹çš„äººè¿‡çš„å¹³å¹³å®‰å®‰å¼€å¼€å¿ƒå¿ƒå°±è¡Œäº†ï¼Œå…¶ä»–éƒ½æ˜¯æ‰¯æ·¡ã€‚<br>
è€Œæˆ‘è‡ªå·±è¿åŠ¨çš„åŠ¨åŠ›æ¥æºæ˜¯ï¼Œå¦‚æœæˆ‘è‡ªå·±èº«ä½“ä¸è¡Œï¼Œé‚£å°±æ²¡æœ‰èƒ½åŠ›ç…§æŠ¤èº«è¾¹äººã€‚æˆ‘è‡ªå·±èƒ½å¤Ÿæˆé•¿ä¸ºå¤§æ ‘ï¼Œè®©åˆ«äººå®‰å¿ƒå€šé ã€‚</p>
<p>ç°åœ¨è™½ç„¶æ¯•ä¸šäº†3å¹´ï¼Œ6å—è…¹è‚Œå·²ç»å˜æˆäº†4å¿«ï¼Œèº«ä½“æ²¡æœ‰æ¯•ä¸šé‚£ä¼šå¥½ï¼Œä½†æ˜¯æˆ‘è‡ªå·±è¿˜æ˜¯ä¼šåšæŒçš„ï¼Œæœç€æ›´mançš„ç›®æ ‡å¥‹æ–—ã€‚æƒ³å½“å¹´æˆ‘å¯æ˜¯æ‹¥æœ‰8å—è…¹è‚Œçš„ç”·äººã€‚ã€‚ã€‚ã€‚</p>
<h3 id="çˆ±æƒ…">çˆ±æƒ…</h3>
<p><img src="https://zhangyaoo.github.io/post-images/1609517842818.jpg" alt="" loading="lazy"><br>
ä»Šå¹´æœ€å¼€å¿ƒçš„å°±æ˜¯å’Œå¥³æœ‹å‹åº¦è¿‡ç¬¬ä¸€å¹´çš„æ‹çˆ±æœŸï¼ˆä¸è¦è„¸çš„æˆ‘ï¼Œè‡ªè®¤ä¸ºç½‘æ‹äº†ä¸€å¹´çš„çƒ­æ‹æœŸï¼‰ï¼Œè¿™ä¸€å¹´æœ‰å¼€å¿ƒå’Œéš¾è¿‡ï¼Œä¸è¿‡éš¾è¿‡æ—¶åˆ»å¾ˆå°‘ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯å¼€å¿ƒæ—¶åˆ»ï¼Œæˆ‘è§‰å¾—å·²ç»å¯ä»¥äº†ï¼Œèƒ½å¤Ÿå’Œå¯¹æ–¹æ¯å¤©éƒ½å¾ˆå¼€å¿ƒï¼Œå·²ç»å¾ˆä¸é”™äº†ã€‚æ¯•ç«Ÿå’Œå–œæ¬¢çš„äººåœ¨ä¸€èµ·ä¸å°±æ˜¯å¼€å¿ƒæ’’ï¼Œè¿™ä¸ªæ˜¯æœ€éš¾èƒ½å¯è´µçš„ã€‚ã€‚</p>
<p>æˆ‘è‡ªè®¤ä¸ºæˆ‘æ˜¯ä¸ªä¸å¥½iç›¸å¤„çš„äººï¼Œä¸ªäººçš„å°è„¾æ°”å¾ˆå¤šï¼Œè€Œä¸”æœ‰æ—¶å€™ä¼šå¸¸æœ‰ä¸è‡ªä¿¡ã€‚è°¢è°¢æˆ‘å¥³æœ‹å‹çš„ç†è§£å’Œé¼“åŠ±ã€‚ä»Šå¹´å¾€åï¼Œè¿˜å¸Œæœ›ä¸€èµ·å¼€å¿ƒåº¦è¿‡æ¯ä¸€å¤©ï¼Œå“ˆå“ˆå“ˆå“ˆã€‚</p>
<p>æ–°çš„ä¸€å¹´ï¼Œå¸Œæœ›å’±ä¿©éƒ½èº«ä½“å¥åº·ï¼Œå¼€å¼€å¿ƒå¿ƒ~</p>
<h3 id="2021flag">2021flag</h3>
<p>å›½é™…æƒ¯ä¾‹ï¼Œæœ€åè¯´ä¸€äº›æ‰“è„¸çš„flag<br>
1ã€å®Œæˆä¸Šé¢çš„èµ„æ–™çš„å­¦ä¹ <br>
2ã€æ¯ä¸ªæœˆä¸€æ¬¡æ–‡ç« æ€»ç»“ï¼Œå·¥ä½œæ€»ç»“ï¼Œ4æ¬¡ä¸ªäººç½‘ç«™æ–‡ç« çš„å‘è¡¨å’Œç»´æŠ¤<br>
3ã€ä¸€å‘¨ä¸€æ¬¡è¿åŠ¨+ç¯®çƒ<br>
4ã€èº«ä½“ä½“é‡ä¸è¶…130<br>
5ã€ç»è¥å¥½ä¸ªäººåšå®¢<br>
6ã€ æ—©ç¡æ—©èµ·ï¼Œ11ç‚¹åŠä¹‹å‰ç¡</p>
<p><strong>2021å¹´ï¼Œå¹²å°±å®Œäº‹</strong>ã€‚<br>
<img src="https://zhangyaoo.github.io/post-images/1609517948326.jpg" alt="" loading="lazy"></p>

            </div>
            
            
              <div class="post-footer">
  <ul class="post-copyright">
    <li class="post-copyright-author">
      <strong class="language" data-lan="author">æœ¬æ–‡ä½œè€…ï¼š</strong>
      will
    </li>
    <li class="post-copyright-link">
      <strong class="language" data-lan="link">æœ¬æ–‡é“¾æ¥ï¼š</strong>
      <a href="https://zhangyaoo.github.io/post/2020-nian-zong-jie/" title="2020å¹´æ€»ç»“">https://zhangyaoo.github.io/post/2020-nian-zong-jie/</a>
    </li>
    <li class="post-copyright-license">
      <strong class="language" data-lan="copyright">ç‰ˆæƒå£°æ˜ï¼š </strong>
      æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
    </li>
  </ul>
  <div class="tags">
    
      <a href="https://zhangyaoo.github.io/tag/hD1pMQ2Ri/"># æ€»ç»“</a>
    
  </div>
  <div class="nav">
    <div class="nav-prev">
      
        <i class="fa fa-chevron-left"></i>
        <a class="nav-pc-next" title="è®°ä¸€æ¬¡å¤šæ•°æ®æºè·¯ç”±é€ æˆçš„æ•°æ®åº“è¿æ¥æ³„éœ²æ’æŸ¥è¿‡ç¨‹" href="https://zhangyaoo.github.io/post/ji-yi-ci-duo-shu-ju-yuan-lu-you-zao-cheng-de-shu-ju-ku-lian-jie-nei-cun-xie-lu/">è®°ä¸€æ¬¡å¤šæ•°æ®æºè·¯ç”±é€ æˆçš„æ•°æ®åº“è¿æ¥æ³„éœ²æ’æŸ¥è¿‡ç¨‹</a class="nav-pc-next">
        <a class="nav-mobile-prev" title="è®°ä¸€æ¬¡å¤šæ•°æ®æºè·¯ç”±é€ æˆçš„æ•°æ®åº“è¿æ¥æ³„éœ²æ’æŸ¥è¿‡ç¨‹" href="https://zhangyaoo.github.io/post/ji-yi-ci-duo-shu-ju-yuan-lu-you-zao-cheng-de-shu-ju-ku-lian-jie-nei-cun-xie-lu/">ä¸Šä¸€ç¯‡</a>
      
    </div>
    <div class="nav-next">
      
        <a class="nav-pc-next" title="æ¦‚ç‡ç›¸ç­‰çš„æ‹¼æ‰‹æ°”çº¢åŒ…ç®—æ³•å®ç°" href="https://zhangyaoo.github.io/post/shou-lu-yi-ge-hong-bao-suan-fa/">æ¦‚ç‡ç›¸ç­‰çš„æ‹¼æ‰‹æ°”çº¢åŒ…ç®—æ³•å®ç°</a>
        <a class="nav-mobile-next" title="æ¦‚ç‡ç›¸ç­‰çš„æ‹¼æ‰‹æ°”çº¢åŒ…ç®—æ³•å®ç°" href="https://zhangyaoo.github.io/post/shou-lu-yi-ge-hong-bao-suan-fa/">ä¸‹ä¸€ç¯‡</a>
        <i class="fa fa-chevron-right"></i>
      
    </div>
  </div>
</div>
            
            
  

          </div>
        </div>
      </div>
    </div>
    <div class="footer-box">
  <footer class="footer">
    <div class="copyright">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | Â© 2019-2020 Theme By <a
        href="https://github.com/hsxyhao/gridea-theme-next" target="_blank">HsxyHao</a>
    </div>
    <div class="poweredby">
      <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <span id="busuanzi_container_site_pv">æœ¬ç«™æ€»è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>æ¬¡</span>
    </div>
  </footer>
  
  
  <div class="pisces back-to-top" id="back_to_top">
    <i class="fa fa-arrow-up"></i>
    
    <span class="scrollpercent">
      <span id="back_to_top_text">0</span>%
    </span>
    
  </div>
  
  
  
</div>
<script>

  let sideBarOpen = 'sidebar-open';
  let body = document.body;
  let back2Top = document.querySelector('#back_to_top'),
    back2TopText = document.querySelector('#back_to_top_text'),
    drawerBox = document.querySelector('#drawer_box'),
    rightSideBar = document.querySelector('.sidebar'),
    viewport = document.querySelector('body');

  function scrollAnimation(currentY, targetY) {

    let needScrollTop = targetY - currentY
    let _currentY = currentY
    setTimeout(() => {
      const dist = Math.ceil(needScrollTop / 10)
      _currentY += dist
      window.scrollTo(_currentY, currentY)
      if (needScrollTop > 10 || needScrollTop < -10) {
        scrollAnimation(_currentY, targetY)
      } else {
        window.scrollTo(_currentY, targetY)
      }
    }, 1)
  }

  back2Top.addEventListener("click", function (e) {
    scrollAnimation(document.scrollingElement.scrollTop, 0);
    e.stopPropagation();
    return false;
  });

  window.addEventListener('scroll', function (e) {
    let percent = document.scrollingElement.scrollTop / (document.scrollingElement.scrollHeight - document.scrollingElement.clientHeight) * 100;
    if (percent > 1 && !back2Top.classList.contains('back-top-active')) {
      back2Top.classList.add('back-top-active');
    }
    if (percent == 0) {
      back2Top.classList.remove('back-top-active');
    }
    if (back2TopText) {
      back2TopText.textContent = Math.floor(percent);
    }
  });


  let hasCacu = false;
  window.onresize = function () {
    calcuHeight();
  }

  function calcuHeight() {
    // åŠ¨æ€è°ƒæ•´ç«™ç‚¹æ¦‚è§ˆé«˜åº¦
    if (!hasCacu && back2Top.classList.contains('pisces') || back2Top.classList.contains('gemini')) {
      let sideBar = document.querySelector('.sidebar');
      let navUl = document.querySelector('#site_nav');
      sideBar.style = 'margin-top:' + (navUl.offsetHeight + navUl.offsetTop + 15) + 'px;';
      hasCacu = true;
    }
  }
  calcuHeight();

  let open = false, MOTION_TIME = 300, RIGHT_MOVE_DIS = '320px';

  if (drawerBox) {
    let rightMotions = document.querySelectorAll('.right-motion');
    let right = drawerBox.classList.contains('right');

    let transitionDir = right ? "transition.slideRightIn" : "transition.slideLeftIn";

    let openProp, closeProp;
    if (right) {
      openProp = {
        paddingRight: RIGHT_MOVE_DIS
      };
      closeProp = {
        paddingRight: '0px'
      };
    } else {
      openProp = {
        paddingLeft: RIGHT_MOVE_DIS
      };
      closeProp = {
        paddingLeft: '0px'
      };
    }

    drawerBox.onclick = function () {
      open = !open;
      window.Velocity(rightSideBar, 'stop');
      window.Velocity(viewport, 'stop');
      window.Velocity(rightMotions, 'stop');
      if (open) {
        window.Velocity(rightSideBar, {
          width: RIGHT_MOVE_DIS
        }, {
          duration: MOTION_TIME,
          begin: function () {
            window.Velocity(rightMotions, transitionDir, {});
          }
        })
        window.Velocity(viewport, openProp, {
          duration: MOTION_TIME
        });
      } else {
        window.Velocity(rightSideBar, {
          width: '0px'
        }, {
          duration: MOTION_TIME,
          begin: function () {
            window.Velocity(rightMotions, {
              opacity: 0
            });
          }
        })
        window.Velocity(viewport, closeProp, {
          duration: MOTION_TIME
        });
      }
      for (let i = 0; i < drawerBox.children.length; i++) {
        drawerBox.children[i].classList.toggle('muse-line');
      }
      drawerBox.classList.toggle(sideBarOpen);
    }
  }

  // é“¾æ¥è·³è½¬
  let newWindow = 'true'
  if (newWindow === 'true') {
    let links = document.querySelectorAll('.post-body a')
    links.forEach(item => {
      if (!item.classList.contains('btn')) {
        item.setAttribute("target", "_blank");
      }
    })
  }

  let faSearch = document.querySelector('#fa_search');
  faSearch.addEventListener('click', function () {
    document.querySelector('#search_mask').style = ''
  })

  // ä»£ç é«˜äº®
  hljs.initHighlightingOnLoad();
  
  // ç¦»å¼€å½“å‰é¡µtitleå˜åŒ–
  var leaveTitle = '';
  if (leaveTitle) {
    document.addEventListener('visibilitychange', function () {
      if (document.visibilityState == 'hidden') {
        normal_title = document.title;
        document.title = leaveTitle;
      } else {
        document.title = normal_title;
      }
    });
  }

</script>
    <div class="light-box" id="light_box"></div>
<script>
  let imgs = document.querySelectorAll('.post-body img');
  let lightBox = document.querySelector('#light_box');
  lightBox.addEventListener('mousedown', (e) => {
    e.preventDefault()
  })
  lightBox.addEventListener('mousewheel', (e) => {
    e.preventDefault()
  })
  let width = window.innerWidth * 0.8;
  lightBox.onclick = () => {
    let img = lightBox.querySelector('img');
    lightBox.style = '';
    img && img.remove();
  }
  imgs.forEach(item => {
    item.onclick = function (e) {
      let lightImg = document.createElement('img');
      lightImg.src = this.src;
      lightBox.style = `height: 100%; opacity: 1; background-color: rgba(0, 0, 0, 0.5);cursor: zoom-out;`;
      lightImg.style = `width: ${width}px; border: 1px solid #fff; border-radius: 2px;`;
      lightImg.onclick = function () {
        lightBox.style = '';
        this.remove();
      }
      lightBox.append(lightImg);
    }
  })
</script>
    <div class="reward-mask" style="display: none;">
  <div class="reward-relative">
    <span class="close" aria-hidden="true">x</span>
    <div class="reward-body">
      <h2>æ„Ÿè°¢æ‚¨çš„æ”¯æŒï¼Œæˆ‘ä¼šç»§ç»­åŠªåŠ›çš„!</h2>
      <div class="reward-img-box">
        <div style="position: relative; width: 140px; height: 140px;">
          
          
          
        </div>
      </div>
      <p class="reward-word">æ‰«ç æ‰“èµï¼Œä½ è¯´å¤šå°‘å°±å¤šå°‘</p>
      <p class="reward-tip">æ‰“å¼€å¾®ä¿¡æ‰«ä¸€æ‰«ï¼Œå³å¯è¿›è¡Œæ‰«ç æ‰“èµå“¦</p>
    </div>
    <div class="bottom">
      
      
    </div>
  </div>
</div>
<style>
  .reward-mask {
    position: fixed;
    z-index: 99999;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    background-color: #00000054;
  }

  .reward-relative {
    position: relative;
    width: 480px;
    text-align: center;
    margin: 0 auto;
    border-radius: 5px;
    background-color: #fff;
    top: 50%;
    margin-top: -205px;
  }

  .reward-relative .close {
    position: absolute;
    right: 10px;
    font-weight: normal;
    font-size: 16px;
    color: #929292;
  }

  .reward-body {
    padding: 40px 20px 20px;
  }

  .bottom {
    display: flex;
  }

  .reward-btn {
    text-align: center;
  }

  .reward-btn-text {
    display: inline-block;
    cursor: pointer;
    width: 60px;
    height: 60px;
    line-height: 60px;
    border-radius: 50%;
    background-color: #ff9734;
    color: #FFF;
    margin-top: 20px;
  }

  .pay-text {
    margin-top: 10px;
    padding: 10px;
    flex: 1;
    transition: all .2s linear;
  }

  .pay-text:hover {
    background-color: #a5a5a536;
  }

  .reward-body h2 {
    padding-top: 10px;
    text-align: center;
    color: #a3a3a3;
    font-size: 16px;
    font-weight: normal;
    margin: 0 0 20px;
  }

  .reward-body h2:after,
  .reward-body h2:before {
    font-family: Arial, Helvetica, sans-serif;
    background: 0 0;
    width: 0;
    height: 0;
    font-style: normal;
    color: #eee;
    font-size: 80px;
    position: absolute;
    top: 20px;
  }

  .reward-body h2:before {
    content: '\201c';
    left: 50px;
  }

  .reward-body h2:after {
    content: '\201d';
    right: 80px;
  }

  .reward-img-box {
    display: inline-block;
    padding: 10px;
    border: 6px solid #ea5f00;
    margin: 0 auto;
    border-radius: 3px;
    position: relative;
  }

  .reward-img {
    position: absolute;
    left: 0px;
    top: 0px;
    width: 100%;
    height: 100%;
  }

  @media (max-width: 767px) {
    .reward-relative {
      height: 100%;
      top: 0px;
      margin-top: 0;
      width: auto;
    }

    .reward-relative .bottom {
      flex-direction: column;
    }

    .reward-relative .pay-text {
      width: 80%;
      margin: 5px auto;
      border: 1px solid silver;
      padding: 6px;
      border-radius: 4px;
    }

    .reward-body h2:after {
      right: 40px;
    }

    .reward-body h2:after,
    .reward-body h2:before {
      font-size: 60px;
    }

    .reward-body h2:before {
      left: 20px;
    }
  }
</style>
<script>
  !function () {
    var mask = document.querySelector('.reward-mask');
    let close = document.querySelector('.reward-relative .close');
    let rewardBtn = document.querySelector('.reward-btn');

    let zfb = document.querySelector('#zfb'),
      wx = document.querySelector('#wx'),
      zfbBtn = document.querySelector('#zfbBtn'),
      wxBtn = document.querySelector('#wxBtn');

    if (zfbBtn && wxBtn) {
      zfbBtn.addEventListener('click', () => {
        window.Velocity(zfb, 'transition.slideLeftIn', {
          duration: 400
        });
        window.Velocity(wx, 'transition.slideRightOut', {
          display: 'none',
          duration: 400
        });
      });

      wxBtn.addEventListener('click', () => {
        window.Velocity(wx, 'transition.slideRightIn', {
          duration: 400
        });
        window.Velocity(zfb, 'transition.slideLeftOut', {
          display: 'none',
          duration: 400
        });
      });
    }

    rewardBtn.addEventListener('click', (e) => {
      window.Velocity(mask, 'transition.slideDownIn', {
        duration: 400
      })
    });

    close.addEventListener('click', (e) => {
      e.preventDefault();
      window.Velocity(mask, 'transition.slideUpOut', {
        duration: 400
      })
    })
  }()
</script>

  </div>
</body>

  <div class="search-mask" id="search_mask" style="display: none;">
  <div class="search-box">
    <div class="search-title">
      <i class="fa fa-search"></i>
      <div class="input-box">
        <input id="search" type="text" class="language" data-lan="search" placeholder="æœç´¢">
      </div>
      <i id="close" class="fa fa-times-circle"></i>
    </div>
    <div class="stat-box">
      <span id="stat_count">0</span><span class="language" data-lan="stat">æ¡ç›¸å…³æ¡ç›®ï¼Œä½¿ç”¨äº†</span><span id="stat_times">0</span><span class="language" data-lan="stat-time">æ¯«ç§’</span>
      <hr>
    </div>
    <div class="result" id="result">
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://zhangyaoo.github.io/post/ji-yu-netty-ji-shi-tong-xun-xi-tong-she-ji-yu-shi-xian/"" data-c="
          &lt;h2 id=&#34;fastim&#34;&gt;FastIM&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸš€åŸºäºNettyé«˜å¯ç”¨åˆ†å¸ƒå¼å³æ—¶é€šè®¯ç³»ç»Ÿï¼Œæ”¯æŒé•¿è¿æ¥ç½‘å…³ç®¡ç†ã€å•èŠã€ç¾¤èŠã€ç™»å½•ç™»å‡ºã€èŠå¤©è®°å½•æŸ¥è¯¢ã€ç¦»çº¿æ¶ˆæ¯å­˜å‚¨ã€æ¶ˆæ¯æ¨é€ã€å¿ƒè·³ã€åˆ†å¸ƒå¼å”¯ä¸€IDã€çº¢åŒ…ã€æ¶ˆæ¯åŒæ­¥å’Œæ¼«æ¸¸ç­‰åŠŸèƒ½ï¼Œæ”¯æŒé›†ç¾¤éƒ¨ç½²çš„åˆ†å¸ƒå¼æ¶æ„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;ä¸€-åŠŸèƒ½&#34;&gt;ä¸€ã€åŠŸèƒ½&lt;/h2&gt;
&lt;h3 id=&#34;1-è®¾è®¡&#34;&gt;1. è®¾è®¡&lt;/h3&gt;
&lt;ul class=&#34;contains-task-list&#34;&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-2961719&#34;&gt; &lt;a href=&#34;#%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1&#34;&gt;IMæ¶æ„è®¾è®¡&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-2961719&#34;&gt; [IMæ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)&lt;/label&gt;&lt;/li&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-1018164&#34;&gt; &lt;a href=&#34;#%E6%B6%88%E6%81%AFID%E7%94%9F%E6%88%90%E6%9C%BA%E5%88%B6&#34;&gt;åˆ†å¸ƒå¼IDè®¾è®¡&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-1018164&#34;&gt; [åˆ†å¸ƒå¼IDè®¾è®¡](#æ¶ˆæ¯IDç”Ÿæˆæœºåˆ¶)&lt;/label&gt;&lt;/li&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-8624631&#34;&gt; &lt;a href=&#34;#%E6%A0%B8%E5%BF%83%E8%A1%A8%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1&#34;&gt;IMè¡¨ç»“æ„è®¾è®¡&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-8624631&#34;&gt; [IMè¡¨ç»“æ„è®¾è®¡](#æ ¸å¿ƒè¡¨ç»“æ„è®¾è®¡)&lt;/label&gt;&lt;/li&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-4891272&#34;&gt;&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-4891272&#34;&gt; TCPç½‘å…³è®¾è®¡&lt;/label&gt;&lt;/li&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-5318263&#34;&gt;&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-5318263&#34;&gt; HTTPç½‘å…³è®¾è®¡&lt;/label&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;2-åŠŸèƒ½&#34;&gt;2. åŠŸèƒ½&lt;/h3&gt;
&lt;ul class=&#34;contains-task-list&#34;&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-2731915&#34;&gt;&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-2731915&#34;&gt; å•èŠ&lt;/label&gt;&lt;/li&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-1373941&#34;&gt;&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-1373941&#34;&gt; ç¾¤èŠ&lt;/label&gt;&lt;/li&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-8646244&#34;&gt;&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-8646244&#34;&gt; å¿ƒè·³ä¿æ´»ï¼Œæ–­çº¿è‡ªåŠ¨é‡è¿&lt;/label&gt;&lt;/li&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-1935693&#34;&gt; &lt;a href=&#34;#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%80%9A%E8%AE%AF%E5%8D%8F%E8%AE%AE+Protobuf%E5%BA%8F%E5%88%97%E5%8C%96&#34;&gt;è‡ªå®šä¹‰é€šè®¯åè®® + Protobufåºåˆ—åŒ–&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-1935693&#34;&gt; [è‡ªå®šä¹‰é€šè®¯åè®® + Protobufåºåˆ—åŒ–](#è‡ªå®šä¹‰é€šè®¯åè®®+Protobufåºåˆ—åŒ–)&lt;/label&gt;&lt;/li&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-1312619&#34;&gt; &lt;a href=&#34;#%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%9C%AAack%E6%B6%88%E6%81%AF%E9%87%8D%E8%AF%95&#34;&gt;å®¢æˆ·ç«¯æœªackæ¶ˆæ¯é‡è¯•&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-1312619&#34;&gt; [å®¢æˆ·ç«¯æœªackæ¶ˆæ¯é‡è¯•](#å®¢æˆ·ç«¯æœªackæ¶ˆæ¯é‡è¯•)&lt;/label&gt;&lt;/li&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-7127960&#34;&gt;&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-7127960&#34;&gt; æ¶ˆæ¯æœªè¯»è®¡æ•°&lt;/label&gt;&lt;/li&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-8522881&#34;&gt;&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-8522881&#34;&gt; èŠå¤©è®°å½•å­˜å‚¨å’ŒæŸ¥è¯¢&lt;/label&gt;&lt;/li&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-745469&#34;&gt;&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-745469&#34;&gt; ç™»å½•ã€ç™»å‡º&lt;/label&gt;&lt;/li&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-5882915&#34;&gt;&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-5882915&#34;&gt; é€šè®¯åè®®æ”¯æŒHTTP/2&lt;/label&gt;&lt;/li&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; checked=&#34;&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-13603&#34;&gt; &lt;a href=&#34;#%E5%AE%A2%E6%88%B7%E7%AB%AFSDK&#34;&gt;å®¢æˆ·ç«¯SDK&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-13603&#34;&gt; [å®¢æˆ·ç«¯SDK](#å®¢æˆ·ç«¯SDK)&lt;/label&gt;&lt;/li&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-3285230&#34;&gt;&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-3285230&#34;&gt; å¤šç«¯æ¶ˆæ¯åŒæ­¥å’Œæ¶ˆæ¯æ¼«æ¸¸&lt;/label&gt;&lt;/li&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-9870161&#34;&gt;&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-9870161&#34;&gt; å”¯ä¸€è®¾å¤‡è¸¢å‡º&lt;/label&gt;&lt;/li&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-7699860&#34;&gt;&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-7699860&#34;&gt; æ–‡ä»¶å›¾ç‰‡å‘é€&lt;/label&gt;&lt;/li&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-8897110&#34;&gt;&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-8897110&#34;&gt; æ¶ˆæ¯åŠ å¯†&lt;/label&gt;&lt;/li&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-2228880&#34;&gt;&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-2228880&#34;&gt; ç¾¤çº¢åŒ…&lt;/label&gt;&lt;/li&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-3425310&#34;&gt;&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-3425310&#34;&gt; æ¶ˆæ¯æ’¤å›&lt;/label&gt;&lt;/li&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-758566&#34;&gt;&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-758566&#34;&gt; æ¶ˆæ¯å·²è¯»&lt;/label&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;äºŒ-ç³»ç»Ÿè®¾è®¡&#34;&gt;äºŒã€ç³»ç»Ÿè®¾è®¡&lt;/h2&gt;
&lt;h3 id=&#34;1-imæ¶æ„å›¾&#34;&gt;1. IMæ¶æ„å›¾&lt;/h3&gt;
&lt;p&gt;åŸºäºå¯æ‰©å±•æ€§é«˜å¯ç”¨åŸåˆ™ï¼ŒæŠŠç½‘å…³å±‚ã€è·¯ç”±å±‚ã€é€»è¾‘å±‚ã€æ•°æ®å±‚åˆ†ç¦»ï¼Œå¹¶ä¸”æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²&lt;br&gt;
&lt;img src=&#34;https://github.com/zhangyaoo/fastim/blob/master/pic/architecture.png&#34; alt=&#34;IMæ¶æ„å›¾&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;2-æ¶æ„è®¾è®¡&#34;&gt;2. æ¶æ„è®¾è®¡&lt;/h3&gt;
&lt;h4 id=&#34;20-clientè®¾è®¡&#34;&gt;2.0 CLIENTè®¾è®¡ï¼š&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;clientæ¯ä¸ªè®¾å¤‡ä¼šåœ¨æœ¬åœ°å­˜æ¯ä¸€ä¸ªä¼šè¯ï¼Œä¿ç•™æœ‰æœ€æ–°ä¸€æ¡æ¶ˆæ¯çš„é¡ºåº ID&lt;/li&gt;
&lt;li&gt;ä¸ºäº†é¿å…clientå®•æœºï¼Œä¹Ÿå°±æ˜¯é€€å‡ºåº”ç”¨ï¼Œä¿å­˜åœ¨å†…å­˜çš„æ¶ˆæ¯IDä¸¢å¤±ï¼Œä¼šå­˜åˆ°æœ¬åœ°çš„æ–‡ä»¶ä¸­&lt;/li&gt;
&lt;li&gt;clientéœ€è¦åœ¨æœ¬åœ°ç»´æŠ¤ä¸€ä¸ªç­‰å¾…acké˜Ÿåˆ—ï¼Œå¹¶é…åˆtimerè¶…æ—¶æœºåˆ¶ï¼Œæ¥è®°å½•å“ªäº›æ¶ˆæ¯æ²¡æœ‰æ”¶åˆ°ackï¼šNï¼Œä»¥å®šæ—¶é‡å‘ã€‚&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯æœ¬åœ°ç”Ÿæˆä¸€ä¸ªé€’å¢åºåˆ—å·å‘é€ç»™æœåŠ¡å™¨ï¼Œç”¨ä½œä¿è¯å‘é€é¡ºåºæ€§ã€‚è¯¥åºåˆ—å·è¿˜ç”¨ä½œacké˜Ÿåˆ—æ”¶æ¶ˆæ¯æ—¶å€™çš„ç§»é™¤ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h5 id=&#34;21-å®¢æˆ·ç«¯åºåˆ—å·è®¾è®¡&#34;&gt;2.1 å®¢æˆ·ç«¯åºåˆ—å·è®¾è®¡&lt;/h5&gt;
&lt;h5 id=&#34;æ–¹æ¡ˆä¸€&#34;&gt;æ–¹æ¡ˆä¸€&lt;/h5&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://github.com/zhangyaoo/fastim/blob/master/pic/sequenceId.png&#34; alt=&#34;å®¢æˆ·ç«¯åºåˆ—å·&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;è®¾è®¡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ•°æ®ä¼ è¾“ä¸­çš„å¤§å°å°½é‡å°ç”¨intï¼Œä¸ç”¨bigintï¼ŒèŠ‚çœä¼ è¾“å¤§å°&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åªä¿è¯é€’å¢å³å¯,åœ¨ç”¨æˆ·é‡æ–°ç™»å½•æˆ–è€…é‡è¿åå¯ä»¥è¿›è¡Œæ—¥æœŸé‡ç½®ï¼Œåªä¿è¯å•æ¬¡&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®¢æˆ·ç«¯å‘å·å™¨ä¸éœ€è¦åƒç±»ä¼¼æœåŠ¡å™¨ç«¯å‘å·å™¨é‚£æ ·é›†ç¾¤éƒ¨ç½²ï¼Œä¸éœ€è¦è€ƒè™‘é›†ç¾¤åŒæ­¥é—®é¢˜&lt;br&gt;
è¯´æ˜ï¼šä¸Šè¿°ç”Ÿæˆå™¨å¯ä»¥ç”¨18å¹´[(2^29-1)/3600/24/365]å·¦å³ï¼Œä¸€ç§’å†…æœ€å¤šäº§ç”Ÿ4ä¸ªæ¶ˆæ¯&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¼˜ç‚¹ï¼šå¯ä»¥åœ¨æ–­çº¿é‡è¿å’Œé‡è£…APPçš„æƒ…å†µä¸‹ï¼Œ18å¹´ä¹‹å†…æ˜¯æœ‰åºçš„&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¼ºç‚¹ï¼šæ¯ç§’åªèƒ½å‘4ä¸ªæ¶ˆæ¯ï¼Œé™åˆ¶å¤ªå¤§ï¼Œå¯¹äºç¾¤å‘åœºæ™¯ä¸åˆé€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ”¹è¿›ï¼šä½¿ç”¨longè¿›è¡Œä¼ è¾“ï¼Œå¹´é™æ‰©å±•å¾ˆä¹…å¹¶ä¸”æœ‰åº&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;æ–¹æ¡ˆäºŒ&#34;&gt;æ–¹æ¡ˆäºŒ&lt;/h5&gt;
&lt;p&gt;è®¾è®¡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ¯æ¬¡é‡æ–°å»ºç«‹é“¾æ¥åè¿›è¡Œé‡ç½®ï¼Œå°†sequence_idï¼ˆintè¡¨ç¤ºï¼‰ä»0å¼€å§‹è¿›è¡Œä¸¥æ ¼é€’å¢&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ä¼šå¸¦ä¸Šå”¯ä¸€çš„é€’å¢sequence_idï¼ŒåŒä¸€æ¡æ¶ˆæ¯é‡å¤æŠ•é€’çš„sequence_idæ˜¯ä¸€æ ·çš„&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åç«¯å­˜å‚¨æ¯ä¸ªç”¨æˆ·çš„sequence_idï¼Œå½“sequence_idå½’0ï¼Œç”¨æˆ·çš„epochå¹´ä»£åŠ 1å­˜å‚¨å…¥åº“ï¼Œå•èŠåœºæ™¯ä¸‹è½¬å‘ç»™æ¥æ”¶è€…æ—¶å€™ï¼Œæ¥æ”¶è€…æŒ‰ç…§sequence_idå’Œepochæ¥è¿›è¡Œæ’åº&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¼˜ç‚¹ï¼šå¯ä»¥åœ¨æ–­çº¿é‡è¿å’Œé‡è£…APPçš„æƒ…å†µä¸‹ï¼Œæ¥æ”¶è€…å¯ä»¥æŒ‰ç…§å‘é€è€…å‘é€æ—¶åºæ¥æ˜¾ç¤ºï¼Œå¹¶ä¸”å¯¹å‘é€æ¶ˆæ¯çš„é€Ÿç‡æ²¡é™åˆ¶&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;21-lsbè®¾è®¡ä¸ä¼˜åŒ–&#34;&gt;2.1 LSBè®¾è®¡ä¸ä¼˜åŒ–ï¼š&lt;/h4&gt;
&lt;h5 id=&#34;210-lsbè®¾è®¡&#34;&gt;2.1.0 LSBè®¾è®¡&lt;/h5&gt;
&lt;ol&gt;
&lt;li&gt;æ¥å…¥å±‚çš„é«˜å¯ç”¨ã€è´Ÿè½½å‡è¡¡ã€æ‰©å±•æ€§å…¨éƒ¨åœ¨è¿™é‡Œé¢åš&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯é€šè¿‡LSBï¼Œæ¥è·å–gate IPåœ°å€ï¼Œé€šè¿‡IPç›´è¿ï¼Œç›®çš„æ˜¯
&lt;ul&gt;
&lt;li&gt;çµæ´»çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ å¯æ ¹æ®æœ€å°‘è¿æ¥æ•°æ¥åˆ†é…IP&lt;/li&gt;
&lt;li&gt;åšç°åº¦ç­–ç•¥æ¥åˆ†é…IP&lt;/li&gt;
&lt;li&gt;AppIdä¸šåŠ¡éš”ç¦»ç­–ç•¥ ä¸åŒä¸šåŠ¡è¿æ¥ä¸åŒçš„gateï¼Œé˜²æ­¢ç›¸äº’å½±å“&lt;/li&gt;
&lt;li&gt;å•èŠå’Œç¾¤èŠçš„imæ¥å…¥å±‚é€šé“åˆ†å¼€&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h5 id=&#34;211-lsbä¼˜åŒ–&#34;&gt;2.1.1 LSBä¼˜åŒ–&lt;/h5&gt;
&lt;p&gt;é—®é¢˜èƒŒæ™¯ï¼šå½“æŸä¸ªå®ä¾‹é‡å¯åï¼Œè¯¥å®ä¾‹çš„è¿æ¥æ–­å¼€åï¼Œå®¢æˆ·ç«¯ä¼šå‘èµ·é‡è¿ï¼Œé‡è¿å°±å¤§æ¦‚ç‡è½¬ç§»å…¶ä»–å®ä¾‹ä¸Šï¼Œå¯¼è‡´æœ€è¿‘å¯åŠ¨çš„å®ä¾‹è¿æ¥æ•°è¾ƒå°‘ï¼Œæœ€æ—©å¯åŠ¨çš„å®ä¾‹è¿æ¥æ•°è¾ƒå¤š&lt;br&gt;
è§£å†³æ–¹æ³•ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å®¢æˆ·ç«¯ä¼šå‘èµ·é‡è¿ï¼Œè·ŸæœåŠ¡å™¨ç”³è¯·é‡è¿çš„æ–°çš„æœåŠ¡å™¨IPï¼Œç³»ç»Ÿæä¾›åˆé€‚çš„ç®—æ³•æ¥å¹³æ‘Šgateå±‚çš„å‹åŠ›ï¼Œé˜²æ­¢é›ªå´©æ•ˆåº”ã€‚&lt;/li&gt;
&lt;li&gt;gateå±‚å®šæ—¶ä¸ŠæŠ¥æœ¬æœºçš„å…ƒæ•°æ®ä¿¡æ¯ä»¥åŠè¿æ¥æ•°ä¿¡æ¯ï¼Œæä¾›ç»™LSBä¸­å¿ƒï¼ŒLSBæ ¹æ®æœ€å°‘è¿æ¥æ•°è´Ÿè½½å‡è¡¡å®ç°ï¼Œæ¥è®¡ç®—ä¸€ä¸ªèŠ‚ç‚¹ä¾›è¿æ¥ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;22-gateè®¾è®¡&#34;&gt;2.2 GATEè®¾è®¡ï¼š&lt;/h4&gt;
&lt;p&gt;GATEå±‚ç½‘å…³æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä»»ä½•ä¸€ä¸ªgateç½‘å…³æ–­æ‰ï¼Œç”¨æˆ·ç«¯æ£€æµ‹åˆ°ä»¥åé‡æ–°è¿æ¥LSBæœåŠ¡è·å–å¦ä¸€ä¸ªgateç½‘å…³IPï¼Œæ‹¿åˆ°IPé‡æ–°è¿›è¡Œé•¿è¿æ¥é€šä¿¡ã€‚å¯¹æ•´ä½“æœåŠ¡å¯é æ€§åŸºæœ¬æ²¡æœ‰å½±å“ã€‚&lt;/li&gt;
&lt;li&gt;gateå¯ä»¥æ— çŠ¶æ€çš„æ¨ªå‘éƒ¨ç½²ï¼Œæ¥æ‰©å±•æ¥å…¥å±‚çš„æ¥å…¥èƒ½åŠ›&lt;/li&gt;
&lt;li&gt;æ ¹æ®åè®®åˆ†ç±»å°†å…¥å£è¯·æ±‚æ‰“åˆ°ä¸åŒçš„ç½‘å…³ä¸Šå»ï¼ŒHTTPç½‘å…³æ¥æ”¶HTTPè¯·æ±‚ï¼ŒTCPç½‘å…³æ¥æ”¶tcpé•¿è¿æ¥è¯·æ±‚&lt;/li&gt;
&lt;li&gt;é•¿è¿æ¥ç½‘å…³ï¼Œæä¾›å„ç§ç›‘æ§åŠŸèƒ½ï¼Œæ¯”å¦‚ç½‘å…³æ‰§è¡Œçº¿ç¨‹æ•°ã€é˜Ÿåˆ—ä»»åŠ¡æ•°ã€ByteBufä½¿ç”¨å †å†…å­˜æ•°ã€å †å¤–å†…å­˜æ•°ã€æ¶ˆæ¯ä¸Šè¡Œå’Œä¸‹è¡Œçš„æ•°é‡ä»¥åŠæ—¶é—´&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;23-routerè®¾è®¡&#34;&gt;2.3 ROUTERè®¾è®¡ï¼š&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;æŠŠç”¨æˆ·çŠ¶æ€ä¿¡æ¯å­˜å‚¨åœ¨Redisé›†ç¾¤é‡Œã€‚å› æ­¤ä¹Ÿæ˜¯æ— çŠ¶æ€çš„ï¼Œä»»ä½•ä¸€ä¸ªrouteræœåŠ¡æŒ‚æ‰ï¼Œä¸å½±å“æ•´ä½“æœåŠ¡èƒ½åŠ›ã€‚&lt;/li&gt;
&lt;li&gt;è½¬å‘æ¶ˆæ¯ï¼Œå°†æ¶ˆæ¯æŠ•é€’ç»™å›ºå®šgateä¸Šçš„ä¼šè¯ï¼Œå¤„ç†è·¯ç”±é€»è¾‘&lt;/li&gt;
&lt;li&gt;routerå±‚éœ€è¦å­˜å‚¨çš„å…³ç³»
&lt;ul&gt;
&lt;li&gt;uidå’Œgateå±‚æœºå™¨IDå…³ç³»&lt;/li&gt;
&lt;li&gt;ç”¨æˆ·å…¨å±€åœ¨çº¿ä¿¡æ¯&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç”¨æˆ·è·¯ç”±çŠ¶æ€ä¸€è‡´æ€§ä¿è¯
&lt;ul&gt;
&lt;li&gt;å¦‚æœè·¯ç”±çŠ¶æ€å’Œchannelé€šé“ä¸ä¸€è‡´ï¼Œæ¯”å¦‚æœ‰è·¯ç”±çŠ¶æ€ï¼Œæ²¡æœ‰channelé€šé“ï¼ˆå·²å…³é—­ï¼‰é‚£ä¹ˆï¼Œå°±ä¼šèµ°ç¦»çº¿æ¶ˆæ¯æµå‡ºï¼Œå¹¶ä¸”æ¸…é™¤è·¯ç”±ä¿¡æ¯&lt;/li&gt;
&lt;li&gt;åŠ¨æ€é‡å¯gateï¼Œä¼šåŠæ—¶æ¸…ç†è·¯ç”±ä¿¡æ¯&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;24-logicè®¾è®¡&#34;&gt;2.4 LOGICè®¾è®¡ï¼š&lt;/h4&gt;
&lt;p&gt;logicæŒ‰ç…§åˆ†å¸ƒå¼å¾®æœåŠ¡çš„æ‹†åˆ†æ€æƒ³è¿›è¡Œæ‹†åˆ†ï¼Œæ‹†åˆ†ä¸ºå¤šä¸ªæ¨¡å—&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å•èŠæœåŠ¡&lt;/li&gt;
&lt;li&gt;ç¾¤èŠæœåŠ¡&lt;/li&gt;
&lt;li&gt;ç™»å½• ç™»å‡º æ³¨å†ŒæœåŠ¡&lt;/li&gt;
&lt;li&gt;çº¢åŒ…æœåŠ¡&lt;/li&gt;
&lt;li&gt;åˆ†å¸ƒå¼IDæœåŠ¡&lt;/li&gt;
&lt;li&gt;ç¦»çº¿æœåŠ¡&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;25-das-data-access-serviceè®¾è®¡&#34;&gt;2.5 DAS (data access service)è®¾è®¡ï¼š&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;å®šæ—¶å°†å†·æ•°æ®è¿ç§»åˆ°Coldå­˜å‚¨ç³»ç»Ÿ&lt;/li&gt;
&lt;li&gt;å¤šä¸ªå­˜å‚¨ç³»ç»Ÿçš„å®ç°ï¼Œç»Ÿä¸€cacheå±‚&lt;/li&gt;
&lt;li&gt;å‘ä¸Šæ¸¸å±è”½å­˜å‚¨å¼•æ“ï¼Œæä¾›å‹å¥½çš„æ¥å£&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;3-åè®®è®¾è®¡&#34;&gt;3. åè®®è®¾è®¡&lt;/h3&gt;
&lt;h4 id=&#34;30-ç›®æ ‡&#34;&gt;3.0 ç›®æ ‡&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;é«˜æ€§èƒ½ï¼šåè®®è®¾è®¡ç´§å‡‘ï¼Œä¿è¯æ•°æ®åŒ…å°ï¼Œå¹¶ä¸”åºåˆ—åŒ–æ€§èƒ½å¥½&lt;/li&gt;
&lt;li&gt;å¯æ‰©å±•æ€§ï¼šé’ˆå¯¹åç»­ä¸šåŠ¡å‘å±•ï¼Œå¯ä»¥è‡ªç”±çš„è‡ªå®šä¹‰åè®®ï¼Œæ— éœ€è¾ƒå¤§æ”¹åŠ¨åè®®ç»“æ„&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;31-è®¾è®¡&#34;&gt;3.1 è®¾è®¡&lt;/h4&gt;
&lt;p&gt;IMåè®®é‡‡ç”¨äºŒè¿›åˆ¶å®šé•¿åŒ…å¤´å’Œå˜é•¿åŒ…ä½“æ¥å®ç°å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„é€šä¿¡ï¼Œå¹¶ä¸”é‡‡ç”¨è°·æ­Œprotobufåºåˆ—åŒ–åè®®ï¼Œè®¾è®¡å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://github.com/zhangyaoo/fastim/blob/master/pic/IM-protocol.png&#34; alt=&#34;IMåè®®è®¾è®¡å›¾&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;å„ä¸ªå­—æ®µå¦‚ä¸‹è§£é‡Šï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;headDataï¼šå¤´éƒ¨æ ‡è¯†ï¼Œåè®®å¤´æ ‡è¯†ï¼Œç”¨ä½œç²˜åŒ…åŠåŒ…å¤„ç†ã€‚4ä¸ªå­—èŠ‚&lt;/li&gt;
&lt;li&gt;versionï¼šå®¢æˆ·ç«¯ç‰ˆæœ¬ã€‚4ä¸ªå­—èŠ‚&lt;/li&gt;
&lt;li&gt;cmdï¼šä¸šåŠ¡å‘½ä»¤ï¼Œæ¯”å¦‚å¿ƒè·³ã€æ¨é€ã€å•èŠã€ç¾¤èŠã€‚1ä¸ªå­—èŠ‚&lt;/li&gt;
&lt;li&gt;msgTypeï¼šæ¶ˆæ¯é€šçŸ¥ç±»å‹ request response notifyã€‚1ä¸ªå­—èŠ‚&lt;/li&gt;
&lt;li&gt;logIdï¼šè°ƒè¯•æ€§æ—¥å¿—ï¼Œè¿½æº¯ä¸€ä¸ªè¯·æ±‚çš„å…¨è·¯å¾„ã€‚4ä¸ªå­—èŠ‚&lt;/li&gt;
&lt;li&gt;sequenceIdï¼šåºåˆ—å·ï¼Œå¯ä»¥ç”¨ä½œå¼‚æ­¥å¤„ç†ã€‚4ä¸ªå­—èŠ‚&lt;/li&gt;
&lt;li&gt;dataLengthï¼šæ•°æ®ä½“çš„é•¿åº¦ã€‚4ä¸ªå­—èŠ‚&lt;/li&gt;
&lt;li&gt;dataï¼šæ•°æ®&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;32-å®è·µ&#34;&gt;3.2 å®è·µ&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;é’ˆå¯¹æ•°æ®dataï¼Œ&lt;strong&gt;ç½‘å…³gateå±‚ä¸åšååºåˆ—åŒ–ï¼Œååºåˆ—åŒ–æ­¥éª¤åœ¨serviceåš&lt;/strong&gt;ï¼Œé¿å…é‡å¤åºåˆ—åŒ–å’Œååºåˆ—åŒ–å¯¼è‡´çš„æ€§èƒ½æŸå¤±&lt;/li&gt;
&lt;li&gt;ç½‘å…³å±‚ä¸åšä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œåªåšæ¶ˆæ¯è½¬å‘å’Œæ¨é€ï¼Œå‡å°‘ç½‘å…³å±‚çš„å¤æ‚åº¦&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;4-å®‰å…¨ç®¡ç†&#34;&gt;4. å®‰å…¨ç®¡ç†&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;ä¸ºé˜²æ­¢æ¶ˆæ¯ä¼ è¾“è¿‡ç¨‹ä¸­ä¸è¢«æˆªè·ã€ç¯¡æ”¹ã€ä¼ªé€ ï¼Œé‡‡ç”¨TLSä¼ è¾“å±‚åŠ å¯†åè®®&lt;/li&gt;
&lt;li&gt;ç§æœ‰åŒ–åè®®å¤©ç„¶å…·å¤‡ä¸€å®šçš„é˜²çªƒå–å’Œé˜²ç¯¡æ”¹çš„èƒ½åŠ›ï¼Œç›¸å¯¹äºä½¿ç”¨JSONã€XMLã€HTMLç­‰æ˜æ–‡ä¼ è¾“ç³»ç»Ÿï¼Œè¢«ç¬¬ä¸‰æ–¹æˆªè·ååœ¨å†…å®¹ç ´è§£ä¸Šç›¸å¯¹æˆæœ¬æ›´é«˜ï¼Œå› æ­¤å®‰å…¨æ€§ä¸Šä¼šæ›´å¥½ä¸€äº›&lt;/li&gt;
&lt;li&gt;æ¶ˆæ¯å­˜å‚¨å®‰å…¨æ€§:é’ˆå¯¹è´¦å·å¯†ç çš„å­˜å‚¨å®‰å…¨å¯ä»¥é€šè¿‡â€œé«˜å¼ºåº¦å•å‘æ•£åˆ—ç®—æ³•â€å’Œâ€œåŠ ç›â€æœºåˆ¶æ¥æå‡åŠ å¯†å¯†ç å¯é€†æ€§ï¼›IMæ¶ˆæ¯é‡‡ç”¨â€œç«¯åˆ°ç«¯åŠ å¯†â€æ–¹å¼æ¥æä¾›æ›´åŠ å®‰å…¨çš„æ¶ˆæ¯ä¼ è¾“ä¿æŠ¤ã€‚&lt;/li&gt;
&lt;li&gt;å®‰å…¨å±‚åè®®è®¾è®¡ã€‚åŸºäºåŠ¨æ€å¯†é’¥ï¼Œå€Ÿé‰´ç±»ä¼¼SSLï¼Œä¸éœ€è¦ç”¨è¯ä¹¦æ¥ç®¡ç†ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;5-æ¶ˆæ¯æµè½¬è®¾è®¡&#34;&gt;5. æ¶ˆæ¯æµè½¬è®¾è®¡&lt;/h3&gt;
&lt;p&gt;ä¸€ä¸ªæ­£å¸¸çš„æ¶ˆæ¯æµè½¬éœ€è¦å¦‚å›¾æ‰€ç¤ºçš„æµç¨‹ï¼š&lt;br&gt;
&lt;img src=&#34;https://github.com/zhangyaoo/fastim/blob/master/pic/IM-pic1.png&#34; alt=&#34;IMæ ¸å¿ƒæµç¨‹å›¾&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å®¢æˆ·ç«¯Aå‘é€è¯·æ±‚åŒ…R&lt;/li&gt;
&lt;li&gt;serverå°†æ¶ˆæ¯å­˜å‚¨åˆ°DB&lt;/li&gt;
&lt;li&gt;å­˜å‚¨æˆåŠŸåè¿”å›ç¡®è®¤ack&lt;/li&gt;
&lt;li&gt;server pushæ¶ˆæ¯ç»™å®¢æˆ·ç«¯B&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯Bæ”¶åˆ°æ¶ˆæ¯åè¿”å›ç¡®è®¤ack&lt;/li&gt;
&lt;li&gt;serveræ”¶åˆ°ackåæ›´æ–°æ¶ˆæ¯çš„çŠ¶æ€æˆ–è€…åˆ é™¤æ¶ˆæ¯&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;éœ€è¦è€ƒè™‘çš„æ˜¯ï¼Œä¸€ä¸ªå¥å£®çš„ç³»ç»Ÿéœ€è¦è€ƒè™‘å„ç§å¼‚å¸¸æƒ…å†µï¼Œå¦‚ä¸¢æ¶ˆæ¯ï¼Œé‡å¤æ¶ˆæ¯ï¼Œæ¶ˆæ¯æ—¶åºé—®é¢˜&lt;/p&gt;
&lt;h4 id=&#34;50-æ¶ˆæ¯å¯é æ€§å¦‚ä½•ä¿è¯-ä¸ä¸¢æ¶ˆæ¯&#34;&gt;5.0 æ¶ˆæ¯å¯é æ€§å¦‚ä½•ä¿è¯ ä¸ä¸¢æ¶ˆæ¯&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;åº”ç”¨å±‚ACK&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯éœ€è¦è¶…æ—¶ä¸é‡ä¼ &lt;/li&gt;
&lt;li&gt;æœåŠ¡ç«¯éœ€è¦è¶…æ—¶ä¸é‡ä¼ ï¼Œå…·ä½“åšæ³•å°±æ˜¯å¢åŠ acké˜Ÿåˆ—å’Œå®šæ—¶å™¨Timer&lt;/li&gt;
&lt;li&gt;ä¸šåŠ¡ä¾§å…œåº•ä¿è¯ï¼Œå®¢æˆ·ç«¯æ‹‰æ¶ˆæ¯é€šè¿‡ä¸€ä¸ªæœ¬åœ°çš„æ—§çš„åºåˆ—å·æ¥æ‹‰å–æœåŠ¡å™¨çš„æœ€æ–°æ¶ˆæ¯&lt;/li&gt;
&lt;li&gt;ä¸ºäº†ä¿è¯æ¶ˆæ¯å¿…è¾¾ï¼Œåœ¨çº¿å®¢æˆ·ç«¯è¿˜å¢åŠ ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå®šæ—¶å‘æœåŠ¡ç«¯æ‹‰å–æ¶ˆæ¯ï¼Œé¿å…æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€æ‹‰å–é€šçŸ¥çš„åŒ…ä¸¢å¤±å¯¼è‡´å®¢æˆ·ç«¯æœªåŠæ—¶æ‹‰å–æ•°æ®ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;51-æ¶ˆæ¯é‡å¤æ€§å¦‚ä½•ä¿è¯-ä¸é‡å¤&#34;&gt;5.1 æ¶ˆæ¯é‡å¤æ€§å¦‚ä½•ä¿è¯ ä¸é‡å¤&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;è¶…æ—¶ä¸é‡ä¼ æœºåˆ¶å°†å¯¼è‡´æ¥æ”¶çš„clientæ”¶åˆ°é‡å¤çš„æ¶ˆæ¯ï¼Œå…·ä½“åšæ³•å°±æ˜¯ä¸€ä»½æ¶ˆæ¯ä½¿ç”¨åŒä¸€ä¸ªæ¶ˆæ¯IDè¿›è¡Œå»é‡å¤„ç†ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;52-æ¶ˆæ¯é¡ºåºæ€§å¦‚ä½•ä¿è¯-ä¸ä¹±åº&#34;&gt;5.2 æ¶ˆæ¯é¡ºåºæ€§å¦‚ä½•ä¿è¯ ä¸ä¹±åº&lt;/h4&gt;
&lt;h5 id=&#34;520-æ¶ˆæ¯ä¹±åºå½±å“çš„å› ç´ &#34;&gt;5.2.0 æ¶ˆæ¯ä¹±åºå½±å“çš„å› ç´ &lt;/h5&gt;
&lt;ol&gt;
&lt;li&gt;æ—¶é’Ÿä¸ä¸€è‡´ï¼Œåˆ†å¸ƒå¼ç¯å¢ƒä¸‹æ¯ä¸ªæœºå™¨çš„æ—¶é—´å¯èƒ½æ˜¯ä¸ä¸€è‡´çš„&lt;/li&gt;
&lt;li&gt;å¤šå‘é€æ–¹å’Œå¤šæ¥æ”¶æ–¹ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œæ— æ³•ä¿å…ˆå‘çš„æ¶ˆæ¯è¢«å…ˆæ”¶åˆ°&lt;/li&gt;
&lt;li&gt;ç½‘ç»œä¼ è¾“å’Œå¤šçº¿ç¨‹ï¼Œç½‘ç»œä¼ è¾“ä¸ç¨³å®šçš„è¯å¯èƒ½å¯¼è‡´åŒ…åœ¨æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­æœ‰çš„æ…¢æœ‰çš„å¿«ã€‚å¤šçº¿ç¨‹ä¹Ÿå¯èƒ½æ˜¯ä¼šå¯¼è‡´æ—¶åºä¸ä¸€è‡´å½±å“çš„å› ç´ &lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä»¥ä¸Šï¼Œå¦‚æœä¿æŒç»å¯¹çš„å®ç°ï¼Œé‚£ä¹ˆåªèƒ½æ˜¯ä¸€ä¸ªå‘é€æ–¹ï¼Œä¸€ä¸ªæ¥æ”¶æ–¹ï¼Œä¸€ä¸ªçº¿ç¨‹é˜»å¡å¼é€šè®¯æ¥å®ç°ã€‚é‚£ä¹ˆæ€§èƒ½ä¼šé™ä½ã€‚&lt;/p&gt;
&lt;h5 id=&#34;521-å¦‚ä½•ä¿è¯æ—¶åº&#34;&gt;5.2.1 å¦‚ä½•ä¿è¯æ—¶åº&lt;/h5&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å•èŠï¼šé€šè¿‡å‘é€æ–¹çš„ç»å¯¹æ—¶åºseqï¼Œæ¥ä½œä¸ºæ¥æ”¶æ–¹çš„å±•ç°æ—¶åºseqã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®ç°æ–¹å¼ï¼šå¯ä»¥é€šè¿‡æ—¶é—´æˆ³æˆ–è€…æœ¬åœ°åºåˆ—å·æ–¹å¼æ¥å®ç°&lt;/li&gt;
&lt;li&gt;ç¼ºç‚¹ï¼šæœ¬åœ°æ—¶é—´æˆ³ä¸å‡†ç¡®æˆ–è€…æœ¬åœ°åºåˆ—å·åœ¨æ„å¤–æƒ…å†µä¸‹å¯èƒ½ä¼šæ¸…0ï¼Œéƒ½ä¼šå¯¼è‡´å‘é€æ–¹çš„ç»å¯¹æ—¶åºä¸å‡†ç¡®&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¾¤èŠï¼šå› ä¸ºå‘é€æ–¹å¤šç‚¹å‘é€æ—¶åºä¸ä¸€è‡´ï¼Œæ‰€ä»¥é€šè¿‡æœåŠ¡å™¨çš„å•ç‚¹åšåºåˆ—åŒ–ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡IDé€’å¢å‘å·å™¨æœåŠ¡æ¥ç”Ÿæˆseqï¼Œæ¥æ”¶æ–¹é€šè¿‡seqæ¥è¿›è¡Œå±•ç°æ—¶åºã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®ç°æ–¹å¼ï¼šé€šè¿‡æœåŠ¡ç«¯ç»Ÿä¸€ç”Ÿæˆå”¯ä¸€è¶‹åŠ¿é€’å¢æ¶ˆæ¯IDæ¥å®ç°æˆ–è€…é€šè¿‡redisçš„é€’å¢incræ¥å®ç°&lt;/li&gt;
&lt;li&gt;ç¼ºç‚¹ï¼šredisçš„é€’å¢incræ¥å®ç°ï¼Œrediså–å·éƒ½æ˜¯ä»ä¸»å–çš„ï¼Œä¼šæœ‰æ€§èƒ½ç“¶é¢ˆã€‚IDé€’å¢å‘å·å™¨æœåŠ¡æ˜¯é›†ç¾¤éƒ¨ç½²ï¼Œå¯èƒ½ä¸åŒå‘å·æœåŠ¡ä¸Šçš„é›†ç¾¤æ—¶é—´æˆ³ä¸åŒï¼Œå¯èƒ½ä¼šå¯¼è‡´ååˆ°çš„æ¶ˆæ¯seqè¿˜å°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¾¤èŠæ—¶åºçš„ä¼˜åŒ–ï¼šæŒ‰ç…§ä¸Šé¢çš„ç¾¤èŠå¤„ç†ï¼Œä¸šåŠ¡ä¸ŠæŒ‰ç…§é“ç†åªéœ€è¦ä¿è¯å•ä¸ªç¾¤çš„æ—¶åºï¼Œä¸éœ€è¦ä¿è¯æ‰€æœ‰ç¾¤çš„ç»å¯¹æ—¶åºï¼Œæ‰€ä»¥è§£å†³æ€è·¯å°±æ˜¯&lt;strong&gt;åŒä¸€ä¸ªç¾¤çš„æ¶ˆæ¯è½åˆ°åŒä¸€ä¸ªå‘å·service&lt;/strong&gt;ä¸Šé¢ï¼Œæ¶ˆæ¯seqé€šè¿‡serviceæœ¬åœ°ç”Ÿæˆå³å¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h5 id=&#34;522-å®¢æˆ·ç«¯å¦‚ä½•ä¿è¯é¡ºåº&#34;&gt;5.2.2 å®¢æˆ·ç«¯å¦‚ä½•ä¿è¯é¡ºåº&lt;/h5&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆè¦ä¿è¯é¡ºåºï¼Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¶ˆæ¯å³ä½¿æŒ‰ç…§é¡ºåºåˆ°è¾¾æœåŠ¡å™¨ç«¯ï¼Œä¹Ÿä¼šå¯èƒ½å‡ºç°ï¼šä¸åŒæ¶ˆæ¯åˆ°è¾¾æ¥æ”¶ç«¯åï¼Œå¯èƒ½ä¼šå‡ºç°â€œå…ˆäº§ç”Ÿçš„æ¶ˆæ¯ååˆ°â€â€œåäº§ç”Ÿçš„æ¶ˆæ¯å…ˆåˆ°â€ç­‰é—®é¢˜ã€‚æ‰€ä»¥å®¢æˆ·ç«¯éœ€è¦è¿›è¡Œå…œåº•çš„æµé‡æ•´å½¢æœºåˆ¶&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚ä½•ä¿è¯é¡ºåºï¼Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¥æ”¶æ–¹æ”¶åˆ°æ¶ˆæ¯åè¿›è¡Œåˆ¤å®šï¼Œå¦‚æœå½“å‰æ¶ˆæ¯åºå·å¤§äºå‰ä¸€æ¡æ¶ˆæ¯çš„åºå·å°±å°†å½“å‰æ¶ˆæ¯è¿½åŠ åœ¨ä¼šè¯é‡Œ&lt;/li&gt;
&lt;li&gt;å¦åˆ™ç»§ç»­å¾€å‰æŸ¥æ‰¾å€’æ•°ç¬¬äºŒæ¡ã€ç¬¬ä¸‰æ¡ç­‰æ¶ˆæ¯ï¼Œä¸€ç›´æŸ¥æ‰¾åˆ°æ°å¥½å°äºå½“å‰æ¨é€æ¶ˆæ¯çš„é‚£æ¡æ¶ˆæ¯ï¼Œç„¶åæ’å…¥åœ¨å…¶åå±•ç¤ºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;6-æ¶ˆæ¯é€šçŸ¥è®¾è®¡&#34;&gt;6 æ¶ˆæ¯é€šçŸ¥è®¾è®¡&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;æ•´ä½“æ¶ˆæ¯æ¨é€å’Œæ‹‰å–çš„æ—¶åºå›¾å¦‚ä¸‹ï¼š&lt;/strong&gt;&lt;br&gt;
&lt;img src=&#34;https://github.com/zhangyaoo/fastim/blob/master/pic/msg-pull-push-model.png&#34; alt=&#34;IMæ¶ˆæ¯æ¨æ‹‰æ¨¡å‹&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;60-æ¶ˆæ¯æ‹‰å–æ–¹å¼çš„é€‰æ‹©&#34;&gt;6.0 æ¶ˆæ¯æ‹‰å–æ–¹å¼çš„é€‰æ‹©&lt;/h4&gt;
&lt;p&gt;æœ¬é¡¹ç›®æ˜¯è¿›è¡Œæ¨æ‹‰ç»“åˆæ¥è¿›è¡ŒæœåŠ¡å™¨ç«¯æ¶ˆæ¯çš„æ¨é€å’Œå®¢æˆ·ç«¯çš„æ‹‰å–ï¼Œæˆ‘ä»¬çŸ¥é“å•pullå’Œå•pushæœ‰ä»¥ä¸‹ç¼ºç‚¹ï¼š&lt;/p&gt;
&lt;p&gt;å•pullï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;pullè¦è€ƒè™‘åˆ°æ¶ˆæ¯çš„å®æ—¶æ€§ï¼Œä¸çŸ¥é“æ¶ˆæ¯ä½•æ—¶é€è¾¾&lt;/li&gt;
&lt;li&gt;pullè¦è€ƒè™‘åˆ°å“ªäº›å¥½å‹å’Œç¾¤æ”¶åˆ°äº†æ¶ˆæ¯ï¼Œè¦å¾ªç¯æ¯ä¸ªç¾¤å’Œå¥½å‹æ‹¿åˆ°æ¶ˆæ¯åˆ—è¡¨ï¼Œè¯»æ‰©æ•£&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å•pushï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;pushå®æ—¶æ€§é«˜ï¼Œåªè¦å°†æ¶ˆæ¯æ¨é€ç»™æ¥æ”¶è€…å°±okï¼Œä½†æ˜¯ä¼šé›†ä¸­æ¶ˆè€—æœåŠ¡å™¨èµ„æºã€‚å¹¶ä¸”å†ç¾¤èŠéå¸¸å¤šï¼ŒèŠå¤©é¢‘ç‡éå¸¸é«˜çš„æƒ…å†µä¸‹ï¼Œä¼šå¢åŠ å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„ç½‘ç»œäº¤äº’æ¬¡æ•°&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¨æ‹‰ç»“åˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¨æ‹‰ç»“åˆçš„æ–¹å¼èƒ½å¤Ÿåˆ†æ‘ŠæœåŠ¡ç«¯çš„å‹åŠ›,èƒ½ä¿è¯æ—¶æ•ˆæ€§ï¼Œåˆèƒ½ä¿è¯æ€§èƒ½&lt;/li&gt;
&lt;li&gt;å…·ä½“åšæ³•å°±æ˜¯æœ‰æ–°æ¶ˆæ¯æ—¶å€™ï¼Œæ¨é€å“ªä¸ªå¥½å‹æˆ–è€…å“ªä¸ªç¾¤æœ‰æ–°æ¶ˆæ¯ï¼Œä»¥åŠæ–°æ¶ˆæ¯çš„æ•°é‡æˆ–è€…æœ€æ–°æ¶ˆæ¯IDï¼Œå®¢æˆ·ç«¯æŒ‰éœ€æ ¹æ®è‡ªèº«æ•°æ®è¿›è¡Œæ‹‰å–&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;61-æ¨æ‹‰éš”ç¦»è®¾è®¡&#34;&gt;6.1 æ¨æ‹‰éš”ç¦»è®¾è®¡&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;ä¸ºä»€ä¹ˆåšéš”ç¦»
&lt;ul&gt;
&lt;li&gt;å¦‚æœå®¢æˆ·ç«¯ä¸€è¾¹æ­£åœ¨æ‹‰å–æ•°æ®ï¼Œä¸€è¾¹æœ‰æ–°çš„å¢é‡æ¶ˆæ¯pushè¿‡æ¥&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¦‚ä½•åšéš”ç¦»
&lt;ul&gt;
&lt;li&gt;æœ¬åœ°è®¾ç½®ä¸€ä¸ªå…¨å±€çš„çŠ¶æ€ï¼Œå½“å®¢æˆ·ç«¯æ‹‰å–å®Œç¦»çº¿æ¶ˆæ¯åè®¾ç½®çŠ¶æ€ä¸º1ï¼ˆè¡¨ç¤ºç¦»çº¿æ¶ˆæ¯æ‹‰å–å®Œæ¯•ï¼‰ã€‚å½“å®¢æˆ·ç«¯æ”¶åˆ°æ‹‰å–å®æ—¶æ¶ˆæ¯ï¼Œä¼šå¯ç”¨ä¸€ä¸ªè½®è¯¢ç›‘å¬è¿™ä¸ªçŠ¶æ€ï¼ŒçŠ¶æ€ä¸º1åï¼Œå†å»å‘æœåŠ¡å™¨æ‹‰å–æ¶ˆæ¯ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæ˜¯pushæ¶ˆæ¯è¿‡æ¥ï¼ˆä¸æ˜¯ä¸»åŠ¨æ‹‰å–ï¼‰ï¼Œé‚£ä¹ˆä¼šå…ˆå°†æ¶ˆæ¯å­˜å‚¨åˆ°æœ¬åœ°çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…å®¢æˆ·ç«¯ä¸Šä¸€æ¬¡æ‹‰å–æ•°æ®å®Œæ¯•ï¼Œç„¶åå°†æ•°æ®è¿›è¡Œåˆå¹¶å³å¯&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;7-æ¶ˆæ¯idç”Ÿæˆè®¾è®¡&#34;&gt;7 æ¶ˆæ¯IDç”Ÿæˆè®¾è®¡&lt;/h3&gt;
&lt;h5 id=&#34;70-è®¾è®¡&#34;&gt;7.0 è®¾è®¡&lt;/h5&gt;
&lt;p&gt;å®é™…ä¸šåŠ¡çš„æƒ…å†µã€åªåšå‚è€ƒï¼Œå®é™…å¯ä»¥æ ¹æ®å…¬å¸ä¸šåŠ¡çº¿æ¥è°ƒæ•´ã€‘&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å•æœºé«˜å³°å¹¶å‘é‡å°äº1Wï¼Œé¢„è®¡æœªæ¥5å¹´å•æœºé«˜å³°å¹¶å‘é‡å°äº10W&lt;/li&gt;
&lt;li&gt;æœ‰2ä¸ªæœºæˆ¿ï¼Œé¢„è®¡æœªæ¥5å¹´æœºæˆ¿æ•°é‡å°äº4ä¸ª æ¯ä¸ªæœºæˆ¿æœºå™¨æ•°å°äº150å°&lt;/li&gt;
&lt;li&gt;ç›®å‰åªæœ‰å•èŠå’Œç¾¤èŠä¸¤ä¸ªä¸šåŠ¡çº¿ï¼Œåç»­å¯ä»¥æ‰©å±•ä¸ºç³»ç»Ÿæ¶ˆæ¯ã€èŠå¤©å®¤ã€å®¢æœç­‰ä¸šåŠ¡çº¿ï¼Œæœ€å¤š8ä¸ªä¸šåŠ¡çº¿&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ ¹æ®ä»¥ä¸Šä¸šåŠ¡æƒ…å†µï¼Œæ¥è®¾è®¡åˆ†å¸ƒå¼IDï¼š&lt;br&gt;
&lt;img src=&#34;https://github.com/zhangyaoo/fastim/blob/master/pic/server-id.jpg&#34; alt=&#34;IMæœåŠ¡ç«¯åˆ†å¸ƒå¼IDè®¾è®¡&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h5 id=&#34;71-ä¼˜ç‚¹&#34;&gt;7.1 ä¼˜ç‚¹&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;ä¸åŒæœºæˆ¿ä¸åŒæœºå™¨ä¸åŒä¸šåŠ¡çº¿å†…ç”Ÿæˆçš„IDäº’ä¸ç›¸åŒ&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªæœºå™¨çš„æ¯æ¯«ç§’å†…ç”Ÿæˆçš„IDä¸åŒ&lt;/li&gt;
&lt;li&gt;é¢„ç•™ä¸¤ä½ç•™ä½œæ‰©å±•ä½&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;72-ç¼ºç‚¹&#34;&gt;7.2 ç¼ºç‚¹ï¼š&lt;/h5&gt;
&lt;p&gt;å½“å¹¶å‘åº¦ä¸é«˜çš„æ—¶å€™ï¼Œæ—¶é—´è·¨æ¯«ç§’çš„æ¶ˆæ¯ï¼ŒåŒºåˆ†ä¸å‡ºæ¥æ¶ˆæ¯çš„å…ˆåé¡ºåºã€‚å› ä¸ºæ—¶é—´è·¨æ¯«ç§’çš„æ¶ˆæ¯ç”Ÿæˆçš„IDåé¢çš„æœ€åä¸€ä½éƒ½æ˜¯0ï¼Œåç»­å¦‚æœæŒ‰ç…§æ¶ˆæ¯IDç»´åº¦è¿›è¡Œåˆ†åº“åˆ†è¡¨ï¼Œä¼šå¯¼è‡´æ•°æ®å€¾æ–œ&lt;/p&gt;
&lt;h5 id=&#34;73-ä¸¤ç§è§£å†³æ–¹æ¡ˆ&#34;&gt;7.3 ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š&lt;/h5&gt;
&lt;ol&gt;
&lt;li&gt;æ–¹æ¡ˆä¸€ï¼šå»æ‰snowflakeæœ€å8ä½ï¼Œç„¶åå¯¹å‰©ä½™çš„ä½è¿›è¡Œå–æ¨¡&lt;/li&gt;
&lt;li&gt;æ–¹æ¡ˆäºŒï¼šä¸åŒæ¯«ç§’çš„è®¡æ•°ï¼Œæ¯æ¬¡ä¸æ˜¯å½’0ï¼Œè€Œæ˜¯å½’ä¸ºéšæœºæ•°ï¼Œç›¸æ¯”æ–¹æ¡ˆä¸€ï¼Œæ¯”è¾ƒç®€å•å®ç”¨&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;8-æ¶ˆæ¯æœªè¯»æ•°è®¾è®¡&#34;&gt;8 æ¶ˆæ¯æœªè¯»æ•°è®¾è®¡&lt;/h3&gt;
&lt;h4 id=&#34;80-å®ç°&#34;&gt;8.0 å®ç°&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;æ¯å‘ä¸€ä¸ªæ¶ˆæ¯ï¼Œæ¶ˆæ¯æ¥æ”¶è€…çš„ä¼šè¯æœªè¯»æ•°+1ï¼Œå¹¶ä¸”æ¥æ”¶è€…æ‰€æœ‰æœªè¯»æ•°+1&lt;/li&gt;
&lt;li&gt;æ¶ˆæ¯æ¥æ”¶è€…è¿”å›æ¶ˆæ¯æ¥æ”¶ç¡®è®¤ackåï¼Œæ¶ˆæ¯æœªè¯»æ•°ä¼š-1&lt;/li&gt;
&lt;li&gt;æ¶ˆæ¯æ¥æ”¶è€…çš„æœªè¯»æ•°+1ï¼ŒæœåŠ¡ç«¯å°±ä¼šæ¨ç®—æœ‰å¤šå°‘æ¡æœªè¯»æ•°çš„é€šçŸ¥&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;81-åˆ†å¸ƒå¼é”ä¿è¯æ€»æœªè¯»æ•°å’Œä¼šè¯æœªè¯»æ•°ä¸€è‡´&#34;&gt;8.1 åˆ†å¸ƒå¼é”ä¿è¯æ€»æœªè¯»æ•°å’Œä¼šè¯æœªè¯»æ•°ä¸€è‡´&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;ä¸ä¸€è‡´åŸå› ï¼šå½“æ€»æœªè¯»æ•°å¢åŠ ï¼Œè¿™ä¸ªæ—¶å€™å®¢æˆ·ç«¯æ¥äº†è¯·æ±‚å°†æœªçŸ¥æ•°ç½®0ï¼Œç„¶åå†å¢åŠ ä¼šè¯æœªè¯»æ•°ï¼Œé‚£ä¹ˆä¼šå¯¼è‡´ä¸ä¸€è‡´&lt;/li&gt;
&lt;li&gt;ä¿è¯ï¼šä¸ºäº†ä¿è¯æ€»æœªè¯»æ•°å’Œä¼šè¯æœªè¯»æ•°åŸå­æ€§ï¼Œéœ€è¦ç”¨åˆ†å¸ƒå¼é”æ¥ä¿è¯&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;82-ç¾¤èŠæ¶ˆæ¯æœªè¯»æ•°éš¾ç‚¹å’Œä¼˜åŒ–&#34;&gt;8.2 ç¾¤èŠæ¶ˆæ¯æœªè¯»æ•°éš¾ç‚¹å’Œä¼˜åŒ–&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;éš¾ç‚¹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€ä¸ªç¾¤èŠæ¯ç§’å‡ ç™¾çš„å¹¶å‘èŠå¤©ï¼Œæ¯”å¦‚æ¶ˆæ¯æœªè¯»æ•°ï¼Œç›¸å½“äºæ¯ç§’Wçº§åˆ«çš„å†™å…¥redisï¼Œå³ä¾¿redisåšäº†é›†ç¾¤æ•°æ®åˆ†ç‰‡+ä¸»ä»ï¼Œä½†æ˜¯å†™å…¥è¿˜æ˜¯å•èŠ‚ç‚¹ï¼Œä¼šæœ‰å†™å…¥ç“¶é¢ˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¼˜åŒ–&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;ç¾¤IDåˆ†ç»„æˆ–è€…ç”¨æˆ·IDåˆ†ç»„ï¼Œæ‰¹é‡å†™å…¥ï¼Œå†™å…¥çš„ä¸¤ç§æ–¹å¼
&lt;ul&gt;
&lt;li&gt;å®šæ—¶flush&lt;/li&gt;
&lt;li&gt;æ»¡å¤šå°‘æ¶ˆæ¯è¿›è¡Œflush&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;9-ç½‘å…³è®¾è®¡&#34;&gt;9. ç½‘å…³è®¾è®¡&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ¥å…¥å±‚ç½‘å…³å’Œåº”ç”¨å±‚ç½‘å…³ä¸åŒåœ°æ–¹
&lt;ul&gt;
&lt;li&gt;æ¥å…¥å±‚ç½‘å…³éœ€è¦æœ‰æ¥æ”¶é€šçŸ¥åŒ…æˆ–è€…ä¸‹è¡Œæ¥æ”¶æ•°æ®çš„ç«¯å£ï¼Œå¹¶ä¸”éœ€è¦å¦å¤–å¼€å¯çº¿ç¨‹æ± ã€‚åº”ç”¨å±‚ç½‘å…³ä¸éœ€è¦å¼€ç«¯å£ï¼Œå¹¶ä¸”ä¸éœ€è¦å¼€å¯çº¿ç¨‹æ± ã€‚&lt;/li&gt;
&lt;li&gt;æ¥å…¥å±‚ç½‘å…³éœ€è¦ä¿æŒé•¿è¿æ¥ï¼Œæ¥å…¥å±‚ç½‘å…³éœ€è¦æœ¬åœ°ç¼“å­˜channelæ˜ å°„å…³ç³»ã€‚åº”ç”¨å±‚ç½‘å…³æ— çŠ¶æ€ä¸éœ€è¦ä¿å­˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;91-æ¥å…¥å±‚ç½‘å…³è®¾è®¡&#34;&gt;9.1 æ¥å…¥å±‚ç½‘å…³è®¾è®¡&lt;/h4&gt;
&lt;h5 id=&#34;910-ç›®æ ‡&#34;&gt;9.1.0 ç›®æ ‡ï¼š&lt;/h5&gt;
&lt;ol&gt;
&lt;li&gt;ç½‘å…³çš„çº¿ç¨‹æ± å®ç°1+8+4+1ï¼Œå‡å°‘çº¿ç¨‹åˆ‡æ¢&lt;/li&gt;
&lt;li&gt;é›†ä¸­å®ç°é•¿è¿æ¥ç®¡ç†å’Œæ¨é€èƒ½åŠ›&lt;/li&gt;
&lt;li&gt;ä¸ä¸šåŠ¡æœåŠ¡å™¨è§£è€¦ï¼Œé›†ç¾¤éƒ¨ç½²ç¼©å®¹æ‰©å®¹ä»¥åŠé‡å¯å‡çº§ä¸ç›¸äº’å½±å“&lt;/li&gt;
&lt;li&gt;é•¿è¿æ¥çš„ç›‘æ§ä¸æŠ¥è­¦èƒ½åŠ›&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯é‡è¿æŒ‡ä»¤ä¸€é”®å®ç°&lt;/li&gt;
&lt;/ol&gt;
&lt;h5 id=&#34;911-æŠ€æœ¯ç‚¹&#34;&gt;9.1.1 æŠ€æœ¯ç‚¹ï¼š&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;è‡ªå®šä¹‰åè®®ä»¥åŠåºåˆ—åŒ–&lt;/li&gt;
&lt;li&gt;é€šé“è¿æ¥è‡ªå®šä¹‰ä¿æ´»ä»¥åŠå¿ƒè·³æ£€æµ‹&lt;/li&gt;
&lt;li&gt;æœ¬åœ°ç¼“å­˜channel&lt;/li&gt;
&lt;li&gt;è´£ä»»é“¾&lt;/li&gt;
&lt;li&gt;æœåŠ¡è°ƒç”¨å®Œå…¨å¼‚æ­¥&lt;/li&gt;
&lt;li&gt;æ³›åŒ–è°ƒç”¨&lt;/li&gt;
&lt;li&gt;è½¬å‘é€šçŸ¥åŒ…æˆ–è€…PushåŒ…&lt;/li&gt;
&lt;li&gt;å®¹é”™ç½‘å…³downæœºå¤„ç†&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;912-è®¾è®¡æ–¹æ¡ˆ&#34;&gt;9.1.2 è®¾è®¡æ–¹æ¡ˆï¼š&lt;/h5&gt;
&lt;p&gt;å‚è€ƒ&lt;a href=&#34;https://github.com/zhangyaoo/fastim/blob/master/fastim-gate/fastim-gate-tcp/README.md&#34;&gt;åŸºäºNettyçš„é•¿è¿æ¥ç½‘å…³è®¾è®¡ä¸å®ç°&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªNotifyåŒ…çš„æ•°æ®ç»ç½‘å…³çš„çº¿ç¨‹æ¨¡å‹å›¾ï¼š&lt;br&gt;
&lt;img src=&#34;https://github.com/zhangyaoo/fastim/blob/master/pic/TCP-Gate-ThreadModel.png&#34; alt=&#34;TCPç½‘å…³çº¿ç¨‹æ¨¡å‹&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;92-åº”ç”¨å±‚apiç½‘å…³è®¾è®¡&#34;&gt;9.2 åº”ç”¨å±‚APIç½‘å…³è®¾è®¡&lt;/h4&gt;
&lt;h5 id=&#34;920-ç›®æ ‡&#34;&gt;9.2.0 ç›®æ ‡ï¼š&lt;/h5&gt;
&lt;ol&gt;
&lt;li&gt;åŸºäºç‰ˆæœ¬çš„è‡ªåŠ¨å‘ç°ä»¥åŠç°åº¦/æ‰©å®¹ ï¼Œä¸éœ€è¦å…³æ³¨IP&lt;/li&gt;
&lt;li&gt;ç½‘å…³çš„çº¿ç¨‹æ± å®ç°1+8+1ï¼Œå‡å°‘çº¿ç¨‹åˆ‡æ¢&lt;/li&gt;
&lt;li&gt;æ”¯æŒåè®®è½¬æ¢å®ç°å¤šä¸ªåè®®è½¬æ¢ï¼ŒåŸºäºSPIæ¥å®ç°&lt;/li&gt;
&lt;li&gt;ä¸ä¸šåŠ¡æœåŠ¡å™¨è§£è€¦ï¼Œé›†ç¾¤éƒ¨ç½²ç¼©å®¹æ‰©å®¹ä»¥åŠé‡å¯å‡çº§ä¸ç›¸äº’å½±å“&lt;/li&gt;
&lt;li&gt;æ¥å£é”™è¯¯ä¿¡æ¯ç»Ÿè®¡å’ŒRTæ—¶é—´çš„ç›‘æ§å’ŒæŠ¥è­¦èƒ½åŠ›&lt;/li&gt;
&lt;li&gt;UIç•Œé¢å®ç°è·¯ç”±ç®—æ³•ï¼ŒæœåŠ¡æ¥å£ç‰ˆæœ¬ç®¡ç†ï¼Œç°åº¦ç­–ç•¥ç®¡ç†ä»¥åŠæ¥å£å’ŒæœåŠ¡ä¿¡æ¯å±•ç¤ºèƒ½åŠ›&lt;/li&gt;
&lt;li&gt;åŸºäºOpenAPIæä¾›æ¥å£çº§åˆ«çš„è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£çš„åŠŸèƒ½&lt;/li&gt;
&lt;/ol&gt;
&lt;h5 id=&#34;921-æŠ€æœ¯ç‚¹&#34;&gt;9.2.1 æŠ€æœ¯ç‚¹ï¼š&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;Http2.0&lt;/li&gt;
&lt;li&gt;channelè¿æ¥æ± å¤ç”¨&lt;/li&gt;
&lt;li&gt;Netty http æœåŠ¡ç«¯ç¼–è§£ç &lt;/li&gt;
&lt;li&gt;è´£ä»»é“¾&lt;/li&gt;
&lt;li&gt;æœåŠ¡è°ƒç”¨å®Œå…¨å¼‚æ­¥&lt;/li&gt;
&lt;li&gt;å…¨é“¾è·¯è¶…æ—¶æœºåˆ¶&lt;/li&gt;
&lt;li&gt;æ³›åŒ–è°ƒç”¨&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;922-è®¾è®¡æ–¹æ¡ˆ&#34;&gt;9.2.2 è®¾è®¡æ–¹æ¡ˆï¼š&lt;/h5&gt;
&lt;p&gt;å‚è€ƒ&lt;a href=&#34;https://github.com/zhangyaoo/fastim/blob/master/fastim-gate/fastim-gate-http/README.md&#34;&gt;åŸºäºNettyçš„APIç½‘å…³è®¾è®¡ä¸å®ç°&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªè¯·æ±‚åŒ…çš„æ•°æ®ç»ç½‘å…³çš„æ¶æ„å›¾ï¼š&lt;br&gt;
&lt;img src=&#34;https://github.com/zhangyaoo/fastim/blob/master/pic/HTTP-gate.png&#34; alt=&#34;ç½‘å…³çš„æ¶æ„å›¾&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;10-é«˜å¹¶å‘-é«˜å¯ç”¨è®¾è®¡&#34;&gt;10. é«˜å¹¶å‘ã€é«˜å¯ç”¨è®¾è®¡&lt;/h3&gt;
&lt;h4 id=&#34;100-é«˜å¹¶å‘è®¾è®¡&#34;&gt;10.0 é«˜å¹¶å‘è®¾è®¡&lt;/h4&gt;
&lt;h5 id=&#34;1000-æ¶æ„ä¼˜åŒ–&#34;&gt;10.0.0 æ¶æ„ä¼˜åŒ–&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;æ°´å¹³æ‰©å±•ï¼šå„ä¸ªæ¨¡å—æ— çŠ¶æ€éƒ¨ç½²&lt;/li&gt;
&lt;li&gt;çº¿ç¨‹æ¨¡å‹ï¼šæ¯ä¸ªæœåŠ¡åº•å±‚çº¿ç¨‹æ¨¡å‹éµä»Nettyä¸»ä»reactoræ¨¡å‹&lt;/li&gt;
&lt;li&gt;å¤šå±‚ç¼“å­˜ï¼šGateå±‚äºŒçº§ç¼“å­˜ï¼ŒRedisä¸€çº§ç¼“å­˜&lt;/li&gt;
&lt;li&gt;é•¿è¿æ¥ï¼šå®¢æˆ·ç«¯é•¿è¿æ¥ä¿æŒï¼Œé¿å…é¢‘ç¹åˆ›å»ºè¿æ¥æ¶ˆè€—&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;1001-ä¸‡äººç¾¤èŠä¼˜åŒ–&#34;&gt;10.0.1 ä¸‡äººç¾¤èŠä¼˜åŒ–&lt;/h5&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;éš¾ç‚¹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¶ˆæ¯æ‰‡å‡ºå¤§ï¼Œæ¯”å¦‚æ¯ç§’ç¾¤èŠæœ‰50æ¡æ¶ˆæ¯ï¼Œç¾¤èŠ2000äººï¼Œé‚£ä¹ˆå…‰ä¸€ä¸ªç¾¤å¯¹ç³»ç»Ÿå¹¶å‘å°±æœ‰10Wçš„æ¶ˆæ¯æ‰‡å‡º&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¼˜åŒ–&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‰¹é‡ACKï¼šæ¯æ¡ç¾¤æ¶ˆæ¯éƒ½ACKï¼Œä¼šç»™æœåŠ¡å™¨é€ æˆå·¨å¤§çš„å†²å‡»ï¼Œä¸ºäº†å‡å°‘ACKè¯·æ±‚é‡ï¼Œå‚è€ƒTCPçš„Delay ACKæœºåˆ¶ï¼Œåœ¨æ¥æ”¶æ–¹å±‚é¢è¿›è¡Œæ‰¹é‡ACKã€‚&lt;/li&gt;
&lt;li&gt;ç¾¤æ¶ˆæ¯å’Œæˆå‘˜æ‰¹é‡åŠ è½½ä»¥åŠæ‡’åŠ è½½ï¼šåœ¨çœŸæ­£è¿›å…¥ä¸€ä¸ªç¾¤æ—¶æ‰å®æ—¶æ‹‰å–ç¾¤å‹çš„æ•°æ®&lt;/li&gt;
&lt;li&gt;ç¾¤ç¦»çº¿æ¶ˆæ¯è¿‡å¤šï¼šç¾¤æ¶ˆæ¯åˆ†é¡µæ‹‰å–,ç¬¬äºŒæ¬¡æ‹‰å–è¯·æ±‚ä½œä¸ºç¬¬ä¸€æ¬¡æ‹‰å–è¯·æ±‚çš„ack&lt;/li&gt;
&lt;li&gt;å¯¹äºæ¶ˆæ¯æœªè¯»æ•°åœºæ™¯ï¼Œæ¯ä¸ªç”¨æˆ·ç»´æŠ¤ä¸€ä¸ªå…¨å±€çš„æœªè¯»æ•°å’Œæ¯ä¸ªä¼šè¯çš„æœªè¯»æ•°ï¼Œå½“ç¾¤èŠéå¸¸å¤§æ—¶ï¼Œæœªè¯»èµ„æºå˜æ›´çš„QPSéå¸¸å¤§ã€‚è¿™ä¸ªæ—¶å€™åº”ç”¨å±‚å¯¹æœªè¯»æ•°è¿›è¡Œç¼“å­˜ï¼Œæ‰¹é‡å†™+å®šæ—¶å†™æ¥ä¿è¯æœªè¯»è®¡æ•°çš„å†™å…¥æ€§èƒ½&lt;/li&gt;
&lt;li&gt;è·¯ç”±ä¿¡æ¯å­˜å…¥redisä¼šæœ‰å†™å…¥å’Œè¯»å–çš„æ€§èƒ½ç“¶é¢ˆï¼Œæ¯æ¡æ¶ˆæ¯åœ¨å‘å‡ºçš„æ—¶å€™ä¼šæŸ¥è·¯ç”±ä¿¡æ¯æ¥å‘é€å¯¹åº”çš„gateæ¥å…¥å±‚ï¼Œæ¯”å¦‚æœ‰10ä¸ªç¾¤ï¼Œæ¯ä¸ªç¾¤1Wï¼Œé‚£ä¹ˆ1s100æ¡æ¶ˆæ¯ï¼Œé‚£ä¹ˆ1000Wçš„æŸ¥è¯¢ä¼šæ‰“æ»¡redisï¼Œå³ä½¿redisåšäº†é›†ç¾¤ã€‚ä¼˜åŒ–çš„æ€è·¯å°±æ˜¯å°†é›†ä¸­çš„è·¯ç”±ä¿¡æ¯åˆ†æ•£åˆ°Router JVMæœ¬åœ°å†…å­˜ä¸­ï¼Œç„¶ååšRouteå¯ç”¨ï¼Œé¿å…å•ç‚¹æ•…éšœã€‚&lt;/li&gt;
&lt;li&gt;å­˜å‚¨çš„ä¼˜åŒ–ï¼Œæ‰©æ•£å†™å†™å…¥å¹¶å‘é‡å·¨å¤§ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿå­˜åœ¨å­˜å‚¨æµªè´¹ï¼Œä¸€èˆ¬ä¼˜åŒ–æˆæ‰©æ•£è¯»çš„æ–¹å¼å­˜å‚¨&lt;/li&gt;
&lt;li&gt;æ¶ˆæ¯è·¯ç”±åˆ°ç›¸åŒæ¥å…¥å±‚æœºå™¨è¿›è¡Œåˆå¹¶è¯·æ±‚å‡å°‘ç½‘ç»œåŒ…ä¼ è¾“&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;101-é«˜å¯ç”¨è®¾è®¡&#34;&gt;10.1 é«˜å¯ç”¨è®¾è®¡&lt;/h4&gt;
&lt;h3 id=&#34;1010-å¿ƒè·³è®¾è®¡&#34;&gt;10.1.0 å¿ƒè·³è®¾è®¡&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;æœåŠ¡ç«¯æ£€æµ‹åˆ°æŸä¸ªå®¢æˆ·ç«¯è¿Ÿè¿Ÿæ²¡æœ‰å¿ƒè·³è¿‡æ¥å¯ä»¥ä¸»åŠ¨å…³é—­é€šé“ï¼Œè®©å®ƒä¸‹çº¿ï¼Œå¹¶ä¸”æ¸…é™¤åœ¨çº¿ä¿¡æ¯å’Œè·¯ç”±ä¿¡æ¯ï¼›&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯æ£€æµ‹åˆ°æŸä¸ªæœåŠ¡ç«¯è¿Ÿè¿Ÿæ²¡æœ‰å“åº”å¿ƒè·³ä¹Ÿèƒ½é‡è¿è·å–ä¸€ä¸ªæ–°çš„è¿æ¥ã€‚&lt;/li&gt;
&lt;li&gt;æ™ºèƒ½å¿ƒè·³ç­–ç•¥ï¼Œæ¯”å¦‚æ­£åœ¨å‘åŒ…çš„æ—¶å€™ï¼Œä¸éœ€è¦å‘é€å¿ƒè·³ã€‚ç­‰å¾…å‘åŒ…å®Œæ¯•ååœ¨å¼€å¯å¿ƒè·³ã€‚å¹¶ä¸”è‡ªé€‚åº”å¿ƒè·³ç­–ç•¥è°ƒæ•´ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;1011-å¼‚å¸¸åœºæ™¯è®¾è®¡&#34;&gt;10.1.1 å¼‚å¸¸åœºæ™¯è®¾è®¡&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;gateå±‚é‡å¯å‡çº§æˆ–è€…æ„å¤–downæœºæœ‰ä»¥ä¸‹é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®¢æˆ·ç«¯å’Œgateæ„å¤–ä¸¢å¤±é•¿è¿æ¥ï¼Œå¯¼è‡´ å®¢æˆ·ç«¯åœ¨å‘é€æ¶ˆæ¯çš„æ—¶å€™å¯¼è‡´æ¶ˆæ¯è¶…æ—¶ç­‰å¾…ä»¥åŠå®¢æˆ·ç«¯é‡è¯•ç­‰æ— æ„ä¹‰æ“ä½œ&lt;/li&gt;
&lt;li&gt;å‘é€ç»™å®¢æˆ·ç«¯çš„æ¶ˆæ¯ï¼Œä»routerå±‚è½¬å‘ç»™gateçš„æ¶ˆæ¯ä¸¢å¤±ï¼Œå¯¼è‡´æ¶ˆæ¯è¶…æ—¶ç­‰å¾…ä»¥åŠé‡è¯•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é‡å¯å‡çº§æ—¶å€™ï¼Œå‘å®¢æˆ·ç«¯å‘é€é‡æ–°è¿æ¥æŒ‡ä»¤ï¼Œè®©å®¢æˆ·ç«¯é‡æ–°è¯·æ±‚LSBè·å–IPç›´è¿ã€‚&lt;/li&gt;
&lt;li&gt;å½“gateå±‚downæœºå¼‚å¸¸åœæ­¢æ—¶å€™ï¼Œå¢åŠ hooké’©å­ï¼Œå‘å®¢æˆ·ç«¯å‘é€é‡æ–°è¿æ¥æŒ‡ä»¤ã€‚&lt;/li&gt;
&lt;li&gt;é¢å¤–å¢åŠ hookï¼Œå‘routerå±‚å‘é€è¯·æ±‚æ¸…ç©ºè·¯ç”±æ¶ˆæ¯å’Œåœ¨çº¿çŠ¶æ€&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;1012-ç³»ç»Ÿç¨³å®šæ€§è®¾è®¡&#34;&gt;10.1.2 ç³»ç»Ÿç¨³å®šæ€§è®¾è®¡&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;èƒŒæ™¯ï¼šé«˜å³°æœŸç³»ç»Ÿå‹åŠ›å¤§ï¼Œå¶å‘çš„ç½‘ç»œæ³¢åŠ¨æˆ–è€…æœºå™¨è¿‡è½½ï¼Œéƒ½æœ‰å¯èƒ½å¯¼è‡´å¤§é‡çš„ç³»ç»Ÿå¤±è´¥ã€‚åŠ ä¸ŠIMç³»ç»Ÿè¦æ±‚å®æ—¶æ€§ï¼Œä¸èƒ½ç”¨å¼‚æ­¥å¤„ç†å®æ—¶å‘è¿‡æ¥çš„æ¶ˆæ¯ã€‚æ‰€ä»¥æœ‰äº†æŸ”æ€§ä¿æŠ¤æœºåˆ¶é˜²æ­¢é›ªå´©&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æŸ”æ€§ä¿æŠ¤æœºåˆ¶å¼€å¯åˆ¤æ–­æŒ‡æ ‡ï¼Œå½“æ¯ä¸ªæŒ‡æ ‡ä¸åœ¨å¹³å‡èŒƒå›´å†…çš„æ—¶å€™å°±å¼€å¯&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯æ¡æ¶ˆæ¯çš„ackæ—¶é—´ RTæ—¶é—´&lt;/li&gt;
&lt;li&gt;åŒæ—¶åœ¨çº¿äººæ•°ä»¥åŠåŒæ—¶å‘æ¶ˆæ¯çš„äººæ•°&lt;/li&gt;
&lt;li&gt;æ¯å°æœºå™¨çš„è´Ÿè½½CPUå’Œå†…å­˜å’Œç½‘ç»œIOå’Œç£ç›˜IOä»¥åŠGCå‚æ•°&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å½“å¼€å¯äº†æŸ”æ€§ä¿æŠ¤æœºåˆ¶ï¼Œé‚£ä¹ˆä¼šè¿”å›å¤±è´¥ï¼Œç”¨æˆ·ç«¯ä½“éªŒä¸å‹å¥½ï¼Œå¦‚ä½•ä¼˜åŒ–&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“å¼€å¯äº†æŸ”æ€§ä¿æŠ¤æœºåˆ¶ï¼Œé€»è¾‘å±‚holdä½å¤šä½™çš„è¯·æ±‚ï¼Œè¿”å›å‰ç«¯æˆåŠŸï¼Œä¸æ˜¾ç¤ºå‘é€å¤±è´¥ï¼Œåç«¯å¼‚æ­¥é‡è¯•ï¼Œç›´è‡³æˆåŠŸï¼›&lt;/li&gt;
&lt;li&gt;ä¸ºäº†é¿å…é‡è¯•åŠ å‰§ç³»ç»Ÿè¿‡è½½ï¼ŒæŒ‡æ•°æ—¶é—´å»¶è¿Ÿé‡è¯•&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;11-æ ¸å¿ƒè¡¨ç»“æ„è®¾è®¡&#34;&gt;11. æ ¸å¿ƒè¡¨ç»“æ„è®¾è®¡&lt;/h3&gt;
&lt;p&gt;æ ¸å¿ƒè®¾è®¡ç‚¹&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç¾¤æ¶ˆæ¯åªå­˜å‚¨ä¸€ä»½ï¼Œç”¨æˆ·ä¸éœ€è¦ä¸ºæ¯ä¸ªæ¶ˆæ¯å•ç‹¬å­˜ä¸€ä»½ã€‚ç”¨æˆ·ä¹Ÿæ— éœ€å»åˆ é™¤ç¾¤æ¶ˆæ¯ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äºåœ¨çº¿çš„ç”¨æˆ·ï¼Œæ”¶åˆ°ç¾¤æ¶ˆæ¯åï¼Œä¿®æ”¹è¿™ä¸ªlast_ack_msg_idã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äºç¦»çº¿ç”¨æˆ·ï¼Œç”¨æˆ·ä¸Šçº¿åï¼Œå¯¹æ¯”æœ€æ–°çš„æ¶ˆæ¯IDå’Œlast_ack_msg_idï¼Œæ¥è¿›è¡Œæ‹‰å–(å‚è€ƒKafkaçš„æ¶ˆè´¹è€…æ¨¡å‹)&lt;/li&gt;
&lt;li&gt;å¯¹åº”å•èŠï¼Œéœ€è¦è®°å½•æ¶ˆæ¯çš„é€è¾¾çŠ¶æ€ï¼Œä»¥ä¾¿åœ¨å¼‚å¸¸æƒ…å†µä¸‹æ¥åšé‡è¯•å¤„ç†&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;ç”¨æˆ·è¡¨-t_user&#34;&gt;ç”¨æˆ·è¡¨ t_user&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å­—æ®µ&lt;/th&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;id&lt;/td&gt;
&lt;td&gt;int&lt;/td&gt;
&lt;td&gt;è‡ªå¢ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;user_id&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·ID&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;ç¾¤è¡¨-t_group&#34;&gt;ç¾¤è¡¨ t_group&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å­—æ®µ&lt;/th&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;id&lt;/td&gt;
&lt;td&gt;int&lt;/td&gt;
&lt;td&gt;è‡ªå¢ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;group_id&lt;/td&gt;
&lt;td&gt;int&lt;/td&gt;
&lt;td&gt;ç¾¤ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;creator&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;åˆ›å»ºäºº&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;ç¾¤ç”¨æˆ·è¡¨-t_group_user&#34;&gt;ç¾¤ç”¨æˆ·è¡¨ t_group_user&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å­—æ®µ&lt;/th&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;id&lt;/td&gt;
&lt;td&gt;int&lt;/td&gt;
&lt;td&gt;è‡ªå¢ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;group_id&lt;/td&gt;
&lt;td&gt;int&lt;/td&gt;
&lt;td&gt;ç¾¤ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;user_id&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;join_time&lt;/td&gt;
&lt;td&gt;datetime&lt;/td&gt;
&lt;td&gt;åŠ ç¾¤æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;active_time&lt;/td&gt;
&lt;td&gt;datetime&lt;/td&gt;
&lt;td&gt;æ´»è·ƒæ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;ç¾¤ç”¨æˆ·æ¶ˆæ¯è¡¨-t_group_user_msg&#34;&gt;ç¾¤ç”¨æˆ·æ¶ˆæ¯è¡¨ t_group_user_msg&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å­—æ®µ&lt;/th&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;id&lt;/td&gt;
&lt;td&gt;int&lt;/td&gt;
&lt;td&gt;è‡ªå¢ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;group_id&lt;/td&gt;
&lt;td&gt;int&lt;/td&gt;
&lt;td&gt;ç¾¤ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;user_id&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;last_ack_msg_id&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;æœ€åä¸€æ¬¡ackçš„æ¶ˆæ¯ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;user_device_type&lt;/td&gt;
&lt;td&gt;tinyint&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·è®¾å¤‡ç±»å‹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;is_deleted&lt;/td&gt;
&lt;td&gt;tinyint&lt;/td&gt;
&lt;td&gt;æ˜¯å¦åˆ é™¤,æ ¹æ®è¿™ä¸ªå­—æ®µåç»­å¯ä»¥åšå†·å¤‡å½’æ¡£&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;create_time&lt;/td&gt;
&lt;td&gt;datetime&lt;/td&gt;
&lt;td&gt;åˆ›å»ºæ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;update_time&lt;/td&gt;
&lt;td&gt;datetime&lt;/td&gt;
&lt;td&gt;æ›´æ–°æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;ç¾¤æ¶ˆæ¯è¡¨-t_group_msg&#34;&gt;ç¾¤æ¶ˆæ¯è¡¨ t_group_msg&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å­—æ®µ&lt;/th&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;id&lt;/td&gt;
&lt;td&gt;int&lt;/td&gt;
&lt;td&gt;è‡ªå¢ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;msg_id&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;æ¶ˆæ¯ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;group_id&lt;/td&gt;
&lt;td&gt;int&lt;/td&gt;
&lt;td&gt;ç¾¤ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;sender_id&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;å‘é€æ–¹ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;msg_type&lt;/td&gt;
&lt;td&gt;int&lt;/td&gt;
&lt;td&gt;æ¶ˆæ¯ç±»å‹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;msg_content&lt;/td&gt;
&lt;td&gt;varchar&lt;/td&gt;
&lt;td&gt;æ¶ˆæ¯å†…å®¹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;is_deleted&lt;/td&gt;
&lt;td&gt;tinyint&lt;/td&gt;
&lt;td&gt;æ˜¯å¦åˆ é™¤&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;create_time&lt;/td&gt;
&lt;td&gt;datetime&lt;/td&gt;
&lt;td&gt;åˆ›å»ºæ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;update_time&lt;/td&gt;
&lt;td&gt;datetime&lt;/td&gt;
&lt;td&gt;æ›´æ–°æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;ä¸ªäººæ¶ˆæ¯è¡¨-t_user_msg&#34;&gt;ä¸ªäººæ¶ˆæ¯è¡¨ t_user_msg&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å­—æ®µ&lt;/th&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;id&lt;/td&gt;
&lt;td&gt;int&lt;/td&gt;
&lt;td&gt;è‡ªå¢ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;msg_id&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;æ¶ˆæ¯ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;sender_id&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;å‘é€æ–¹ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;receiver_id&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;æ¥æ”¶æ–¹ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;receiver_device_type&lt;/td&gt;
&lt;td&gt;tinyint&lt;/td&gt;
&lt;td&gt;æ¥æ”¶æ–¹è®¾å¤‡ç±»å‹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;msg_type&lt;/td&gt;
&lt;td&gt;int&lt;/td&gt;
&lt;td&gt;æ¶ˆæ¯ç±»å‹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;msg_content&lt;/td&gt;
&lt;td&gt;varchar&lt;/td&gt;
&lt;td&gt;æ¶ˆæ¯å†…å®¹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;msg_status&lt;/td&gt;
&lt;td&gt;tinyint&lt;/td&gt;
&lt;td&gt;æ¶ˆæ¯çŠ¶æ€ï¼Œå·²é€è¾¾å’Œæœªé€è¾¾&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;is_deleted&lt;/td&gt;
&lt;td&gt;tinyint&lt;/td&gt;
&lt;td&gt;æ˜¯å¦åˆ é™¤&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;create_time&lt;/td&gt;
&lt;td&gt;datetime&lt;/td&gt;
&lt;td&gt;åˆ›å»ºæ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;update_time&lt;/td&gt;
&lt;td&gt;datetime&lt;/td&gt;
&lt;td&gt;æ›´æ–°æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;ä¸ªäººä¼šè¯è¡¨-t_conversation&#34;&gt;ä¸ªäººä¼šè¯è¡¨ t_conversation&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å­—æ®µ&lt;/th&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;id&lt;/td&gt;
&lt;td&gt;int&lt;/td&gt;
&lt;td&gt;è‡ªå¢ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;conversation_id&lt;/td&gt;
&lt;td&gt;int&lt;/td&gt;
&lt;td&gt;ä¼šè¯ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;user_id&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;conversation_type&lt;/td&gt;
&lt;td&gt;tinyint&lt;/td&gt;
&lt;td&gt;ä¼šè¯ç±»å‹ 1=å•èŠ 2=ç¾¤èŠ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;receiver_id&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;æ¥æ”¶æ–¹ID å•èŠä¸ºä¸ªäººç”¨æˆ·ID ç¾¤èŠä¸ºç¾¤ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;last_sequence_id&lt;/td&gt;
&lt;td&gt;int&lt;/td&gt;
&lt;td&gt;å®¢æˆ·ç«¯æœ€æ–°ä¸€æ¡æ¶ˆæ¯åºå·&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;last_msg_id&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;å®¢æˆ·ç«¯æœ€æ–°ä¸€æ¡æ¶ˆæ¯å¯¹åº”çš„ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;last_msg_receive_time&lt;/td&gt;
&lt;td&gt;datetime&lt;/td&gt;
&lt;td&gt;å®¢æˆ·ç«¯æœ€æ–°ä¸€æ¡æ¶ˆæ¯æ¥æ”¶æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;is_deleted&lt;/td&gt;
&lt;td&gt;tinyint&lt;/td&gt;
&lt;td&gt;ä¼šè¯æ˜¯å¦åˆ é™¤&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;create_time&lt;/td&gt;
&lt;td&gt;datetime&lt;/td&gt;
&lt;td&gt;ä¼šè¯åˆ›å»ºæ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;update_time&lt;/td&gt;
&lt;td&gt;datetime&lt;/td&gt;
&lt;td&gt;æ›´æ–°æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;12-æ ¸å¿ƒä¸šåŠ¡æµç¨‹&#34;&gt;12 æ ¸å¿ƒä¸šåŠ¡æµç¨‹&lt;/h3&gt;
&lt;h4 id=&#34;120-ç”¨æˆ·aå‘æ¶ˆæ¯ç»™ç”¨æˆ·b-å•èŠ&#34;&gt;12.0 ç”¨æˆ·Aå‘æ¶ˆæ¯ç»™ç”¨æˆ·B ã€å•èŠã€‘&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;Aé€šè¿‡è´¦å·å¯†ç ç™»å½•è·å–tokenï¼Œä»¥åŠæ¥å…¥å±‚IPå’Œportä¿¡æ¯&lt;/li&gt;
&lt;li&gt;æ¥å…¥å±‚IPå’Œportä¿¡æ¯è¿›è¡Œè¿œç¨‹TCPè¿æ¥ï¼Œæ¥å…¥å±‚ç»´æŠ¤ç™»å½•çŠ¶æ€&lt;/li&gt;
&lt;li&gt;æœåŠ¡å±‚æ ¡éªŒtokenï¼Œtokenæ ¡éªŒé€šè¿‡&lt;/li&gt;
&lt;li&gt;Aæ‰“åŒ…æ•°æ®å‘é€ç»™æœåŠ¡ç«¯ï¼Œ æœåŠ¡ç«¯æ£€æµ‹Aç”¨æˆ·æ˜¯å¦é£é™©ç”¨æˆ·&lt;/li&gt;
&lt;li&gt;æœåŠ¡ç«¯å¯¹æ¶ˆæ¯è¿›è¡Œæ•æ„Ÿè¯æ£€æŸ¥ï¼Œä»¥åŠå‘é€é¢‘ç‡çš„é™åˆ¶æ£€æŸ¥&lt;/li&gt;
&lt;li&gt;æœåŠ¡ç«¯æ¥æ”¶æ¶ˆæ¯åï¼Œæ ¹æ®æ¥æ”¶æ¶ˆæ¯çš„sequence_idæ¥è¿›è¡Œå®¢æˆ·ç«¯å‘é€æ¶ˆæ¯çš„å»é‡ï¼Œå¹¶ä¸”ç”Ÿæˆé€’å¢çš„æ¶ˆæ¯IDï¼Œå°†å‘é€çš„ä¿¡æ¯å’ŒIDæ‰“åŒ…ä¸€å—å…¥åº“ï¼Œå…¥åº“æˆåŠŸåè¿”å›ACKï¼ŒACKåŒ…å¸¦ä¸ŠæœåŠ¡ç«¯ç”Ÿæˆçš„æ¶ˆæ¯ID&lt;/li&gt;
&lt;li&gt;æœåŠ¡ç«¯æ£€æµ‹æ¥æ”¶ç”¨æˆ·Bæ˜¯å¦åœ¨çº¿ï¼Œåœ¨çº¿ç›´æ¥æ¨é€ç»™ç”¨æˆ·B&lt;/li&gt;
&lt;li&gt;å¦‚æœæ²¡æœ‰æœ¬åœ°æ¶ˆæ¯IDåˆ™å­˜å…¥ï¼Œå¹¶ä¸”è¿”å›æ¥å…¥å±‚ACKä¿¡æ¯ï¼›å¦‚æœæœ‰åˆ™æ‹¿æœ¬åœ°sequence_idå’Œæ¨é€è¿‡æ¥çš„sequence_idå¤§å°å¯¹æ¯”ï¼Œå¹¶ä¸”å»é‡ï¼Œè¿›è¡Œå±•ç°æ—¶åºè¿›è¡Œæ’åºå±•ç¤ºï¼Œå¹¶ä¸”è®°å½•æœ€æ–°ä¸€æ¡æ¶ˆæ¯IDã€‚æœ€åè¿”å›æ¥å…¥å±‚ack&lt;/li&gt;
&lt;li&gt;æœåŠ¡ç«¯æ¥æ”¶ACKåï¼Œå°†æ¶ˆæ¯æ ‡ä¸ºå·²é€è¾¾&lt;/li&gt;
&lt;li&gt;å¦‚æœç”¨æˆ·Bä¸åœ¨çº¿,é¦–å…ˆå°†æ¶ˆæ¯å­˜å…¥åº“ä¸­ï¼Œç„¶åç›´æ¥é€šè¿‡æ‰‹æœºé€šçŸ¥æ¥å‘ŠçŸ¥å®¢æˆ·æ–°æ¶ˆæ¯åˆ°æ¥&lt;/li&gt;
&lt;li&gt;ç”¨æˆ·Bä¸Šçº¿åï¼Œæ‹¿æœ¬åœ°æœ€æ–°çš„æ¶ˆæ¯IDï¼Œå»æœåŠ¡ç«¯æ‹‰å–æ‰€æœ‰å¥½å‹å‘é€ç»™Bçš„æ¶ˆæ¯ï¼Œè€ƒè™‘åˆ°ä¸€æ¬¡æ‹‰å–æ‰€æœ‰æ¶ˆæ¯æ•°æ®é‡å¤§ï¼Œé€šè¿‡channelé€šé“æ¥è¿›è¡Œåˆ†é¡µæ‹‰å–ï¼Œå°†ä¸Šä¸€æ¬¡æ‹‰å–æ¶ˆæ¯çš„æœ€å¤§çš„IDï¼Œä½œä¸ºè¯·æ±‚å‚æ•°ï¼Œæ¥è¯·æ±‚æœ€æ–°ä¸€é¡µçš„æ¯”IDå¤§çš„æ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;121-ç”¨æˆ·aå‘æ¶ˆæ¯ç»™ç¾¤g-ç¾¤èŠ&#34;&gt;12.1 ç”¨æˆ·Aå‘æ¶ˆæ¯ç»™ç¾¤G ã€ç¾¤èŠã€‘&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;ç™»å½•ï¼ŒTCPè¿æ¥ï¼Œtokenæ ¡éªŒï¼Œåè¯æ£€æŸ¥ï¼Œsequence_idå»é‡ï¼Œç”Ÿæˆé€’å¢çš„æ¶ˆæ¯IDï¼Œç¾¤æ¶ˆæ¯å…¥åº“æˆåŠŸè¿”å›å‘é€æ–¹ACK&lt;/li&gt;
&lt;li&gt;æŸ¥è¯¢ç¾¤Gæ‰€æœ‰çš„æˆå‘˜ï¼Œç„¶åå»redisä¸­å¤®å­˜å‚¨ä¸­æ‰¾åœ¨çº¿çŠ¶æ€ã€‚ç¦»çº¿å’Œåœ¨çº¿æˆå‘˜åˆ†ä¸åŒçš„æ–¹å¼å¤„ç†&lt;/li&gt;
&lt;li&gt;åœ¨çº¿æˆå‘˜ï¼šå¹¶è¡Œå‘é€æ‹‰å–é€šçŸ¥ï¼Œç­‰å¾…åœ¨çº¿æˆå‘˜è¿‡æ¥æ‹‰å–ï¼Œå‘é€æ‹‰å–é€šçŸ¥åŒ…å¦‚ä¸¢å¤±ä¼šæœ‰å…œåº•æœºåˆ¶&lt;/li&gt;
&lt;li&gt;åœ¨çº¿æˆå‘˜è¿‡æ¥æ‹‰å–ï¼Œä¼šå¸¦ä¸Šè¿™ä¸ªç¾¤æ ‡è¯†å’Œä¸Šä¸€æ¬¡æ‹‰å–ç¾¤çš„æœ€å°æ¶ˆæ¯IDï¼ŒæœåŠ¡ç«¯ä¼šæ‰¾æ¯”è¿™ä¸ªæ¶ˆæ¯IDå¤§çš„æ‰€æœ‰çš„æ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œç­‰å¾…å®¢æˆ·ç«¯ACKã€‚ä¸€æ®µæ—¶é—´æ²¡ackç»§ç»­æ¨é€ã€‚å¦‚æœé‡è¯•å‡ æ¬¡åæ²¡æœ‰å›ackï¼Œé‚£ä¹ˆå…³é—­è¿æ¥å’Œæ¸…é™¤ackç­‰å¾…é˜Ÿåˆ—æ¶ˆæ¯&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯ä¼šæ›´æ–°æœ¬åœ°çš„æœ€æ–°çš„æ¶ˆæ¯IDï¼Œç„¶åè¿›è¡Œackå›åŒ…ã€‚æœåŠ¡ç«¯æ”¶åˆ°ackåä¼šæ›´æ–°ç¾¤æˆå‘˜çš„æœ€æ–°çš„æ¶ˆæ¯ID&lt;/li&gt;
&lt;li&gt;ç¦»çº¿æˆå‘˜ï¼šå‘é€æ‰‹æœºé€šçŸ¥æ é€šçŸ¥ã€‚ç¦»çº¿æˆå‘˜ä¸Šçº¿åï¼Œæ‹¿æœ¬åœ°æœ€æ–°çš„æ¶ˆæ¯IDï¼Œå»æœåŠ¡ç«¯æ‹‰å–ç¾¤Gå‘é€ç»™Açš„æ¶ˆæ¯ï¼Œé€šè¿‡channelé€šé“æ¥è¿›è¡Œåˆ†é¡µæ‹‰å–ï¼Œæ¯ä¸€æ¬¡è¯·æ±‚ï¼Œä¼šå°†ä¸Šä¸€æ¬¡æ‹‰å–æ¶ˆæ¯çš„æœ€å¤§çš„IDï¼Œä½œä¸ºè¯·æ±‚å‚æ•°æ¥æ‹‰å–æ¶ˆæ¯ï¼Œè¿™é‡Œç›¸å½“äºç¬¬äºŒæ¬¡æ‹‰å–è¯·æ±‚åŒ…æ˜¯ä½œä¸ºç¬¬ä¸€æ¬¡æ‹‰å–çš„ackåŒ…ã€‚&lt;/li&gt;
&lt;li&gt;åˆ†é¡µçš„æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯åœ¨æ”¶åˆ°ä¸Šä¸€é¡µè¯·æ±‚çš„çš„æ•°æ®åæ›´æ–°æœ¬åœ°çš„æœ€æ–°çš„æ¶ˆæ¯IDåï¼Œå†è¯·æ±‚ä¸‹ä¸€é¡µå¹¶ä¸”å¸¦ä¸Šæ¶ˆæ¯IDã€‚ä¸Šä¸€é¡µè¯·æ±‚çš„çš„æ•°æ®å¯ä»¥å½“ä½œä¸ºackæ¥è¿”å›æœåŠ¡ç«¯ï¼Œé¿å…ç½‘ç»œå¤šæ¬¡äº¤äº’ã€‚æœåŠ¡ç«¯æ”¶åˆ°ackåä¼šæ›´æ–°ç¾¤æˆå‘˜çš„æœ€æ–°çš„æ¶ˆæ¯ID&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;13-çº¢åŒ…è®¾è®¡&#34;&gt;13 çº¢åŒ…è®¾è®¡&lt;/h3&gt;
&lt;h4 id=&#34;131-æŠ¢çº¢åŒ…çš„å¤§è‡´æ ¸å¿ƒé€»è¾‘&#34;&gt;13.1 æŠ¢çº¢åŒ…çš„å¤§è‡´æ ¸å¿ƒé€»è¾‘&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;é“¶è¡Œå¿«æ·æ”¯ä»˜ï¼Œä¿è¯è´¦æˆ·ä½™é¢å’Œå‘é€çº¢åŒ…é€»è¾‘çš„ä¸€è‡´æ€§&lt;/li&gt;
&lt;li&gt;å‘é€çº¢åŒ…åï¼Œé¦–å…ˆè®¡ç®—å¥½çº¢åŒ…çš„ä¸ªæ•°ï¼Œä¸ªæ•°ç¡®å®šå¥½åï¼Œç¡®å®šå¥½æ¯ä¸ªçº¢åŒ…çš„é‡‘é¢ï¼Œå­˜å…¥å­˜å‚¨å±‚ã€è¿™é‡Œå¯ä»¥æ˜¯redisçš„Listæˆ–è€…æ˜¯é˜Ÿåˆ—ã€‘æ–¹ä¾¿åç»­æ¯ä¸ªäººæ¥å–&lt;/li&gt;
&lt;li&gt;ç”Ÿæˆä¸€ä¸ª24å°æ—¶çš„å»¶è¿Ÿä»»åŠ¡ï¼Œæ£€æµ‹çº¢åŒ…æ˜¯å¦è¿˜æœ‰é’±æ–¹ä¾¿é€€å›&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªçº¢åŒ…çš„é‡‘é¢éœ€è¦ä¿è¯æ¯ä¸ªçº¢åŒ…çš„çš„æŠ¢é‡‘é¢æ¦‚ç‡æ˜¯ä¸€è‡´çš„ï¼Œç®—æ³•éœ€è¦è€ƒé‡&lt;/li&gt;
&lt;li&gt;å­˜å…¥æ•°æ®åº“è¡¨ä¸­åï¼ŒæœåŠ¡å™¨é€šè¿‡é•¿è¿æ¥ï¼Œç»™ç¾¤é‡Œnotifyçº¢åŒ…æ¶ˆæ¯,ä¾›ç¾¤æˆå‘˜æŠ¢çº¢åŒ…&lt;/li&gt;
&lt;li&gt;ç¾¤æˆå‘˜å¹¶å‘æŠ¢çº¢åŒ…ï¼Œåœ¨ç¬¬äºŒæ­¥ä¸­ä¼šå°†æ¯ä¸ªçº¢åŒ…çš„é‡‘é¢æ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—æˆ–è€…å…¶ä»–å­˜å‚¨ä¸­ï¼Œç¾¤æˆå‘˜å®é™…æ˜¯æ¥ç«äº‰å»é˜Ÿåˆ—ä¸­çš„çº¢åŒ…é‡‘é¢ã€‚å…œåº•æœºåˆ¶ï¼šå¦‚æœredisæŒ‚äº†ï¼Œå¯ä»¥é‡æ–°ç”Ÿæˆçº¢åŒ…ä¿¡æ¯åˆ°æ•°æ®åº“ä¸­&lt;/li&gt;
&lt;li&gt;å–æˆåŠŸåï¼Œéœ€è¦ä¿è¯çº¢åŒ…å‰©ä½™é‡‘é¢ã€æ–°æ’å…¥çš„çº¢åŒ…æµæ°´æ•°æ®ã€é˜Ÿåˆ—ä¸­çš„çº¢åŒ…æ•°æ®ä»¥åŠç¾¤æˆå‘˜çš„ä½™é¢è´¦æˆ·é‡‘é¢ä¸€è‡´æ€§ã€‚&lt;/li&gt;
&lt;li&gt;è¿™é‡Œè¿˜éœ€è¦ä¿è¯ä¸€ä¸ªç”¨æˆ·åªèƒ½é¢†å–ä¸€æ¬¡ï¼Œå¹¶ä¸”ä¿æŒå¹‚ç­‰&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;132-çº¢åŒ…ç›¸å…³è¡¨ç»“æ„è®¾è®¡&#34;&gt;13.2 çº¢åŒ…ç›¸å…³è¡¨ç»“æ„è®¾è®¡&lt;/h4&gt;
&lt;h5 id=&#34;çº¢åŒ…è¡¨-t_red_package-åŸåˆ™ä¸Šçº¢åŒ…ä¿¡æ¯å’Œè®¢å•æ”¯ä»˜ä¿¡æ¯åˆ†ä¸¤ä¸ªè¡¨&#34;&gt;çº¢åŒ…è¡¨ t_red_package (åŸåˆ™ä¸Šçº¢åŒ…ä¿¡æ¯å’Œè®¢å•æ”¯ä»˜ä¿¡æ¯åˆ†ä¸¤ä¸ªè¡¨)&lt;/h5&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å­—æ®µ&lt;/th&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;id&lt;/td&gt;
&lt;td&gt;int&lt;/td&gt;
&lt;td&gt;è‡ªå¢ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;package_id&lt;/td&gt;
&lt;td&gt;int&lt;/td&gt;
&lt;td&gt;çº¢åŒ…ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;sender_id&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;å‘é€ç”¨æˆ·ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;received_id&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;æ¥æ”¶è€…IDæˆ–è€…ç¾¤ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;type&lt;/td&gt;
&lt;td&gt;tinyint&lt;/td&gt;
&lt;td&gt;1=å•èŠçº¢åŒ… 2=ç¾¤èŠçº¢åŒ…&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;package_amount&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;çº¢åŒ…é‡‘é¢, å¡«å……0åˆ°åˆ†åä¸¤ä½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;package_lock_amount&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;çº¢åŒ…é¢„å é‡‘é¢&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;package_remaining_amount_&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;çº¢åŒ…å‰©ä½™é‡‘é¢&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;status&lt;/td&gt;
&lt;td&gt;tinyint&lt;/td&gt;
&lt;td&gt;çº¢åŒ…çŠ¶æ€ï¼Œæ˜¯å¦æ”¯ä»˜æˆåŠŸ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;pay_time&lt;/td&gt;
&lt;td&gt;datetime&lt;/td&gt;
&lt;td&gt;æ”¯ä»˜æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;pay_order_no&lt;/td&gt;
&lt;td&gt;datetime&lt;/td&gt;
&lt;td&gt;æ”¯ä»˜è®¢å•å·&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;is_deleted&lt;/td&gt;
&lt;td&gt;tinyint&lt;/td&gt;
&lt;td&gt;æ˜¯å¦åˆ é™¤&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;create_time&lt;/td&gt;
&lt;td&gt;datetime&lt;/td&gt;
&lt;td&gt;åˆ›å»ºæ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;update_time&lt;/td&gt;
&lt;td&gt;datetime&lt;/td&gt;
&lt;td&gt;æ›´æ–°æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h5 id=&#34;æŠ¢çº¢åŒ…è®°å½•è¡¨-t_red_package_record&#34;&gt;æŠ¢çº¢åŒ…è®°å½•è¡¨ t_red_package_record&lt;/h5&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å­—æ®µ&lt;/th&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;id&lt;/td&gt;
&lt;td&gt;int&lt;/td&gt;
&lt;td&gt;è‡ªå¢ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;user_id&lt;/td&gt;
&lt;td&gt;int&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;package_id&lt;/td&gt;
&lt;td&gt;int&lt;/td&gt;
&lt;td&gt;çº¢åŒ…ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;package_rob_amount&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;æŠ¢çº¢åŒ…é‡‘é¢&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;status&lt;/td&gt;
&lt;td&gt;tinyint&lt;/td&gt;
&lt;td&gt;çº¢åŒ…çŠ¶æ€ï¼Œæ˜¯å¦å­˜å…¥é›¶é’±è´¦æˆ·&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;payment_time&lt;/td&gt;
&lt;td&gt;datetime&lt;/td&gt;
&lt;td&gt;æ”¶æ¬¾æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;receive_order_no&lt;/td&gt;
&lt;td&gt;datetime&lt;/td&gt;
&lt;td&gt;æ”¶æ¬¾è®¢å•å·&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;is_deleted&lt;/td&gt;
&lt;td&gt;tinyint&lt;/td&gt;
&lt;td&gt;æ˜¯å¦åˆ é™¤&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;create_time&lt;/td&gt;
&lt;td&gt;datetime&lt;/td&gt;
&lt;td&gt;åˆ›å»ºæ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;update_time&lt;/td&gt;
&lt;td&gt;datetime&lt;/td&gt;
&lt;td&gt;æ›´æ–°æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;ä¸‰-é¡¹ç›®ç»“æ„&#34;&gt;ä¸‰ã€é¡¹ç›®ç»“æ„&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;fastim-logicï¼šé€»è¾‘æœåŠ¡ï¼Œæ¯”å¦‚å•èŠã€ç¾¤èŠã€çº¢åŒ…ã€ç¦»çº¿ç­‰ä¸šåŠ¡é€»è¾‘&lt;/li&gt;
&lt;li&gt;fastim-clientï¼šå®¢æˆ·ç«¯é€»è¾‘å®ç°ï¼Œå®ç°å‘é€æ¶ˆæ¯ã€æ–­çº¿é‡è¿ã€SDKåŒ…ç­‰åŠŸèƒ½&lt;/li&gt;
&lt;li&gt;fastim-gate-tcpï¼šHTTP APIç½‘å…³å®ç°ï¼Œå®ç°é™æµé™çº§ã€ç‰ˆæœ¬è·¯ç”±ã€openAPIç®¡ç†ã€åè®®è½¬æ¢ã€æ³›åŒ–è°ƒç”¨ç­‰åŠŸèƒ½&lt;/li&gt;
&lt;li&gt;fastim-gate-httpï¼šé•¿è¿æ¥TCPç½‘å…³å®ç°ï¼Œå®ç°è‡ªå®šä¹‰åè®®ã€channelç®¡ç†ã€å¿ƒè·³æ£€æµ‹ã€æ³›åŒ–è°ƒç”¨ç­‰åŠŸèƒ½&lt;/li&gt;
&lt;li&gt;fastim-leafï¼šåˆ†å¸ƒå¼IDå®ç°ï¼ŒåŸºäºzookeeperçš„å®ç°æˆ–åŸºäºrediså®ç°æˆ–å®Œå…¨åŸºäºå†…å­˜çš„å®ç°&lt;/li&gt;
&lt;li&gt;fastim-routerï¼šè·¯ç”±é€»è¾‘æœåŠ¡ï¼Œä¸»è¦è´Ÿè´£æ¶ˆæ¯çš„è·¯ç”±è½¬å‘ï¼Œä»¥åŠå®¢æˆ·ç«¯åœ¨çº¿çŠ¶æ€çš„ç»´æŠ¤&lt;/li&gt;
&lt;li&gt;fastim-commonï¼šå…±ç”¨ç±»ï¼Œä¸»è¦æ˜¯å®ä½“ç±»å’Œå·¥å…·ç±»çš„å­˜æ”¾&lt;/li&gt;
&lt;li&gt;fastim-lsbï¼šLSB serviceï¼Œæä¾›æ¥å…¥å±‚IPå’Œportæ¥è¿›è¡Œè´Ÿè½½å‡è¡¡çš„è¿æ¥&lt;/li&gt;
&lt;li&gt;fastim-dasï¼šæ•°æ®è®¿é—®å±‚å®ç°ï¼Œå°è£…ä¸€å±‚ï¼Œæä¾›æ•°æ®çš„å¢åˆ æ”¹æŸ¥å…¥å£&lt;/li&gt;
&lt;li&gt;fastim-sampleï¼šå®¢æˆ·ç«¯clientä½¿ç”¨æ¡ˆä¾‹&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å››-æ€§èƒ½æµ‹è¯•&#34;&gt;å››ã€æ€§èƒ½æµ‹è¯•&lt;/h2&gt;
&lt;h2 id=&#34;äº”-qa&#34;&gt;äº”ã€Q&amp;amp;A&lt;/h2&gt;
&lt;h3 id=&#34;1-æ¶æ„&#34;&gt;1 æ¶æ„&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Qï¼šå¯¹äºå•èŠå’Œç¾¤èŠçš„å®æ—¶æ€§æ¶ˆæ¯ï¼Œæ˜¯å¦éœ€è¦MQæ¥ä½œä¸ºé€šä¿¡çš„ä¸­é—´ä»¶æ¥ä»£æ›¿rpcï¼Ÿ&lt;/p&gt;
&lt;p&gt;Aï¼šMQä½œä¸ºè§£è€¦å¯ä»¥æœ‰ä»¥ä¸‹å¥½å¤„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ˜“æ‰©å±•ï¼Œgateå±‚åˆ°logicå±‚æ— éœ€è·¯ç”±ï¼Œlogicå±‚å¤šä¸ªæœ‰æ–°çš„ä¸šåŠ¡æ—¶å€™ï¼Œåªéœ€è¦ç›‘å¬æ–°çš„topicå³å¯&lt;/li&gt;
&lt;li&gt;è§£è€¦ï¼Œgateå±‚åˆ°logicå±‚è§£è€¦ï¼Œä¸ä¼šæœ‰ä¾èµ–å…³ç³»&lt;/li&gt;
&lt;li&gt;èŠ‚çœç«¯å£èµ„æºï¼Œgateå±‚æ— éœ€å†å¼€å¯æ–°çš„ç«¯å£æ¥æ”¶logicçš„è¯·æ±‚ï¼Œè€Œä¸”ç›´æ¥ç›‘å¬MQæ¶ˆæ¯å³å¯&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½†æ˜¯ç¼ºç‚¹ä¹Ÿæœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç½‘ç»œé€šä¿¡å¤šä¸€æ¬¡ç½‘ç»œé€šä¿¡ï¼Œå¢åŠ RTçš„æ—¶é—´ï¼Œæ¶ˆæ¯å®æ—¶æ€§å¯¹äºIMå³ä½¿é€šä¿¡çš„åœºæ™¯æ˜¯éå¸¸æ³¨é‡çš„ä¸€ä¸ªç‚¹&lt;/li&gt;
&lt;li&gt;MQçš„ç¨³å®šæ€§ï¼Œä¸ç®¡ä»»ä½•ç³»ç»Ÿåªè¦å¼•å…¥ä¸­é—´ä»¶éƒ½ä¼šæœ‰ç¨³å®šæ€§é—®é¢˜ï¼Œéœ€è¦è€ƒè™‘MQä¸å¯ç”¨æˆ–è€…ä¸¢å¤±æ•°æ®çš„æƒ…å†µ&lt;/li&gt;
&lt;li&gt;éœ€è¦è€ƒè™‘åˆ°è¿ç»´çš„æˆæœ¬&lt;/li&gt;
&lt;li&gt;å½“ç”¨æ¶ˆæ¯ä¸­é—´ä»£æ›¿è·¯ç”±å±‚çš„æ—¶å€™ï¼Œgateå±‚éœ€è¦å¹¿æ’­æ¶ˆè´¹æ¶ˆæ¯ï¼Œè¿™ä¸ªæ—¶å€™gateå±‚ä¼šæ¥æ”¶å¤§éƒ¨åˆ†çš„æ— æ•ˆæ¶ˆæ¯ï¼Œå› ä¸ºè¿™ä¸ªæ¶ˆæ¯çš„æ¥æ”¶è€…channelä¸åœ¨æœ¬æœºç»´æŠ¤çš„sessionä¸­&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç»¼ä¸Šï¼Œæ˜¯å¦è€ƒè™‘ä½¿ç”¨MQéœ€è¦æ¶æ„å¸ˆå»è€ƒé‡ï¼Œæ¯”å¦‚è€ƒè™‘ä¸šåŠ¡æ˜¯å¦å…è®¸ã€æˆ–è€…ç³»ç»Ÿçš„æµé‡ç­‰ç­‰å½±å“å› ç´ ã€‚&lt;br&gt;
æœ¬é¡¹ç›®åŸºäºä½¿ç”¨æˆæœ¬ã€è€¦åˆæˆæœ¬å’Œè¿ç»´æˆæœ¬è€ƒè™‘ï¼Œé‡‡ç”¨RPCçš„æ–¹æ¡ˆæ¥å®ç°ã€‚å¹¶ä¸”æ ¹æ®æ³›åŒ–è°ƒç”¨ï¼Œä¹Ÿèƒ½åŒæ ·å®ç°å±‚çº§è§£è€¦ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Qï¼šæ¶æ„è®¾è®¡ä¸ºä»€ä¹ˆè¦å¢åŠ routerå±‚ï¼Ÿä¸Šè¡Œæ¶ˆæ¯gateå±‚ä¸ºä»€ä¹ˆç›´æ¥è®¿é—®serviceï¼Œè€Œä¸‹è¡Œæ¶ˆæ¯serviceåˆ™éœ€è¦ç»è¿‡routerå’ŒKafkaæ¥è·Ÿgateé€šä¿¡ï¼Ÿ&lt;/p&gt;
&lt;p&gt;Aï¼šå¢åŠ routerå±‚çš„ç›®çš„æ˜¯æ ¹æ®è·¯ç”±å…¨å±€ä¿¡æ¯å°†é€šçŸ¥åŒ…æˆ–è€…æ¨é€åŒ…è·¯ç”±åˆ°å…·ä½“çš„æŸä¸€å°æ¥å…¥å±‚çš„æœºå™¨ä¸Šï¼Œç„¶årouterå±‚é€šè¿‡rpcæˆ–è€…MQå‘é€åˆ°gateå±‚ï¼Œgateå‘é€æ•°æ®åˆ°å®¢æˆ·ç«¯æ¥è¿›è¡Œé€šä¿¡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Qï¼šä¸ºä»€ä¹ˆæ¥å…¥å±‚ç”¨LSBè¿”å›çš„IPæ¥åšæ¥å…¥å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;Aï¼šå¯ä»¥æœ‰ä»¥ä¸‹å¥½å¤„ï¼š1ã€çµæ´»çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ å¯æ ¹æ®æœ€å°‘è¿æ¥æ•°æ¥åˆ†é…IPï¼›2ã€åšç°åº¦ç­–ç•¥æ¥åˆ†é…IPï¼›3ã€AppIdä¸šåŠ¡éš”ç¦»ç­–ç•¥ ä¸åŒä¸šåŠ¡è¿æ¥ä¸åŒçš„gateï¼Œé˜²æ­¢ç›¸äº’å½±å“&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Qï¼šä¸ºä»€ä¹ˆåº”ç”¨å±‚å¿ƒè·³å¯¹è¿æ¥è¿›è¡Œå¥åº·æ£€æŸ¥ï¼Ÿ&lt;/p&gt;
&lt;p&gt;Aï¼šå› ä¸ºTCP KeepaliveçŠ¶æ€æ— æ³•ååº”åº”ç”¨å±‚çŠ¶æ€é—®é¢˜ï¼Œå¦‚è¿›ç¨‹é˜»å¡ã€æ­»é”ã€TCPç¼“å†²åŒºæ»¡ç­‰æƒ…å†µï¼›å¹¶ä¸”è¦æ³¨æ„å¿ƒè·³çš„é¢‘ç‡ï¼Œé¢‘ç‡å°åˆ™å¯èƒ½åŠæ—¶æ„ŸçŸ¥ä¸åˆ°åº”ç”¨æƒ…å†µï¼Œé¢‘ç‡å¤§å¯èƒ½æœ‰ä¸€å®šçš„æ€§èƒ½å¼€é”€ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Qï¼šMQçš„ä½¿ç”¨åœºæ™¯ï¼Ÿ&lt;/p&gt;
&lt;p&gt;Aï¼šIMæ¶ˆæ¯æ˜¯éå¸¸åºå¤§çš„ï¼Œæ¯”å¦‚è¯´ç¾¤èŠç›¸å…³ä¸šåŠ¡ã€æ¨é€ï¼Œå¯¹äºä¸€äº›ä¸šåŠ¡ä¸Šå¯ä»¥å¿å—çš„åœºæ™¯ï¼Œå°½é‡ä½¿ç”¨MQæ¥è§£è€¦å’Œé€šä¿¡ï¼Œæ¥é™ä½åŒæ­¥é€šè®¯çš„æœåŠ¡å™¨å‹åŠ›ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Qï¼šç¾¤æ¶ˆæ¯å­˜ä¸€ä»½è¿˜æ˜¯å¤šä»½ï¼Œè¯»æ‰©æ•£è¿˜æ˜¯å†™æ‰©æ•£ï¼Ÿ&lt;/p&gt;
&lt;p&gt;Aï¼šå­˜1ä»½ï¼Œè¯»æ‰©æ•£ã€‚å­˜å¤šä»½ä¸‹åŒä¸€æ¡æ¶ˆæ¯å­˜å‚¨äº†å¾ˆå¤šæ¬¡ï¼Œå¯¹ç£ç›˜å’Œå¸¦å®½é€ æˆäº†å¾ˆå¤§çš„æµªè´¹ã€‚å¯ä»¥åœ¨æ¶æ„ä¸Šå’Œä¸šåŠ¡ä¸Šè¿›è¡Œä¼˜åŒ–ï¼Œæ¥å®ç°è¯»æ‰©æ•£ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Qï¼šæ¶ˆæ¯IDä¸ºä»€ä¹ˆæ˜¯è¶‹åŠ¿é€’å¢å°±å¯ä»¥ï¼Œä¸¥æ ¼é€’å¢çš„ä¸è¡Œå—ï¼Ÿ&lt;/p&gt;
&lt;p&gt;Aï¼šä¸¥æ ¼é€’å¢ä¼šæœ‰å•ç‚¹æ€§èƒ½ç“¶é¢ˆï¼Œæ¯”å¦‚MySQL auto incrementsï¼›redisæ€§èƒ½å¥½ä½†æ˜¯æ²¡æœ‰ä¸šåŠ¡è¯­ä¹‰ï¼Œæ¯”å¦‚ç¼ºå°‘æ—¶é—´å› ç´ ï¼Œè¿˜å¯èƒ½ä¼šæœ‰æ•°æ®ä¸¢å¤±çš„é£é™©ï¼Œå¹¶ä¸”é›†ç¾¤ç¯å¢ƒä¸‹å†™å…¥IDä¹Ÿå±äºå•ç‚¹ï¼Œå±äºé›†ä¸­å¼ç”ŸæˆæœåŠ¡ã€‚å°å‹IMå¯ä»¥æ ¹æ®ä¸šåŠ¡åœºæ™¯éœ€æ±‚ç›´æ¥ä½¿ç”¨redisçš„incrå‘½ä»¤æ¥å®ç°IMæ¶ˆæ¯å”¯ä¸€IDã€‚æœ¬é¡¹ç›®é‡‡ç”¨snowflakeç®—æ³•å®ç°å”¯ä¸€è¶‹åŠ¿é€’å¢IDï¼Œå³å¯å®ç°IMæ¶ˆæ¯ä¸­ï¼Œæ—¶åºæ€§ï¼Œé‡å¤æ€§ä»¥åŠæŸ¥æ‰¾åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Qï¼šä¸ºä»€ä¹ˆgateå±‚æ³›åŒ–è°ƒç”¨logicå±‚ï¼Œrouterå±‚æ³›åŒ–è°ƒç”¨gateå±‚ï¼Ÿ&lt;/p&gt;
&lt;p&gt;Aï¼šgateå±‚ç›´æ¥è°ƒç”¨logicå±‚ï¼Œä¸éœ€è¦è°ƒç”¨routerå±‚ï¼Œå‡å°‘ç½‘ç»œä¼ è¾“å’ŒRTæ—¶é—´ï¼Œå¢åŠ ä¸€ä¸ªæœåŠ¡,å°±å¤šäº†ä¸€æ¡é“¾è·¯, å°±å¯èƒ½ä¼šå¯¼è‡´æœåŠ¡é“¾è·¯è¿‡é•¿,ç¨³å®šæ€§ä¸‹é™ã€‚æ³›åŒ–è°ƒç”¨çš„ç›®çš„æ˜¯è§£è€¦ç½‘å…³å’ŒæœåŠ¡ï¼Œä½¿å…¶ä¸ç›¸äº’å½±å“ã€‚routerå±‚æ³›åŒ–è°ƒç”¨gateå±‚ï¼Œç›®çš„ä¹Ÿæ˜¯è§£è€¦gateå±‚å’Œrouterå±‚ï¼Œé˜²æ­¢å„è‡ªå±‚çº§æœºå™¨æ‰©å®¹ç¼©å®¹é‡å¯å‡çº§ç­‰åœºæ™¯ä¸‹äº’ç›¸å½±å“ï¼Œå¹¶ä¸”routeréœ€è¦å…·ä½“è°ƒç”¨æŸä¸€å°gateå±‚æœºå™¨ï¼Œæ³›åŒ–åˆšå¥½èƒ½å®ç°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Qï¼šgateå±‚ä¸ºä»€ä¹ˆéœ€è¦å¼€ä¸¤ä¸ªç«¯å£ï¼Ÿ&lt;/p&gt;
&lt;p&gt;Aï¼šgateä¼šæ¥æ”¶å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ï¼ˆè¢«åŠ¨ï¼‰ï¼Œéœ€è¦å¤–ç½‘ç›‘å¬ç«¯å£ï¼›entryä¼šä¸»åŠ¨ç»™logicå‘è¯·æ±‚ï¼ˆä¸»åŠ¨ï¼‰ï¼›entryä¼šæ¥æ”¶routerç»™å®ƒçš„é€šçŸ¥è¯·æ±‚ï¼ˆè¢«åŠ¨ï¼‰ï¼Œéœ€è¦å†…ç½‘ç›‘å¬ç«¯å£ã€‚ä¸€ä¸ªç«¯å£å¯¹å†…ï¼Œä¸€ä¸ªç«¯å£å¯¹å¤–ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Qï¼šç”¨æˆ·çš„åœ¨çº¿çŠ¶æ€ï¼Œæ˜¯ç»´æŠ¤åœ¨ä¸­å¤®å­˜å‚¨çš„redisä¸­ï¼Œè¿˜æ˜¯ç»´æŠ¤åœ¨æ¯ä¸ªgateå±‚å†…å­˜ä¸­ï¼Ÿ&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Aï¼šå¦‚æœç»´æŠ¤åœ¨æ¯ä¸ªgateå±‚å†…å­˜çš„è¯ï¼Œrouterå±‚æ— æ³•çŸ¥æ™“ç›®æ ‡çš„ç”¨æˆ·ä¼šè¯åœ¨å“ªä¸ªgateå±‚ï¼Œåªèƒ½é€šè¿‡MQæˆ–è€…å¹¿æ’­åˆ°gateå±‚ï¼Œç„¶ågateå±‚åšè¿‡æ»¤å¤„ç†ã€‚è¿™ç§å¤„ç†æ–¹å¼çš„ç¼ºç‚¹å°±æ˜¯ä¼šå¤šæ¶ˆè€—ç½‘ç»œèµ„æºï¼Œå¥½å¤„ä¹Ÿæ˜æ˜¾ï¼Œä¸éœ€è¦ä¸­å¤®ç»´æŠ¤èµ„æºï¼Œé«˜å¹¶å‘æŸ¥è¯¢ä¸‹ä¼šå¢åŠ æ€§èƒ½ã€‚å¦‚æœç»´æŠ¤åœ¨ä¸­å¤®å­˜å‚¨çš„è¯ï¼Œç›¸æ¯”å„è‡ªå­˜å‚¨ä¸éœ€è¦æ¶ˆè€—å¤ªå¤šçš„ç½‘ç»œèµ„æºï¼Œä½†ç¼ºç‚¹å°±æ˜¯éœ€è¦ç»´æŠ¤ä¸­å¤®å­˜å‚¨çš„redis&lt;/p&gt;
&lt;h3 id=&#34;2-æŠ€æœ¯ç»†èŠ‚&#34;&gt;2 æŠ€æœ¯ç»†èŠ‚&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Qï¼šæœ¬åœ°å†™æ•°æ®æˆåŠŸï¼Œä¸€å®šä»£è¡¨å¯¹ç«¯åº”ç”¨ä¾§æ¥æ”¶è¯»å–æ¶ˆæ¯äº†å—ï¼Ÿ&lt;/p&gt;
&lt;p&gt;Aï¼šæœ¬åœ°TCPå†™æ“ä½œæˆåŠŸï¼Œä½†æ•°æ®å¯èƒ½è¿˜åœ¨æœ¬åœ°å†™ç¼“å†²åŒºä¸­ã€ç½‘ç»œé“¾è·¯è®¾å¤‡ä¸­ã€å¯¹ç«¯è¯»ç¼“å†²åŒºä¸­ï¼Œå¹¶ä¸ä»£è¡¨å¯¹ç«¯åº”ç”¨è¯»å–åˆ°äº†æ•°æ®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Qï¼šä¸ºä»€ä¹ˆç”¨nettyåšæ¥åšhttpç½‘å…³, è€Œä¸ç”¨tomcatï¼Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;nettyå¯¹è±¡æ± ï¼Œå†…å­˜æ± ï¼Œé«˜æ€§èƒ½çº¿ç¨‹æ¨¡å‹&lt;/li&gt;
&lt;li&gt;nettyå †å¤–å†…å­˜ç®¡ç†ï¼Œå‡å°‘GCå‹åŠ›ï¼Œjvmç®¡ç†çš„åªæ˜¯ä¸€ä¸ªå¾ˆå°çš„DirectByteBufferå¯¹è±¡å¼•ç”¨&lt;/li&gt;
&lt;li&gt;tomcatè¯»å–æ•°æ®å’Œå†™å…¥æ•°æ®éƒ½éœ€è¦ä»å†…æ ¸æ€ç¼“å†²copyåˆ°ç”¨æˆ·æ€çš„JVMä¸­ï¼Œå¤š1æ¬¡æˆ–è€…2æ¬¡çš„æ‹·è´ä¼šæœ‰æ€§èƒ½å½±å“&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Qï¼šä¸ºä»€ä¹ˆæ¶ˆæ¯å…¥åº“åï¼Œå¯¹äºåœ¨çº¿çŠ¶æ€çš„ç”¨æˆ·ï¼Œå•èŠç›´æ¥æ¨é€ï¼Œç¾¤èŠé€šçŸ¥å®¢æˆ·ç«¯æ¥æ‹‰å–ï¼Œè€Œä¸æ˜¯ç›´æ¥æ¨é€æ¶ˆæ¯ç»™å®¢æˆ·ç«¯ï¼ˆæ¨æ‹‰ç»“åˆï¼‰ï¼Ÿ&lt;/p&gt;
&lt;p&gt;Aï¼šåœ¨ä¿è¯æ¶ˆæ¯å®æ—¶æ€§çš„å‰æä¸‹ï¼Œå¯¹äºå•èŠï¼Œç›´æ¥æ¨é€ã€‚å¯¹äºç¾¤èŠï¼Œç”±äºç¾¤èŠäººæ•°å¤šï¼Œæ¨é€çš„è¯ä¸€ä»½ç¾¤æ¶ˆæ¯ä¼šå¯¹ç¾¤å†…æ‰€æœ‰çš„ç”¨æˆ·éƒ½äº§ç”Ÿä¸€ä»½æ¨é€çš„æ¶ˆæ¯ï¼Œæ¨é€é‡å·¨å¤§ã€‚è§£å†³åŠæ³•æ˜¯æŒ‰éœ€æ‹‰å–ï¼Œå½“ç¾¤æ¶ˆæ¯æœ‰æ–°æ¶ˆæ¯æ—¶å€™å‘é€æ—¶å€™ï¼ŒæœåŠ¡ç«¯ä¸»åŠ¨æ¨é€æ–°çš„æ¶ˆæ¯æ•°é‡ï¼Œç„¶åå®¢æˆ·ç«¯åˆ†é¡µæŒ‰éœ€æ‹‰å–æ•°æ®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Qï¼šä¸ºä»€ä¹ˆé™¤äº†å•èŠ ç¾¤èŠ æ¨é€ ç¦»çº¿æ‹‰å–ç­‰å®æ—¶æ€§ä¸šåŠ¡ï¼Œå…¶ä»–çš„ä¸šåŠ¡éƒ½èµ°httpåè®®ï¼Ÿ&lt;/p&gt;
&lt;p&gt;Aï¼šIMåè®®ç®€å•æœ€å¥½ï¼Œå¦‚æœè®©å…¶ä»–çš„ä¸šåŠ¡è¯·æ±‚æ··è¿›IMåè®®ä¸­ï¼Œä¼šè®©å…¶IMå˜çš„æ›´å¤æ‚ï¼Œæ¯”å¦‚æŸ¥æ‰¾ç¦»çº¿æ¶ˆæ¯è®°å½•æ‹‰å–èµ°httpé€šé“é¿å…tcp é€šé“å‹åŠ›è¿‡å¤§ï¼Œå½±å“å³æ—¶æ¶ˆæ¯ä¸‹å‘æ•ˆç‡ã€‚åœ¨æ¯”å¦‚ä¸Šä¼ å›¾ç‰‡å’Œå¤§æ–‡ä»¶ï¼Œå¯ä»¥åˆ©ç”¨HTTPçš„æ–­ç‚¹ä¸Šä¼ å’Œåˆ†æ®µä¸Šä¼ ç‰¹æ€§&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;å…­-contact&#34;&gt;å…­ã€Contact&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ç½‘ç«™ï¼šzhangyaoo.github.io&lt;/li&gt;
&lt;li&gt;å¾®ä¿¡ï¼šwill_zhangyao&lt;/li&gt;
&lt;/ul&gt;
">åŸºäºNettyå³æ—¶é€šè®¯ç³»ç»Ÿè®¾è®¡ä¸å®ç°</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://zhangyaoo.github.io/post/netty-wei-he-xing-neng-zhe-me-gao/"" data-c="
          &lt;h2 id=&#34;çº¿ç¨‹æ¨¡å‹&#34;&gt;çº¿ç¨‹æ¨¡å‹&lt;/h2&gt;
&lt;p&gt;å†…å­˜æ¨¡å‹ï¼š&lt;br&gt;
é”æ¨¡å‹ï¼š&lt;br&gt;
ç½‘ç»œIOæ¨¡å‹ï¼š&lt;br&gt;
é›¶æ‹·è´ï¼š&lt;br&gt;
å†…å­˜æ± ï¼š&lt;br&gt;
å †å¤–å†…å­˜ï¼šä¸å—å †å†…å­˜çš„å¤§å°çš„å½±å“ï¼ŒJVMå†…å­˜æŒæœ‰å †å¤–å†…å­˜çš„å¼•ç”¨ï¼Œå¥½å¤„æ˜¯ä¸å—GCåœé¡¿å¸¦æ¥çš„å½±å“ã€‚å †å¤–å†…å­˜åŸºäºå¼•ç”¨è®¡æ•°æ¥è¿›è¡Œå›æ”¶&lt;br&gt;
å…¶ä»–ï¼šè‡ªå»ºFastThreadLocalï¼ŒåŸºæœ¬ç±»å‹ä»£æ›¿å¼•ç”¨ç±»å‹ï¼Œæµ·é‡å¯¹è±¡åœºæ™¯ç±»FieldUpdaterå¯¹è±¡ä»£æ›¿åŸå­ç±»ï¼ŒIntObjectMapä»£æ›¿HashMapï¼ŒwrappedBufé¿å…å†…å­˜å¤åˆ¶ï¼Œå†…å»ºå¤šç§åºåˆ—åŒ–æ–¹å¼ï¼Œå¤šç§ç²˜åŒ…å’ŒåŠåŒ…å¤„ç†å’Œè‡ªå®šä¹‰å¤„ç†&lt;/p&gt;
">Nettyä¸ºä½•æ€§èƒ½è¿™ä¹ˆé«˜</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://zhangyaoo.github.io/post/jie-gou-hua-si-wei/"" data-c="
          &lt;h3 id=&#34;what&#34;&gt;whatï¼š&lt;/h3&gt;
&lt;p&gt;æ˜¯ä¸€ç§ä»¥æ— åºåˆ°æœ‰åºçš„æ•´ç†ä¿¡æ¯å’Œæ„å»ºç»“æ„åŒ–çš„æ€ç»´æ–¹å¼ï¼Œç›®çš„æ˜¯å‡å°‘è®¤çŸ¥å¤æ‚åº¦ï¼Œæ˜¯çš„æ›´åŠ è¢«å®¹æ˜“ç†è§£å’Œè®°å¿†ï¼Œè¡¨è¾¾æ¸…æ™°&lt;/p&gt;
&lt;h3 id=&#34;why&#34;&gt;why:&lt;/h3&gt;
&lt;p&gt;0213645879 å’Œ 0123456789ï¼Œè¿™ä¸¤ä¸²æ•°å­—å“ªä¸ªæ›´å®¹æ˜“è¢«äººè®°ä½ã€‚&lt;br&gt;
å½“ç„¶æ˜¯æŒ‰ç…§é¡ºåºæ’åˆ—çš„æ•°å­—ä¸²æ¯”æ‚ä¹±æ— åºæ’åˆ—çš„è¦æ›´å®¹æ˜“è¢«è®°ä½ã€‚&lt;br&gt;
å› ä¸ºäººç±»æ›´å®¹æ˜“è®°ä½ç»“æ„åŒ–çš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h3 id=&#34;how&#34;&gt;howï¼š&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1627012568883.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å¡”å°–å°±æ˜¯æˆ‘ä»¬çš„ä¸­å¿ƒæ€æƒ³æˆ–ä¸»é¢˜ã€‚å¡”èº«å°±æ˜¯æ„æˆä¸­å¿ƒæ€è€ƒæˆ–è€…ä¸»é¢˜çš„å„ä¸ªåˆ†è®ºç‚¹ã€‚è€Œå¡”åŸºåˆ™æ˜¯æ”¯æ’‘å„ä¸ªåˆ†è®ºç‚¹çš„è¦ç´ æˆ–è®ºæ®&lt;/p&gt;
&lt;p&gt;1ã€ç»¼ä¸Šè€Œä¸‹çš„ç»“æ„åŒ–æ€ç»´&lt;br&gt;
çºµå‘æ˜¯è‡ªä¸Šè€Œä¸‹çš„å±‚æ¬¡çš„å…³ç³»ï¼Œä¸‹ä¸€å±‚æ˜¯ä¸Šä¸€å±‚çš„è§£é‡Šå’Œæ„æˆï¼Œä¸Šä¸€å±‚æ˜¯ä¸‹ä¸€å±‚çš„æ€»ç»“å’Œæ¦‚æ‹¬&lt;br&gt;
æ¯”å¦‚ï¼Œå…ˆç»™ç»“è®ºåç»™åŸå› ï¼Œå…ˆç›®çš„åæ–¹æ³•ï¼Œå…ˆæŠ½è±¡åå…·ä½“ï¼Œå…ˆæ•´ä½“åéƒ¨åˆ†&lt;br&gt;
2ã€ä»å·¦å¾€å³çš„é¡ºåºæ€ç»´ï¼Œåœ¨åŒä¸€ä¸ªç»„å†…å¿…é¡»æ˜¯åŒä¸€ä¸ªé€»è¾‘èŒƒç•´ï¼ŒæŒ‰ç…§é¡ºåºæ¥ç»„ç»‡&lt;/p&gt;
&lt;h4 id=&#34;å…·ä½“çš„æ­¥éª¤&#34;&gt;å…·ä½“çš„æ­¥éª¤ï¼š&lt;/h4&gt;
&lt;p&gt;1ã€ç¡®å®šé—®é¢˜äº§ç”ŸèƒŒæ™¯&lt;br&gt;
2ã€ç¡®å®šæ ¸å¿ƒç›®æ ‡&lt;br&gt;
3ã€æ‹†è§£æ ¸å¿ƒç›®æ ‡&lt;br&gt;
4ã€ç»§ç»­åˆ†è§£ï¼Œç›´åˆ°èƒ½å¤ŸæŠŠé—®é¢˜è§£é‡Šæ¸…æ¥šï¼Œå½¢æˆæ–¹æ³•è®º&lt;/p&gt;
&lt;h3 id=&#34;example&#34;&gt;example&lt;/h3&gt;
&lt;h4 id=&#34;1-é‡‡è´­æ¸…å•&#34;&gt;1ã€é‡‡è´­æ¸…å•&lt;/h4&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1627012578248.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h4 id=&#34;2-å¸¦å›¢é˜Ÿ&#34;&gt;2ã€å¸¦å›¢é˜Ÿ&lt;/h4&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1627012581164.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h4 id=&#34;3-äº‹æƒ…åˆ’åˆ†æ–¹æ³•&#34;&gt;3ã€äº‹æƒ…åˆ’åˆ†æ–¹æ³•&lt;/h4&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;3&#34;&gt;&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1627012584884.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
">æµ…è°ˆç»“æ„åŒ–æ€ç»´</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://zhangyaoo.github.io/post/hikaridatasource-he-xin-yuan-ma-fen-xi/"" data-c="
          &lt;h2 id=&#34;ä¸€-å‰è¨€&#34;&gt;ä¸€ã€å‰è¨€&lt;/h2&gt;
&lt;p&gt;ä¸Šä¸€ç¯‡æ–‡ç« è®²äº†ä¸åˆç†çš„è¿æ¥æ± ä»£ç å¯¼è‡´çš„å†…å­˜æ³„éœ²äº‹ä»¶ï¼Œè¯¦è§è¿™ç¯‡æ–‡ç« &lt;a href=&#34;https://zhangyaoo.github.io/post/ji-yi-ci-duo-shu-ju-yuan-lu-you-zao-cheng-de-shu-ju-ku-lian-jie-nei-cun-xie-lu/&#34;&gt;è®°ä¸€æ¬¡å¤šæ•°æ®æºè·¯ç”±é€ æˆçš„æ•°æ®åº“è¿æ¥æ³„éœ²æ’æŸ¥è¿‡ç¨‹&lt;/a&gt;ã€‚å…¶ä¸­ç²—ç•¥çš„åˆ†æäº†HikariDataSourceè¿æ¥æ± çš„ä»£ç ï¼Œå¹¶æ²¡æœ‰ä»”ç»†åˆ†æã€‚æœ¬ç¯‡æ–‡ç« å¸¦è¯»è€…ä»¬ä¸€èµ·å»åˆ†æä¸€æ³¢æºç ï¼Œçœ‹å®Œæœ¬ç¯‡æ–‡ç« åï¼Œä½ å¯ä»¥&lt;br&gt;
1ã€å¯¹é”å’Œé«˜å¹¶å‘æœ‰ä¸€å®šç†è§£ä»¥åŠå…¶åœ¨è¿æ¥æ± ä¸­çš„è¿ç”¨&lt;br&gt;
2ã€äº†è§£HikariDataSourceä¸šç•Œæ€§èƒ½æœ€é«˜è¿æ¥æ± çš„åŸå› &lt;br&gt;
3ã€å¯ä»¥å¯¹è¿æ¥æ± çš„åŸç†æœ‰å¤§è‡´çš„äº†è§£ï¼Œå¯ä»¥å°è¯•è‡ªå·±å®ç°ä¸€ä¸ªè¿æ¥æ± &lt;/p&gt;
&lt;h2 id=&#34;äºŒ-æºç åˆ†æ&#34;&gt;äºŒã€æºç åˆ†æ&lt;/h2&gt;
&lt;h3 id=&#34;20-å…³é”®ä»£ç ç±»ä»‹ç»&#34;&gt;2.0 å…³é”®ä»£ç ç±»ä»‹ç»&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;HikariDataSourceå¯¹è±¡ï¼šHikariä¸­çš„æ ¸å¿ƒç±»ä¸ºHikariDataSourceï¼Œå®ç°äº†DataSourceçš„getConnetionæ¥å£&lt;/li&gt;
&lt;li&gt;HikariPoolå¯¹è±¡ï¼šHikariDataSourceä¸­æœ‰ä¸¤ä¸ªHikariPoolå¯¹è±¡,ä¸€ä¸ªæ˜¯fastPathPoolæ˜¯åœ¨HikariPoolæœ‰å‚æ„é€ å‡½æ•°ä¸­åˆ›å»º, å¦‚æœæ²¡æœ‰åˆ›å»ºfastPathPool,é‚£ä¹ˆå°±ä¼šåœ¨getConnectionæ–¹æ³•æ—¶åˆ›å»ºpoolå¯¹è±¡ã€‚&lt;/li&gt;
&lt;li&gt;ConcurrentBagå¯¹è±¡ï¼šè¿æ¥æ± çš„çœŸæ­£å®ç°ï¼Œå®ç°äº†&lt;strong&gt;é«˜æ€§èƒ½é«˜å¹¶å‘çš„æ— é”è®¾è®¡&lt;/strong&gt;ï¼Œä¸»è¦çš„æ–¹æ³•æœ‰borrow å€Ÿ,requite å½’è¿˜,add æ–°å¢,remove å»é™¤ã€‚&lt;/li&gt;
&lt;li&gt;PoolEntryå¯¹è±¡ï¼šå¯¹æ•°æ®åº“connectionå¯¹è±¡è¿›è¡ŒåŒ…è£…ï¼Œå¢åŠ é¢å¤–çš„å±æ€§ï¼ŒåŒ…æ‹¬æœ€åä¸€æ¬¡è®¿é—®æ—¶é—´ï¼Œæ˜¯å¦ä¸¢å¼ƒï¼Œå½“å‰çŠ¶æ€ç­‰ç­‰ã€‚HikariDataSourceæºç åº•å±‚é‡Œé¢éƒ½æ˜¯æ“ä½œè¿™ä¸ªå¯¹è±¡ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;21-åˆå§‹åŒ–ä»¥ä¸‹æ‰€æœ‰ä»£ç åªåˆ—å‡ºå…³é”®å®ç°&#34;&gt;2.1 åˆå§‹åŒ–ï¼ˆä»¥ä¸‹æ‰€æœ‰ä»£ç åªåˆ—å‡ºå…³é”®å®ç°ï¼‰&lt;/h3&gt;
&lt;p&gt;åˆå§‹åŒ–å·¥ä½œåŒ…æ‹¬HikariDataSourceåˆå§‹åŒ–ï¼ŒHikariPoolåˆå§‹åŒ–ï¼ŒconnectionBagåˆå§‹åŒ–ï¼Œä¸€äº›çº¿ç¨‹æ± çš„åˆå§‹åŒ–ï¼Œæœ€å°è¿æ¥æ•°çš„åˆå§‹åŒ–ï¼Œä»¥ä¸‹é€ä¸€åˆ†æ&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public HikariDataSource(HikariConfig configuration)
{
  // ä¸€ä¸ªdatasourceæœ‰ä¸¤ä¸ªHikariPoolæˆå‘˜å˜é‡ï¼ŒfastPathPoolæ— å‚æ„é€ ä¸ºnullï¼Œç”¨finalä¿®é¥°ï¼Œpoolæœ‰å‚æ„é€ ï¼Œç”¨volatileä¿®é¥°
  // å› ä¸ºvolatileä¿®é¥°çš„å¯¹è±¡ï¼Œéœ€è¦ä»ä¸»å†…å­˜è¯»å–ï¼Œè€Œä¸”éœ€è¦å†™å…¥ä¸»å†…å­˜ç­‰æ“ä½œï¼Œæ‰€ä»¥æœ€å¥½åœ¨ä½¿ç”¨ä¸Šç”¨æœ‰å‚æ„é€ æ¥æ„é€ HikariDataSource
  pool = fastPathPool = new HikariPool(this);
  // è¿æ¥æ± é…ç½®é”å®šæ— æ³•ä¿®æ”¹
  this.seal();
}
// HikariPoolåˆå§‹åŒ–æˆå‘˜å˜é‡EntryCreatorï¼Œåˆ›å»ºPoolEntryçš„ä»»åŠ¡
private final PoolEntryCreator postFillPoolEntryCreator = new PoolEntryCreator(&amp;quot;After adding &amp;quot;);

public HikariPool(final HikariConfig config)
{
  // åˆå§‹åŒ–é…ç½®ï¼Œæ ¹æ®é…ç½®ç”Ÿæˆdatasourceå˜é‡
  super(config);
  // ç”ŸæˆçœŸæ­£çš„è¿æ¥æ± ï¼Œåç»­çš„è·å–è¿æ¥é‡Šæ”¾è¿æ¥éƒ½æ˜¯ä»è¿™é‡Œé¢å¼„çš„
  this.connectionBag = new ConcurrentBag&amp;lt;&amp;gt;(this);
  // æµ‹è¯•æ•°æ®åº“çš„è¿é€šæ€§
  checkFailFast();
  // å¢åŠ è¿æ¥çš„çº¿ç¨‹æ± 
  this.addConnectionExecutor = createThreadPoolExecutor(addConnectionQueue, poolName + &amp;quot; connection adder&amp;quot;, threadFactory, new ThreadPoolExecutor.DiscardOldestPolicy());
  // å…³é—­è¿æ¥çš„çº¿ç¨‹æ± 
  this.closeConnectionExecutor = createThreadPoolExecutor(maxPoolSize, poolName + &amp;quot; connection closer&amp;quot;, threadFactory, new ThreadPoolExecutor.CallerRunsPolicy());
  // åˆå§‹åŒ–ç»´æŒæœ€å°è¿æ¥æ•°ä»»åŠ¡
  this.houseKeeperTask = houseKeepingExecutorService.scheduleWithFixedDelay(new HouseKeeper(), 100L, housekeepingPeriodMs, MILLISECONDS);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;é‡ç‚¹æ˜¯ç»´æŒæœ€å°è¿æ¥æ•°ä»»åŠ¡ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;private final class HouseKeeper implements Runnable{
  public void run(){
     // Detect retrograde time, allowing +128ms as per NTP spec.
    if (plusMillis(now, 128) &amp;lt; plusMillis(previous, housekeepingPeriodMs)) {
       previous = now;
       // æ ‡ä¸ºä¸¢å¼ƒçš„è¿æ¥å…³é—­
       softEvictConnections();
       return;
    }
    if (idleTimeout &amp;gt; 0L &amp;amp;&amp;amp; config.getMinimumIdle() &amp;lt; config.getMaximumPoolSize()) {
       // è·å–å½“å‰è¿æ¥æ± ä¸­å·²ç»ä¸æ˜¯ä½¿ç”¨ä¸­çš„è¿æ¥é›†åˆ
       final List&amp;lt;PoolEntry&amp;gt; notInUse = connectionBag.values(STATE_NOT_IN_USE);
       int toRemove = notInUse.size() - config.getMinimumIdle();
       for (PoolEntry entry : notInUse) {
          // å¦‚æœPoolEntryçš„æœ€åä¸€æ¬¡è®¿é—®çš„æ—¶é—´è¶…è¿‡äº†idleTimeoutå¹¶ä¸”å°†è¿™ä¸ªPoolEntryçš„çŠ¶æ€å˜ä¸ºä¸å¯å€ŸçŠ¶æ€STATE_RESERVED
          // STATE_RESERVEDçŠ¶æ€åº•å±‚å˜æ›´æ˜¯CASå˜æ›´ï¼Œç”¨åˆ°çš„ç±»æ˜¯AtomicIntegerFieldUpdaterï¼Œå¯ä»¥å¯¹æŒ‡å®šç±»çš„æŒ‡å®š volatile int å­—æ®µè¿›è¡ŒåŸå­æ›´æ–°
          if (toRemove &amp;gt; 0 &amp;amp;&amp;amp; elapsedMillis(entry.lastAccessed, now) &amp;gt; idleTimeout &amp;amp;&amp;amp; connectionBag.reserve(entry)) {
             // å…³é—­è¿æ¥
             closeConnection(entry, &amp;quot;(connection has passed idleTimeout)&amp;quot;);
             toRemove--;
          }
       }
    }
    // å¡«å……æœ€å°è¿æ¥åˆ°minimumã€‚ åœ¨åˆå§‹åŒ–æ—¶å€™å°±å¡«å……è¿æ¥ï¼Œå¼‚æ­¥å¡«å……
    fillPool();
  }
}
// å¡«å……è¿æ¥
// å½“æ²¡æœ‰è¾¾åˆ°æœ€å¤§è¿æ¥æ•°ä¹‹å‰ æˆ–è€… ç©ºé—²è¿æ¥æ•°å°äºæœ€å°è¿æ¥æ•°æ—¶å€™ å°±å¼‚æ­¥æäº¤åˆ›å»ºpoolEntryCreatorä»»åŠ¡
private synchronized void fillPool(){
  final int connectionsToAdd = Math.min(config.getMaximumPoolSize() - getTotalConnections(), config.getMinimumIdle() - getIdleConnections())
                               - addConnectionQueueReadOnlyView.size();
  for (int i = 0; i &amp;lt; connectionsToAdd; i++) {
     addConnectionExecutor.submit((i &amp;lt; connectionsToAdd - 1) ? poolEntryCreator : postFillPoolEntryCreator);
  }
}

// å…³é—­è¿æ¥
void closeConnection(final PoolEntry poolEntry, final String closureReason){
    // å¦‚æœremoveæˆåŠŸï¼Œå°†çŠ¶æ€è®¾ç½®ä¸ºSTATE_REMOVED
	if (connectionBag.remove(poolEntry)) {
     final Connection connection = poolEntry.close();
     // å¼‚æ­¥å…³é—­
     closeConnectionExecutor.execute(() -&amp;gt; {
        quietlyCloseConnection(connection, closureReason);
        if (poolState == POOL_NORMAL) {
           fillPool();
        }
     });
  }
}

&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä»¥ä¸Šå¤§è‡´é€»è¾‘å°±æ˜¯ï¼Œå°†è¢«æ ‡ä¸ºä¸¢å¼ƒçš„è¿æ¥å…³é—­ï¼Œå°†ç©ºé—²è¶…æ—¶çš„è¿æ¥è¿›è¡Œå…³é—­ï¼Œç„¶åè¿›è¡Œè¿›è¿æ¥å¡«å……è¿æ¥ï¼Œå¡«å……è¿æ¥çš„é€»è¾‘å°±æ˜¯å¢åŠ poolEntryCreatorä»»åŠ¡,poolEntryCreatoré€»è¾‘åœ¨åé¢åˆ†æã€‚&lt;/p&gt;
&lt;h3 id=&#34;22-è·å–è¿æ¥&#34;&gt;2.2 è·å–è¿æ¥&lt;/h3&gt;
&lt;p&gt;è·å–è¿æ¥æ˜¯ä¸»è¦çš„å®ç°é€»è¾‘ï¼Œé¦–å…ˆçœ‹HikariDataSourceå¯¹è±¡getConnnectionæ–¹æ³•&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;// åŒé‡é”å®ç°
public Connection getConnection(){
	HikariPool result = pool;
	if (result == null) {
	 synchronized (this) {
	    result = pool;
	    if (result == null) {
	       pool = result = new HikariPool(this);
	       // é”å®šé…ç½®ï¼Œä¸èƒ½çƒ­æ›´æ–°é…ç½®
	       this.seal();
	    }
	 }
	}
	return result.getConnection();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;result.getConnection()å°±æ˜¯HikariPool getConnectionæ–¹æ³•ï¼Œè¿™é‡Œé¢å¤§è‡´æ ¸å¿ƒé€»è¾‘å°±æ˜¯åŠ é”åœ¨è¶…æ—¶æ—¶é—´å†…è·å–poolEntryçš„connectionBag.borrowæ–¹æ³•ï¼Œé‡ç‚¹ç€é‡borrowæ–¹æ³•å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è®²ä¹‹å‰ï¼Œå…ˆä»‹ç»ä»¥ä¸‹connectionBagçš„å‡ ä¸ªé‡è¦çš„æˆå‘˜å˜é‡&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;final CopyOnWriteArrayList&lt;T&gt; sharedListï¼šå½“å‰æ‰€æœ‰ç¼“å­˜çš„poolEntryè¿æ¥ï¼Œéƒ½åœ¨è¿™ä¸ªlistå†…ï¼ŒCopyOnWriteArrayListå†™æ—¶å¤åˆ¶ï¼Œåœ¨è¯»å¤šå†™å°‘çš„åœºæ™¯ä¸‹æ€§èƒ½æ›´é«˜ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¿æ¥æ± ä¸­çš„poolEntryè¿æ¥ä¸ä¼šå¢åŠ æˆ–è€…å…³é—­ï¼Œè¯»åœºæ™¯å¤šã€‚&lt;/li&gt;
&lt;li&gt;final ThreadLocal&amp;lt;List&lt;Object&gt;&amp;gt; threadList ï¼šå½“å‰çº¿ç¨‹ç¼“å­˜çš„æœ¬åœ°poolEntryçš„listã€‚æœç”Ÿå¤•ç­çš„çº¿ç¨‹ï¼Œæ˜¯æ— æ³•æœ‰æ•ˆåˆ©ç”¨æœ¬åœ°çº¿ç¨‹ç¼“å­˜çš„ï¼Œåªæœ‰åœ¨çº¿ç¨‹æ± åœºæ™¯æˆ–è€…å½“å‰çº¿ç¨‹å¤šæ¬¡ä½¿ç”¨getConnetionè·å–connectionæ–¹æ³•è¿›è¡Œå¢åˆ æ”¹æ—¶å€™ï¼Œæ‰ä¼šæœ‰æ•ˆçš„ä½¿ç”¨ThreadLocalã€‚&lt;/li&gt;
&lt;li&gt;final boolean weakThreadLocalsï¼šæ˜¯å¦æ˜¯å¼±å¼•ç”¨ï¼ŒThreadLocalå¯èƒ½ä¼šå­˜åœ¨å†…å­˜æ³„éœ²çš„é£é™©ï¼Œå½“å€¼ä¸ºtrueæ—¶åŒ…è£…çš„poolEntryå¯¹è±¡æ˜¯å¼±å¼•ç”¨ï¼Œåœ¨å†…å­˜ä¸è¶³æ—¶GCçš„æ—¶å€™ä¼šè¢«å›æ”¶ï¼Œé¿å…äº†å‡ºç°å†…å­˜æ³„éœ²çš„é—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;final IBagStateListener listenerï¼šç›‘å¬å™¨ï¼Œç›‘å¬åˆ›å»ºpoolEntryçš„ä»»åŠ¡&lt;/li&gt;
&lt;li&gt;final AtomicInteger waitersï¼šå½“å‰æ­£åœ¨ç­‰å¾…è·å–è¿æ¥çš„æ•°é‡&lt;/li&gt;
&lt;li&gt;final SynchronousQueue&lt;T&gt; handoffQueueï¼šæ— å­˜å‚¨å…ƒç´ çš„å•ä¸ªæä¾›è€…å’Œæ¶ˆè´¹è€…é€šä¿¡é˜Ÿåˆ—ï¼Œå¹¶ä¸”æ˜¯å…¬å¹³æ¨¡å¼ã€‚æ¯”å¦‚ï¼Œæ˜¯è°å…ˆæ¥takeæ“ä½œï¼Œè°å°±ä¼šä¼˜å…ˆtakeæˆåŠŸï¼Œç±»ä¼¼FIFOã€‚&lt;/li&gt;
&lt;li&gt;this.threadList = ThreadLocal.withInitial(() -&amp;gt; new FastList&amp;lt;&amp;gt;(IConcurrentBagEntry.class, 16))ï¼šé»˜è®¤æƒ…å†µä¸‹ä¼šThreadLocal valueé»˜è®¤ä½¿ç”¨fastListæ¥å­˜å‚¨poolEntryï¼ŒfastListæ˜¯Hikariè‡ªå·±å†™ä¸€ä¸ªä¸éœ€è¦èŒƒå›´æ£€æŸ¥çš„ä¸€ä¸ªListï¼Œè€Œä¸”å®ƒçš„removeæ–¹æ³•æ˜¯ä»åå¾€å‰éå†åˆ é™¤çš„ï¼ˆå’ŒarrayListç›¸åï¼‰ï¼Œåˆšå¥½ç¬¦åˆä¸‹é¢å€’å™éå†è·å–poolEntryçš„é€»è¾‘&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public T borrow(long timeout, final TimeUnit timeUnit) throws InterruptedException
   {
      // Try the thread-local list first
      // 1ã€ä¼˜å…ˆä»æœ¬åœ°çº¿ç¨‹ç¼“å­˜ä¸­è·å–poolEntry
      final List&amp;lt;Object&amp;gt; list = threadList.get();
      // å€’å™éå†ï¼Œä¼˜å…ˆè·å–æœ€è¿‘ä½¿ç”¨çš„poolEntry
      for (int i = list.size() - 1; i &amp;gt;= 0; i--) {
         final Object entry = list.remove(i);
         // å¼€å¯å¼±å¼•ç”¨å°±å¯¹valueè¿›è¡Œå¼±å¼•ç”¨åŒ…è£…
         final T bagEntry = weakThreadLocals ? ((WeakReference&amp;lt;T&amp;gt;) entry).get() : (T) entry;
         // CASæˆåŠŸå°±è¿”å›poolEntry
         if (bagEntry != null &amp;amp;&amp;amp; bagEntry.compareAndSet(STATE_NOT_IN_USE, STATE_IN_USE)) {
            return bagEntry;
         }
      }

      // Otherwise, scan the shared list ... then poll the handoff queue
      // 2ã€æœ¬åœ°ç¼“å­˜æ²¡æœ‰ï¼Œé‚£ä¹ˆä»æ‰€æœ‰ç¼“å­˜çš„poolEntryè¿æ¥åˆ—è¡¨ä¸­è·å–
      final int waiting = waiters.incrementAndGet();
      try {
         for (T bagEntry : sharedList) {
            if (bagEntry.compareAndSet(STATE_NOT_IN_USE, STATE_IN_USE)) {
               // If we may have stolen another waiter&#39;s connection, request another bag add.
               // å¦‚æœç­‰å¾…çš„ä»»åŠ¡å¤§äº1ï¼Œæ·»åŠ ä¸€ä¸ªç›‘å¬ä»»åŠ¡
               if (waiting &amp;gt; 1) {
                  listener.addBagItem(waiting - 1);
               }
               return bagEntry;
            }
         }

         // å¦‚æœsharedListéƒ½åœ¨ä½¿ç”¨çŠ¶æ€ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªç›‘å¬ä»»åŠ¡
         listener.addBagItem(waiting);

		 // 3ã€æ‰€æœ‰çš„è¿æ¥æ­£åœ¨è¢«ä½¿ç”¨ï¼Œè¶…æ—¶ç­‰å¾…å…¶ä»–poolEntryè¢«å½’è¿˜é€šçŸ¥handoffQueue
         timeout = timeUnit.toNanos(timeout);
         do {
            final long start = currentTime();
            // ä»é˜»å¡é˜Ÿåˆ—ä¸­è·å–bagEntry
            final T bagEntry = handoffQueue.poll(timeout, NANOSECONDS);
            if (bagEntry == null || bagEntry.compareAndSet(STATE_NOT_IN_USE, STATE_IN_USE)) {
               return bagEntry;
            }

            timeout -= elapsedNanos(start);
         } while (timeout &amp;gt; 10_000);
         return null;
      }finally {
         waiters.decrementAndGet();
      }
   }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä»¥ä¸Šå…·ä½“å®ç°æ­¥éª¤&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¼˜å…ˆä»æœ¬åœ°çº¿ç¨‹ç¼“å­˜ä¸­è·å–poolEntry&lt;/li&gt;
&lt;li&gt;æœ¬åœ°ç¼“å­˜æ²¡æœ‰ï¼Œé‚£ä¹ˆä»æ‰€æœ‰ç¼“å­˜çš„poolEntryè¿æ¥åˆ—è¡¨ä¸­è·å–&lt;/li&gt;
&lt;li&gt;æ‰€æœ‰çš„è¿æ¥æ­£åœ¨è¢«ä½¿ç”¨ï¼Œå¢åŠ ä¸€ä¸ªç›‘å¬ä»»åŠ¡ï¼Œè¿™ä¸ªä»»åŠ¡å°±æ˜¯å¼‚æ­¥åˆ›å»ºpoolEntryï¼Œä»¥ä¾¿ç»™æ­¤æ¬¡é˜»å¡çš„çº¿ç¨‹æä¾›poolEntry&lt;/li&gt;
&lt;li&gt;è¶…æ—¶ç­‰å¾…å…¶ä»–poolEntryè¢«å½’è¿˜æˆ–è€…æ–°å»ºå é€šçŸ¥handoffQueueï¼Œä»¥ä¾¿è·å–poolEntry&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¯ä»¥æ€»ç»“å‡ºï¼ŒHikariè¿æ¥æ± æœ€å¤§é™åº¦ä¸Šå‡å°‘å¤šçº¿ç¨‹é”ç«äº‰ï¼Œæå‡è¿æ¥æ± çš„æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶åçœ‹ä¸€ä¸‹å¼‚æ­¥åˆ›å»ºpoolEntry poolEntryCreatorçš„å®ç°ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;private final class PoolEntryCreator implements Callable&amp;lt;Boolean&amp;gt; {
  @Override
  public Boolean call()
  {
     // åªæœ‰ç‰¹å®šæ¡ä»¶ä¸‹æ‰åˆ›å»ºPoolEntry
     while (poolState == POOL_NORMAL &amp;amp;&amp;amp; shouldCreateAnotherConnection()) {
        // åˆ›å»ºPoolEntry
        final PoolEntry poolEntry = createPoolEntry();
        if (poolEntry != null) {
           // åœ¨è¿æ¥æ± ä¸­å¢åŠ PoolEntry
           connectionBag.add(poolEntry);
           return Boolean.TRUE;
        }
     }

     // Pool is suspended or shutdown or at max size
     return Boolean.FALSE;
  }

  // 1ã€æ€»çš„è¿æ¥æ•°å°äºæœ€å¤§è¿æ¥æ•° 
  // 2ã€å½“å‰è¿æ¥æ± ä¸­çš„ç­‰å¾…è·å–è¿æ¥çš„çº¿ç¨‹å¤§äº0  æˆ–è€… è¿æ¥æ± ä¸­çš„ç©ºé—²è¿æ¥å°äºæœ€å°è¿æ¥æ± æ•°
  // æ»¡è¶³æ‰€æœ‰ä¸Šè¿°æ¡ä»¶åæ‰åˆ›å»ºpoolEntry
  private synchronized boolean shouldCreateAnotherConnection() {
     return getTotalConnections() &amp;lt; config.getMaximumPoolSize() &amp;amp;&amp;amp;
        (connectionBag.getWaitingThreadCount() &amp;gt; 0 || getIdleConnections() &amp;lt; config.getMinimumIdle());
  }
}

// çœŸæ­£åˆ›å»ºpoolEntryçš„å®ç°
private PoolEntry createPoolEntry(){
  try {
      // åˆ›å»ºpoolEntry
     final PoolEntry poolEntry = newPoolEntry();

     final long maxLifetime = config.getMaxLifetime();
     if (maxLifetime &amp;gt; 0) {
        // variance up to 2.5% of the maxlifetime
        final long variance = maxLifetime &amp;gt; 10_000 ? ThreadLocalRandom.current().nextLong( maxLifetime / 40 ) : 0;
        final long lifetime = maxLifetime - variance;
        // å¦‚æœé…ç½®äº†maxlifetimeï¼Œé‚£ä¹ˆä¼šç»™è¿™ä¸€ä¸ªè¿æ¥å¢åŠ ä¸€ä¸ªå»¶è¿Ÿä»»åŠ¡
        // å»¶è¿Ÿä»»åŠ¡ä¸»è¦å°±æ˜¯å°†è¿™ä¸ªè¿æ¥æ ‡è®°ä¸ºEvictä¸å¯ç”¨
        poolEntry.setFutureEol(houseKeepingExecutorService.schedule(
           () -&amp;gt; {
              if (softEvictConnection(poolEntry, &amp;quot;(connection has passed maxLifetime)&amp;quot;, false /* not owner */)) {
                 addBagItem(connectionBag.getWaitingThreadCount());
              }
           },
           lifetime, MILLISECONDS));
     }
     return poolEntry;
  }
  return null;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç”±ä¸Šé¢createPoolEntryå¯ä»¥çŸ¥é“ï¼ŒHikariCPåœ¨ä½¿ç”¨æ—¶ä¸ä¼šå…³é—­è¿æ¥ã€‚å¦‚æœä½¿ç”¨ä¸­çš„è¿æ¥åˆ°è¾¾maxLifetimeæ—¶å®ƒå°†è¢«æ ‡è®°ä¸ºé©±é€ï¼Œå¹¶ä¸”åœ¨ä¸‹ä¸€æ¬¡çº¿ç¨‹å°è¯•å€Ÿç”¨å®ƒæ—¶å°†è¢«é©±é€ï¼Œè¿™ä¹Ÿæ˜¯Hikariè¿æ¥æ± è®¾è®¡çš„ä¸€ä¸ªæ ¸å¿ƒç²¾é«“ã€‚&lt;/p&gt;
&lt;p&gt;å†æ¥çœ‹ä¸€ä¸‹connectionBagçš„addæ–¹æ³•&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public void add(final T bagEntry){
      // åœ¨sharedListå¢åŠ bagEntry
      sharedList.add(bagEntry);
      // spin until a thread takes it or none are waiting
      // æ»¡è¶³ä¸€ä¸‹æ¡ä»¶åï¼Œè®©å‡ºå½“å‰çº¿ç¨‹CPUæ—¶é—´ç‰‡ï¼Œè®©å…¶ä»–çº¿ç¨‹å»å·¥ä½œ
      // 1ã€å½“ç­‰å¾…è·å–è¿æ¥çš„çº¿ç¨‹å¤§äº0  2ã€å½“å‰çš„PoolEntryçŠ¶æ€æ˜¯æ²¡å ç”¨  3ã€æ²¡æœ‰å…¶ä»–çº¿ç¨‹å»ä»é˜Ÿåˆ—ä¸­å–ä»»åŠ¡
      while (waiters.get() &amp;gt; 0 &amp;amp;&amp;amp; bagEntry.getState() == STATE_NOT_IN_USE &amp;amp;&amp;amp; !handoffQueue.offer(bagEntry)) {
         Thread.yield();
      }
   }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œæ–°å¢çš„poolEntryä¼šåŠ å…¥åˆ°sharedListæ‰€æœ‰çš„ç¼“å­˜è¿æ¥ä¸­ï¼Œå¹¶ä¸”è¦æ»¡è¶³ä¸Šè¿°ä¸‰ä¸ªæ¡ä»¶çš„æ—¶å€™ä¼šä¸€ç›´å¾ªç¯è®©å‡ºCPUæ—¶é—´ç‰‡ï¼Œè®©å…¶ä»–çº¿ç¨‹ä»æ— ç•Œé˜Ÿåˆ—ä¸­å»å–è¿æ¥&lt;/p&gt;
&lt;h3 id=&#34;23-é‡Šæ”¾è¿æ¥&#34;&gt;2.3 é‡Šæ”¾è¿æ¥&lt;/h3&gt;
&lt;p&gt;Hikariå®ç°äº†å…³é—­è¿æ¥Connectionçš„æ–¹æ³•ï¼Œä¸æ˜¯çœŸæ­£çš„å…³é—­è¿æ¥ï¼Œè€Œæ˜¯å½’è¿˜åˆ°è¿æ¥æ± å½“ä¸­ï¼Œå®ç°é€»è¾‘åœ¨ProxyConnectionçš„closeæ–¹æ³•ä¸­ï¼Œç„¶åä¼šè°ƒç”¨poolEntryçš„recycleæ–¹æ³•ï¼Œæœ€ç»ˆä¼šè°ƒç”¨ConcurrentBagçš„requiteæ–¹æ³•ï¼Œæˆ‘ä»¬ç€é‡åˆ†æè¿™ä¸ªæ–¹æ³•ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;// æ­¤æ–¹æ³•ä¼šå°†å€Ÿæ¥çš„å¯¹è±¡è¿”å›åˆ°ConcurrentBagä¸­ã€‚å¦‚æœä¸å½’è¿˜ä¼šå¯¼è‡´å†…å­˜æ³„éœ²
public void requite(final T bagEntry){
  // è®¾ç½®ä¸ºæœªä½¿ç”¨çŠ¶æ€ä»¥ä¾¿å…¶ä»–çº¿ç¨‹è·å–è¿æ¥
  bagEntry.setState(STATE_NOT_IN_USE);
  for (int i = 0; waiters.get() &amp;gt; 0; i++) {
     // ä¼ é€’ä¿¡å·ç»™é˜Ÿåˆ—ï¼Œä¼˜å…ˆå‘Šè¯‰å…¶ä»–é˜»å¡ç­‰å¾…è·å–çš„çº¿ç¨‹è·å–poolEntry
     if (bagEntry.getState() != STATE_NOT_IN_USE || handoffQueue.offer(bagEntry)) {
        return;
     }
     // å¾ªç¯å¤šæ¬¡åï¼Œç­‰å¾…é˜»å¡10çº³ç§’
     else if ((i &amp;amp; 0xff) == 0xff) {
        parkNanos(MICROSECONDS.toNanos(10));
     }
     else {
        // è®©å‡ºæ—¶é—´ç‰‡
        Thread.yield();
     }
  }

  // æ›´æ–°æœ€æ–°poolEntryçš„æœ¬åœ°çº¿ç¨‹çš„ç¼“å­˜ä¸­ï¼Œä»¥ä¾¿å½“å‰çº¿ç¨‹ä¸‹æ¬¡è·å–è¿æ¥
  final List&amp;lt;Object&amp;gt; threadLocalList = threadList.get();
  if (threadLocalList.size() &amp;lt; 50) {
     // å¯¹åº”ä¸Šæ–‡ä¸­çš„fastList, æ¯æ¬¡æ–°å¢éƒ½æ˜¯æ”¾åˆ°æ•°ç»„æœ€åé¢
     threadLocalList.add(weakThreadLocals ? new WeakReference&amp;lt;&amp;gt;(bagEntry) : bagEntry);
  }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æœ€åæˆ‘ä»¬åˆ†æä»¥ä¸‹removeæ–¹æ³•ï¼Œå¾ˆç®€å•&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public boolean remove(final T bagEntry)
   {
      if (!bagEntry.compareAndSet(STATE_IN_USE, STATE_REMOVED) &amp;amp;&amp;amp; !bagEntry.compareAndSet(STATE_RESERVED, STATE_REMOVED) &amp;amp;&amp;amp; !closed) {
         LOGGER.warn(&amp;quot;Attempt to remove an object from the bag that was not borrowed or reserved: {}&amp;quot;, bagEntry);
         return false;
      }
      // ä»æ‰€æœ‰ç¼“å­˜çš„listå»é™¤
      final boolean removed = sharedList.remove(bagEntry);
      // ä»å½“å‰æœ¬åœ°çº¿ç¨‹ç¼“å­˜ä¸­å»é™¤
      threadList.get().remove(bagEntry);
      return removed;
   }

&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä»€ä¹ˆæ—¶å€™ä¼šè°ƒç”¨removeï¼Œç¬”è€…æ€»ç»“äº†ä»¥ä¸‹ï¼š&lt;br&gt;
1ã€å½“è°ƒç”¨datasource shutdownæ–¹æ³•æ—¶å€™&lt;br&gt;
2ã€å½“å‰connetionæ²¡æœ‰ç”¨çš„æ—¶å€™ï¼ˆå¯èƒ½æ˜¯MySQLæœåŠ¡å™¨downæœºï¼‰&lt;br&gt;
3ã€å½“å‰conntionè¢«æ ‡è®°ä¸ºä¸¢å¼ƒæ—¶å€™ï¼Œè¶…è¿‡äº†maxLifetimeè¢«æ ‡è®°ä¸ºä¸¢å¼ƒ&lt;br&gt;
4ã€å½“å‰connetionçš„æœ€åä¸€æ¬¡ä½¿ç”¨æ—¶é—´å’Œå½“å‰æ—¶é—´çš„å·®å€¼å¤§äºidleTimeoutæ—¶å€™&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šå¯ä»¥ç†è§£äº†ä»åˆå§‹åŒ–åˆ°getConnectionè·å–è¿æ¥ï¼Œåˆ°closeConnectiondçš„æ ¸å¿ƒé€»è¾‘ï¼Œå®ç°äº†æ ¸å¿ƒé€»è¾‘çš„å°é—­ç¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸‰-è‡ªå·±å†™ä¸ªè¿æ¥æ± éœ€è¦è€ƒè™‘å“ªäº›æ–¹é¢&#34;&gt;ä¸‰ã€è‡ªå·±å†™ä¸ªè¿æ¥æ± éœ€è¦è€ƒè™‘å“ªäº›æ–¹é¢&lt;/h2&gt;
&lt;p&gt;æ ¹æ®ä¸Šé¢åˆ†æçš„æºç ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœè‡ªå·±å®ç°ä¸€ä¸ªè¿æ¥æ± çš„è¯ï¼Œéœ€è¦è€ƒè™‘ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åˆå§‹åŒ–çš„æ­¥éª¤ï¼Œåˆå§‹åŒ–æœ€åˆçš„æœ€å°ç©ºé—²æ•°è¿æ¥&lt;/li&gt;
&lt;li&gt;å–è¿æ¥ï¼Œä»è¿æ¥æ± ä¸­å–ï¼Œå¹¶ä¸”è¦ä¸Šé”&lt;/li&gt;
&lt;li&gt;å½’è¿˜è¿æ¥ï¼Œéœ€è¦æ”¾å›åˆ°è¿æ¥æ± ä¸­ï¼Œè¦ä¸Šé”&lt;/li&gt;
&lt;li&gt;å¦‚æœè¿æ¥æ± å…¨è¢«å ç”¨ï¼Œæ˜¯è¿”å›å¤±è´¥ï¼Œè¿˜æ˜¯è®©ä¸Šæ¸¸ç­‰å¾…&lt;/li&gt;
&lt;li&gt;æ‹¿åˆ°çš„è¿æ¥ï¼Œéœ€è¦æ£€æµ‹è¿™ä¸ªè¿æ¥æ˜¯å¦å¯ç”¨ï¼Œæ˜¯å¦è¿˜æ˜¯æ´»çš„ï¼Œå› ä¸ºä¸çŸ¥é“æœåŠ¡ç«¯æ˜¯å¦æŒ‚æ‰ï¼ŒæŠ‘æˆ–æ˜¯è¿æ¥è¶…è¿‡maxlifeè¢«æ ‡è®°ä¸ºevitæ­£åœ¨å…³é—­&lt;/li&gt;
&lt;li&gt;è¿æ¥æ± ç”¨ä»€ä¹ˆæ•°æ®ç»“æ„å­˜å‚¨ï¼Œæ•°ç»„è¿˜æ˜¯é“¾è¡¨ï¼Œè¿˜è¦è€ƒè™‘å¹¶å‘å®‰å…¨&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;å››-æ€»ç»“&#34;&gt;å››ã€æ€»ç»“&lt;/h2&gt;
&lt;p&gt;æœ¬ç¯‡æ–‡ç« ä»æºç è§’åº¦åˆ†æäº†ä¸€æ³¢ï¼Œæ˜ç™½äº†ä¸ºä»€ä¹ˆHikariDataSourceæ˜¯ä¸šç•Œæ€§èƒ½æœ€é«˜è¿æ¥æ± çš„åŸå› ã€‚æˆ‘ä»¬å¯ä»¥æ›´æ·±å…¥ç†è§£è¿æ¥æ± èƒŒåçš„å·¥ä½œåŸç†ï¼Œä»¥ä¾¿åé¢å‡ºäº†çº¿ä¸Šé—®é¢˜å¯ä»¥è½»æ¾åº”å¯¹ã€‚æœ€åè¯»è€…å¯ä»¥è¯•è¯•è‡ªå·±å®ç°ä¸€ä¸ªè¿æ¥æ± åŠ æ·±ç†è§£ã€‚&lt;br&gt;
ä»¥ä¸Šæ–‡ç« æœ‰ä»»ä½•è¡¨è¾¾ä¸Šæˆ–è€…æŠ€æœ¯é—®é¢˜æ¬¢è¿æŒ‡æ­£ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å››-å‚è€ƒ&#34;&gt;å››ã€å‚è€ƒ&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;æ•°æ®åº“è¿æ¥æ± ä¹‹Hikariæºç è§£æâ€”â€”https://www.cnblogs.com/jackion5/p/14193025.html&lt;/li&gt;
&lt;/ol&gt;
">HikariDataSourceæ ¸å¿ƒæºç åˆ†æ</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://zhangyaoo.github.io/post/ji-yi-ci-duo-shu-ju-yuan-lu-you-zao-cheng-de-shu-ju-ku-lian-jie-nei-cun-xie-lu/"" data-c="
          &lt;h3 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h3&gt;
&lt;p&gt;ä¹‹å‰ä¸€ç¯‡æ–‡ç« è®²äº†è‡ªå·±å†™äº†ä¸€ä¸ªå¤šæ•°æ®æºè·¯ç”±ç»„ä»¶ç»™å…¬å¸å†…éƒ¨ä½¿ç”¨ï¼Œè¿›è¡Œå¿«é€Ÿè¿­ä»£ã€‚æ–‡ç« URLæ˜¯ &lt;a href=&#34;https://zhangyaoo.github.io/post/saas-xi-tong-duo-shu-ju-yuan-lu-you-you-ya-jie-jue-fang-an&#34;&gt;SaaSç³»ç»Ÿå¤šæ•°æ®æºè·¯ç”±ä¼˜é›…è§£å†³æ–¹æ¡ˆ&lt;/a&gt;&lt;br&gt;
éšç€æ—¶é—´æ¨ç§»ï¼ŒæŸä¸€å¤©è¿ç»´æ‰¾ä¸Šé—¨è¯´æ•°æ®åº“è¿æ¥æ‰“æ»¡ï¼Œå°±åˆšå¥½è¿™ä¸€å°æœºå™¨ä¸Šè£…äº†JavaæœåŠ¡å¯¼è‡´çš„ã€‚&lt;br&gt;
ä¸‹é¢æ–‡ç« å°±æ˜¯è®²çš„è¿™æ¬¡è¿æ¥æ³„éœ²å¯¼è‡´çš„æ•°æ®åº“hangä½é—®é¢˜ä»¥åŠåé¢çš„è§£å†³è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸€-æ¡ˆå‘å½“æ—¶çš„æƒ…å†µ&#34;&gt;ä¸€ã€æ¡ˆå‘å½“æ—¶çš„æƒ…å†µï¼š&lt;/h3&gt;
&lt;p&gt;çº¿ä¸ŠMySQL session é€æ¸å¢åŠ ï¼Œä¸æ´»è·ƒçš„çš„æ•°é‡é€æ¸å¢åŠ ï¼Œå¯¼è‡´çš„åæœï¼šå ç”¨é“¾æ¥ï¼Œå¯¼è‡´é“¾æ¥æ»¡äº†æ— æ³•åˆ†é…æ–°çš„è¿æ¥&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1612261925869.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;äºŒ-ç´§æ€¥å¤„ç†æ–¹å¼&#34;&gt;äºŒã€ç´§æ€¥å¤„ç†æ–¹å¼ï¼š&lt;/h3&gt;
&lt;p&gt;ç”¨è‡ªç ”çš„åº”ç”¨å±‚ç½‘å…³å°†æµé‡åˆ‡æ¢ä¸ºæ—§çš„ç‰ˆæœ¬ä¸­ï¼Œå¹¶ä¸”ä¸åœæœºåˆ‡æ¢ï¼Œç„¶åå°†å½“å‰çš„ç‰ˆæœ¬çš„æœåŠ¡åœè°ƒï¼Œç„¶åè§‚å¯Ÿé˜¿é‡Œäº‘çš„æ•°æ®åº“è¿æ¥æ•°é‡å˜å›æ­£å¸¸ã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰çº¿ä¸Šå­˜åœ¨å¤šä¸ªç‰ˆæœ¬å­˜åœ¨dockerï¼Œç„¶åç”¨K8séƒ¨ç½²ï¼Œå®ç°å¿«é€Ÿä¸åœæœºåˆ‡æ¢ä¸Šçº¿ã€‚&lt;br&gt;
è‡ªç ”ç½‘å…³è¿™ç¯‡æ–‡ç« æœ‰ä»‹ç»ï¼š &lt;a href=&#34;https://zhangyaoo.github.io/post/ying-yong-ceng-wang-guan-she-ji-yu-shi-xian&#34;&gt;åº”ç”¨å±‚ç½‘å…³è®¾è®¡å’Œå®ç°&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;ä¸‰-ç¬¬ä¸€æ¬¡æŸ¥æ‰¾é—®é¢˜å¹¶ä¸”è§£å†³çš„è¿‡ç¨‹&#34;&gt;ä¸‰ã€ç¬¬ä¸€æ¬¡æŸ¥æ‰¾é—®é¢˜å¹¶ä¸”è§£å†³çš„è¿‡ç¨‹ï¼š&lt;/h3&gt;
&lt;p&gt;1ã€å¼€å¯æœ¬åœ°æœåŠ¡ï¼Œè®©å®ƒé£ä¸€ä¼šï¼Œæˆ–è€…å¤šçº¿ç¨‹å¹¶ä¸”åˆ‡ç§Ÿæˆ·æŸ¥è¯¢æ•°æ®åº“ï¼Œdumpå†…å­˜å¿«ç…§è¿›è¡Œåˆ†æ&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1612253583270.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;p&gt;2ã€ç„¶åæŸ¥çœ‹æœ¬åœ°æœåŠ¡ç›¸å…³æ•°æ®åº“è¿æ¥çš„å¯¹è±¡&lt;br&gt;
1ï¼‰åˆ†æsqlsession å¯¹è±¡ï¼Œå‘ç°sqlsessionå¯¹è±¡ä¸º0ï¼Œè€Œä¸”æ—¥å¿—ä¸­æœ‰æ‰“å°åŠæ—¶å…³é—­sqlsessionã€‚ç»“è®ºï¼šsqlsessionæ­£å¸¸ï¼Œè¯´æ˜æ­£å¸¸å…³é—­äº†sqlsession&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1612237357285.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
2ï¼‰åˆ†ædatasource å¯¹è±¡ï¼Œå‘ç°datasourceå¯¹è±¡å’Œæ•°æ®åº“è¿æ¥é…ç½®ä¸­çš„max-pool-sizeä¸€è‡´ã€‚ç»“è®ºï¼šdatasourceæ­£å¸¸ï¼Œè¯´æ˜æ­£å¸¸å…³é—­äº†datasource&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1612237380060.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
3ï¼‰åˆ†æconnectionå¯¹è±¡ï¼Œå‘ç°HikariProxyConnectionå¯¹è±¡å’Œæ•°æ®åº“é…ç½®ä¸€è‡´ã€‚ç»“è®ºï¼šHikariProxyConnectionæ­£å¸¸&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1612237411657.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;p&gt;3ã€åœ¨åˆ†ææœ¬åœ°å†…å­˜å¿«ç…§ï¼Œå‘ç°ä¸€ä¸ªç±»éšç€æ—¶é—´çš„æ¨ç§»ï¼Œé€æ¸å¢å¤šï¼Œå¹¶ä¸”æ²¡æœ‰è¢«å›æ”¶ï¼Œæ­£æ˜¯connectionImplå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯MySQLåº•å±‚è¿æ¥çš„å®ç°ï¼Œæ¥è‡ªcom.mysql.cj.jdbc&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1612237433473.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
ï¼ˆå›¾ç‰‡ä¸­æŒ‡çš„ç±»æœ‰100å¤šä¸ªå¯¹è±¡ï¼‰&lt;/p&gt;
&lt;p&gt;4ã€è·Ÿè¸ªäº†ä¸€æ³¢æºç ï¼Œå‘ç°HikariProxyConnectionå¯¹è±¡ï¼Œå®è´¨ä¸Šåº•å±‚å°±æ˜¯newäº†ä¸€ä¸ªå¹¶ç®¡ç†connectionImplå¯¹è±¡ï¼ŒçŒœæµ‹æŸä¸ªå› ä¸ºå‚æ•°åŸå› å¯¼è‡´HikariProxyConnectionåŠæ—¶é‡Šæ”¾ï¼Œè€ŒconnectionImplæ²¡æœ‰é‡Šæ”¾ï¼Œç§¯ç´¯æ²¡æœ‰åŠæ—¶æ¸…é™¤å¯¼è‡´çš„ã€‚&lt;/p&gt;
&lt;p&gt;5ã€ç»è¿‡GoogleæŸ¥æ‰¾é—®é¢˜ï¼Œæ€€ç–‘æ˜¯max_lifetimeå¯¼è‡´çš„é—®é¢˜ã€‚max_lifetimeå®˜ç½‘è§£é‡Šï¼šä¸€ä¸ªè¿æ¥çš„ç”Ÿå‘½æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ï¼Œè¶…æ—¶è€Œä¸”æ²¡è¢«ä½¿ç”¨åˆ™è¢«é‡Šæ”¾ï¼ˆretiredï¼‰ã€‚å»ºè®®æ¯”æ•°æ®åº“çš„wait_timeoutå°å‡ åˆ†é’Ÿã€‚é»˜è®¤30åˆ†é’Ÿ&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1612237640791.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;p&gt;6ã€æŸ¥çœ‹çº¿ä¸Šé…ç½®å’Œæµ‹è¯•ç¯å¢ƒé…ç½®ï¼Œæœç„¶æ˜¯åªé…ç½®äº†1åˆ†é’Ÿã€‚&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1612262047685.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
éšåå°†å…¶æ”¹æˆ30åˆ†é’Ÿï¼Œç„¶åç»§ç»­å¤šçº¿ç¨‹å¹¶å‘è·‘æµ‹è¯•ç”¨ä¾‹ã€‚æµ‹è¯•ç¯å¢ƒéªŒè¯ï¼Œdumpå†…å­˜ï¼Œè§‚å¯ŸconnectionImplå¯¹è±¡å¹¶æ²¡æœ‰éšç€æ—¶é—´çš„æ¨ç§»å¢åŠ ã€‚å‘ç°connectionImplå¯¹è±¡å¹¶æ²¡æœ‰éšç€æ—¶é—´çš„æ¨ç§»å¢åŠ ã€‚éªŒè¯äº†ä¸ªäººçš„çŒœæƒ³ã€‚&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1612237699007.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;p&gt;7ã€æœ€ç»ˆå°†é…ç½®æ›´æ–°åä¸Šçº¿ï¼Œè¿‡äº†æ²¡2ä¸ªå°æ—¶ï¼Œè¿æ¥æ•°åˆé£™å‡ã€‚åˆæ­¥è§‚å¯Ÿè¿˜æ˜¯connectionImplå¯¹è±¡å¢å¤šï¼Œè¿æ¥æ²¡æœ‰é‡Šæ”¾ã€‚æ‰€ä»¥è®¤ä¸ºï¼Œä¸æ˜¯max_lifetimeé…ç½®çš„é—®é¢˜ã€‚è¿˜æ˜¯å¾—ä»æºç ä¸­å…¥æ‰‹å’Œçº¿ä¸Šçš„dumpå…¥æ‰‹çœ‹ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€æ¬¡æŸ¥æ‰¾é—®é¢˜å¹¶&lt;strong&gt;æ²¡æœ‰è§£å†³æ ¹æœ¬é—®é¢˜&lt;/strong&gt;ï¼Œå¯¹æ­¤æ€»ç»“äº†ä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è‡ªå·±çš„çŒœæƒ³ç¼ºå°‘å®é™…çš„æ•°æ®æ”¯æŒå’Œå¤šæ–¹ä½çš„æœ‰åŠ›è¯æ˜&lt;/li&gt;
&lt;li&gt;å¯¹æºç ç ”ç©¶ä¸å¤Ÿæ·±å…¥ï¼Œåªæ˜¯åœç•™åœ¨è¡¨æ˜&lt;/li&gt;
&lt;li&gt;å¯¹å®˜ç½‘çš„é…ç½®å‚æ•°ç†è§£ä¸å¤Ÿé€å½»&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;å››-ç¬¬äºŒæ¬¡æŸ¥æ‰¾é—®é¢˜å¹¶ä¸”è§£å†³çš„è¿‡ç¨‹&#34;&gt;å››ã€ç¬¬äºŒæ¬¡æŸ¥æ‰¾é—®é¢˜å¹¶ä¸”è§£å†³çš„è¿‡ç¨‹ï¼š&lt;/h3&gt;
&lt;p&gt;æœ¬åœ°ç¯å¢ƒè§‚å¯Ÿæ²¡æœ‰é—®é¢˜ï¼Œæ­£å¼ç¯å¢ƒè§‚å¯Ÿå°±æœ‰é—®é¢˜ã€‚åƒè¿™ç§é—®é¢˜ç®—æ˜¯æ¯”è¾ƒéš¾è§£å†³çš„ï¼Œä¸ºäº†å¿«é€Ÿè§£å†³é—®é¢˜ï¼Œé¿å…æŠŠçº¿ä¸Šæ•°æ®copyåˆ°æœ¬åœ°è¿›è¡Œæµ‹è¯•ï¼Œç›´æ¥downçº¿ä¸Šçš„dumpæ–‡ä»¶ä¸‹æ¥è¿›è¡Œä»”ç»†åˆ†æã€‚&lt;/p&gt;
&lt;p&gt;1ã€æŸ¥æ‰¾çº¿ä¸Šçš„å†…å­˜ï¼Œdumpæ•°é‡ï¼Œåˆšå¥½100ä¸ªï¼Œå¹¶ä¸”éšç€æ—¶é—´åç§»ï¼Œè¿™ä¸ªç±»å¯¹è±¡è¶Šæ¥è¶Šå¤šï¼Œä¸ªäººçŒœæƒ³å°±æ˜¯è¿™ä¸ªå¯¹è±¡æ²¡æœ‰è¢«å›æ”¶å¯¼è‡´è¿æ¥æ•°æœªé‡Šæ”¾ã€‚æœ‰å¼ºå¼•ç”¨å¼•ç”¨è¿™ä¸ªå¯¹è±¡ã€‚&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1612420897419.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;p&gt;2ã€æŸ¥æ‰¾è¿™ä¸ªå¯¹è±¡GC rootå¯¹è±¡ï¼Œå³é”®é€‰æ‹©Merge Shortest Paths to GC roots -&amp;gt; exclude all phantom/weak/soft etc.reference(æ’é™¤æ‰€æœ‰è™šå¼±è½¯å¼•ç”¨)ï¼Œå‘ç°è¿™100ä¸ªå¯¹è±¡å¤§éƒ¨åˆ†è¢«ä¸€ä¸ªåå­—å«åšhousekeeperçº¿ç¨‹æ‰€å¼ºå¼•ç”¨ï¼Œå¦‚ä¸‹å›¾ã€‚ä¸ªäººéªŒè¯çŒœæƒ³æ˜¯çº¿ç¨‹æ²¡æœ‰åŠæ—¶å›æ”¶å…³é—­æˆ–è€…æ˜¯æ²¡æœ‰å…³é—­çº¿ç¨‹æ± ã€‚&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1612423498302.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;p&gt;3ã€è¿™ä¸ªæ—¶å€™dumpæ–‡ä»¶é‡Œé¢å°±æ²¡æ³•å‘ç°æ›´å¤šæœ‰ç”¨çš„ä¿¡æ¯äº†ï¼Œç„¶åå°±å»çœ‹æºç çœ‹è¿™ä¸ªhousekeeperçº¿ç¨‹ä¸ºä»€ä¹ˆä¸€ç›´å¼ºå¼•ç”¨ã€‚æŸ¥æ‰¾æºç å‘ç°åœ¨è·å–datasource çš„ getConnetcionæ–¹æ³•ï¼Œä¼šåˆå§‹åŒ–HikariPoolè¿æ¥æ± ã€‚&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1612423896839.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;p&gt;åˆå§‹åŒ–è¿æ¥æ± é‡Œé¢ä¼šåˆå§‹åŒ–housekeeperè¿æ¥æ± ï¼Œåˆšå¥½å¯¹åº”äº†ä¸Šé¢åœ¨æ ¹å¼•ç”¨çš„å¯¹è±¡ã€‚&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1612423966034.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1612425624943.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;p&gt;çœ‹äº†ä¸‹è¿™ä¸ªhousekeeperå¯¹è±¡çš„ä½œç”¨ï¼Œç›®çš„æ˜¯ä¸ºäº†ç»´æŒæœ€å°‘çš„ç©ºé—²çš„è¿æ¥ï¼Œè¯´ç™½äº†å°±æ˜¯æ ¹æ®é…ç½®å‚æ•°idleTimeoutå’ŒminIdleæ¥ç»´æŒæœ€å°çš„ç©ºé—²è¿æ¥æ•°ã€‚&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1612425545450.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;p&gt;4ã€è‡³æ­¤ï¼Œå¯ä»¥åˆæ­¥å¾—å‡ºç»“è®ºï¼Œæ˜¯ç”±äºåº”ç”¨ç¨‹åºä¸åœçš„new HikariPoolï¼Œç„¶åæ²¡æœ‰åŠæ—¶closeå¯¼è‡´çš„é—®é¢˜ã€‚ç„¶åé¡ºç€è¿™ä¸ªç»“è®ºå»æŸ¥çœ‹åº”ç”¨ç¨‹åºçš„BUG&lt;/p&gt;
&lt;p&gt;5ã€åœ¨ç¨‹åºå‘ç°ä¸‹é¢é€»è¾‘ï¼Œä¸‹é¢è¿™ä¸€æ®µé€»è¾‘å°±æ˜¯æ ¹æ®ç§Ÿæˆ·æ¥è·å–ç¼“å­˜ä¸­ç§Ÿæˆ·å¯¹åº”çš„datasourceå¯¹è±¡&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;   /**
     * è·å–å·²ç¼“å­˜çš„æ•°æ®æº
     */
    private Optional&amp;lt;DataSource&amp;gt; getDataSourceIfCache(SelectRdsConfigDto rdsConfigDto) {
        String key = getUniqueMysqlKey(rdsConfigDto.getHost(), rdsConfigDto.getPort());
        if (Objects.nonNull(dataSourceCachePool.get(key))) {
            DataSourceCache dataSourceCache = dataSourceCachePool.get(key);
            //cacheä¸­å·²ç»ç¼“å­˜äº†ç§Ÿæˆ·çš„è¿æ¥å¹¶ä¸”æ²¡æœ‰ä¿®æ”¹rds configä¿¡æ¯
            if (dataSourceCache.verifyRdsConfig(rdsConfigDto)) {
                return Optional.ofNullable(dataSourceCachePool.get(key).getDataSource());
            }
            //cacheä¸­å·²ç»ç¼“å­˜äº†ç§Ÿæˆ·çš„è¿æ¥ï¼Œä½†æ˜¯æ ¡éªŒä¸é€šè¿‡
            else {
                dataSourceCachePool.remove(key);
                return Optional.empty();
            }
        }
        return Optional.empty();
    }

   // æ ¡éªŒ
   private boolean verifyRdsConfig(SelectRdsConfigDto rdsConfigDto) {
        return rdsConfigDto.getAccount().equals(this.account) &amp;amp;&amp;amp;
                rdsConfigDto.getHost().equals(this.host) &amp;amp;&amp;amp;
                rdsConfigDto.getPort().equals(this.port) &amp;amp;&amp;amp;    rdsConfigDto.getPwd().equals(this.pwd) &amp;amp;&amp;amp;ï¼›

    //  dataSourceCachePoolçš„keyç»„æˆï¼Œä¸€ä¸ªMySQLè¿æ¥å¯¹åº”çš„key
    private String getUniqueMysqlKey(String host, Integer port){
        return host + &amp;quot;:&amp;quot; + port;
    }

 }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™é‡Œé€»è¾‘æœ‰ä¸€æ®µæ˜¯æ ¡éªŒä¸é€šè¿‡ï¼Œä¼šremoveå¯¹åº”çš„datasourceå¯¹è±¡ï¼Œé—®é¢˜å°±å‡ºç°åœ¨è¿™é‡Œï¼Œè¿™é‡Œæ²¡æœ‰åŠæ—¶closeã€‚æ ¡éªŒä¸é€šè¿‡çš„åŸå› å°±æ˜¯ï¼Œä¸€ä¸ªhost portä½œä¸ºä¸€ä¸ªdataSourceCachePoolçš„keyï¼Œå› ä¸ºçº¿ä¸Šæœ‰ä¸€ä¸ªMySQLå®ä¾‹å¤šä¸ªè´¦å·ï¼Œå¯¼è‡´æ ¡éªŒæ€»æ˜¯ä¸é€šè¿‡è¯¯ä»¥ä¸ºæˆæ˜¯ä¿®æ”¹äº†ç”¨æˆ·åæˆ–è€…å¯†ç ï¼Œéšåå°±æ˜¯ä¸€ç›´new datasourceå¯¹è±¡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;äº”-æ ¹æœ¬åŸå› &#34;&gt;äº”ã€æ ¹æœ¬åŸå› &lt;/h3&gt;
&lt;p&gt;æ‰€ä»¥ç»¼ä¸Šï¼Œæœ€ç»ˆå¾—å‡ºç»“è®ºæ˜¯ï¼Œå› ä¸ºç¨‹åºé—®é¢˜å¯¼è‡´HikariDataSourceå¯¹è±¡å¢å¤šï¼Œè€Œä¸”å› ä¸ºHikariDataSourceå¯¹è±¡å†…éƒ¨æœ‰ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œå¦‚æœå¤–éƒ¨ä¸¢å¤±äº†å¯¹è¿™ä¸ªHikariDataSourceå¯¹è±¡çš„å¼•ç”¨ï¼Œä¹Ÿä¸ä¼šè¢«åƒåœ¾å›æ”¶ï¼Œå¯¼è‡´HikariDataSourceå¯¹è±¡ä¸é‡Šæ”¾ï¼Œç„¶åç»“æœå°±æ˜¯æ•°æ®åº“è¿æ¥æœªé‡Šæ”¾ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å…­-æœ€ç»ˆå¤„ç†æ–¹å¼&#34;&gt;å…­ã€æœ€ç»ˆå¤„ç†æ–¹å¼ï¼š&lt;/h3&gt;
&lt;p&gt;1ã€ä¿®æ”¹ä»£ç ï¼š&lt;br&gt;
1ï¼‰ dataSourceCachePoolçš„keyç»„æˆç”±host port æ”¹æˆ host port account pwd å››ä¸ªç»´åº¦ä½œä¸ºä¸€ä¸ªkeyã€‚&lt;/p&gt;
&lt;p&gt;Qï¼šä¸ºä»€ä¹ˆè¦è¿™å››ä¸ªç»´åº¦ä½œä¸ºä¸€ä¸ªkey ï¼Ÿ&lt;br&gt;
Aï¼šå› ä¸ºé¿å…ä¸€ä¸ªrdsæœ‰å¤šä¸ªè´¦æˆ·å¯†ç ï¼Œå¯¼è‡´dataSourceCachePoolæ— é™putç›¸åŒhost portï¼Œé¿å…ä¸€ç›´new datasource å’Œclose datasourceï¼Œæµªè´¹èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;2ï¼‰å…³é—­datasourceå¯¹è±¡ï¼Œremoveé‚£æ®µä»£ç çš„é€»è¾‘ä¿®æ”¹æˆä¸‹é¢è¿™ä¸ªæ ·å­&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;//cacheä¸­å·²ç»ç¼“å­˜äº†ç§Ÿæˆ·çš„è¿æ¥,ä½†æ˜¯ä¿®æ”¹äº†rds configä¿¡æ¯
        DataSource dataSource = dataSourceCachePool.remove(key).getDataSource();
        log.info(&amp;quot;remove datasource:{}, {}&amp;quot;, key, rdsConfigDto.toString());
        new Thread(() -&amp;gt; {
            while (true) {
                try {
                    TimeUnit.SECONDS.sleep(10);
                } catch (InterruptedException e) {
                    log.error(&amp;quot;e:&amp;quot;, e);
                }
                if (dataSource instanceof HikariDataSource) {
                    if (((HikariDataSource) dataSource).getHikariPoolMXBean().getActiveConnections() &amp;gt; 0){
                        log.info(&amp;quot;ActiveConnections &amp;gt; 0, continue&amp;quot;);
                        continue;
                    }
                    log.info(&amp;quot;HikariDataSource close...&amp;quot;);
                    ((HikariDataSource) dataSource).close();
                } else if (dataSource instanceof DruidDataSource) {
                    if (((DruidDataSource) dataSource).getActiveCount() &amp;gt; 0) {
                        log.info(&amp;quot;ActiveConnections &amp;gt; 0, continue&amp;quot;);
                        continue;
                    }
                    log.info(&amp;quot;DruidDataSource close...&amp;quot;);
                    ((DruidDataSource) dataSource).close();
                } else {
                    log.error(&amp;quot;close datasource|datasource is wrong&amp;quot;);
                    throw new RuntimeException(&amp;quot;close datasource|datasource is wrong&amp;quot;);
                }
                break;
            }
        }).start();
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Qï¼šä¸ºä»€ä¹ˆè¦åˆ¤æ–­æ´»è·ƒçš„è¿æ¥ ActiveCount &amp;gt; 0 ï¼Ÿ&lt;br&gt;
Aï¼šå› ä¸ºcloseçš„æ—¶å€™è¦åˆ¤æ–­æ˜¯å¦æœ‰æ­£åœ¨ä½¿ç”¨çš„connectionå¯¹è±¡ï¼Œå¦‚æœå¼ºåˆ¶å…³é—­ï¼Œé‚£ä¹ˆä¼šå‡ºç°ä¸€ä¸ªçº¿ç¨‹æŸ¥è¯¢çš„æ—¶å€™ï¼Œconnetionçªç„¶ä¸å¯ç”¨ï¼Œå¯¼è‡´é”™è¯¯ã€‚&lt;/p&gt;
&lt;p&gt;Qï¼šä¸ºä»€ä¹ˆä¸ç”¨çº¿ç¨‹æ± ï¼Œè€Œæ˜¯ç›´æ¥new Thread ï¼Ÿ&lt;br&gt;
Aï¼šè¿™ä¸ªåœºæ™¯ç¬”è€…ä¹Ÿæœ‰è€ƒè™‘ï¼Œä½†æ˜¯è¿™ç§åœºæ™¯å¾ˆå°‘ï¼Œä¸€èˆ¬ä¸ä¼šæœ‰ï¼Œé™¤éæ‰‹åŠ¨ä¿®æ”¹æ•°æ®åº“é…ç½®ã€‚å¾ˆå°‘ä½¿ç”¨çš„åœºæ™¯ï¼Œå¦‚æœå¼€ä¸ªçº¿ç¨‹æ± ä¸€ç›´æ”¾ç€ï¼Œä¹Ÿè€—ç³»ç»Ÿèµ„æºã€‚&lt;/p&gt;
&lt;p&gt;2ã€æ”¹é…ç½®ï¼Œæ”¹æˆå’Œå®˜æ–¹é»˜è®¤çš„é…ç½®&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1612426469625.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œé‡æ–°ä¸Šçº¿åï¼Œè§‚æµ‹å¯¹è±¡å†…å­˜æ•°æ®ï¼Œæ­£å¸¸ã€‚è§‚å¯Ÿ3306ç«¯å£è¿æ¥æ•°ï¼Œæ­£å¸¸ã€‚&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1613802463906.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;ä¸ƒ-æ€»ç»“&#34;&gt;ä¸ƒã€æ€»ç»“&lt;/h3&gt;
&lt;p&gt;åº•å±‚çš„æ•°æ®åº“ç»„ä»¶çš„ä»£ç ç¼–å†™ï¼Œè¦æ³¨æ„ä½¿ç”¨æ•°æ®åº“è¿æ¥èµ„æºçš„æ—¶å€™ï¼Œä¸€å®šè¦æ£€æŸ¥ä»£ç ä¸­æ˜¯å¦é‡Šæ”¾ï¼Œä¸ç„¶ä¼šé€ æˆä¸¥é‡çš„äº‹æ•…ã€‚è€Œä¸”å¹³å¸¸è¿˜è¦ç†Ÿæ‚‰å®˜æ–¹é…ç½®ï¼Œå¹¶ä¸”å¤šç ”ç©¶æºç ã€‚ä»¥å…å‡ºç°è¿™ç§æƒ…å†µæ—¶æŸæ‰‹æ— ç­–ã€‚&lt;br&gt;
å¯ä»¥çš„è¯è¿˜å¯ä»¥å«èº«è¾¹çš„èµ„æ·±å¤§ç‰›ç»™reviewä»£ç ï¼Œåšåˆ°åŒé‡ä¿éšœã€‚&lt;/p&gt;
&lt;p&gt;æœ€åéå¸¸æ„Ÿè°¢ç»„å†…å°ä¼™ä¼´çš„æŠ€æœ¯æ”¯æŒï¼Œæ‰èƒ½ä¸€æ­¥ä¸€æ­¥çš„æ’é™¤å‡ºé—®é¢˜ï¼Œæ‰¾å‡ºé—®é¢˜æ‰€åœ¨&lt;/p&gt;
">è®°ä¸€æ¬¡å¤šæ•°æ®æºè·¯ç”±é€ æˆçš„æ•°æ®åº“è¿æ¥æ³„éœ²æ’æŸ¥è¿‡ç¨‹</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://zhangyaoo.github.io/post/2020-nian-zong-jie/"" data-c="
          &lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1609517863900.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h3 id=&#34;å¼€å¤´&#34;&gt;å¼€å¤´&lt;/h3&gt;
&lt;p&gt;ä»Šå¤©æ˜¯1æœˆ1å·ï¼Œæ–°å¹´ç¬¬ä¸€å¤©ï¼ŒæŠ“ä½2020å¹´çš„å°å°¾å·´ï¼Œéšä¾¿çµ®çµ®å¨å¨ä¸€ä¸‹ï¼Œåšä¸ªå°æ€»ç»“ã€‚å›æƒ³ä¸€ä¸‹ä»Šå¹´ä¸€æ•´å¹´ï¼Œå¼€å¿ƒï¼Œå›°éš¾ï¼Œå¿ƒé…¸ï¼Œå¤§éƒ¨åˆ†éƒ½ç»å†è¿‡ï¼Œæ²¡æœ‰ä»€ä¹ˆå€¼å¾—è¯´çš„ç»å†ï¼Œå€’æ˜¯å°äº‹æŒºå¤šã€‚&lt;/p&gt;
&lt;p&gt;å€¼å¾—æçš„äº‹æƒ…å°±æ˜¯ç–«æƒ…äº†ï¼Œä»Šå¹´ç–«æƒ…åœ¨å®¶å‘†äº†2ä¸ªæœˆï¼Œé‚£æ—¶å€™å› ä¸ºå¹´å‰è¢«è£ï¼Œå·²ç»æ˜¯å¤±ä¸šçš„çŠ¶æ€ï¼Œæ²¡æœ‰æ”¶å…¥æ¥æºï¼Œå¼€å§‹åç«‹ä¸å®‰ï¼Œçƒ¦èº ã€‚åé¢æ„è¯†åˆ°äº†åœ¨å®¶ä¹Ÿæœ‰åœ¨å®¶å€¼å¾—åšçš„äº‹æƒ…ï¼Œä¸å¿…å› ä¸ºç–«æƒ…æ‰“ä¹±è‡ªå·±çš„å†…å¿ƒï¼Œå……å®é™ªå®¶äººè¿‡æ¯ä¸€å¤©ã€‚&lt;/p&gt;
&lt;p&gt;ä½œä¸ºæˆå¹´äººï¼Œç°åœ¨è®¤ä¸ºæ—¶å¸¸å¼€å¿ƒå¿«ä¹å€’æ˜¯ä¸€ä»¶å¾ˆéš¾çš„äº‹æƒ…ï¼Œæƒ³èµ·ä¸€å¥è¯ï¼Œå°æ—¶å€™å¿«ä¹æ˜¯ä¸€ä»¶ç®€å•çš„äº‹æƒ…ï¼Œé•¿å¤§åï¼Œç®€å•æ˜¯ä¸€ä»¶å¿«ä¹çš„äº‹æƒ…ã€‚ä¸è¿‡åé¢è¿˜æ˜¯è¦æ—¶å¸¸å¼€å¿ƒä¸ºä¸»ï¼Œç„¶åå°±æ˜¯ä»Šå¹´ä»¥åè¦æ²‰é™ä¸‹æ¥ï¼Œç†æ€§æ€è€ƒï¼Œä¸ç®¡å¯¹äººè¿˜æ˜¯å¯¹äº‹ã€‚è¿˜è¦å¤šçœ‹äº›å…³äºç”Ÿæ´»ä¸Šçš„ä¹¦ï¼Œä¸åªæ˜¯ç›¯ç€æŠ€æœ¯ä¹¦æ­»å•ƒï¼Œæé†’ä¸€ä¸‹è‡ªå·±è¦åœä¸‹æ¥å¤šæ€è€ƒï¼Œä½å¤´åšäº‹ï¼ŒæŠ¬å¤´çœ‹è·¯ã€‚&lt;/p&gt;
&lt;p&gt;ä»Šå¹´æ€»ç»“æ–¹é¢æœ‰äº›å°‘ï¼Œå› ä¸ºæˆ‘è‡ªå·±è®¤ä¸ºè¿™äº›æ–¹é¢å€¼å¾—å»æ€»ç»“ï¼Œè‡³äºå…¶ä»–çš„ï¼Œå¯èƒ½æˆ‘æ²¡æœ‰æ„è¯†åˆ°æˆ–è€…æ˜¯ä»Šå¹´ç»å†äº‹æƒ…çš„å¤ªå°‘ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å­¦ä¹ &#34;&gt;å­¦ä¹ &lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1609517630829.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å…³äºå­¦ä¹ è¿™ä»¶äº‹ï¼Œè¿˜æ˜¯è¦æ”¾åœ¨ç¬¬ä¸€æ¥è¯´ã€‚å­¦æ— æ­¢å¢ƒï¼Œæ´»åˆ°è€å­¦åˆ°è€ã€‚äººä¸èƒ½æ€»æ˜¯åœç•™åœ¨åŸåœ°ï¼Œè¿˜æ˜¯è¦å¤šçœ‹ä¹¦å¤šå­¦ä¹ ï¼Œå¢é•¿çŸ¥è¯†ã€‚ä¸­å›½äººå¤§éƒ¨åˆ†åŠ³åŠ¨äººæ°‘ä»¥å‰ï¼ˆ80å¹´ä»£ï¼‰æ˜¯åŸºæœ¬é åŠªåŠ›ï¼Œé å‹¤å¥‹ï¼Œè·å¾—å±äºè‡ªå·±çš„åŠ³åŠ¨æœå®ï¼Œç°åœ¨ä¿¡æ¯æ—¶ä»£ï¼Œé™¤äº†é åŠªåŠ›å‹¤å¥‹ä»¥å¤–ï¼Œè¿˜è¦æœ‰æ•ˆåˆ©ç”¨ä¸“ä¸šçŸ¥è¯†å»è§£å†³ç”Ÿæ´»å·¥ä½œä¸­çš„é—®é¢˜ï¼Œäº«å—ç°åœ¨ä¿¡æ¯æ—¶ä»£ç»™ä¸çš„æˆæœã€‚&lt;br&gt;
å°±åƒæ–‡è‡£æ­¦å°†ï¼Œè°‹å£«å½“å‡ºè°‹åˆ’ç­–ï¼Œæ­¦å£«å½“æˆ˜åœºå®æ€ã€‚æ¯ä¸ªäººå½“å»å‘æŒ¥è‡ªå·±çš„ä¸“ä¸šæœ¬é¢†ã€‚ä¸ç®¡æœ€ç»ˆç›®çš„æ˜¯å•¥ï¼Œç²¾å¿ æŠ¥å›½è¿˜æ˜¯å…»å®¶ç³Šå£ï¼Œå°æœ‰å°ä¹‰ï¼Œå¤§æœ‰å¤§ä¹‰ã€‚&lt;/p&gt;
&lt;p&gt;æ‰¯è¿œäº†ï¼Œä»Šå¹´å‡†å¤‡è¿˜æ˜¯ä»¥æŠ€æœ¯å­¦ä¹ ä¸ºä¸»ï¼Œç„¶åä»¥å…¬ä¼—å·å’ŒGitHubä¸ºè¾…åŠ©è¿›è¡Œå­¦ä¹ ã€‚&lt;br&gt;
ä»Šå¹´å‡†å¤‡çœ‹å®Œè¿™äº›å­¦ä¹ èµ„æ–™ï¼Œå…¶ä¸­æœ‰ä¹¦ç±ä»¥åŠç½‘ç»œè¯¾ç¨‹&lt;br&gt;
1ã€MySQLæ˜¯å¦‚ä½•è¿è¡Œçš„&lt;br&gt;
2ã€redisè®¾è®¡å’Œå®ç°&lt;br&gt;
3ã€æ¶æ„å¸ˆè§†é¢‘è¯¾&lt;br&gt;
4ã€æå®¢æ—¶é—´MySQL&lt;br&gt;
5ã€Nettyç½‘ç»œç¼–ç¨‹å­¦ä¹ +æŠ€æœ¯ä¹¦ç±+Nettyå®æˆ˜&lt;/p&gt;
&lt;p&gt;ä¸å¤šï¼Œåˆ—å¤šäº†å°±çœ‹ä¸å®Œäº†[dog]ã€‚&lt;/p&gt;
&lt;p&gt;å…¶ä»–åˆ™æŒ‰æ—¶åŠæ—¶æ€»ç»“å·¥ä½œä¸Šé‡åˆ°çš„é—®é¢˜ï¼Œæå‡è‡ªå·±çš„æŠ€æœ¯æ·±åº¦ã€‚æ¯•ç«Ÿå·¥ä½œä¸­é‡åˆ°çš„æœ€å®¹æ˜“åŠ æ·±ç†è§£çš„å’Œæå‡èƒ½åŠ›çš„ã€‚&lt;br&gt;
é¡ºä¾¿çœ‹ä¸€äº›ä¼˜ç§€çš„åšå®¢åŠæ—¶æ€»ç»“ï¼Œè¾“å‡ºè‡ªå·±çš„ç†è§£ã€‚ç„¶åç»´æŠ¤åˆ°è‡ªå·±çš„ä¸ªäººç½‘ç«™ä¸Šé¢å»ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶åå…¶ä»–æ—¶é—´ï¼Œå‡†å¤‡çœ‹ä¸€äº›å…¶ä»–ç±»å‹çš„ä¹¦ç±ï¼Œæ¯”å¦‚äººæ–‡å†å²ï¼Œä»¥åŠå…¶ä»–ä¼˜ç§€çš„å›½å†…å¤–è‘—ä½œï¼Œç°åœ¨å·²ç»æƒ³å¥½çœ‹äº›ä»€ä¹ˆï¼Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ï¼Œä»Šå¹´ä»Šåä¼šæŠ½ç©ºä½™æ—¶é—´å»çœ‹è¿™äº›ï¼Œæå‡è‡ªå·±å¯¹äººå’Œç”Ÿæ´»çš„ä¸€äº›æ€è€ƒã€‚&lt;/p&gt;
&lt;p&gt;æœ€åçš„è¯è¦æé†’è‡ªå·±å°‘çœ‹åŠ¨æ¼«äºŒæ¬¡å…ƒå¤šå­¦ä¹ ï¼Œæ—©ç¡æ—©èµ·~~&lt;/p&gt;
&lt;h3 id=&#34;è¿åŠ¨&#34;&gt;è¿åŠ¨&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1609517659211.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
è¿åŠ¨è¿™ä»¶äº‹æƒ…ï¼Œç®—æ˜¯æˆ‘ä¸ªäººæ¯å¹´ç«‹çš„flagä¸­ï¼Œè‡ªå·±æœ€æ»¡æ„çš„äº†ã€‚ä¸€å‘¨æœ€å°‘ä¸€æ¬¡è·‘æ­¥+ç¯®çƒã€‚åŸºæœ¬ä¸Šä¹Ÿä¸ç®—å…¨éƒ¨ï¼Œæ¯å‘¨éƒ½åšäº†ã€‚&lt;br&gt;
æˆ‘èº«è¾¹çš„æœ‹å‹æˆ–è€…äº²äººï¼Œæˆ‘ä¼šç»å¸¸æé†’ä»–ä»¬ï¼Œè¦é€‚å½“çš„é”»ç‚¼ã€‚è™½ç„¶æ€»æ˜¯è¢«å½“ä½œè€³è¾¹é£ï¼Œä½†æ˜¯æ¯æ¬¡è¿‡å¹´ç¥åˆ«äººèº«ä½“å¥åº·åªæ˜¯å™±å¤´ï¼Œåªæœ‰çœŸæ­£å…³å¿ƒä½ çš„äººä¼šåœ¨ä¹ä½ çš„å¥åº·ã€‚æˆ‘ä¸ªäººä¸ç®¡æ˜¯ç”Ÿæ—¥è¿˜æ˜¯æ–°å¹´æ„¿æœ›ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯å¸Œæœ›èº«è¾¹çš„äººè¿‡çš„å¹³å¹³å®‰å®‰å¼€å¼€å¿ƒå¿ƒå°±è¡Œäº†ï¼Œå…¶ä»–éƒ½æ˜¯æ‰¯æ·¡ã€‚&lt;br&gt;
è€Œæˆ‘è‡ªå·±è¿åŠ¨çš„åŠ¨åŠ›æ¥æºæ˜¯ï¼Œå¦‚æœæˆ‘è‡ªå·±èº«ä½“ä¸è¡Œï¼Œé‚£å°±æ²¡æœ‰èƒ½åŠ›ç…§æŠ¤èº«è¾¹äººã€‚æˆ‘è‡ªå·±èƒ½å¤Ÿæˆé•¿ä¸ºå¤§æ ‘ï¼Œè®©åˆ«äººå®‰å¿ƒå€šé ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨è™½ç„¶æ¯•ä¸šäº†3å¹´ï¼Œ6å—è…¹è‚Œå·²ç»å˜æˆäº†4å¿«ï¼Œèº«ä½“æ²¡æœ‰æ¯•ä¸šé‚£ä¼šå¥½ï¼Œä½†æ˜¯æˆ‘è‡ªå·±è¿˜æ˜¯ä¼šåšæŒçš„ï¼Œæœç€æ›´mançš„ç›®æ ‡å¥‹æ–—ã€‚æƒ³å½“å¹´æˆ‘å¯æ˜¯æ‹¥æœ‰8å—è…¹è‚Œçš„ç”·äººã€‚ã€‚ã€‚ã€‚&lt;/p&gt;
&lt;h3 id=&#34;çˆ±æƒ…&#34;&gt;çˆ±æƒ…&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1609517842818.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
ä»Šå¹´æœ€å¼€å¿ƒçš„å°±æ˜¯å’Œå¥³æœ‹å‹åº¦è¿‡ç¬¬ä¸€å¹´çš„æ‹çˆ±æœŸï¼ˆä¸è¦è„¸çš„æˆ‘ï¼Œè‡ªè®¤ä¸ºç½‘æ‹äº†ä¸€å¹´çš„çƒ­æ‹æœŸï¼‰ï¼Œè¿™ä¸€å¹´æœ‰å¼€å¿ƒå’Œéš¾è¿‡ï¼Œä¸è¿‡éš¾è¿‡æ—¶åˆ»å¾ˆå°‘ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯å¼€å¿ƒæ—¶åˆ»ï¼Œæˆ‘è§‰å¾—å·²ç»å¯ä»¥äº†ï¼Œèƒ½å¤Ÿå’Œå¯¹æ–¹æ¯å¤©éƒ½å¾ˆå¼€å¿ƒï¼Œå·²ç»å¾ˆä¸é”™äº†ã€‚æ¯•ç«Ÿå’Œå–œæ¬¢çš„äººåœ¨ä¸€èµ·ä¸å°±æ˜¯å¼€å¿ƒæ’’ï¼Œè¿™ä¸ªæ˜¯æœ€éš¾èƒ½å¯è´µçš„ã€‚ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘è‡ªè®¤ä¸ºæˆ‘æ˜¯ä¸ªä¸å¥½iç›¸å¤„çš„äººï¼Œä¸ªäººçš„å°è„¾æ°”å¾ˆå¤šï¼Œè€Œä¸”æœ‰æ—¶å€™ä¼šå¸¸æœ‰ä¸è‡ªä¿¡ã€‚è°¢è°¢æˆ‘å¥³æœ‹å‹çš„ç†è§£å’Œé¼“åŠ±ã€‚ä»Šå¹´å¾€åï¼Œè¿˜å¸Œæœ›ä¸€èµ·å¼€å¿ƒåº¦è¿‡æ¯ä¸€å¤©ï¼Œå“ˆå“ˆå“ˆå“ˆã€‚&lt;/p&gt;
&lt;p&gt;æ–°çš„ä¸€å¹´ï¼Œå¸Œæœ›å’±ä¿©éƒ½èº«ä½“å¥åº·ï¼Œå¼€å¼€å¿ƒå¿ƒ~&lt;/p&gt;
&lt;h3 id=&#34;2021flag&#34;&gt;2021flag&lt;/h3&gt;
&lt;p&gt;å›½é™…æƒ¯ä¾‹ï¼Œæœ€åè¯´ä¸€äº›æ‰“è„¸çš„flag&lt;br&gt;
1ã€å®Œæˆä¸Šé¢çš„èµ„æ–™çš„å­¦ä¹ &lt;br&gt;
2ã€æ¯ä¸ªæœˆä¸€æ¬¡æ–‡ç« æ€»ç»“ï¼Œå·¥ä½œæ€»ç»“ï¼Œ4æ¬¡ä¸ªäººç½‘ç«™æ–‡ç« çš„å‘è¡¨å’Œç»´æŠ¤&lt;br&gt;
3ã€ä¸€å‘¨ä¸€æ¬¡è¿åŠ¨+ç¯®çƒ&lt;br&gt;
4ã€èº«ä½“ä½“é‡ä¸è¶…130&lt;br&gt;
5ã€ç»è¥å¥½ä¸ªäººåšå®¢&lt;br&gt;
6ã€ æ—©ç¡æ—©èµ·ï¼Œ11ç‚¹åŠä¹‹å‰ç¡&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2021å¹´ï¼Œå¹²å°±å®Œäº‹&lt;/strong&gt;ã€‚&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1609517948326.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
">2020å¹´æ€»ç»“</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://zhangyaoo.github.io/post/ying-yong-ceng-wang-guan-she-ji-yu-shi-xian/"" data-c="
          &lt;h3 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h3&gt;
&lt;h3 id=&#34;apiç½‘å…³è°ƒç ”&#34;&gt;APIç½‘å…³è°ƒç ”&lt;/h3&gt;
&lt;h4 id=&#34;kong&#34;&gt;kong&lt;/h4&gt;
&lt;h4 id=&#34;zuul&#34;&gt;zuul&lt;/h4&gt;
&lt;h4 id=&#34;spring-cloud-gateway&#34;&gt;spring cloud gateway&lt;/h4&gt;
&lt;p&gt;è‡ªç ”åŸå› ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æœåŠ¡è‡ªåŠ¨æ³¨å†Œå‘ç°ï¼Œä¸ç”¨äººå·¥æ›´æ”¹é…ç½®æ¥å£æœåŠ¡&lt;/li&gt;
&lt;li&gt;ç›¸æ¯”ç”¨nginx+luaï¼Œä¸ç”¨å¤šç»´æŠ¤ä¸€å¥—æ³¨å†Œä¸­å¿ƒ&lt;/li&gt;
&lt;li&gt;Javaç”Ÿæ€æ¥å…¥å¥½ï¼Œå‡å°‘å­¦ä¹ æˆæœ¬&lt;/li&gt;
&lt;li&gt;ç½‘å…³è‡ªåŠ¨ä¸ºAPIæ¥å£ç”ŸæˆOpenApiæ–‡æ¡£&lt;/li&gt;
&lt;li&gt;åŸºäºç‰ˆæœ¬çš„ç°åº¦å‘å¸ƒè®¾è®¡å®ç°&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;åŸç†&#34;&gt;åŸç†&lt;/h3&gt;
&lt;h3 id=&#34;è®¾è®¡&#34;&gt;è®¾è®¡&lt;/h3&gt;
&lt;h3 id=&#34;å…³é”®å®ç°&#34;&gt;å…³é”®å®ç°&lt;/h3&gt;
&lt;h3 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h3&gt;
&lt;h3 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h3&gt;
">åº”ç”¨å±‚ç½‘å…³è®¾è®¡ä¸å®ç°</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://zhangyaoo.github.io/post/shou-lu-yi-ge-hong-bao-suan-fa/"" data-c="
          &lt;h3 id=&#34;1-è¦æ±‚&#34;&gt;1ã€è¦æ±‚&lt;/h3&gt;
&lt;p&gt;çº¢åŒ…ç®—æ³• functionï¼šæ‹¼æ‰‹æ°”çº¢åŒ…&lt;br&gt;
1ã€æ¯ä¸ªçº¢åŒ…è·å¾—çš„æ•°å­¦æ¦‚ç‡è¦ä¸€æ ·&lt;br&gt;
2ã€çº¢åŒ…æœ€å°å€¼ï¼š1åˆ†é’±&lt;/p&gt;
&lt;h3 id=&#34;2-æ€è·¯&#34;&gt;2ã€æ€è·¯ï¼š&lt;/h3&gt;
&lt;p&gt;åˆ©ç”¨åˆ‡ç‰‡çš„æ€æƒ³ï¼Œæ¯”å¦‚æœ‰5ä¸ªçº¢åŒ…ï¼Œ20åˆ†ï¼Œå°±ä»0-20çš„èŒƒå›´å†…è·å–å››ä¸ªéšæœºæ•°ï¼Œå°±è¢«åˆ†æˆ5ä»½ï¼Œç„¶åé¡ºåºæŠ½å–ã€‚è¿™æ ·ä¿è¯æ¯ä¸ªçº¢åŒ…çš„çš„æ¦‚ç‡ä¸€æ ·&lt;br&gt;
è¿™ç§æ–¹æ¡ˆéœ€è¦è€ƒè™‘åˆ°å‡ ä¸ªæ³¨æ„ç‚¹ï¼š&lt;br&gt;
1ï¼‰é‡å¤çš„éšæœºåˆ‡ç‰‡å¦‚ä½•å¤„ç†ï¼›&lt;br&gt;
2ï¼‰éœ€è¦è€ƒè™‘1åˆ†é’±å¦‚ä½•å¤„ç†ï¼›&lt;/p&gt;
&lt;h3 id=&#34;3-å®ç°&#34;&gt;3ã€å®ç°ï¼š&lt;/h3&gt;
&lt;p&gt;é‡åˆ°éšæœºåˆ‡ç‰‡é‡å¤:é‡æ–°ç”Ÿæˆåˆ‡ç‰‡ç›´è‡³ä¸é‡å¤&lt;br&gt;
1åˆ†é’±å¤„ç†ï¼šåˆ¤æ–­ç›¸é‚»é—´éš”çš„å¤§å°&lt;/p&gt;
&lt;p&gt;###4ã€ ä»£ç å®ç°ï¼š&lt;br&gt;
åˆ©ç”¨treeMapçš„é¡ºåºæœ‰åºæ€§&lt;/p&gt;
&lt;p&gt;ç›´æ¥ä¸Šä»£ç ï¼ˆç¬”è€…å·²ç»è°ƒè¯•è¿‡æ²¡æœ‰é—®é¢˜ï¼Œå¯ä»¥è¿è¡Œï¼‰&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public class RedPackage {
   /**
    * çº¢åŒ…æœ€å°é‡‘é¢
    */
   private long minAmount = 1L;

   /**
    * æœ€å¤§çš„çº¢åŒ…æ˜¯å¹³å‡å€¼çš„Nå€
    */
   private static final long N = 2;

   /**
    * çº¢åŒ…æœ€å¤§é‡‘é¢
    */
   private long maxAmount;

   /**
    * çº¢åŒ…é‡‘é¢ åˆ†
    */
   private long packageAmount;

   /**
    * çº¢åŒ…ä¸ªæ•°
    */
   private long packageSize;

   /**
    * æ˜¯å¦æŠ¢å®Œ
    */
   private boolean finish;

   /**
    * å­˜å‚¨çº¢åŒ…çš„é‡‘é¢é¡ºåº
    */
   private final TreeMap&amp;lt;Long, Long&amp;gt; treeMap = Maps.newTreeMap((o1, o2) -&amp;gt; o1 &amp;gt; o2 ? 1 : o1.equals(o2) ? 0 : -1);

   /**
    * æ„é€ å‡½æ•°ä¸å†™ä¸šåŠ¡é€»è¾‘
    */
   public RedPackage(long packageAmount, int packageSize){
       this.packageAmount = packageAmount;
       this.packageSize = packageSize;
       maxAmount = (packageAmount * N)/ packageSize;
   }

   public RedPackage(long packageAmount, int packageSize, long minAmount){
       this.packageAmount = packageAmount;
       this.packageSize = packageSize;
       this.minAmount = minAmount;
   }

   /**
    * è·å–é‡‘é¢
    */
   public synchronized long nextAmount(){
       // å‰ç½®æ ¡éªŒï¼Œåˆå§‹åŒ–
       if(!finish &amp;amp;&amp;amp; treeMap.size() == 0){
           treeMap.put(packageAmount, 0L);
           for (int i = 0; i &amp;lt; packageSize - 1; i++) {
               // éšæœºæŠ½å–åˆ‡ç‰‡
               long splitNum = RandomUtils.nextLong(minAmount, packageAmount);
               Long higher = treeMap.higherKey(splitNum);
               higher = higher == null ? packageAmount : higher;
               Long lower = treeMap.lowerKey(splitNum);
               lower = lower == null ? 0 : lower;
               // ç›¸åŒåˆ‡ç‰‡é‡æ–°ç”Ÿæˆ,å’Œä¸Šä¸€ä¸ªæˆ–è€…ä¸‹ä¸€ä¸ªåˆ‡ç‰‡é—´éš”å°äºminAmountçš„é‡æ–°ç”Ÿæˆ
               while (higher - splitNum &amp;lt;= minAmount
                       || splitNum - lower &amp;lt;= minAmount
                       || treeMap.containsKey(splitNum)){
                   splitNum = RandomUtils.nextLong(minAmount, packageAmount);
               }
               // valueæ”¾å…¥ä¸Šä¸€ä¸ªentryçš„key,ç»„æˆé“¾æ¡ï¼Œé˜²æ­¢å†æ¬¡å¾ªç¯
               treeMap.put(splitNum, lower);
               treeMap.put(higher, splitNum);
           }
           System.out.println(&amp;quot;init finish&amp;quot;);
       }
       Map.Entry&amp;lt;Long, Long&amp;gt; entry = treeMap.pollFirstEntry();
       if(treeMap.size() == 0){
           // ç”¨å®Œçº¢åŒ…
           this.finish = true;
           if(entry == null){
               return 0L;
           }
       }
       return entry.getKey() - entry.getValue();
   }

   public static void main(String[] args) {
       RedPackage redPackage = new RedPackage(1500L, 10, 10L);
       long result = 0;
       for (int i = 0; i &amp;lt; 15; i++) {
           long amount = redPackage.nextAmount()ï¼›
           System.out.println(amount);
           result = result + amount;
       }
       System.out.println(result);
   }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;5-todo-è®¾ç½®å•ä¸ªçº¢åŒ…æœ€å¤§é™é¢å€¼&#34;&gt;5ã€TODO è®¾ç½®å•ä¸ªçº¢åŒ…æœ€å¤§é™é¢å€¼&lt;/h3&gt;
&lt;p&gt;ç›®å‰è¿˜æ²¡æœ‰å®ç°æ€è·¯&lt;/p&gt;
">æ¦‚ç‡ç›¸ç­‰çš„æ‹¼æ‰‹æ°”çº¢åŒ…ç®—æ³•å®ç°</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://zhangyaoo.github.io/post/di-pin-lu-da-shu-ju-liang-qiang-yi-zhi-xing-chang-jing-xia-jie-jue-si-lu/"" data-c="
          &lt;h1 id=&#34;&#34;&gt;&lt;/h1&gt;
">ä½é¢‘ç‡å¤§æ•°æ®é‡å¼ºä¸€è‡´æ€§åœºæ™¯ä¸‹è§£å†³æ€è·¯</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://zhangyaoo.github.io/post/hua-dong-chuang-kou-shi-xian-xian-liu-suan-fa-huan-xing-dui-lie-shi-xian/"" data-c="
          &lt;h3 id=&#34;&#34;&gt;&lt;/h3&gt;
">æ»‘åŠ¨çª—å£é™æµç®—æ³•â€”â€”ç¯å½¢é˜Ÿåˆ—å®ç°</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://zhangyaoo.github.io/post/xue-xi-bi-ji-mysql/"" data-c="
          &lt;h2 id=&#34;å¹»è¯»åŸç†&#34;&gt;å¹»è¯»åŸç†&lt;/h2&gt;
&lt;h3 id=&#34;1-å®šä¹‰&#34;&gt;1ã€å®šä¹‰ï¼š&lt;/h3&gt;
&lt;p&gt;å¹»è¯»æŒ‡çš„æ˜¯ä¸€ä¸ªäº‹åŠ¡åœ¨å‰åä¸¤æ¬¡æŸ¥è¯¢åŒä¸€ä¸ªèŒƒå›´çš„æ—¶å€™ï¼Œåä¸€æ¬¡æŸ¥è¯¢çœ‹åˆ°äº†å‰ä¸€æ¬¡æŸ¥è¯¢æ²¡æœ‰çœ‹åˆ°çš„è¡Œ&lt;br&gt;
å¹»è¯»ï¼šæäº¤éš”ç¦»çº§åˆ«ä¸‹çœ‹åˆ°çš„ï¼Œä¸¥æ ¼æ¥è¯´ä¸ç®—ã€‚å› ä¸ºè¿™ä¸ªå°±æ˜¯è¯»æäº¤éš”ç¦»çº§åˆ«ä¸‹â€œè®¾è®¡å†…â€çš„é—®é¢˜&lt;br&gt;
å¯¹äºè¯»æäº¤éš”ç¦»çº§åˆ«ï¼Œè¿™ä¸ªç®—â€œfeatureâ€,å¯¹äºå¯é‡å¤è¯»ï¼Œè¿™ä¸ªæ˜¯â€bugâ€, æ‰€ä»¥è¦è§£å†³ï¼Œç§°å‘¼è¿™ä¸ªbugä¸ºå¹»è¯»&lt;/p&gt;
&lt;h3 id=&#34;2-æ³¨æ„&#34;&gt;2ã€æ³¨æ„ï¼š&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ™®é€šçš„æŸ¥è¯¢æ˜¯å¿«ç…§è¯»ï¼Œæ˜¯ä¸ä¼šçœ‹åˆ°åˆ«çš„äº‹åŠ¡æ’å…¥çš„æ•°æ®çš„ã€‚å› æ­¤ï¼Œå¹»è¯»åœ¨â€œå½“å‰è¯»â€ä¸‹æ‰ä¼šå‡ºç°ã€‚&lt;/li&gt;
&lt;li&gt;å¹»è¯»åªé’ˆå¯¹æ–°å¢çš„è¡Œï¼Œå³ä½¿æŠŠæ‰€æœ‰çš„è®°å½•éƒ½åŠ ä¸Šé”ï¼Œè¿˜æ˜¯é˜»æ­¢ä¸äº†æ–°æ’å…¥çš„è®°å½•&lt;/li&gt;
&lt;li&gt;é—´éš™é”æ˜¯åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹æ‰ä¼šç”Ÿæ•ˆçš„ã€‚å¦‚æœæŠŠéš”ç¦»çº§åˆ«è®¾ç½®ä¸ºè¯»æäº¤çš„è¯ï¼Œå°±æ²¡æœ‰é—´éš™é”äº†ã€‚&lt;/li&gt;
&lt;li&gt;éš”ç¦»çº§åˆ«ä¸ºè¯»æäº¤çš„è¯ï¼Œå°±ä¼šå‡ºç°å¹»è¯»ã€ä¸¥æ ¼æ¥è¯´RCçº§åˆ«ä¸‹ä¸æ˜¯å¹»è¯»ã€‘æƒ…å†µã€‚å¹¶ä¸”éœ€è¦å°†binlogçš„æ¨¡å¼è®¾ç½®ä¸ºrowæ¨¡å¼ï¼ˆbinlogä¸‰ç§æ¨¡å¼https://www.cnblogs.com/xingyunfashi/p/8431780.htmlï¼‰ï¼Œä¸èƒ½ä½¿ç”¨statementæ ¼å¼ï¼Œstatementä¼šå¯¼è‡´æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼ˆæ²¡æœ‰é—´éš™é”ï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆè¦è®¾ç½®ä¸ºrowï¼Ÿ&lt;br&gt;
é—´éš™é”æ˜¯åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹æ‰ä¼šç”Ÿæ•ˆçš„ã€‚æ‰€ä»¥ï¼Œä½ å¦‚æœæŠŠéš”ç¦»çº§åˆ«è®¾ç½®ä¸ºè¯»æäº¤çš„è¯ï¼Œå°±æ²¡æœ‰é—´éš™é”äº†ã€‚ä½†åŒæ—¶ï¼Œä½ è¦è§£å†³å¯èƒ½å‡ºç°çš„æ•°æ®å’Œæ—¥å¿—ä¸ä¸€è‡´é—®é¢˜ï¼Œéœ€è¦æŠŠ binlog æ ¼å¼è®¾ç½®ä¸º rowã€‚&lt;/p&gt;
&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;ä¸»é”®ä¹‹é—´ä¹Ÿä¼šä¹Ÿæœ‰é—´éš™é”ï¼Œå¦‚ä¸‹å›¾ï¼Œæ‰§è¡Œselect * from t where id=N for update; å¦‚æœæ²¡æœ‰è¿™è¡Œä¼šé”ä½é—´éš™(5,10)(æœ‰ä¸€æ¡5å’Œä¸€æ¡10çš„è®°å½•)ã€‚å¦‚ä¸‹å›¾ï¼Œå¤šçº¿ç¨‹æ‰§è¡Œè¯­å¥ä¼šå¯¼è‡´æ­»é”&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1614246510870.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;3-è§£å†³&#34;&gt;3ã€è§£å†³ï¼š&lt;/h3&gt;
&lt;p&gt;é—´éš™é”å’Œè¡Œé”ï¼Œåˆæˆä¸ºnext-key lockï¼Œnext-key lockæ˜¯å‰å¼€åé—­åŒºé—´ï¼Œå•ç‹¬é—´éš™é”æ˜¯å‰å¼€åå¼€åŒºé—´&lt;/p&gt;
&lt;h3 id=&#34;4-åæœ&#34;&gt;4ã€åæœï¼š&lt;/h3&gt;
&lt;p&gt;é—´éš™é”çš„å¼•å…¥ï¼Œå¯èƒ½ä¼šå¯¼è‡´åŒæ ·çš„è¯­å¥é”ä½æ›´å¤§çš„èŒƒå›´ï¼Œå½±å“å¹¶å‘åº¦&lt;/p&gt;
&lt;h3 id=&#34;5-æ¡ˆä¾‹&#34;&gt;5ã€æ¡ˆä¾‹&lt;/h3&gt;
&lt;p&gt;æ¡ˆä¾‹1ã€select * from t where d=5 for updateï¼Œdæ²¡æœ‰ç´¢å¼•&lt;br&gt;
è¿™ä¸ªæ—¶å€™ä¼šæ‰«æå…¨è¡¨ï¼Œä¼šç»™è¡¨è®°å½•æ‰€æœ‰çš„è¡ŒåŠ ä¸Šè¡Œé”ï¼Œè¿˜ä¼šåŠ ä¸Šé—´éš™é”ã€‚æ¯”å¦‚è¡¨tæœ‰6æ¡è®°å½•ï¼Œä¼šä¸Š6æ¡è¡Œé”ï¼Œä»¥åŠ7ä¸ªé—´éš™é”ã€‚&lt;br&gt;
ç»“è®ºï¼šå¯¹äºéç´¢å¼•å­—æ®µè¿›è¡Œupdateæˆ–select .. for updateæ“ä½œï¼Œä»£ä»·æé«˜ã€‚æ‰€æœ‰è®°å½•ä¸Šé”ï¼Œä»¥åŠæ‰€æœ‰é—´éš”çš„é”ã€‚å¯¹äºç´¢å¼•å­—æ®µè¿›è¡Œä¸Šè¿°æ“ä½œï¼Œä»£ä»·ä¸€èˆ¬ã€‚åªæœ‰ç´¢å¼•å­—æ®µæœ¬èº«å’Œé™„è¿‘çš„é—´éš”ä¼šè¢«åŠ é”ã€‚&lt;/p&gt;
&lt;h2 id=&#34;online-ddl-åŸç†&#34;&gt;online DDL åŸç†&lt;/h2&gt;
&lt;h3 id=&#34;1-mdlé”è¡¨å…ƒæ•°æ®é”åœ¨online-ddlçš„ä½“ç°&#34;&gt;1ã€MDLé”ï¼ˆè¡¨å…ƒæ•°æ®é”ï¼‰åœ¨online DDLçš„ä½“ç°ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;ä½œç”¨ï¼šç»´æŠ¤è¡¨å…ƒæ•°æ®çš„æ•°æ®ä¸€è‡´æ€§ï¼Œä¿è¯DDLæ“ä½œä¸DMLæ“ä½œä¹‹é—´çš„ä¸€è‡´æ€§ã€‚å¦‚æœåœ¨SQLæŸ¥è¯¢æœŸé—´ä¿®æ”¹äº†è¡¨ç»“æ„å°±ä¼šæœ‰é—®é¢˜ã€‚&lt;br&gt;
æ€»ç»“ï¼šMDLä½œç”¨æ˜¯é˜²æ­¢DDLå’ŒDMLå¹¶å‘çš„å†²çª&lt;/p&gt;
&lt;h3 id=&#34;2-è¿‡ç¨‹&#34;&gt;2ã€è¿‡ç¨‹&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å½“å¯¹ä¸€ä¸ªè¡¨åšå¢åˆ æ”¹æŸ¥æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDL è¯»é”ï¼›å½“è¦å¯¹è¡¨åšç»“æ„å˜æ›´æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDL å†™é”ã€‚&lt;br&gt;
ç»“è®ºï¼šåŠ è¯»é”åˆ™æ‰€æœ‰çº¿ç¨‹å¯æ­£å¸¸è¯»å…ƒæ•°æ®ï¼Œä¸å½±å“å¢åˆ æ”¹æŸ¥æ“ä½œï¼Œåªæ˜¯ä¸èƒ½ä¿®æ”¹è¡¨ç»“æ„ï¼›åŠ å†™é”åˆ™åªæœ‰æ‹¥æœ‰é”çš„çº¿ç¨‹å¯ä»¥è¯»å†™å…ƒæ•°æ®ï¼Œä¹Ÿå°±æ˜¯ä¿®æ”¹è¡¨ç»“æ„ï¼Œå…¶å®ƒçº¿ç¨‹ä¸èƒ½æ‰§è¡Œä»»ä½•æ“ä½œï¼ŒåŒ…æ‹¬ä¿®æ”¹è¡¨ç»“æ„ä¸å¢åˆ æ”¹æŸ¥ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;äº‹åŠ¡ä¸­çš„ MDL é”ï¼Œåœ¨è¯­å¥æ‰§è¡Œå¼€å§‹æ—¶ç”³è¯·ï¼Œä½†æ˜¯è¯­å¥ç»“æŸåå¹¶ä¸ä¼šé©¬ä¸Šé‡Šæ”¾ï¼Œè€Œä¼šç­‰åˆ°æ•´ä¸ªäº‹åŠ¡æäº¤åå†é‡Šæ”¾ã€‚&lt;br&gt;
æ³¨ï¼šä¸€èˆ¬å¢åˆ æ”¹æŸ¥è¯­å¥é»˜è®¤åŠ ä¸ŠMDLè¯»é”&lt;br&gt;
ç»“è®ºï¼šå½“æœ‰æœªæäº¤çš„äº‹åŠ¡æ—¶å€™ï¼Œæˆ–è€…æ˜¯é•¿äº‹åŠ¡æ—¶å€™ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™è¿›è¡Œå¢åˆ æ”¹æŸ¥ï¼Œæ˜¯ä¸€ä¸ªå±é™©çš„æ“ä½œï¼Œå¯èƒ½é˜»å¡å…¶å®ƒå¢åˆ æ”¹æŸ¥è¯·æ±‚ï¼Œæˆ–å¯¼è‡´çº¿ç¨‹çˆ†æ»¡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;3-online-ddlå·¥ä½œåŸç†&#34;&gt;3ã€online DDLå·¥ä½œåŸç†&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;æ‹¿MDLå†™é”&lt;/li&gt;
&lt;li&gt;DDLæ‰§è¡Œå‡†å¤‡&lt;/li&gt;
&lt;li&gt;é™çº§æˆMDLè¯»é”&lt;/li&gt;
&lt;li&gt;DDLæ ¸å¿ƒæ‰§è¡Œï¼ˆè€—æ—¶æœ€å¤šçš„ï¼‰&lt;/li&gt;
&lt;li&gt;å‡çº§æˆMDLå†™é”&lt;/li&gt;
&lt;li&gt;DDLæœ€ç»ˆæäº¤&lt;/li&gt;
&lt;li&gt;é‡Šæ”¾MDLé”&lt;br&gt;
æ³¨ï¼šé™¤äº†ç¬¬å››æ­¥ï¼Œå…¶ä»–éƒ½æ˜¯è·å–é”ï¼Œå¦‚æœæ²¡æœ‰å†²çªï¼Œè·å–é”çš„æ—¶é—´è¾ƒå°ã€‚å…¶ä¸­ç¬¬å››æ­¥æ˜¯è¯»é”ï¼Œæ‰€ä»¥æ˜¯å¯ä»¥æ­£å¸¸è¯»å†™æ•°æ®æ‰€ä»¥è¢«ç§°ä¸ºOnline DDLã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;oderby-å·¥ä½œåŸç†&#34;&gt;oderby å·¥ä½œåŸç†&lt;/h2&gt;
&lt;h3 id=&#34;1-å¼•å‡º&#34;&gt;1ã€å¼•å‡º&lt;/h3&gt;
&lt;p&gt;explain çš„extraä¿¡æ¯é‡Œé¢å‡ºç°äº†filesortï¼ŒMySQL ä¼šç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€å—å†…å­˜ç”¨äºæ’åºï¼Œç§°ä¸º sort_bufferã€‚&lt;/p&gt;
&lt;p&gt;sort_buffer_sizeï¼Œå°±æ˜¯ MySQL ä¸ºæ’åºå¼€è¾Ÿçš„å†…å­˜ï¼ˆsort_bufferï¼‰çš„å¤§å°ã€‚å¦‚æœè¦æ’åºçš„æ•°æ®é‡å°äº sort_buffer_sizeï¼Œæ’åºå°±åœ¨å†…å­˜ä¸­å®Œæˆã€‚ä½†å¦‚æœæ’åºæ•°æ®é‡å¤ªå¤§ï¼Œå†…å­˜æ”¾ä¸ä¸‹ï¼Œåˆ™ä¸å¾—ä¸åˆ©ç”¨ç£ç›˜ä¸´æ—¶æ–‡ä»¶è¾…åŠ©æ’åºã€‚&lt;br&gt;
å¤–éƒ¨æ’åºä¸€èˆ¬ä½¿ç”¨å½’å¹¶æ’åºç®—æ³•ã€‚&lt;/p&gt;
&lt;h3 id=&#34;2-æ’åºç±»å‹&#34;&gt;2ã€æ’åºç±»å‹&lt;/h3&gt;
&lt;p&gt;å…¨å­—æ®µæ’åºå’ŒrowIDæ’åº&lt;br&gt;
å…¨å­—æ®µæ’åºï¼šä¼šæ‰¾å‡ºä¸»é”®ç´¢å¼•çš„æ‰€æœ‰å­—æ®µæ•°æ®æ”¾å…¥sort_bufferä¸­æ’åº&lt;br&gt;
ç¼ºç‚¹ï¼šè¿”å›çš„å­—æ®µå¾ˆå¤šçš„è¯ï¼Œé‚£ä¹ˆ sort_buffer é‡Œé¢è¦æ”¾çš„å­—æ®µæ•°å¤ªå¤šï¼Œè¿™æ ·å†…å­˜é‡Œèƒ½å¤ŸåŒæ—¶æ”¾ä¸‹çš„è¡Œæ•°å¾ˆå°‘ï¼Œè¦åˆ†æˆå¾ˆå¤šä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œæ’åºçš„æ€§èƒ½ä¼šå¾ˆå·®&lt;/p&gt;
&lt;p&gt;rowIDæ’åºï¼šè¦æ’åºçš„åˆ—åªæœ‰æ’åºå­—æ®µå’ŒID&lt;br&gt;
ç¼ºç‚¹:rowid æ’åºå¤šè®¿é—®äº†ä¸€æ¬¡è¡¨ t çš„ä¸»é”®ç´¢å¼•ï¼Œå¤šäº†ç£ç›˜è¯»&lt;/p&gt;
&lt;p&gt;MySQLè®¾è®¡æ€æƒ³ï¼šå¦‚æœå†…å­˜å¤Ÿï¼Œå°±è¦å¤šåˆ©ç”¨å†…å­˜ï¼Œå°½é‡å‡å°‘ç£ç›˜è®¿é—®ã€‚&lt;/p&gt;
&lt;h3 id=&#34;3-å¢åŠ è¦†ç›–ç´¢å¼•å’Œè”åˆç´¢å¼•ä¼˜åŒ–æ’åº&#34;&gt;3ã€å¢åŠ è¦†ç›–ç´¢å¼•å’Œè”åˆç´¢å¼•ä¼˜åŒ–æ’åº&lt;/h3&gt;
&lt;p&gt;ç´¢å¼•é»˜è®¤æ•°æ®æ˜¯æœ‰åºçš„ï¼Œè¿™æ ·å¯ä»¥é¿å…ä½¿ç”¨sort_bufferï¼ˆå…¨å­—æ®µæ’åºå’ŒrowIDæ’åºï¼‰æ¥è¿›è¡Œæ’åº&lt;/p&gt;
&lt;h3 id=&#34;4-é¢å¤–æ¡ˆä¾‹&#34;&gt;4ã€é¢å¤–æ¡ˆä¾‹&lt;/h3&gt;
&lt;p&gt;1ï¼‰æ— æ¡ä»¶æŸ¥è¯¢å¦‚æœåªæœ‰order by create_timeï¼ˆcreate_timeæ˜¯ç´¢å¼•ï¼‰ï¼Œé‚£ä¹ˆä¸ä¼šèµ°ç´¢å¼•&lt;br&gt;
åŸå› ï¼šä¼˜åŒ–å™¨è®¤ä¸ºèµ°äºŒçº§ç´¢å¼•å†å»å›è¡¨æˆæœ¬æ¯”å…¨è¡¨æ‰«ææ’åºæ›´é«˜ï¼Œæ‰€ä»¥é€‰æ‹©èµ°å…¨è¡¨æ‰«æï¼Œç„¶ååˆ©ç”¨å…¨å­—æ®µæ’åºå’ŒrowIDæ’åºå…¶ä¸­ä¸€ç§æ’åºã€‚&lt;/p&gt;
&lt;h2 id=&#34;select-countå·¥ä½œåŸç†&#34;&gt;select countå·¥ä½œåŸç†&lt;/h2&gt;
&lt;h3 id=&#34;1-count-å®ç°æ–¹å¼&#34;&gt;1ã€count(*) å®ç°æ–¹å¼&lt;/h3&gt;
&lt;p&gt;åœ¨ä¸åŒçš„ MySQL å¼•æ“ä¸­ï¼Œcount(&lt;em&gt;) æœ‰ä¸åŒçš„å®ç°æ–¹å¼ã€‚&lt;br&gt;
MyISAM å¼•æ“æŠŠä¸€ä¸ªè¡¨çš„æ€»è¡Œæ•°å­˜åœ¨äº†ç£ç›˜ä¸Šï¼Œå› æ­¤æ‰§è¡Œ count(&lt;/em&gt;) çš„æ—¶å€™ä¼šç›´æ¥è¿”å›è¿™ä¸ªæ•°ï¼Œæ•ˆç‡å¾ˆé«˜ï¼›&lt;br&gt;
è€Œ InnoDB å¼•æ“å°±éº»çƒ¦äº†ï¼Œå®ƒæ‰§è¡Œ count(*) çš„æ—¶å€™ï¼Œéœ€è¦æŠŠæ•°æ®ä¸€è¡Œä¸€è¡Œåœ°ä»å¼•æ“é‡Œé¢è¯»å‡ºæ¥ï¼Œç„¶åç´¯ç§¯è®¡æ•°ã€‚&lt;/p&gt;
&lt;h3 id=&#34;2-ä¸ºä»€ä¹ˆinnodb-ä¸è·Ÿ-myisam-ä¸€æ ·ä¹ŸæŠŠæ•°å­—å­˜èµ·æ¥å‘¢&#34;&gt;2ã€ä¸ºä»€ä¹ˆInnoDB ä¸è·Ÿ MyISAM ä¸€æ ·ï¼Œä¹ŸæŠŠæ•°å­—å­˜èµ·æ¥å‘¢&lt;/h3&gt;
&lt;p&gt;å› ä¸ºInnoDB æœ‰MVCCï¼Œä¸åŒæ—¶åˆ»ä¸åŒäº‹åŠ¡ä¹‹é—´æœ‰å¯èƒ½çš„ç»“æœä¸ä¸€æ ·&lt;/p&gt;
&lt;h3 id=&#34;3-å°ç»“ä¸€ä¸‹&#34;&gt;3ã€å°ç»“ä¸€ä¸‹&lt;/h3&gt;
&lt;p&gt;MyISAM è¡¨è™½ç„¶ count(&lt;em&gt;) å¾ˆå¿«ï¼Œä½†æ˜¯ä¸æ”¯æŒäº‹åŠ¡ï¼›ï¼ŒåŠ äº†whereæ¡ä»¶ä¹Ÿå¾ˆæ…¢&lt;br&gt;
show table status å‘½ä»¤è™½ç„¶è¿”å›å¾ˆå¿«ï¼Œä½†æ˜¯ä¸å‡†ç¡®ï¼›&lt;br&gt;
InnoDB è¡¨ç›´æ¥ count(&lt;/em&gt;) ä¼šéå†å…¨è¡¨ï¼Œè™½ç„¶ç»“æœå‡†ç¡®ï¼Œä½†ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜&lt;/p&gt;
&lt;h3 id=&#34;4-count-countä¸»é”®-id-countå­—æ®µ-å’Œ-count1-ç­‰ä¸åŒç”¨æ³•çš„æ€§èƒ½æœ‰å“ªäº›å·®åˆ«&#34;&gt;4ã€count(*)ã€count(ä¸»é”® id)ã€count(å­—æ®µ) å’Œ count(1) ç­‰ä¸åŒç”¨æ³•çš„æ€§èƒ½ï¼Œæœ‰å“ªäº›å·®åˆ«ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;countè¯­ä¹‰ï¼šcount() æ˜¯ä¸€ä¸ªèšåˆå‡½æ•°ï¼Œå¯¹äºè¿”å›çš„ç»“æœé›†ï¼Œä¸€è¡Œè¡Œåœ°åˆ¤æ–­ï¼Œå¦‚æœ count å‡½æ•°çš„å‚æ•°ä¸æ˜¯ NULLï¼Œç´¯è®¡å€¼å°±åŠ  1ï¼Œå¦åˆ™ä¸åŠ ã€‚æœ€åè¿”å›ç´¯è®¡å€¼&lt;br&gt;
å¾—å‡ºç»“è®ºï¼šcount(*)ã€count(ä¸»é”® id) å’Œ count(1) éƒ½è¡¨ç¤ºè¿”å›æ»¡è¶³æ¡ä»¶çš„ç»“æœé›†çš„æ€»è¡Œæ•°ï¼›è€Œ count(å­—æ®µï¼‰ï¼Œåˆ™è¡¨ç¤ºè¿”å›æ»¡è¶³æ¡ä»¶çš„æ•°æ®è¡Œé‡Œé¢ï¼Œå‚æ•°â€œå­—æ®µâ€ä¸ä¸º NULL çš„æ€»ä¸ªæ•°&lt;/p&gt;
&lt;h3 id=&#34;5-æ€§èƒ½å¯¹æ¯”&#34;&gt;5ã€æ€§èƒ½å¯¹æ¯”ï¼š&lt;/h3&gt;
&lt;p&gt;count(ä¸»é”®ID)ï¼šInnoDB å¼•æ“éå†æ•´å¼ è¡¨ï¼Œä½†ä¸å–å€¼ã€‚server å±‚æ‹¿åˆ° id åï¼Œåˆ¤æ–­æ˜¯ä¸å¯èƒ½ä¸ºç©ºçš„ï¼Œå°±æŒ‰è¡Œç´¯åŠ &lt;br&gt;
count(1)ï¼šInnoDB å¼•æ“éå†æ•´å¼ è¡¨ï¼ŒæŠŠæ¯ä¸€è¡Œçš„IDå–å‡ºæ¥ã€‚server å±‚å¯¹äºè¿”å›çš„æ¯ä¸€è¡Œï¼Œæ”¾ä¸€ä¸ªæ•°å­—â€œ1â€è¿›å»ï¼Œåˆ¤æ–­æ˜¯ä¸å¯èƒ½ä¸ºç©ºçš„ï¼ŒæŒ‰è¡Œç´¯åŠ &lt;br&gt;
count(å­—æ®µ)ï¼šä¸€è¡Œè¡Œåœ°ä»è®°å½•é‡Œé¢è¯»å‡ºè¿™ä¸ªå­—æ®µï¼Œåˆ¤æ–­ä¸èƒ½ä¸º nullï¼ŒæŒ‰è¡Œç´¯åŠ &lt;br&gt;
count(&lt;em&gt;)ï¼šcount(&lt;/em&gt;)æ˜¯ä¸ªä¾‹å¤–ï¼Œç›®å‰MySQLåªé’ˆå¯¹äº†è¿™ä¸ªåšäº†ä¼˜åŒ–ï¼Œå¹¶ä¸ä¼šæŠŠå…¨éƒ¨å­—æ®µå–å‡ºæ¥ï¼Œè€Œæ˜¯ä¸“é—¨åšäº†ä¼˜åŒ–ï¼Œä¸å–å€¼ã€‚count(*) è‚¯å®šä¸æ˜¯ nullï¼ŒæŒ‰è¡Œç´¯åŠ ã€‚&lt;/p&gt;
&lt;h3 id=&#34;6-ç»“è®º&#34;&gt;6ã€ç»“è®º&lt;/h3&gt;
&lt;p&gt;count(å­—æ®µ) &amp;lt; count(ä¸»é”®ID)&amp;lt; count(1)=count(&lt;em&gt;)&lt;br&gt;
1ã€å› ä¸ºcount(&lt;/em&gt;) å’Œ count(1) ä¸å–å­—æ®µå€¼ï¼Œå¼•æ“å±‚å‡å°‘å¾€ serverå±‚çš„æ•°æ®è¿”å›ï¼Œæ‰€ä»¥æ¯”å…¶ä»–count(å­—æ®µ)è¦è¿”å›å€¼çš„ã€æ€§èƒ½ã€‘è¾ƒå¥½ï¼›&lt;br&gt;
2ã€ä¸ºä»€ä¹ˆcount(å­—æ®µ)&amp;lt; count(ä¸»é”®ID)ï¼Œå› ä¸ºå¦‚æœé€‰æ‹©count(ID)ï¼Œé‚£ä¹ˆMySQLä¼šè‡ªåŠ¨é€‰æ‹©æœ€å°çš„ç´¢å¼•æ ‘æ¥éå†ï¼Œå¦‚æœæ˜¯count(å­—æ®µ)ï¼Œè€Œä¸”å­—æ®µæ²¡æœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆä¼šä½¿ç”¨ä¸»é”®ç´¢å¼•ã€‚ä¸»é”®ç´¢å¼•å¾ˆå¤§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•é€‰æ‹©&#34;&gt;æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•é€‰æ‹©&lt;/h2&gt;
&lt;h3 id=&#34;1-æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•é€‰æ‹©&#34;&gt;1ã€æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•é€‰æ‹©&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;æŸ¥è¯¢æ€§èƒ½éƒ½ä¸€æ ·&lt;/li&gt;
&lt;li&gt;æ›´æ–°åˆ†ä¸¤ç§æƒ…å†µ&lt;/li&gt;
&lt;/ol&gt;
&lt;ol&gt;
&lt;li&gt;è¿™ä¸ªè®°å½•è¦æ›´æ–°çš„ç›®æ ‡é¡µåœ¨å†…å­˜ä¸­ï¼š&lt;br&gt;
å¯¹äºå”¯ä¸€ç´¢å¼•æ¥è¯´ï¼Œæ‰¾åˆ° 3 å’Œ 5 ä¹‹é—´çš„ä½ç½®ï¼Œåˆ¤æ–­åˆ°æ²¡æœ‰å†²çªï¼Œæ’å…¥è¿™ä¸ªå€¼ï¼Œè¯­å¥æ‰§è¡Œç»“æŸï¼›&lt;br&gt;
å¯¹äºæ™®é€šç´¢å¼•æ¥è¯´ï¼Œæ‰¾åˆ° 3 å’Œ 5 ä¹‹é—´çš„ä½ç½®ï¼Œæ’å…¥è¿™ä¸ªå€¼ï¼Œè¯­å¥æ‰§è¡Œç»“æŸã€‚&lt;br&gt;
æ€»ç»“ï¼šç›®æ ‡è®°å½•åœ¨å†…å­˜buffer poolä¸­çš„è¯ï¼Œæ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•æ›´æ–°æ€§èƒ½æ˜¯ä¸€è‡´çš„ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;2)è¿™ä¸ªè®°å½•è¦æ›´æ–°çš„ç›®æ ‡é¡µä¸åœ¨å†…å­˜ä¸­ï¼š&lt;br&gt;
å¯¹äºå”¯ä¸€ç´¢å¼•æ¥è¯´ï¼Œéœ€è¦å°†æ•°æ®é¡µè¯»å…¥å†…å­˜ï¼Œåˆ¤æ–­åˆ°æ²¡æœ‰å†²çªï¼Œæ’å…¥è¿™ä¸ªå€¼ï¼Œè¯­å¥æ‰§è¡Œç»“æŸï¼›&lt;br&gt;
å¯¹äºæ™®é€šç´¢å¼•æ¥è¯´ï¼Œåˆ™æ˜¯å°†æ›´æ–°è®°å½•åœ¨ change bufferï¼Œè¯­å¥æ‰§è¡Œå°±ç»“æŸäº†ã€‚&lt;br&gt;
æ€»ç»“ï¼šå”¯ä¸€ç´¢å¼•å°†æ•°æ®é¡µè¯»å…¥å†…å­˜æ¶‰åŠéšæœºè®¿é—®IOï¼Œæ“ä½œæˆæœ¬æé«˜ã€‚change bufferé¿å…æ›´æ–°ç£ç›˜ï¼Œå‡å°‘äº†éšæœºç£ç›˜è®¿é—®ï¼Œæä¾›æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;æ¡ˆä¾‹ï¼šæŸä¸ªä¸šåŠ¡çš„åº“å†…å­˜å‘½ä¸­ç‡çªç„¶ä» 99% é™ä½åˆ°äº† 75%ï¼Œæ•´ä¸ªç³»ç»Ÿå¤„äºé˜»å¡çŠ¶æ€ï¼Œæ›´æ–°è¯­å¥å…¨éƒ¨å µä½&lt;br&gt;
åŸå› ï¼šä¸šåŠ¡æœ‰å¤§é‡æ’å…¥æ•°æ®çš„æ“ä½œï¼Œå¼€å‘äººå‘˜æŠŠå…¶ä¸­çš„æŸä¸ªæ™®é€šç´¢å¼•æ”¹æˆäº†å”¯ä¸€ç´¢å¼•ã€‚&lt;/p&gt;
&lt;h3 id=&#34;2-changebufferçš„ä½¿ç”¨åœºæ™¯&#34;&gt;2ã€changebufferçš„ä½¿ç”¨åœºæ™¯&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;å”¯ä¸€ç´¢å¼•çš„æ›´æ–°å°±ä¸èƒ½ä½¿ç”¨ change bufferï¼Œå®é™…ä¸Šä¹Ÿåªæœ‰æ™®é€šç´¢å¼•å¯ä»¥ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äºå†™å¤šè¯»å°‘çš„ä¸šåŠ¡æ¥è¯´ï¼Œé¡µé¢åœ¨å†™å®Œä»¥åé©¬ä¸Šè¢«è®¿é—®åˆ°çš„æ¦‚ç‡æ¯”è¾ƒå°ï¼Œæ­¤æ—¶ change buffer çš„ä½¿ç”¨æ•ˆæœæœ€å¥½ã€‚è¿™ç§ä¸šåŠ¡æ¨¡å‹å¸¸è§çš„å°±æ˜¯è´¦å•ç±»ã€æ—¥å¿—ç±»çš„ç³»ç»Ÿã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæ˜¯å†™å®Œç«‹é©¬è¯»çš„åœºæ™¯ï¼Œå»ºè®®å…³é—­change buffer ï¼Œå› ä¸ºç«‹é©¬æŸ¥è¯¢ä¼šè®¿é—®æ•°æ®é¡µï¼Œä¼šè¿›è¡Œmergeæ“ä½œ&lt;br&gt;
mergeï¼šå°† change buffer ä¸­çš„æ“ä½œåº”ç”¨åˆ°åŸæ•°æ®é¡µï¼Œå¾—åˆ°æœ€æ–°ç»“æœçš„è¿‡ç¨‹ç§°ä¸º mergeã€‚é™¤äº†è®¿é—®è¿™ä¸ªæ•°æ®é¡µä¼šè§¦å‘ merge å¤–ï¼Œç³»ç»Ÿæœ‰åå°çº¿ç¨‹ä¼šå®šæœŸ mergeã€‚åœ¨æ•°æ®åº“æ­£å¸¸å…³é—­ï¼ˆshutdownï¼‰çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿä¼šæ‰§è¡Œ merge æ“ä½œã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;3-change-buffer-å’Œ-redo-logä¸¤ä¸ªåˆ†åˆ«æ˜¯å¦‚ä½•æé«˜æ€§èƒ½çš„&#34;&gt;3ã€change buffer å’Œ redo logä¸¤ä¸ªåˆ†åˆ«æ˜¯å¦‚ä½•æé«˜æ€§èƒ½çš„&lt;/h3&gt;
&lt;p&gt;redo log ä¸»è¦èŠ‚çœçš„æ˜¯éšæœºå†™ç£ç›˜çš„ IO æ¶ˆè€—ï¼ˆè½¬æˆé¡ºåºå†™ï¼‰ï¼Œ&lt;br&gt;
å¯¹äºæ™®é€šç´¢å¼•çš„ä¿®æ”¹ï¼Œåˆ™ä¼šè®°å½•åˆ°change bufferï¼Œè€Œ change buffer ä¸»è¦èŠ‚çœçš„åˆ™æ˜¯éšæœºè¯»ç£ç›˜çš„ IO æ¶ˆè€—ã€‚&lt;/p&gt;
&lt;h3 id=&#34;4-ä¸¾ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜-mergechangebufferredologçš„å…³ç³»&#34;&gt;4ã€ä¸¾ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜ mergeï¼Œchangebufferï¼Œredologçš„å…³ç³»&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;æ’å…¥(id1,k1) (id2,k2)ä¸¤æ¡è®°å½•ï¼Œk1 æ‰€åœ¨çš„æ•°æ®é¡µåœ¨å†…å­˜ (InnoDB buffer pool) ä¸­ï¼Œk2 æ‰€åœ¨çš„æ•°æ®é¡µä¸åœ¨å†…å­˜ä¸­&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1614246819842.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
ä»¥ä¸Šæ“ä½œæ˜¯ï¼š&lt;br&gt;
1ï¼‰Page 1 åœ¨å†…å­˜ä¸­ï¼Œç›´æ¥æ›´æ–°å†…å­˜ï¼›&lt;br&gt;
2ï¼‰Page 2 æ²¡æœ‰åœ¨å†…å­˜ä¸­ï¼Œå°±åœ¨å†…å­˜çš„ change buffer åŒºåŸŸï¼Œè®°å½•ä¸‹â€œæˆ‘è¦å¾€ Page 2 æ’å…¥ä¸€è¡Œâ€è¿™ä¸ªä¿¡3ï¼‰å°†ä¸Šè¿°ä¸¤ä¸ªåŠ¨ä½œè®°å…¥ redo log ä¸­ï¼ˆå›¾ä¸­ 3 å’Œ 4ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ‰§è¡ŒæŸ¥è¯¢æ“ä½œselect * from t where k in (k1, k2)&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1614246855416.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
ä»¥ä¸Šæ“ä½œæ˜¯ï¼š&lt;br&gt;
1ï¼‰å¦‚æœk1å¯¹åº”çš„æ•°æ®é¡µåœ¨buffer poolå†…å­˜ä¸­ï¼Œé‚£ä¹ˆç›´æ¥ä»å†…å­˜ä¸­æŸ¥å‡ºå¹¶ä¸”è¿”å›ã€‚è¿™é‡Œä¸ç”¨ç›´æ¥ä»redologä¸­è¯»ç›˜&lt;br&gt;
2ï¼‰å¦‚æœk2å¯¹åº”çš„æ•°æ®é¡µä¸åœ¨å†…å­˜ä¸­ï¼Œé‚£ä¹ˆä¼šè¯»ç›˜ï¼Œè¯»æ•°æ®åˆ°æ•°æ®é¡µpage2ä¸­ï¼Œç„¶ååº”ç”¨ change buffer é‡Œé¢çš„æ“ä½œæ—¥å¿—ï¼Œåšmergeæ“ä½œï¼Œå¹¶ä¸”è¿”å›æ­£ç¡®çš„æ•°æ®&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ³¨ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ­¤æ—¶æ•°æ®é¡µæ˜¯è„é¡µï¼Œéœ€è¦åˆ·ç›˜flush&lt;/li&gt;
&lt;li&gt;change bufferè™½ç„¶æ˜¯åœ¨å†…å­˜ä¸­çš„ï¼Œå¦‚ä½•é¿å…åœç”µå¯¼è‡´çš„ä¸¢å¤±å‘¢ï¼Ÿ&lt;br&gt;
1ï¼‰.change bufferæœ‰ä¸€éƒ¨åˆ†åœ¨å†…å­˜æœ‰ä¸€éƒ¨åˆ†åœ¨ibdata.åšpurgeæ“ä½œ,åº”è¯¥å°±ä¼šæŠŠchange bufferé‡Œç›¸åº”çš„æ•°æ®æŒä¹…åŒ–åˆ°ibdata&lt;br&gt;
2.ï¼‰redo logé‡Œè®°å½•äº†æ•°æ®é¡µçš„ä¿®æ”¹ä»¥åŠchange bufferæ–°å†™å…¥çš„ä¿¡æ¯&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;mysqlæŠ–åŠ¨å¯èƒ½åŸå› &#34;&gt;MySQLæŠ–åŠ¨å¯èƒ½åŸå› &lt;/h2&gt;
&lt;h3 id=&#34;1-æ¦‚å¿µ&#34;&gt;1ã€æ¦‚å¿µ&lt;/h3&gt;
&lt;p&gt;å½“å†…å­˜æ•°æ®é¡µè·Ÿç£ç›˜æ•°æ®é¡µå†…å®¹ä¸ä¸€è‡´çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç§°è¿™ä¸ªå†…å­˜é¡µä¸ºâ€œè„é¡µâ€ã€‚å†…å­˜æ•°æ®å†™å…¥åˆ°ç£ç›˜åï¼Œå†…å­˜å’Œç£ç›˜ä¸Šçš„æ•°æ®é¡µçš„å†…å®¹å°±ä¸€è‡´äº†ï¼Œç§°ä¸ºâ€œå¹²å‡€é¡µâ€ã€‚å†…å­˜é‡Œçš„æ•°æ®å†™å…¥ç£ç›˜çš„è¿‡ç¨‹ï¼Œæœ¯è¯­å°±æ˜¯ flush&lt;/p&gt;
&lt;p&gt;æ›´æ–°æ“ä½œï¼šå…¶å®å°±æ˜¯åœ¨å†™å†…å­˜å’Œæ—¥å¿—&lt;br&gt;
MySQL å¶å°”â€œæŠ–â€ä¸€ä¸‹çš„é‚£ä¸ªç¬é—´ï¼šå¯èƒ½å°±æ˜¯åœ¨åˆ·è„é¡µ&lt;/p&gt;
&lt;h3 id=&#34;2-è§¦å‘åˆ·flushæ—¶æœº&#34;&gt;2ã€è§¦å‘åˆ·flushæ—¶æœº&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;redo logå†™æ»¡&lt;br&gt;
redo logæ˜¯ä¸€ä¸ªç¯å½¢çš„æ•°æ®ç»“æ„ï¼Œå½“æ•°ç»„redo logå†™æ»¡äº†ï¼Œä¼šåœæ­¢æ‰€æœ‰çš„æ›´æ–°æ“ä½œã€‚checkpoint å¾€å‰æ¨è¿›ï¼Œredo log ç•™å‡ºç©ºé—´å¯ä»¥ç»§ç»­å†™ã€‚&lt;br&gt;
checkpoint å¦‚æœè¦å¾€å‰ç§»åŠ¨ï¼Œå°±éœ€è¦å°†ä¸¤ä¸ªç‚¹ä¹‹é—´çš„æ—¥å¿—ï¼ˆæµ…ç»¿è‰²éƒ¨åˆ†ï¼‰ï¼Œå¯¹åº”çš„æ‰€æœ‰è„é¡µéƒ½ flush åˆ°ç£ç›˜ä¸Šã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™ç§å¯¹æ•°æ®åº“å½±å“æ˜¯å¾ˆä¸¥é‡çš„ï¼Œä¼šåœæ­¢æ‰€æœ‰çš„æ›´æ–°æ“ä½œ&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1614246959529.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;
&lt;p&gt;BufferPoolå†…å­˜æ± æ— å¯ç”¨å†…å­˜ï¼Œéœ€è¦æ·˜æ±°è„é¡µï¼Œæ·˜æ±°è„é¡µéœ€è¦flush&lt;br&gt;
å½“éœ€è¦æ–°çš„å†…å­˜é¡µï¼Œè€Œå†…å­˜ä¸å¤Ÿç”¨çš„æ—¶å€™ï¼Œå°±è¦æ·˜æ±°ä¸€äº›æ•°æ®é¡µï¼Œç©ºå‡ºå†…å­˜ç»™åˆ«çš„æ•°æ®é¡µä½¿ç”¨ã€‚è¿™æ—¶å€™åªèƒ½æŠŠæœ€ä¹…ä¸ä½¿ç”¨çš„æ•°æ®é¡µä»å†…å­˜ä¸­æ·˜æ±°æ‰ï¼šã€‚å¦‚æœæ·˜æ±°çš„æ˜¯â€œè„é¡µâ€ï¼Œå°±è¦å…ˆå°†è„é¡µå†™åˆ°ç£ç›˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;MySQLç©ºé—²ä¼šä¸»åŠ¨flush&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;MySQL æ­£å¸¸å…³é—­çš„æƒ…å†µã€‚&lt;br&gt;
è¿™æ—¶å€™ï¼ŒMySQL ä¼šæŠŠå†…å­˜çš„è„é¡µéƒ½ flush åˆ°ç£ç›˜ä¸Šï¼Œä¸‹æ¬¡ MySQL å¯åŠ¨çš„æ—¶å€™ï¼Œå°±å¯ä»¥ç›´æ¥ä»ç£ç›˜ä¸Šè¯»æ•°æ®ï¼Œå¯åŠ¨é€Ÿåº¦ä¼šå¾ˆå¿«ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;3-innodbåˆ·è„é¡µçš„ç­–ç•¥&#34;&gt;3ã€Innodbåˆ·è„é¡µçš„ç­–ç•¥&lt;/h3&gt;
&lt;p&gt;æ­£ç¡®åœ°å‘Šè¯‰ InnoDB æ‰€åœ¨ä¸»æœºçš„ IO èƒ½åŠ›ï¼Œé€šè¿‡innodb_io_capacityå‚æ•°è®©InnoDBçŸ¥é“ç£ç›˜IOèƒ½åŠ›ï¼Œä»¥ä¾¿å…¶æ­£ç¡®åœ°åˆ·è„é¡µã€‚&lt;br&gt;
å»ºè®®ï¼šinnodb_io_capacityè®¾ç½®ä¸ºç£ç›˜çš„ IOPSã€‚ ç£ç›˜çš„ IOPSï¼Œä¹Ÿå°±æ˜¯åœ¨ä¸€ç§’å†…ï¼Œç£ç›˜è¿›è¡Œå¤šå°‘æ¬¡ I/O è¯»å†™ï¼Œæ˜¯è¡¡é‡ç£ç›˜æ€§èƒ½çš„ä¸»è¦æŒ‡æ ‡ã€‚&lt;/p&gt;
&lt;p&gt;åˆ·è„é¡µæ…¢å¯èƒ½å¯¼è‡´çš„æƒ…å†µï¼šå†…å­˜è„é¡µå¤ªå¤šï¼Œå…¶æ¬¡æ˜¯ redo log å†™æ»¡ã€‚&lt;br&gt;
æ€»ç»“: æ— è®ºæ˜¯ä½ çš„æŸ¥è¯¢è¯­å¥åœ¨éœ€è¦å†…å­˜çš„æ—¶å€™å¯èƒ½è¦æ±‚æ·˜æ±°ä¸€ä¸ªè„é¡µï¼Œè¿˜æ˜¯ç”±äºåˆ·è„é¡µçš„é€»è¾‘ä¼šå ç”¨ IO èµ„æºå¹¶å¯èƒ½å½±å“åˆ°äº†ä½ çš„æ›´æ–°è¯­å¥ï¼Œéƒ½å¯èƒ½æ˜¯é€ æˆä½ ä»ä¸šåŠ¡ç«¯æ„ŸçŸ¥åˆ° MySQLâ€œæŠ–â€äº†ä¸€ä¸‹çš„åŸå› ã€‚&lt;/p&gt;
&lt;h3 id=&#34;4-å…·ä½“ä¸šåŠ¡åœºæ™¯&#34;&gt;4ã€å…·ä½“ä¸šåŠ¡åœºæ™¯&lt;/h3&gt;
&lt;p&gt;å‡ºç°è¿™æ ·çš„åœºæ™¯ï¼šMySQLçš„TPSä¼šå¾ˆä½ï¼Œä½†æ˜¯ä¸»æœºçš„IOå‹åŠ›ä¸å¤§&lt;br&gt;
å¦‚æœæ˜¯å›ºæ€ç¡¬ç›˜ï¼Œé‚£ä¹ˆå®ƒçš„IOè¯»å†™èƒ½åŠ›ä¼šå¾ˆå¤§ã€‚è¿™ä¸ªæ—¶å€™å¦‚æœinnodb_io_capacityè®¾ç½®å¤ªä½ï¼ŒMySQLè®¤ä¸ºç£ç›˜ioèƒ½åŠ›å¤ªå·®ï¼Œå¯¼è‡´å…¨åŠ›åˆ·è„é¡µå˜æ…¢ã€è„é¡µç´¯ç§¯ä¸‹æ¥ï¼Œåç»­åªè¦åˆ·è„é¡µï¼Œä¸ç®¡æ˜¯å†…å­˜ä¸å¤Ÿè¿˜æ˜¯æ—¥å¿—æ»¡äº†å¯¼è‡´çš„åˆ·è„é¡µï¼Œéƒ½ä¼šå¯¼è‡´å˜æ…¢ã€‚&lt;/p&gt;
&lt;h3 id=&#34;5-qa&#34;&gt;5 Q&amp;amp;A&lt;/h3&gt;
&lt;p&gt;1ã€â€œå†…å­˜ä¸å¤Ÿç”¨äº†ï¼Œè¦å…ˆå°†è„é¡µå†™åˆ°ç£ç›˜â€œredo logå¯¹åº”çš„ç©ºé—´ä¼šé‡Šæ”¾å˜›ï¼Ÿâ€œredo log å†™æ»¡äº†ï¼Œè¦ flush è„é¡µâ€å¯¹åº”çš„å†…å­˜é¡µä¼šé‡Šæ”¾å˜›ï¼Ÿ&lt;br&gt;
redolog çš„ç©ºé—´æ˜¯å¾ªç¯ä½¿ç”¨çš„ï¼Œæ— æ‰€è°“é‡Šæ”¾ã€‚ å¯¹åº”çš„å†…å­˜é¡µä¼šå˜æˆå¹²å‡€é¡µã€‚ä½†æ˜¯ç­‰æ·˜æ±°çš„æ—¶å€™æ‰ä¼šé€å‡ºå†…å­˜&lt;/p&gt;
&lt;p&gt;2ã€redo logæ˜¯æ€ä¹ˆè®°å½•å¯¹åº”è„é¡µæ˜¯å¦å·²ç»flushäº†ï¼Ÿå¦‚æœæ–­ç”µäº†é‡å¯å¯¼è‡´å†…å­˜ä¸¢å¤±ï¼Œå‰é¢å‡ ç« è¯´é€šè¿‡redo logè¿›è¡Œæ•°æ®æ¢å¤é‚£redo logåˆæ€ä¹ˆå»é‡Šæ”¾ç©ºé—´ï¼Ÿ&lt;br&gt;
ä¸ç”¨è®°ï¼Œé‡å¯äº†å°±ä»checkpoint çš„ä½ç½®å¾€åæ‰«ã€‚ å¦‚æœå·²ç»ä¹‹å‰åˆ·è¿‡ç›˜çš„, ä¸ä¼šé‡å¤åº”ç”¨redo log&lt;/p&gt;
&lt;p&gt;3ã€redologæ˜¯è®°å½•çš„ä»€ä¹ˆï¼Ÿ&lt;br&gt;
redolog è®°å½•çš„æ˜¯åŠ¨ä½œï¼Œä¸æ˜¯ç»“æœã€‚Redo logè®°å½•çš„æ˜¯é¡µçš„åç§»é‡ã€‚æ¯”å¦‚updateè¯­å¥æ›´æ–°+9ï¼ŒRedo logé‡Œæ˜¯è®°çš„+9&lt;/p&gt;
&lt;p&gt;4ï¼šæ€ä¹ˆè®©MySQLä¸æŠ–ï¼Ÿ&lt;br&gt;
è®¾ç½®åˆç†å‚æ•°é…é…ç½®ï¼Œå°¤å…¶æ˜¯è®¾ç½® å¥½innodb_io_capacity çš„å€¼ï¼Œå¹¶ä¸”å¹³æ—¶è¦å¤šå…³æ³¨è„é¡µæ¯”ä¾‹ï¼Œä¸è¦è®©å®ƒç»å¸¸æ¥è¿‘ 75%&lt;/p&gt;
&lt;p&gt;5ï¼šWALæ€ä¹ˆæŠŠéšæœºå†™è½¬åŒ–ä¸ºé¡ºåºå†™çš„ï¼Ÿ&lt;br&gt;
å†™redologæ˜¯é¡ºåºå†™çš„ï¼Œå…ˆå†™redologç­‰åˆé€‚çš„æ—¶å€™å†å†™ç£ç›˜ï¼Œé—´æ¥çš„å°†éšæœºå†™å˜æˆäº†é¡ºåºå†™ï¼Œæ€§èƒ½ç¡®å®ä¼šæé«˜ä¸å°‘&lt;/p&gt;
">å­¦ä¹ ç¬”è®°ï¼šMySQL</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://zhangyaoo.github.io/post/ji-yi-ci-cai-yong-fen-bu-shi-id-jie-jue-fen-ku-fen-biao-cai-de-keng/"" data-c="
          &lt;h3 id=&#34;ä¸€-èƒŒæ™¯&#34;&gt;ä¸€ã€èƒŒæ™¯&lt;/h3&gt;
&lt;p&gt;éšç€ä¸šåŠ¡æ¨¡å¼çš„æ‰©å¤§ï¼Œå¤šä¸ªå¹³å°ä¸‹ç”¨æˆ·æ•°é‡ä¸æ–­æ‰©å¤§ã€‚å¹¶ä¸”å› ä¸ºä¸šåŠ¡éœ€è¦ï¼Œéœ€è¦åˆå¹¶ä¸¤ä¸ªä¸šåŠ¡ç³»ç»Ÿçš„ç”¨æˆ·ä¸­å¿ƒï¼Œå› ä¸ºéœ€è¦å¯¹æ¥ä¸‰æ–¹ç³»ç»Ÿï¼Œæ‰€ä»¥è¦æ±‚ç”¨æˆ·çš„IDæ ‡è¯†ä¸èƒ½ä½“ç°å‡ºç³»ç»Ÿçš„ç”¨æˆ·é‡ã€‚&lt;br&gt;
æŠ€æœ¯å›¢é˜Ÿè€ƒè™‘åˆ°è¿™ç§åœºæ™¯ä»¥åŠåç»­ç”¨æˆ·çš„æ‰©å¤§ï¼Œéœ€è¦ä¸€ä¸ªæ–¹æ¡ˆå»è§£å†³åœ¨&lt;strong&gt;åˆ†å¸ƒå¼ç¯å¢ƒ&lt;/strong&gt;ä¸‹IDé€’å¢çš„é—®é¢˜ï¼Œç³»ç»Ÿè‡ªå·±çš„IDé€’å¢ç®—æ³•ä¹Ÿéœ€è¦åšæ”¹å˜ã€‚&lt;/p&gt;
&lt;h3 id=&#34;äºŒ-ä¸šç•Œæ¯”è¾ƒæµè¡Œçš„åˆ†å¸ƒå¼idè§£å†³æ–¹æ¡ˆ&#34;&gt;äºŒã€ä¸šç•Œæ¯”è¾ƒæµè¡Œçš„åˆ†å¸ƒå¼IDè§£å†³æ–¹æ¡ˆ&lt;/h3&gt;
&lt;p&gt;æŠ€æœ¯å›¢é˜Ÿé¦–å…ˆè€ƒå¯Ÿä¸šç•Œæ¯”è¾ƒæµè¡Œçš„åšæ³•ï¼Œæ€»ç»“ä¸åŒæ–¹æ¡ˆä¼˜ç¼ºç‚¹ï¼Œç„¶åæ ¹æ®è‡ªå·±çš„ä¸šåŠ¡æ¥é€‰æ‹©æ›´åˆé€‚çš„æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h4 id=&#34;21-æ•°æ®åº“åˆ†æ‰¹idåˆ†å‘&#34;&gt;2.1 æ•°æ®åº“åˆ†æ‰¹IDåˆ†å‘&lt;/h4&gt;
&lt;p&gt;æ•°æ®åº“åˆ†æ‰¹IDåŸç†ä¸»è¦æ˜¯åˆ©ç”¨åˆ†æ‰¹æ€æƒ³ä»¥åŠä¹è§‚é”æ¥è§£å†³ï¼Œç›®å‰æ·˜å®ä¸­é—´ä»¶TDDLå…¶ä¸­çš„ä¸»é”®åˆ†é…å°±æ˜¯ç”¨äº†è¿™ä¸ªæ–¹æ¡ˆã€‚è¯¥æ–¹æ¡ˆå…·ä½“æ˜¯è¿™æ ·åšçš„ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ•°æ®åº“è¡¨ç»´æŠ¤ä¸€æ¡æ•°æ®ï¼Œè®°å½•å½“å‰åˆ†é…IDå·ä»¥åŠåç§»æ•°é‡ç­‰æ•°æ®&lt;/li&gt;
&lt;li&gt;ç¼–å†™æœåŠ¡ï¼Œåˆ©ç”¨ä¹è§‚é”å»CASæ›´æ–°æ•°æ®ï¼Œæ›´æ–°æˆåŠŸå°±è¯´æ˜æ‹¿åˆ°äº†ä¸€æ‰¹IDå·ï¼Œå¤±è´¥çš„è¯è¿›è¡Œé‡è¯•ï¼Œè®¾ç½®ä¸€å®šçš„é‡è¯•æ¬¡æ•°&lt;/li&gt;
&lt;li&gt;æ”¾å…¥æœ¬åœ°ç¼“å­˜æˆ–è€…redisåšæ‰£å‡ï¼Œå¦‚æœç”¨å®Œå°±é‡å¤æ­¥éª¤2&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å…·ä½“çš„çš„è¡¨å¯ä»¥æ˜¯ç±»ä¼¼è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;å­—æ®µ&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;id&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;è‡ªå¢IDï¼Œæ²¡æœ‰ä¸šåŠ¡æ„ä¹‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;current_num&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;å½“å‰å·²ç»åˆ†é…çš„IDæœ€å¤§å€¼&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;limit&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;ä¸€æ¬¡åˆ†é…å¤šå°‘ä¸ªID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;version&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;ç‰ˆæœ¬å·ï¼ŒCASæ›´æ–°ç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;create_time&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;è®°å½•åˆ›å»ºæ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;update_time&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;è®°å½•æ›´æ–°æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;æ¯”å¦‚ï¼Œlimit=1000ï¼Œä¸€æ¬¡åˆ†é…1000ä¸ªIDï¼Œæ²¡åˆ†é…ä¹‹å‰current_num = 0ï¼Œç¬¬ä¸€æ¬¡current_num = 1000ï¼Œç¬¬äºŒæ¬¡ä¾æ¬¡ç±»æ¨ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶ï¼Œä¸Šè¿°çš„æ–¹æ¡ˆä¹Ÿæœ‰ç¼ºç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸€æ¡æ•°æ®ï¼Œå¦‚æœæœ‰å¤§é‡æµç¨‹å»æ›´æ–°ï¼Œè¦ç«äº‰è·å–è¡Œé”ï¼Œä¼šæœ‰æ€§èƒ½é—®é¢˜ï¼Œï¼ˆå¯ä»¥å‚è€ƒè¡Œé”çš„åˆ©å¼Šï¼Œä¸å¥‡â€”â€”ç§’æ€åœºæ™¯ä¸‹MySQLçš„ä½æ•ˆï¼‰&lt;/li&gt;
&lt;li&gt;å¼ºä¾èµ–DBï¼Œå¦‚æœå½“å‰æ•°æ®åº“å®•æœºï¼Œå¯¼è‡´åˆ†å¸ƒå¼IDåˆ†å‘æœåŠ¡å°±ä¼šå‡ºç°é—®é¢˜&lt;/li&gt;
&lt;li&gt;å¦‚æœåœ¨ä¸»ä»æ•°æ®åº“åœºæ™¯ä¸‹ï¼Œéœ€è¦è€ƒè™‘åˆ°ä¸»ä»çš„å»¶è¿Ÿæ€§å¯¼è‡´åˆ†é…IDçš„ä¸ä¸€è‡´æ€§&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ‰€ä»¥ä¸ºäº†è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œç¬”è€…å‚è€ƒconcurrentHashMapåˆ†æ®µé”çš„æ€æƒ³ï¼Œå°†ä¸€æ¡è®°å½•åˆ†æ®µä¸ºå¤šä¸ªï¼ŒåŒæ—¶ä¸ºäº†é¿å…DBå•ç‚¹å¯ç”¨æ€§ï¼Œå¯ä»¥å°†ä¸åŒçš„è®°å½•åˆ†å¸ƒåœ¨ä¸åŒçš„æ•°æ®åº“ä¸Šé¢ã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“çš„è¡¨å¯ä»¥æ˜¯ç±»ä¼¼è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;å­—æ®µ&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;id&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;è‡ªå¢IDï¼Œæ²¡æœ‰ä¸šåŠ¡æ„ä¹‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;current_num&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;å½“å‰å·²ç»åˆ†é…çš„IDæœ€å¤§å€¼&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;limit&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;ä¸€æ¬¡åˆ†é…å¤šå°‘ä¸ªID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;offset&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;å‰ååˆ†é…çš„IDé—´éš”æ•°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;initial_id&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;åˆå§‹è‡ªå¢çš„ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;version&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;ç‰ˆæœ¬å·ï¼ŒCASæ›´æ–°ç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;create_time&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;è®°å½•åˆ›å»ºæ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;update_time&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;è®°å½•æ›´æ–°æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;â€ƒæ–°å¢offsetåç§»å’Œinitial_idå­—æ®µï¼Œoffsetä»£è¡¨æ•°æ®åº“è¡¨è®°å½•å‰ååˆ†é…é—´éš”æ•°é‡ï¼Œinitial_idä»£è¡¨å¼€å§‹åˆå§‹çš„å€¼ã€‚&lt;br&gt;
â€ƒä¸¾ä¸ªä¾‹å­ï¼Œç°åœ¨å°†è®°å½•åˆ†ä¸º10æ¡ï¼Œåˆ†å¸ƒåœ¨ä¸åŒæ•°æ®åº“ä¸Šï¼Œé‚£ä¹ˆoffsetå°±æ˜¯10000ï¼Œlimitå°±æ˜¯1000ï¼Œç¬¬ä¸€æ¡è®°å½•ç¬¬ä¸€æ¬¡å¼€å§‹é…åˆè·å–0-1000ï¼Œç¬¬äºŒæ¬¡åˆ†é…è·å–10000-11000ï¼Œä¾æ¬¡ç±»æ¨ã€‚&lt;/p&gt;
&lt;p&gt;â€ƒè¿™é‡Œéœ€è¦è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¦‚æœè¯·æ±‚IDåˆ†å‘çš„æœåŠ¡çš„æµé‡&lt;strong&gt;æ€ä¹ˆè·¯ç”±&lt;/strong&gt;åˆ°å…·ä½“çš„è®°å½•å‘¢ï¼Ÿå¦‚æœæµé‡å…¨éƒ¨éƒ½è¯·æ±‚åˆ°ç¬¬ä¸€æ¡è®°å½•ä¸Šäº†ï¼Œå°±ä¼šå¯¼è‡´è¯·æ±‚ä¸å‡ã€‚&lt;br&gt;
â€ƒè¿™ä¸ªé—®é¢˜å¾ˆç®€å•ï¼Œæœ‰ä¸€å®šå¼€å‘ç»éªŒçš„è¯»è€…è‡ªç„¶å¯ä»¥è”æƒ³åˆ°ç”¨ä¸€è‡´æ€§hashå»è·¯ç”±ï¼Œå…·ä½“è·¯ç”±çš„keyå¯ä»¥æ ¹æ®ä¸šåŠ¡å»å®šï¼Œæ¯”å¦‚ç”¨æˆ·æ‰‹æœºå·ã€‚ï¼ˆå…·ä½“ä¸€è‡´æ€§hashè·¯ç”±å¦‚ä½•å®ç°ï¼Œå¯ä»¥å‚è€ƒåˆ©ç”¨treeMapå®ç°ï¼‰&lt;/p&gt;
&lt;p&gt;â€ƒä»¥ä¸Šæ–¹æ¡ˆç®—æ˜¯è§£å†³æ€§èƒ½é—®é¢˜ï¼Œä½†æ˜¯è¿˜æœ‰æ¯”è¾ƒè‡´å‘½çš„é—®é¢˜ï¼Œå°±æ˜¯æ— æ³•æ¨ªå‘æ‰©å±•ã€‚å°±æ¯”å¦‚è¯´ç°åœ¨æœ‰10å°æœºå™¨ä¸åŒæ•°æ®åº“ï¼Œæ¯ä¸€ä¸ªæ•°æ®åº“ä¸€æ¡è®°å½•ã€‚å‡å¦‚ç°åœ¨æœ‰æ–°çš„æœºå™¨10å°æœºå™¨æƒ³è¦åŠ å…¥åˆ†é…çš„è¯ï¼Œé‚£ä¹ˆå°±è¦ä¿®æ”¹offsetå’Œinitial_idï¼Œæ‰€ä»¥åœ¨ä¸åœæœºå®ç°çš„è¯ï¼Œå¯èƒ½æ— æ³•å®ç°ï¼ˆç›®å‰ç¬”è€…æ²¡æœ‰æƒ³åˆ°æ–¹æ³•è§£å†³ï¼Œå¦‚æœè¯»è€…æœ‰ideaå¯ä»¥æ¬¢è¿å’Œæˆ‘è®¨è®ºï¼‰ã€‚è¿™é‡Œç¬”è€…æä¾›ä¸€ç§æ–¹æ³•å»è§£å†³ï¼š&lt;br&gt;
â€ƒæå‰é¢„å…ˆåˆ†é…100æ¡è®°å½•ï¼Œæ¯ä¸€æ¡è®°å½•ä¸€æ‰¹æ¬¡è·å–100ä¸ªIDï¼Œoffsetè®¾ç½®ä¸º10000ï¼Œå½“å‰10å°æœºå™¨æ¯ä¸€å°æœ‰10æ¡è®°å½•ï¼Œåç»­æœ‰æ–°æœºå™¨çš„è¯ç›´æ¥å°†è®°å½•ä¸åœæœºè½¬ç§»åˆ°æ–°æœºå™¨å°±å¯ä»¥äº†ã€‚&lt;/p&gt;
&lt;h4 id=&#34;22-redisåºåˆ—åŒ–åˆ†å‘&#34;&gt;2.2 Redisåºåˆ—åŒ–åˆ†å‘&lt;/h4&gt;
&lt;p&gt;Redisæ¥ç”ŸæˆIDï¼Œè¿™ä¸»è¦ä¾èµ–äºRedisæ˜¯å•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ç”¨ç”Ÿæˆå…¨å±€å”¯ä¸€çš„IDã€‚å¯ä»¥ç”¨Redisçš„åŸå­æ“ä½œ INCRå’ŒINCRBYæ¥å®ç°ã€‚ç›®å‰å•å°redisçš„qpsèƒ½å¤Ÿè¾¾åˆ°5Wï¼Œæ‰€ä»¥ä¸€å®šç¨‹åº¦ä¸Šèƒ½å¤Ÿè§£å†³æ€§èƒ½é—®é¢˜ã€‚å…·ä½“å®ç°ç¬”è€…è¿™é‡Œå°±ä¸é˜è¿°äº†ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶ç”¨è¿™ä¸ªæ–¹æ¡ˆä¹Ÿæœ‰ç¼ºç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¾èµ–redisï¼Œå¦‚æœä¸šåŠ¡ä¸­æ²¡æœ‰å°±è¦ä¾èµ–è¿™ä¸ªä¸­é—´ä»¶&lt;/li&gt;
&lt;li&gt;ç”Ÿæˆçš„IDæ˜¯å•è°ƒé€’å¢çš„ï¼Œå®¹æ˜“æš´éœ²ç³»ç»Ÿçš„ç”¨æˆ·æ•°&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;23-snowflakeé›ªèŠ±ç®—æ³•&#34;&gt;2.3 SnowFlakeé›ªèŠ±ç®—æ³•&lt;/h4&gt;
&lt;p&gt;ä»¥ä¸Š2.1 2.2æ–¹æ¡ˆéƒ½èƒ½è§£å†³æ€§èƒ½é—®é¢˜ï¼Œä½†æ˜¯äº§ç”Ÿçš„IDï¼Œæ˜¯è¿ç»­çš„ï¼Œå®¹æ˜“æš´éœ²è‡ªå·±ç³»ç»Ÿä¸­ç”¨æˆ·çš„æ•°é‡ã€‚æ‰€ä»¥æœ‰äº›ç³»ç»Ÿä¼šè¦æ±‚è¦è¶‹åŠ¿é€’å¢ï¼Œè€Œä¸”è¦ä¿æŒä¿¡æ¯å®‰å…¨ã€‚ç›®å‰é›ªèŠ±ç®—æ³•å°±èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;å…¶ä¸­åŸç†å°±æ˜¯ï¼šç»™ä¸€ä¸ª64ä½çš„äºŒè¿›åˆ¶æ•°å­—ï¼Œå…¶ä¸­&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¬¬1ä½ç½®ä¸º0ã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬2-42ä½æ˜¯ç›¸å¯¹æ—¶é—´æˆ³ï¼Œé€šè¿‡å½“å‰æ—¶é—´æˆ³å‡å»ä¸€ä¸ªå›ºå®šçš„å†å²æ—¶é—´æˆ³ç”Ÿæˆã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬43-52ä½æ˜¯æœºå™¨å·workerIDï¼Œæ¯ä¸ªServerçš„æœºå™¨IDä¸åŒã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬53-64ä½æ˜¯è‡ªå¢IDã€‚&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1604663039402.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™ä¸ªæ–¹æ¡ˆä¹Ÿæœ‰ç¼ºç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å®ç°æ¯”è¾ƒå¤æ‚ï¼Œè€ƒéªŒå¼€å‘äººå‘˜&lt;/li&gt;
&lt;li&gt;éœ€è¦ç‹¬ç«‹éƒ¨ç½²å®ç°&lt;/li&gt;
&lt;li&gt;å¼ºä¾èµ–æ—¶é’Ÿï¼Œæ—¶é’Ÿå›æ‹¨ä¼šæœ‰é‡å¤çš„ID&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;ä¸‰-å½“å‰æ–¹æ¡ˆæ˜¯å¦‚ä½•åšçš„&#34;&gt;ä¸‰ã€å½“å‰æ–¹æ¡ˆæ˜¯å¦‚ä½•åšçš„&lt;/h3&gt;
&lt;p&gt;â€ƒå‚è€ƒä¸Šè¿°æ–¹æ¡ˆåï¼ŒæŠ€æœ¯å›¢é˜Ÿè€ƒè™‘åˆ°æœªæ¥ä¸šåŠ¡çš„å¢åŠ ï¼Œæµé‡çš„å¢é•¿ä»¥åŠåç»­çš„æ‰©å±•ï¼Œå‡†å¤‡åˆ©ç”¨æ–¹æ¡ˆä¸‰å»å®ç°ã€‚å…¶ä¸­å…·ä½“å®ç°å¯ä»¥å‚è€ƒç¬”è€…GitHubçš„å®ç°ï¼š&lt;a href=&#34;https://github.com/zhangyaoo/fastim/blob/master/fastim-leaf/src/main/java/com/zyblue/fastim/leaf/manager/SnowFlakeManager.java&#34;&gt;åˆ†å¸ƒå¼ID SnowFlakeå®ç°&lt;/a&gt;&lt;br&gt;
â€ƒå½“ç„¶ä½¿ç”¨æ–¹æ¡ˆä¸‰ä¹Ÿä¼šæœ‰ç¼ºé™·ï¼Œæ¯”å¦‚ä¼šå‘ç”Ÿæ—¶é’Ÿå›æ‹¨é—®é¢˜ï¼Œä»¥åŠåˆ†å¸ƒå¼IDåˆ†å‘æœåŠ¡å¼ºä¾èµ–zookeeperã€‚&lt;/p&gt;
&lt;h4 id=&#34;31-æ—¶é’Ÿå›æ‹¨&#34;&gt;3.1 æ—¶é’Ÿå›æ‹¨&lt;/h4&gt;
&lt;p&gt;â€ƒå‘ç”Ÿæ—¶é’Ÿå›æ‹¨çš„åŸå› æ˜¯ï¼Œå¦‚æœåˆ†å‘æœåŠ¡æ­£åœ¨ç”ŸæˆIDçš„è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿæ—¶é—´å› ä¸ºä¸å¯æŠ—æ‹’çš„å› ç´ æˆ–è€…äººä¸ºå› ç´ å¯¼è‡´æ—¶é—´å€’æµäº†ï¼Œä¼šå¯¼è‡´å¯èƒ½ä¼šæœ‰é‡å¤çš„IDç”Ÿæˆï¼Œä½œä¸ºåˆ†å¸ƒå¼IDåˆ†å‘è¿™ä¸ªæ˜¯ä¸å‡†å‘ç”Ÿçš„ã€‚æ‰€ä»¥å¦‚æœå‘ç”Ÿæ—¶é’Ÿå›æ‹¨é‚£ä¹ˆå°±æŠ›å‡ºå¼‚å¸¸ï¼Œå®ç°å¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;long timestamp = System.currentTimeMillis();
// å¦‚æœå½“å‰æ—¶é—´æˆ³å°äºä¸Šæ¬¡åˆ†å‘çš„æ—¶é—´æˆ³
if (timestamp &amp;lt; lastTimestamp) {
    long offset = lastTimestamp - timestamp;
    if (offset &amp;lt;= 5) {
        // å¦‚æœæ—¶é—´æˆ³é—´éš”å°äº5ï¼Œé‚£ä¹ˆè¿›è¡Œç­‰å¾…ï¼Œç­‰å¾…çª—å£æ—¶é—´ï¼Œç„¶åå†è¿›è¡Œé‡è¯•
        try {
            wait(offset &amp;lt;&amp;lt; 1);
            timestamp = System.currentTimeMillis();
            if (timestamp &amp;lt; lastTimestamp) {
                throw new RuntimeException(String.format(&amp;quot;lastTimestamp %s is after reference time %s&amp;quot;, lastTimestamp, timestamp));
            }
        } catch (InterruptedException e) {
            logger.error(&amp;quot;wait interrupted&amp;quot;);
            throw new RuntimeException(String.format(&amp;quot;lastTimestamp %s is after reference time %s&amp;quot;, lastTimestamp, timestamp));
        }
    } else {
        // å¦‚æœç›¸å·®è¿‡å¤§ï¼Œç›´æ¥æŠ›å‡ºå¼‚å¸¸
        throw new RuntimeException(String.format(&amp;quot;lastTimestamp %s is after reference time %s&amp;quot;, lastTimestamp, timestamp));
    }
}
// å¦‚æœç­‰äºï¼Œè¡¨æ˜åŒä¸€æ—¶åˆ»
if (lastTimestamp == timestamp) {
    // å¦‚æœå°äºè®¡æ•°å™¨æœ€å¤§å€¼å°±ï¼Œå¢åŠ 
    if (this.counter &amp;lt; MAX_SEQUENCE) {
        this.counter++;
    } else {
        // è¡¨æ˜åŒä¸€æ—¶åˆ»ï¼ŒåŒä¸€æœºå™¨ä¸‹ï¼Œçš„æ‰€æœ‰è®¡æ•°å™¨éƒ½ç”¨å®Œäº†
        throw new RuntimeException(&amp;quot;Sequence exhausted at &amp;quot; + this.counter);
    }
} else {
    //å¦‚æœæ˜¯æ–°çš„mså¼€å§‹
    counter = 0L;
}
// è®°å½•è¿™ä¸€æ¬¡æ—¶é—´æˆ³ï¼Œç”¨ä½œä¸‹ä¸€æ¬¡æ¯”è¾ƒ
lastTimestamp = timestamp;
// åç»­çš„ç”ŸæˆIDé€»è¾‘
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;32-å¼ºä¾èµ–zookeeper&#34;&gt;3.2 å¼ºä¾èµ–zookeeper&lt;/h4&gt;
&lt;p&gt;ä»¥ä¸Šèƒ½è§£å†³æ—¶é’Ÿå›æ‹¨çš„é—®é¢˜ï¼Œä½†æ˜¯å¼ºä¾èµ–zookeeperæ¥ç”Ÿæˆåˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„å½“å‰æœºå™¨çš„IDã€‚ç¬”è€…å‚è€ƒdubboçš„è®¾è®¡æ€æƒ³ï¼Œå½“IDåˆ†å‘æœåŠ¡é€šè¿‡ID+ç«¯å£æ³¨å†Œåˆ°zookeeperçš„é€’å¢æŒä¹…èŠ‚ç‚¹åï¼Œè¿”å›çš„èŠ‚ç‚¹ç›´æ¥å­˜å‚¨å†æœ¬åœ°æ–‡ä»¶ä¸­ï¼Œå®ç°é«˜å¯ç”¨ï¼Œå¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;/**
 * é«˜å¯ç”¨ï¼Œé˜²æ­¢zookeeperæŒ‚äº†ï¼Œæœ¬åœ°æœ¬æœºç”Ÿæ•ˆ
 * å†™å…¥æœ¬åœ°æ–‡ä»¶çš„æ—¶æœºï¼šå½“å‰æœºå™¨è·å–zookeeperçš„æŒä¹…èŠ‚ç‚¹å
 */
private void writeWorkerId2Local(int workerId){
    String path = WORKERID_PATH + File.separator + applicationName + File.separator + &amp;quot;workerId.properties&amp;quot;;
    File file = new File(path);
    if(file.exists() &amp;amp;&amp;amp; file.isFile()){
        try {
            FileUtils.writeStringToFile(file, &amp;quot;workerId=&amp;quot; + workerId, false);
        }catch (Exception e){
            logger.error(&amp;quot;e:&amp;quot;, e);
        }
    }else {
        boolean mkdirs = file.getParentFile().mkdirs();
        if(mkdirs){
            try {
                if (file.createNewFile()) {
                    FileUtils.writeStringToFile(file, &amp;quot;workerId=&amp;quot; + workerId, false);
                    logger.info(&amp;quot;local file cache workerID is {}&amp;quot;, workerId);
                }
            }catch (Exception e){
                logger.error(&amp;quot;e:&amp;quot;, e);
            }
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;å››-é‡‡ç”¨åˆ†å¸ƒå¼idä¸Šçº¿åäº§ç”Ÿçš„bug&#34;&gt;å››ã€é‡‡ç”¨åˆ†å¸ƒå¼IDä¸Šçº¿åäº§ç”Ÿçš„BUG&lt;/h3&gt;
&lt;h4 id=&#34;40-é—®é¢˜åˆ†æ&#34;&gt;4.0 é—®é¢˜åˆ†æ&lt;/h4&gt;
&lt;p&gt;å½“ä¸Šçº¿åˆ†å¸ƒå¼IDåˆ†å‘æœåŠ¡åï¼Œè§‚å¯Ÿæ—¥å¿—ï¼Œå‡ºç°å¤§é‡çš„æŠ¥é”™ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;io.lettuce.core.RedisCommandExecutionException: ERR bit offset is not an integer or out of range
at io.lettuce.core.ExceptionFactory.createExecutionException(ExceptionFactory.java:135) ~[lettuce-core-5.2.1.RELEASE.jar:5.2.1.RELEASE]
at io.lettuce.core.ExceptionFactory.createExecutionException(ExceptionFactory.java:108) ~[lettuce-core-5.2.1.RELEASE.jar:5.2.1.RELEASE]
at io.lettuce.core.protocol.AsyncCommand.completeResult(AsyncCommand.java:120) ~[lettuce-core-5.2.1.RELEASE.jar:5.2.1.RELEASE]
at io.lettuce.core.protocol.AsyncCommand.complete(AsyncCommand.java:111) ~[lettuce-core-5.2.1.RELEASE.jar:5.2.1.RELEASE]
at io.lettuce.core.protocol.CommandHandler.complete(CommandHandler.java:654) ~[lettuce-core-5.2.1.RELEASE.jar:5.2.1.RELEASE]
at io.lettuce.core.protocol.CommandHandler.decode(CommandHandler.java:614) ~[lettuce-core-5.2.1.RELEASE.jar:5.2.1.RELEASE]
â€¦â€¦â€¦â€¦
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¹çœ‹æ˜¯redisçš„æŠ›å‡ºæ¥çš„é”™è¯¯ï¼Œå’Œè¿™æ¬¡åˆ†å¸ƒå¼IDæ”¹é€ æ²¡æœ‰ä»€ä¹ˆå…³ç³»ï¼Œä½†æ˜¯ä»”ç»†é™ä¸‹æ¥æƒ³ä¸€æƒ³ï¼Œè¿™æ¬¡IDæ”¹é€ æ˜¯ä»åŸæ¥çš„æ•°æ®åº“è‡ªå¢æ”¹é€ çš„ï¼Œæ•°æ®åº“è‡ªå¢æ•°æ®ä¸»é”®å¾ˆå°æ˜¯intç±»å‹ï¼Œç„¶åç”¨äº†64ä½äºŒè¿›åˆ¶æ•°æ®å½“ä½œIDåï¼Œå¯¼è‡´redisä¸­ç”¨æˆ·çš„æ•°æ®å­˜ä¸ä¸‹å»ï¼Œç„¶åç¬”è€…å°±æŒ‰ç…§è¿™ä¸ªæ€è·¯å»å‘æ˜é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;ç¬”è€…ä»ä¸šåŠ¡æŠ›å‡ºçš„å †æ ˆä¸­å‘ç°ï¼Œè¿™ä¸ªé”™è¯¯æ˜¯åœ¨åˆ¤æ–­ç”¨æˆ·æ˜¯å¦æ˜¯æ–°ç”¨æˆ·æœåŠ¡æ–¹æ³•ä¸­æŠ›å‡ºçš„ï¼Œè€Œåˆ¤æ–­æ˜¯æ–°ç”¨æˆ·çš„é€»è¾‘å°±æ˜¯ï¼Œåˆ©ç”¨redisçš„bitmapæ¥è§£å†³çš„ï¼šgetbit new_user_key userIdï¼Œå…¶ä¸­ userIdä¸ºç”¨æˆ·IDï¼Œå¦‚æœç”¨æˆ·å‘ç”Ÿäº†äº¤æ˜“ä¿¡æ¯ï¼Œå°±ä¼šæ‰§è¡Œï¼šsetbit new_user_key userId 1 è¿™ä¸ªå‘½ä»¤ã€‚ ä¸ºä»€ä¹ˆè¦ç”¨bitmapè§£å†³å‘¢ï¼Œä¸»è¦æ˜¯å› ä¸ºå¦‚æœä»äº¤æ˜“è®°å½•è¡¨æŸ¥è¯¢æŸä¸ªç”¨æˆ·æ˜¯å¦äº¤æ˜“ä¿¡æ¯æ¥åˆ¤æ–­æ˜¯æ–°ç”¨æˆ·çš„è¯å°±ä¼šéå¸¸è€—æ—¶ï¼Œæ‰€ä»¥åªè¦æ˜¯å‘ç”Ÿäº†äº¤æ˜“ä¿¡æ¯å°±è®¾ç½®bitmapå°±å¯ä»¥äº†ã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¸ºä»€ä¹ˆä¼šæŠ›å‡ºout of rangeè¿™ä¸ªé”™è¯¯å‘¢ï¼Œæˆ‘ä»¬çŸ¥é“bitmapåº•å±‚å…¶å®å°±æ˜¯Stringç±»å‹ï¼Œè€ŒStringç±»å‹çš„æœ€å¤§é•¿åº¦ä¸º512Mï¼Œå®˜ç½‘æˆªå›¾ï¼š&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1605157810715.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æ‰€ä»¥å¦‚æœoffsetè¶…è¿‡512Mè¿™ä¸ªèŒƒå›´é‚£ä¹ˆå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œ512M = 2^9 * 2^12 * 2^12 * 2^3 = 2^32 bitï¼Œä¹Ÿå°±æ˜¯æ”¯æŒIntegerç±»å‹çš„æœ€å¤§å€¼ï¼Œè€Œæˆ‘ä»¬è¿™æ¬¡åˆ†å¸ƒå¼IDæœåŠ¡IDæ˜¯64ä½çš„ï¼Œæ”¯æŒ2^64 bitï¼Œæ‰€ä»¥å¦‚æœoffsetä¹Ÿå°±æ˜¯userIdå¤§äº2^32çš„è¯å°±ä¼šæŠ›å‡ºout of rangeå¼‚å¸¸äº†ã€‚&lt;/p&gt;
&lt;h4 id=&#34;41-é—®é¢˜è§£å†³&#34;&gt;4.1 é—®é¢˜è§£å†³&lt;/h4&gt;
&lt;p&gt;æ‰¾åˆ°äº†é—®é¢˜ï¼Œä¹Ÿå°±å¥½å»åšä¼˜åŒ–äº†ï¼Œè¿™é‡Œç¬”è€…æä¾›å‡ ä¸ªæ–¹æ³•ä½œä¸ºå‚è€ƒ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨æ•°æ®åº“ç”¨æˆ·è¡¨æˆ–è€…ç”¨æˆ·æ‰©å±•è¡¨ä¸­å¢åŠ ä¸€ä¸ªå­—æ®µï¼Œå¦‚æœå‘ç”Ÿäº†äº¤æ˜“ï¼Œé‚£ä¹ˆå°†å­—æ®µæ ‡è®°ä¸ºè€ç”¨æˆ·&lt;/li&gt;
&lt;li&gt;æŠŠç”¨æˆ·IDæ”¾å…¥redisé›†åˆsetä¸­ï¼Œåˆ©ç”¨SMISMEMBERå‘½ä»¤åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦åœ¨é›†åˆå†…ï¼Œå½“ç„¶è¿™ä¸ªä¼šæœ‰æ€§èƒ½é—®é¢˜ï¼Œå…¶æ–¹æ³•æ—¶é—´å¤æ‚åº¦ä½O(N)ï¼Œå®˜æ–¹æˆªå›¾:&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1605162870590.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;äº”-æ€»ç»“&#34;&gt;äº”ã€æ€»ç»“&lt;/h3&gt;
&lt;p&gt;â€ƒç¬”è€…ä»åˆ†å¸ƒå¼IDé€‰å‹å‡ºå‘ï¼Œä»‹ç»äº†å‡ ç§ä¸šç•Œå‡ ç§æ¯”è¾ƒå¸¸ç”¨çš„ç”Ÿæˆæ–¹æ³•ï¼Œå¹¶ä¸”ä»‹ç»äº†å…¶ä¼˜ç¼ºç‚¹ï¼Œç„¶åç»“åˆå®é™…ä¸šåŠ¡å‡ºå‘ï¼Œé€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆã€‚ç„¶åä»‹ç»äº†ä½¿ç”¨SnowFlakeç®—æ³•å¯¼è‡´çš„ä¸šåŠ¡é—®é¢˜ï¼Œä»¥åŠåˆ†ææœ€åæä¾›è§£æ–¹æ³•ã€‚ä»è¿™æ¬¡è¸©å‘çš„ç»å†æ¥è¯´ï¼Œæˆ‘ä»¬è¦æ‡‚æŠ€æœ¯ä½“ç³»ï¼Œå¹¶ä¸”è¿˜è¦éå¸¸ç†Ÿæ‚‰ä¸šåŠ¡ï¼Œæœ€å¤§ç¨‹åº¦é¿å…åŠŸèƒ½ä¹‹é—´çš„ç›¸äº’çš„å½±å“å¯¼è‡´çš„bugã€‚&lt;/p&gt;
&lt;h3 id=&#34;å…­-å‚è€ƒ&#34;&gt;å…­ã€å‚è€ƒ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ç¾å›¢åˆ†å¸ƒå¼ç®—æ³•IDå‡ ç§å®ç°æ–¹å¼â€”â€”https://tech.meituan.com/2017/04/21/mt-leaf.html&lt;/li&gt;
&lt;li&gt;SnowFlakeç®—æ³•â€”â€”https://github.com/twitter-archive/snowflake&lt;/li&gt;
&lt;/ul&gt;
">è®°ä¸€æ¬¡ç”¨æˆ·ä¸­å¿ƒé‡‡ç”¨åˆ†å¸ƒå¼IDè¸©çš„å‘</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://zhangyaoo.github.io/post/saas-xi-tong-duo-shu-ju-yuan-lu-you-you-ya-jie-jue-fang-an/"" data-c="
          &lt;h2 id=&#34;èƒŒæ™¯&#34;&gt;èƒŒæ™¯&lt;/h2&gt;
&lt;p&gt;åœ¨ç›®å‰çš„SaaSç³»ç»Ÿä¸­ï¼Œä¸šåŠ¡å¼€å‘è€…éœ€è¦é‡ç‚¹å…³æ³¨çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯æ•°æ®éš”ç¦»é—®é¢˜ï¼Œè¿™ä¸ªæ˜¯åšSaaSç³»ç»Ÿå¿…é¡»è¦è€ƒè™‘çš„ç‚¹ï¼Œå¤šç§Ÿæˆ·æ•°æ®éš”ç¦»æ˜¯æ¯ä¸ªSaaSç³»ç»Ÿéƒ½è¦é‡åˆ°å¹¶ä¸”è¦è§£å†³çš„é—®é¢˜ï¼Œç¬”è€…å°±åˆ†äº«ä¸‹è§£å†³è¿™ç§é—®é¢˜çš„æ€è·¯ã€å…·ä½“çš„è§£å†³æ–¹æ¡ˆä»¥åŠä¼˜é›…çš„è§£å†³æ€è·¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸€-è§£å†³æ–¹æ¡ˆä»‹ç»&#34;&gt;ä¸€ã€è§£å†³æ–¹æ¡ˆä»‹ç»&lt;/h2&gt;
&lt;h3 id=&#34;ç›®å‰ä¸šç•Œæ•°æ®éš”ç¦»æ–¹æ¡ˆ&#34;&gt;ç›®å‰ä¸šç•Œæ•°æ®éš”ç¦»æ–¹æ¡ˆ&lt;/h3&gt;
&lt;p&gt;1ã€ç‹¬ç«‹æ•°æ®åº“ï¼Œé€šè¿‡åŠ¨æ€åˆ‡æ¢æ•°æ®æºæ¥å®ç°å¤šç§Ÿæˆ·&lt;br&gt;
2ã€å…±äº«æ•°æ®åº“ï¼Œéš”ç¦»æ•°æ®æ¶æ„&lt;br&gt;
3ã€å…±äº«æ•°æ®åº“ï¼Œå…±äº«æ•°æ®è¡¨ï¼Œä½¿ç”¨å­—æ®µæ¥åŒºåˆ†ä¸åŒç§Ÿæˆ·ï¼Œæ­¤æ–¹æ¡ˆæˆæœ¬æœ€ä½&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šæ–¹æ¡ˆä»ä¸Šåˆ°ä¸‹ï¼Œå®‰å…¨æ€§é€æ¸é™ä½ã€‚ç”±äºè€ƒè™‘åˆ°å®‰å…¨é—®é¢˜ï¼Œæ•…é‡‡ç”¨ç¬¬ä¸€ç§æ–¹æ¡ˆè§£å†³æ•°æ®éš”ç¦»&lt;br&gt;
ä¼˜ç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;éå¸¸å®‰å…¨&lt;/li&gt;
&lt;li&gt;æ•°æ®äº’ä¸å½±å“ï¼Œæ€§èƒ½äº’ä¸å½±å“&lt;/li&gt;
&lt;li&gt;æ•°æ®è¿ç§»ï¼Œæ•°æ®æ‰©å±•æ–¹ä¾¿&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç¼ºç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;éœ€è¦ç»´æŠ¤å¤§é‡çš„æ•°æ®åº“&lt;/li&gt;
&lt;li&gt;éœ€è¦è‡ªè¡Œåˆ‡æ¢æ•°æ®åº“ï¼Œå¼€å‘é‡å¤šä¸”å®ç°å¤æ‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;å…·ä½“æŠ€æœ¯å®ç°&#34;&gt;å…·ä½“æŠ€æœ¯å®ç°&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;ç®€å•çš„æ¶æ„å›¾&lt;/strong&gt;&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1603179800053.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å¦‚å›¾æ‰€ç¤ºï¼ŒSaaSé¡¹ç›®å¤§æ¦‚æ¶æ„å›¾ï¼Œå…³é”®ç‚¹æ˜¯åº”ç”¨å±‚ä¼ å‚ï¼Œä»¥åŠè·¯ç”±å±‚çš„å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å®ç°&lt;/strong&gt;&lt;br&gt;
1ã€åº”ç”¨å±‚ï¼šé¡¹ç›®ä¸­åº”ç”¨serviceå±‚æ˜¯dubboæœåŠ¡ï¼Œè€Œä¸”é¡¹ç›®åˆ†å¤šå±‚ï¼Œè¿™é‡Œéœ€è¦è€ƒè™‘åˆ°å¤šå±‚æœåŠ¡åœºæ™¯ä¸‹ï¼Œå¦‚ä½•ä¼˜é›…ä¼ å‚é—®é¢˜ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1603181882775.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æˆ‘ä»¬è€ƒè™‘åˆ°ç§Ÿæˆ·IDæ˜¯å”¯ä¸€æ ‡è¯†ï¼Œå’Œä¸šåŠ¡å‚æ•°ç»‘å®šåœ¨ä¸€èµ·ä¸ä¼˜é›…ï¼Œæ‰€ä»¥ä¸¤ç§å‚æ•°åˆ†å¼€å¤„ç†ï¼Œä¸šåŠ¡å‚æ•°ç›´æ¥å‚æ•°é€ä¼ ï¼Œç§Ÿæˆ·IDå”¯ä¸€æ ‡è¯†é€šè¿‡éšå¼ä¼ å‚æ¥å¤„ç†ï¼ˆå‚è€ƒdubbo http://dubbo.apache.org/zh-cn/docs/user/demos/attachment.htmlï¼‰ï¼Œå¹¶ä¸”å‚æ•°è®°å½•åˆ°æœåŠ¡æœ¬åœ°çš„threadlocalä¸­ï¼Œä»¥ä¾¿åç»­å…¶ä»–ä¸šåŠ¡éœ€è¦ã€‚å…·ä½“å®ç°å¦‚ä¸‹ï¼š&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1603183675071.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;p&gt;2ã€è·¯ç”±å±‚ï¼šè·¯ç”±å±‚å®ç°ä¸»è¦æ˜¯è‡ªè¡Œå®ç°springæ¡†æ¶ä¸­DataSourceæ¥å£ï¼Œè‡ªå®šä¹‰dynamicDataSourceç±»ï¼Œç„¶åimplement DataSourceæ¥å£ï¼Œå®ç°getConnectionæ–¹æ³•ã€‚ç„¶åé‡æ–°å®šä¹‰SqlSessionFactoryçš„beanï¼Œå°†è‡ªå®šä¹‰DataSourceç±»å±æ€§æ³¨å…¥ã€‚&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1603183148592.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1603183156251.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
ç„¶åæˆ‘ä»¬åªéœ€è¦å…³æ³¨getConnectionæ–¹æ³•æ ¹æ®ç§Ÿæˆ·IDï¼Œé€‰æ‹©ç›¸å¯¹åº”çš„ç§Ÿæˆ·è¿æ¥æ± å°±å¯ä»¥äº†ã€‚&lt;br&gt;
å¦‚å›¾ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦å®ç°è¿™ä¸ªselectTenantCodeDataSource()è¿™ä¸ªæ–¹æ³•å°±å¯ä»¥äº†ï¼Œè¿™ä¸ªæ–¹æ³•å®ç°å¾ˆç®€å•ï¼Œè¿™é‡Œå°±ä¸è´´å›¾äº†ã€‚selectTenantCodeDataSource()æ–¹æ³•ä¸»è¦å°±æ˜¯ä»threadlocalä¸­æ‹¿ç§Ÿæˆ·IDï¼Œç„¶åå»ç¼“å­˜æ± mapä¸­æ‹¿å‡ºè¿æ¥æ± ä¿¡æ¯ã€‚&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1603183509071.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å…¶ä¸­ï¼ŒdataSourceCachePoolæ˜¯åœ¨åˆå§‹åŒ–é…ç½®æ—¶å€™ï¼Œå°†æ‰€æœ‰çš„ç§Ÿæˆ·è¿æ¥æ± ç›´æ¥åˆ›å»ºï¼Œç„¶åæ‰”åˆ°dataSourceCachePoolã€‚keyæ˜¯ç§Ÿæˆ·çš„IDï¼Œvalueæ˜¯è¿æ¥æ± ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“çš„åˆå§‹åŒ–é…ç½®ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;/**
 * åˆå§‹åŒ–æ•°æ®æº
 */
@Configuration
public class DataSourceInit {
    
    @PostConstruct
    public void InitDataSource()  {
        log.info(&amp;quot;=====åˆå§‹åŒ–æ•°æ®æº=====&amp;quot;);
        TenantRoutingDataSource tenantRoutingDataSource = (TenantRoutingDataSource)ApplicationContextProvider.getBean(&amp;quot;tenantRoutingDataSource&amp;quot;);
        Map&amp;lt;String, DataSourceCache&amp;gt; dataSourceCachePool = new HashMap&amp;lt;&amp;gt;();

        List&amp;lt;TenantInfo&amp;gt; tenantList = tenantInfoService.InitTenantInfo();
        for (TenantInfo tenantInfo : tenantList) {
            log.info(tenantInfo.toString());
            HikariDataSource dataSource = new HikariDataSource();
            dataSource.setDriverClassName(tenantInfo.getDatasourceDriver());
            dataSource.setJdbcUrl(tenantInfo.getDatasourceUrl());
            dataSource.setUsername(tenantInfo.getDatasourceUsername());
            dataSource.setPassword(tenantInfo.getDatasourcePassword());
            dataSource.setDataSourceProperties(master.getDataSourceProperties());
            dataSourceCachePool.put(tenantInfo.getTenantId(), dataSource);
        }
        //è®¾ç½®æ•°æ®æº
        tenantRoutingDataSource.setDataSources(dataSourceCachePool);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;äºŒ-æ–¹æ¡ˆçš„éšè—ç¼ºç‚¹ä»¥åŠè§£å†³&#34;&gt;äºŒã€æ–¹æ¡ˆçš„éšè—ç¼ºç‚¹ä»¥åŠè§£å†³&lt;/h2&gt;
&lt;h3 id=&#34;éšè—çš„ç¼ºé™·&#34;&gt;éšè—çš„ç¼ºé™·&lt;/h3&gt;
&lt;p&gt;ç›¸ä¿¡æœ‰ä¸€å®šå¼€å‘ç»éªŒçš„è¯»è€…åº”è¯¥èƒ½æƒ³åˆ°ï¼Œä¸Šè¿°æ–¹æ¡ˆæœ€å¤§çš„ç¼ºç‚¹å°±æ˜¯æ€§èƒ½é—®é¢˜ï¼Œå¯¹MySQLæœ‰éå¸¸å¤§çš„å½±å“ã€‚å› ä¸ºä¸€å¼€å§‹åˆå§‹åŒ–éå¸¸å¤šçš„è¿æ¥æ± ï¼Œå°±ä¼šå ç”¨è¿æ¥èµ„æºï¼Œæ¯”å¦‚ç§Ÿæˆ·ä»100ä¸ªæ‰©å±•åˆ°äº†1000ä¸ªä»¥åŠæ›´å¤šï¼Œé‚£ä¹ˆè¿æ¥æ± æ•°é‡å°±çº¿æ€§å¢é•¿ï¼Œå¦‚æœä¸€ä¸ªè¿æ¥æ± ä¿æŒ15ä¸ªæ´»è·ƒè¿æ¥çš„è¯ï¼Œé‚£ä¹ˆè¿æ¥æ•°å°±æ˜¯15*1000ï¼Œæ­¤æ—¶å¦‚æœMySQLçš„maxconntionçš„æ•°é‡éå¸¸å°ï¼Œé‚£ä¹ˆMySQLä¾§å°±ä¼šæŠ›å‡ºâ€too many connctionsâ€œé”™è¯¯ï¼Œåœ¨åº”ç”¨å±‚æ–¹é¢å°±æ˜¯MySQLä¸å¯ç”¨äº†ã€‚&lt;br&gt;
æ²¡ä¼˜åŒ–ä¹‹å‰çš„æ¶æ„ï¼š&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1603190851131.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;è§£å†³&#34;&gt;è§£å†³&lt;/h3&gt;
&lt;p&gt;æƒ³ä¿æŒæ•°æ®åº“åˆ†ç¦»ï¼Œåˆè¦è€ƒè™‘åˆ°MySQLæ€§èƒ½é—®é¢˜ï¼Œåªèƒ½å‘è¿æ¥æ± ä¼˜åŒ–çš„æ–¹å‘å»è€ƒè™‘ï¼Œå…¶å®å¯ä»¥å‡å°‘æ•°é‡å°±å¯ä»¥äº†ï¼Œè¿™é‡Œå®ç°æ–¹æ¡ˆå°±æ˜¯ä¸€ä¸ªæ•°æ®åº“å®ä¾‹ä¸€ä¸ªè¿æ¥æ± ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1603190889253.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å…·ä½“å®ç°å°±æ˜¯å°†ä¸Šè¿°æ–¹æ¡ˆä¸­çš„dataSourceCachePoolçš„keyæ”¹ä¸º â€œIP+ç«¯å£â€ï¼Œä½œä¸ºkeyã€‚ç„¶åå†æ•°æ®æºè·¯ç”±å±‚ï¼Œå¤šä¸€å±‚æ˜ å°„ï¼ˆç§Ÿæˆ·IDâ€”â€”&amp;gt;æ•°æ®åº“å®ä¾‹ï¼‰å°±å¯ä»¥äº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸‰-æ›´ä¼˜é›…æ–¹æ¡ˆè§£å†³ä¼ä¸šå†…éƒ¨å¼€å‘ç—›ç‚¹&#34;&gt;ä¸‰ã€æ›´ä¼˜é›…æ–¹æ¡ˆè§£å†³ä¼ä¸šå†…éƒ¨å¼€å‘ç—›ç‚¹&lt;/h2&gt;
&lt;h3 id=&#34;ç°çŠ¶&#34;&gt;ç°çŠ¶&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;ç°çŠ¶&lt;/strong&gt;ï¼šä¼ä¸šå†…éƒ¨é¡¹ç›®ç»„å¼€å‘æ•°æ®æºè·¯ç”±ï¼Œå„ä¸ªäººå‘˜å¼€å‘æ°´å¹³ä¸ä¸€ï¼Œå„ç§è·¯ç”±æ–¹æ¡ˆå®ç°ä¸åŒï¼Œè‡ªå·±ç»„å†…çš„å¼€å‘çš„æ–¹æ¡ˆåªèƒ½è‡ªå·±ç»„å†…ä½¿ç”¨ï¼Œå¹¶ä¸”å®ç°å¤æ‚ï¼Œè€—äººåŠ›ç‰©åŠ›ã€‚&lt;br&gt;
&lt;strong&gt;ç›®æ ‡&lt;/strong&gt;ï¼šé¡¹ç›®ç»„ä½¿ç”¨ç›´æ¥å¼•å…¥mavenåŒ…ï¼Œä»»ä½•é…ç½®éƒ½ä¸è¦é…ç½®ï¼ˆè‡ªå®šä¹‰çš„è¯éœ€è¦è‡ªè¡Œåœ¨è‡ªå·±é¡¹ç›®ä¸­é…ç½®å±æ€§ï¼‰ï¼Œå¼€ç®±å³ç”¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å…·ä½“å®ç°&#34;&gt;å…·ä½“å®ç°&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;åŸç†&lt;/strong&gt;ï¼šç›´æ¥é‡‡ç”¨springboot starterå¼€å‘ï¼Œå°†ä¸Šè¿°æ–¹æ¡ˆæ‰€æœ‰çš„é€»è¾‘å’ŒæŠ€æœ¯å®ç°å•ç‹¬æ”¾å…¥springboot starterå·¥ç¨‹ä¸­ï¼Œé‡‡ç”¨å¤–éƒ¨é…ç½®çš„æ–¹å¼å®ç°è‡ªå®šä¹‰é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¼€å‘è€…å®ç°&lt;/strong&gt;ï¼šç½‘ä¸Šæœ‰è®¸å¤šspringboot starterå¼€å‘çš„æµç¨‹å’Œå¼€å‘æ¡ˆä¾‹ï¼Œç¬”è€…è¿™é‡Œå°±åªè´´å‡ºå…³é”®çš„ä»£ç &lt;br&gt;
1ã€è‡ªåŠ¨è£…é…ç±»ï¼šspring.factoriesä¸­å†™å…¥è¿™ä¸ªç±»DataSourceAutoConfigureï¼Œå®ç°beançš„è‡ªåŠ¨è£…å…¥ï¼Œç±»é‡Œé¢ä¸»è¦æ˜¯å®ç°SqlSessionFactoryå’ŒPlatformTransactionManagerï¼Œç„¶ååœ¨TenantRoutingDataSourceçš„getconnectionæ–¹æ³•ä¸­è‡ªå®šä¹‰å®ç°è·¯ç”±é€»è¾‘ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Configuration
public class DataSourceAutoConfigure {

    @Resource
    private TenantRoutingDataSource tenantRoutingDataSource;

    @Bean
    @ConditionalOnMissingBean(SqlSessionFactory.class)
    @ConditionalOnBean(TenantRoutingDataSource.class)
    public SqlSessionFactory sqlSessionFactory() throws Exception{
        SqlSessionFactoryBean sqlSessionFactoryBean = new SqlSessionFactoryBean();
        sqlSessionFactoryBean.setDataSource(tenantRoutingDataSource);
        Objects.requireNonNull(sqlSessionFactoryBean.getObject()).getConfiguration().setMapUnderscoreToCamelCase(true);
        return sqlSessionFactoryBean.getObject();
    }

    @Bean
    @ConditionalOnMissingBean(PlatformTransactionManager.class)
    @ConditionalOnBean(TenantRoutingDataSource.class)
    public PlatformTransactionManager platformTransactionManager() {
        return new DataSourceTransactionManager(tenantRoutingDataSource);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;2ã€Java SPIæœºåˆ¶ï¼šåˆ©ç”¨Javaspi æ¥è·å–ç”¨æˆ·è‡ªå®šä¹‰çš„mybatis pluginã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œä¸ç”¨æ¯æ¬¡å¢åŠ ä¸€ä¸ªpluginï¼Œå°±æ”¹åŠ¨æ•°æ®è·¯ç”±ç»„ä»¶çš„ä»£ç ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public SqlSessionFactory sqlSessionFactory(@Qualifier(&amp;quot;tenantRoutingDataSource&amp;quot;) TenantRoutingDataSource tenantRoutingDataSource) throws Exception{
        SqlSessionFactoryBean sqlSessionFactoryBean = new SqlSessionFactoryBean();
        sqlSessionFactoryBean.setDataSource(tenantRoutingDataSource);
        Interceptor[] plugins = loadMybatisPlugin();
        if(plugins.length &amp;gt; 0){
            sqlSessionFactoryBean.setPlugins(plugins);
        }
        Objects.requireNonNull(sqlSessionFactoryBean.getObject()).getConfiguration().setMapUnderscoreToCamelCase(true);
        return sqlSessionFactoryBean.getObject();
    }

    // SPIæœºåˆ¶è·å–æ’ä»¶
    private Interceptor[] loadMybatisPlugin(){
        List&amp;lt;Interceptor&amp;gt; interceptors = new ArrayList&amp;lt;&amp;gt;();
        ServiceLoader&amp;lt;Interceptor&amp;gt; load = ServiceLoader.load(Interceptor.class);
        load.forEach(interceptors::add);
        return interceptors.toArray(new Interceptor[0]);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;3ã€dubbo filteræ‰©å±•æ¥å£ï¼šè·å–ç§Ÿæˆ·IDï¼Œå¹¶ä¸”éœ€è¦åŠ @Activateæ³¨è§£ï¼Œè¿™æ ·dubboåœ¨åˆå§‹åŒ–filteré“¾çš„æ—¶å€™ï¼Œè‡ªåŠ¨å°†è¿™ä¸ªfilteræ³¨å†Œåˆ°filteré“¾ä¸­ï¼Œè¿™æ ·åšçš„å¥½å¤„å°±æ˜¯ï¼Œç”¨æˆ·åœ¨è‡ªå·±å·¥ç¨‹ä¸­ä¸éœ€è¦é…ç½®filterè¿™ä¸ªå‚æ•°ï¼Œæ— éœ€å¢åŠ ä»»ä½•çš„é…ç½®ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Activate(group = {&amp;quot;provider&amp;quot;})
public class TenantCodeContextFilter implements Filter {
    @Override
    public Result invoke(Invoker&amp;lt;?&amp;gt; invoker, Invocation invocation) throws RpcException {
        String tenantCode = RpcContext.getContext().getAttachment(&amp;quot;tenantCode&amp;quot;);
        TenantCodeContextHolder.setTenantCode(tenantCode);
        return invoker.invoke(invocation);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;4ã€æ£€æŸ¥ç”¨æˆ·ä¾§è‡ªå®šä¹‰é…ç½®æ˜¯å¦æ­£ç¡®ï¼šæ£€æŸ¥ç”¨æˆ·çš„é…ç½®æ˜¯å¦åˆç†ï¼Œä¸åˆç†çš„è¯å†å®¹å™¨å°±ç»ªé˜¶æ®µå°±ä¼šæŠ›å‡ºå¼‚å¸¸&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Component
public class CheckConfigListener implements ApplicationListener&amp;lt;ApplicationReadyEvent&amp;gt; {

    @Override
    public void onApplicationEvent(ApplicationReadyEvent applicationReadyEvent) {
        ConfigurableApplicationContext applicationContext = applicationReadyEvent.getApplicationContext();
        ConfigurableEnvironment environment = applicationContext.getEnvironment();
        // æ£€æŸ¥ç”¨æˆ·è‡ªå®šä¹‰é…ç½®æ˜¯å¦æ­£ç¡®ï¼Œè‡ªè¡Œå®ç°
        checkDatasourceConfig(environment);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;5ã€åˆ©ç”¨ç¼“å­˜æ± ä¿å­˜å¤šä¸ªdataSourceå¯¹è±¡ï¼Œä¸€ä¸ªMySQLå®ä¾‹å¯¹åº”ä¸€ä¸ªdataSourceå¯¹è±¡ï¼Œä¸€ä¸ªdataSourceå¯¹åº”å¤šä¸ªç§Ÿæˆ·ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªdataSourceå¯¹åº”ä¸€ä¸ªç§Ÿæˆ·ï¼Œè¿™æ ·çš„å¥½å¤„å°±æ˜¯ï¼Œå¦‚æœä¸€ä¸ªMySQLå®ä¾‹é‡Œé¢çš„ç§Ÿæˆ·æ•°æ®åº“è¿‡å¤šï¼Œä¸ä¼šå¯¼è‡´ä¸€ä¸ªMySQLå®ä¾‹è¿æ¥æ•°è†¨èƒ€é—®é¢˜ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;    /**
     * æ•°æ®æºç¼“å­˜æ± 
     * Key ä¸€ä¸ªMySQLæ•°æ®åº“è¿æ¥ä¿¡æ¯key
     * Value ç¼“å­˜æ—¶RDSè¿æ¥ä¿¡æ¯ä¸DataSource
     */
    private final Map&amp;lt;String, DataSourceCache&amp;gt; dataSourceCachePool = new ConcurrentHashMap&amp;lt;&amp;gt;();
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;ç”¨æˆ·ä½¿ç”¨&lt;/strong&gt;ï¼šç›´æ¥å¼•å…¥ç›¸åº”çš„mavenï¼Œæ–¹ä¾¿å¿«æ·&lt;/p&gt;
&lt;h2 id=&#34;å››-todoåç»­ä¼˜åŒ–&#34;&gt;å››ã€TODOåç»­ä¼˜åŒ–&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;ç›®å‰å¤šç§Ÿæˆ·æ•°æ®æºé€šç”¨å·¥ç¨‹åªæ”¯æŒDubboçš„è°ƒç”¨ï¼Œæœªæ¥å¯æ‰©å±•æ”¯æŒå¤šç§åè®®å¦‚HTTPã€gRPC&lt;/li&gt;
&lt;li&gt;ç›®å‰åªæ”¯æŒHikariæ•°æ®æºï¼Œåç»­æ”¯æŒå¤šç§æ•°æ®æºç±»å‹ï¼Œæ¯”å¦‚Durid&lt;/li&gt;
&lt;li&gt;å¦‚æœç§Ÿæˆ·æ•°æ®éå¸¸å¤§ï¼Œå¯ä»¥è€ƒè™‘ç©ºé—´æ¢æ—¶é—´æ€æƒ³ï¼Œä½¿ç”¨ç¼“å­˜å­˜æ”¾ç§Ÿæˆ·çš„æ•°æ®æºé…ç½®ï¼Œæå‡æŸ¥è¯¢æ•ˆç‡ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;SaaSç³»ç»Ÿæ•°æ®éš”ç¦»æ–¹æ¡ˆâ€”â€”https://blog.arkency.com/comparison-of-approaches-to-multitenancy-in-rails-apps/&lt;/li&gt;
&lt;/ul&gt;
">SaaSç³»ç»Ÿå¤šæ•°æ®æºè·¯ç”±ä¼˜é›…è§£å†³æ–¹æ¡ˆ</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://zhangyaoo.github.io/post/mysql-lian-he-suo-yin-zai-bshu-de-cun-chu-he-cha-zhao/"" data-c="
          &lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;åœ¨å¯¹MySQLå¼€å‘ä¸­ï¼Œè”åˆç´¢å¼•æ˜¯å¾ˆå¸¸è§çš„ä¸€ç§MySQLä¼˜åŒ–æ–¹å¼ï¼Œæœ¬æ–‡è§£é‡Šäº†è”åˆç´¢å¼•çš„å­˜å‚¨ä»¥åŠæŸ¥æ‰¾è¿‡ç¨‹ï¼Œå¯ä»¥äº†è§£ä¸€ä¸‹åº•å±‚çš„åŸç†ä»¥åŠåŠ æ·±å¯¹MySQLè”åˆç´¢å¼•çš„ç†è§£ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;innodb-bæ ‘&#34;&gt;Innodb B+æ ‘&lt;/h2&gt;
&lt;p&gt;å…ˆçœ‹ä¸€ä¸‹Innodb B+æ ‘çš„ä¸»é”®ç´¢å¼•å’Œè¾…åŠ©ç´¢å¼•ã€‚è¿™é‡Œç›´æ¥æ‹¿å¼ æ´‹å¤§ç¥çš„å›¾ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;èšç°‡ç´¢å¼•:&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1593425796639.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/li&gt;
&lt;li&gt;è¾…åŠ©éèšç°‡ç´¢å¼•:&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1593425801180.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
&lt;strong&gt;ç»“æ„&lt;/strong&gt;ï¼šå½“ä¸€ä¸ªè¡¨Tï¼ˆid,name,age,sex,highï¼‰å»ºä¸€ä¸ªæ™®é€šç´¢å¼•  KEY(name)ï¼Œnameçš„ç´¢å¼•ç»“æœå°±å’Œä¸Šé¢è¾…åŠ©éèšç°‡ç´¢å¼•ç»“æ„ä¸€æ ·ã€‚&lt;br&gt;
&lt;strong&gt;æŸ¥è¯¢&lt;/strong&gt;ï¼šå½“æœ‰ä¸€ä¸ªselect id,name,age from T where name = &amp;quot;&amp;quot; è¾…åŠ©ç´¢å¼•ä¼šæ ¹æ®nameåœ¨B+æ ‘ä¸Šè¿›è¡ŒäºŒå‰æ ‘æŸ¥æ‰¾ï¼Œæ‰¾å‡ºå¶å­èŠ‚ç‚¹æ•°æ®åå‘ç°æ²¡æœ‰ageè¿™ä¸ªæ•°æ®ï¼Œå°±ä¼šè¿›è¡Œ&lt;strong&gt;å›è¡¨&lt;/strong&gt;æ“ä½œåˆ°ä¸»é”®èšç°‡ç´¢å¼•å»æŸ¥æ‰¾ï¼Œæ‹¿åˆ°èšç°‡ç´¢å¼•å¶å­èŠ‚ç‚¹çš„ageæ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;è”åˆç´¢å¼•å­˜å‚¨ä»¥åŠå¯»å€&#34;&gt;è”åˆç´¢å¼•å­˜å‚¨ä»¥åŠå¯»å€&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç´¢å¼•ç»“æ„&lt;/strong&gt;ï¼šæˆ‘ä»¬çŸ¥é“ä¸Šè¿°å›è¡¨è¿‡ç¨‹ä¹Ÿä¼šæ¶ˆè€—æ€§èƒ½ï¼Œç›¸å½“äºå¤šæŸ¥ä¸€æ¬¡ï¼Œæ‰€ä»¥ç³»ç»Ÿå¯ä»¥æ ¹æ®ä¸šåŠ¡æƒ…å†µåŠ ä¸Šä¸€ä¸ªç»„åˆç´¢å¼•ï¼Œå½“ç„¶å¹¶ä¸æ˜¯ä¸€ç›´åŠ ç»„åˆç´¢å¼•å°±å¯ä»¥äº†ï¼Œå› ä¸ºè¦è€ƒè™‘åˆ°ç´¢å¼•å­˜å‚¨ç©ºé—´çš„é—®é¢˜ã€‚ä¾‹å¦‚ç»™ä¸Šè¿°åŠ ä¸Šä¸€ä¸ªç»„åˆç´¢å¼•  KEYï¼ˆname,age,sexï¼‰ã€ KEYï¼ˆcol1,col2,col3ï¼‰ã€‘ã€‚é‚£ä¹ˆè¿™ä¸ªç»„åˆç´¢å¼•çš„B+æ ‘éå¶å­èŠ‚ç‚¹æ•°æ®ç»“æ„å’Œä¸Šè¿°è¾…åŠ©éèšç°‡ç´¢å¼•å›¾ä¸€æ ·ï¼Œä½†æ˜¯å¶å­èŠ‚ç‚¹æ˜¯è¿™æ ·çš„ï¼š&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1593425790647.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å¶å­èŠ‚ç‚¹å­˜å‚¨col1,col2,col3è¿™ä¸‰åˆ—æ•°æ®ä»¥åŠåŠ ä¸ŠIDè¿™ä¸€åˆ—æ•°æ®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¯»å€è¿‡ç¨‹ï¼š&lt;/strong&gt;&lt;br&gt;
ä¾‹å¦‚è¯­å¥ï¼šselect * from T where name = &amp;quot;å¼ ä¸‰&amp;quot; and age=25ï¼Œå…ˆæ ¹æ®nameå­—æ®µä»è¾…åŠ©èšç°‡ç´¢å¼•å®šä½åˆ°å“ªä¸€ä¸ªå¶å­èŠ‚ç‚¹æ•°æ®ä¸­ï¼Œç„¶åæ ¹æ®ageèŠ‚ç‚¹åœ¨ä¸Šè¿°è¡¨æ ¼çš„å‰6è¡Œä¸­ï¼Œå¯»æ‰¾age= 25çš„æ•°æ®ï¼Œç„¶åæ‰¾å‡ºæ‰€æœ‰ç¬¦åˆçš„æ•°æ®ä»¥åŠå…¶å¯¹åº”çš„IDï¼Œç„¶åæ ¹æ®IDæ¥è¿›è¡Œå›è¡¨æ“ä½œæŸ¥è¯¢ã€‚è¿™é‡Œè¿”å›äº†ä¸‰æ¡æ•°æ®ï¼Œå°±å›äº†ä¸‰æ¬¡è¡¨ã€‚&lt;br&gt;
ä¸Šè¿°å›è¡¨è¿‡ç¨‹ä¸­ï¼Œç¬”è€…å¼•å…¥ä¸€ä¸ª&lt;strong&gt;ç´¢å¼•ä¸‹æ¨&lt;/strong&gt;çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œç´¢å¼•ä¸‹æ¨æ˜¯MySQLåœ¨5.6ç‰ˆæœ¬åå¼•å…¥çš„ä¸€ä¸ªæŸ¥è¯¢ä¼˜åŒ–ã€‚å°±æ‹¿ä¸Šè¿°çš„ä¾‹å­ï¼Œåœ¨æ²¡æœ‰ä¼˜åŒ–ä¹‹å‰ï¼Œæ®nameå­—æ®µæŸ¥è¯¢â€œå¼ ä¸‰â€åï¼Œä¼šæ‹¿åˆ°6æ¡ç»“æœï¼Œå›è¡¨6æ¬¡ï¼Œç„¶åä»ä¸»é”®ç´¢å¼•æ‹¿åˆ°6æ¡æ•°æ®åï¼Œæ ¹æ®ageå­—æ®µç­›é€‰æ•°æ®ï¼›ä¼˜åŒ–ä¹‹åï¼Œå…ˆå†è¾…åŠ©ç´¢å¼•ä¸Šé¢æ ¹æ®nameå­—æ®µå’Œageå­—æ®µç­›é€‰ç¬¦åˆæ•°æ®ï¼Œä¹Ÿå°±æ˜¯IDï¼Œç„¶åå†å›è¡¨ï¼Œè¿™é‡Œå›è¡¨äº†ä¸‰æ¬¡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»„åˆç´¢å¼•æ³¨æ„äº‹é¡¹&lt;/strong&gt;&lt;br&gt;
å½“ç„¶ï¼Œè”åˆç´¢å¼•çš„æœ€é‡è¦çš„æ˜¯æ³¨æ„è”åˆç´¢å¼•çš„ä½¿ç”¨é—®é¢˜ï¼Œè¦éµå¾ªæœ€å·¦åŒ¹é…åŸåˆ™ï¼Œæ‰å¯ä»¥ä¼˜åŒ–åˆ°æ•´ä¸ªSQLäº†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h3&gt;
&lt;p&gt;ä»¥ä¸Šï¼Œæ€»ç»“äº†MySQLçš„ç´¢å¼•çš„åŸºæœ¬åŸç†ï¼Œä»¥åŠè”åˆç´¢å¼•çš„å­˜å‚¨å’Œå¯»å€è¿‡ç¨‹ï¼Œå¹¶ä¸”å¼•å…¥ç´¢å¼•ä¸‹æ¨æ¦‚å¿µï¼Œè¿˜æœ‰ä½¿ç”¨è”åˆç´¢å¼•çš„æ³¨æ„äº‹é¡¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;MySQLç´¢å¼•èƒŒåçš„æ•°æ®ç»“æ„åŠç®—æ³•åŸç†â€”â€”http://blog.codinglabs.org/articles/theory-of-mysql-index.htmlã€‚&lt;/li&gt;
&lt;/ul&gt;
">MySQLè”åˆç´¢å¼•åœ¨B+æ ‘çš„å­˜å‚¨å’ŒæŸ¥æ‰¾</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://zhangyaoo.github.io/post/guan-yu-zookeeper-qi-shu-jie-dian-yi-ji-nao-lie-wen-ti/"" data-c="
          &lt;h3 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;Zookeeperä½œä¸ºå¾®æœåŠ¡åˆ†å¸ƒå¼åè°ƒä¸­é—´ä»¶ï¼Œäº†è§£å®ƒçš„åŸç†ä»¥åŠæ—¥å¸¸å¼€å‘ä¸­çš„æ³¨æ„äº‹é¡¹å’Œå¯èƒ½ä¼šå‡ºç°çš„é—®é¢˜æ˜¯æœ‰å¿…è¦çš„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;å‰ç½®çŸ¥è¯†zabåè®®&#34;&gt;å‰ç½®çŸ¥è¯†ï¼šZABåè®®&lt;/h3&gt;
&lt;p&gt;ZABï¼šZookeeper Atomic Broadcastï¼ˆZABï¼‰å´©åæ¢å¤å’ŒåŸå­å¹¿æ’­åè®®&lt;br&gt;
1ï¼‰å´©åæ¢å¤ï¼šåœ¨masterèŠ‚ç‚¹å®•æœºæƒ…å†µä¸‹ï¼Œå…¶ä»–é›†ç¾¤èŠ‚ç‚¹ä¼šé‡æ–°é€‰ä¸¾masterèŠ‚ç‚¹ï¼Œå¿«é€Ÿé¢†å¯¼è€…é€‰ä¸¾æœºåˆ¶ï¼šé€‰ä¸¾è§„åˆ™ä¼šå‚ç…§æœ€å¤§çš„åˆ†ä»£å¹´é¾„epoch&amp;gt;æœ€å¤§çš„äº‹åŠ¡zxid&amp;gt;server idæ¥è¿›è¡Œé€‰ä¸¾ï¼Œé€‰ä¸¾è¿‡ç¨‹å°±æ˜¯å°†è‡ªå·±èŠ‚ç‚¹æŠ•ç¥¨ä¿¡æ¯å‘ç»™å…¶ä»–é›†ç¾¤èŠ‚ç‚¹ï¼ŒæŠ•ç¥¨ä¿¡æ¯é™„å¸¦zxidå’Œserveridï¼Œ&lt;strong&gt;åˆ¤æ–­æ˜¯å¦è¶…è¿‡ä¸€åŠçš„æŠ•ç¥¨é€‰åŒä¸€ä¸ªèŠ‚ç‚¹&lt;/strong&gt;ï¼Œé‚£ä¹ˆè¿™ä¸ªèŠ‚ç‚¹å°±ä¼šé€‰ä¸¾ä¸ºmasterã€‚&lt;br&gt;
2ï¼‰é€‰ä¸¾å®Œåï¼Œå°±ä¼šè¿›è¡Œæ•°æ®åŒæ­¥ï¼Œå°†masterèŠ‚ç‚¹æ•°æ®åŒæ­¥åˆ°slaveä¸­ï¼Œæ­¤æ—¶å¯¹å¤–æœåŠ¡ä¸å¯ç”¨ã€‚&lt;br&gt;
3ï¼‰åŸå­å¹¿æ’­ï¼šZABåè®®ä¿è¯æ¶ˆæ¯çš„ä¸€è‡´æ€§å’Œæœ‰åºæ€§&lt;br&gt;
â€ƒä¸€è‡´æ€§ï¼šleaderå‘é€propasaläº‹åŠ¡è¯·æ±‚ï¼ˆåŒ…å«zxidï¼‰ï¼Œmasteråˆ¤æ–­è¿‡åŠæœºåˆ¶ackï¼Œå°±è®¤ä¸ºäº‹åŠ¡å¯ä»¥æäº¤äº†ï¼Œmasterä¼šæäº¤äº‹åŠ¡ï¼Œç„¶åå¹¿æ’­æäº¤äº‹åŠ¡æ¶ˆæ¯ï¼Œä»èŠ‚ç‚¹å¼€å§‹æäº¤æœ¬äº‹åŠ¡ã€‚ä¸€åŠackæœºåˆ¶ï¼Œå¯ä»¥çœ‹zookeeperæ˜¯CPï¼Œä½†æ˜¯ä¸æ˜¯å¼ºä¸€è‡´æ€§ï¼›ä»èŠ‚ç‚¹æ¥æ”¶propasalåï¼Œä¼šå°†äº‹åŠ¡å†™å…¥ç£ç›˜ã€‚&lt;br&gt;
â€ƒæœ‰åºæ€§ï¼šzxidäº‹åŠ¡idä¿è¯å…¨å±€æœ‰åºæ€§ï¼Œæ¯ä¸€ä¸ªslaveæœåŠ¡å™¨ç»´æŒä¸€ä¸ªFIFOé˜Ÿåˆ—ï¼Œç»´æŒå±€éƒ¨æœ‰åºæ€§ã€‚&lt;/p&gt;
&lt;h3 id=&#34;zookeeperè„‘è£‚&#34;&gt;Zookeeperè„‘è£‚&lt;/h3&gt;
&lt;p&gt;â€ƒZookeeperè„‘è£‚éƒ½æ˜¯å‡ºç°åœ¨é›†ç¾¤ç¯å¢ƒä¸­çš„ã€‚æŒ‡çš„æ˜¯ä¸€ä¸ªé›†ç¾¤ç¯å¢ƒä¸­å‡ºç°äº†å¤šä¸ªmasterèŠ‚ç‚¹ï¼Œå¯¼è‡´ä¸¥é‡æ•°æ®åŒæ­¥å’Œå†™å…¥é—®é¢˜ï¼Œæ•°æ®ä¸ä¸€è‡´ç­‰ç­‰ï¼Œå¦‚æœè¿™ç§æƒ…å†µå‡ºç°åœ¨çº¿ä¸Šåˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œä¼šå¯¼è‡´æœåŠ¡ä¸å¯ç”¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å‡ºç°åŸå› &#34;&gt;å‡ºç°åŸå› &lt;/h3&gt;
&lt;p&gt;â€ƒå¯èƒ½å°±æ˜¯ç½‘ç»œç¯å¢ƒæœ‰é—®é¢˜å¯¼è‡´èŠ‚ç‚¹ä¹‹é—´æ–­å¼€ï¼Œæˆ–è€…èŠ‚ç‚¹å‡æ­»ç­‰ç­‰ï¼Œå¯¼è‡´ä¸€éƒ¨åˆ†slaveèŠ‚ç‚¹ä¼šé‡æ–°è¿›å…¥å´©åæ¢å¤æ¨¡å¼ï¼Œé‡æ–°é€‰ä¸¾æ–°çš„masterèŠ‚ç‚¹ï¼Œç„¶åå¯¹å¤–æä¾›äº‹åŠ¡æœåŠ¡ã€‚ç”±äºå¿ƒè·³è¶…æ—¶ï¼ˆç½‘ç»œåŸå› å¯¼è‡´çš„ï¼‰è®¤ä¸ºæ—§çš„masteræ­»äº†ï¼Œä½†å…¶å®æ—§çš„masterè¿˜å­˜æ´»ç€ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¦‚ä½•è§£å†³è„‘è£‚&#34;&gt;å¦‚ä½•è§£å†³è„‘è£‚&lt;/h3&gt;
&lt;p&gt;è¿‡åŠæœºåˆ¶ï¼Œå¦‚æœé›†ç¾¤ä¸­æŸä¸ªèŠ‚ç‚¹çš„æŠ•ç¥¨æ•°é‡å¤§äºé›†ç¾¤æœ‰æ•ˆèŠ‚ç‚¹çš„ä¸€åŠï¼Œå°±ä¼šé€‰å‡ºmasterã€‚è¿™é‡Œæ‹¿å‡ºå…³é”®ä»£ç ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;// éªŒè¯æ˜¯å¦ç¬¦åˆè¿‡åŠæœºåˆ¶ï¼Œå¦‚æœç¬¦åˆå°±ä¼šé€‰ä¸¾æ–°çš„masterèŠ‚ç‚¹
public boolean containsQuorum(Set&amp;lt;Long&amp;gt; set){
    // halfæ˜¯åœ¨æ„é€ æ–¹æ³•é‡Œèµ‹å€¼çš„
    // nè¡¨ç¤ºé›†ç¾¤ä¸­zkServerçš„ä¸ªæ•°ï¼ˆå‡†ç¡®çš„è¯´æ˜¯å‚ä¸è€…çš„ä¸ªæ•°ï¼Œå‚ä¸è€…ä¸åŒ…æ‹¬è§‚å¯Ÿè€…èŠ‚ç‚¹ï¼‰
    half = n/2;
    // set.size()è¡¨ç¤ºæŸå°zkServerè·å¾—çš„ç¥¨æ•°
    return (set.size() &amp;gt; half);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç¬”è€…ä»‹ç»å‡ ç§æƒ…å†µï¼Œæ¥è¯´æ˜ä¸€ä¸‹å‡ ç§è„‘è£‚çš„åœºæ™¯&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ¯”å¦‚é›†ç¾¤ä¸­æœ‰6ä¸ªèŠ‚ç‚¹ï¼Œä¸€ä¸ªmasterå’Œ5ä¸ªslaveï¼Œåˆ†ä¸¤ä¸ªæœºæˆ¿ï¼Œæ¯ä¸ªæœºæˆ¿åˆ†åˆ«ä¸‰å°ï¼Œå‘ç”Ÿäº†æœºæˆ¿ä¸å¯é€šä¿¡çš„æƒ…å†µï¼Œå¦‚ä¸‹å›¾ï¼š&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1593419532309.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
ç„¶åæœºæˆ¿Bå°±ä¼šäº§ç”Ÿæ–°çš„masterï¼Œå¦‚å›¾&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1593419550068.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
è¿™ä¸ªæ—¶å€™Zookeeperä¸ºäº†é˜²æ­¢è¿™æ ·çš„æƒ…å†µå‘ç”Ÿï¼Œåˆ©ç”¨äº†&lt;strong&gt;è¿‡åŠæœºåˆ¶&lt;/strong&gt;çš„è¿™ä¸ªç‰¹æ€§ã€‚&lt;br&gt;
ä¸Šå›¾ä¸­ï¼Œæœºæˆ¿BèŠ‚ç‚¹ä¸º3 å°äºé›†ç¾¤æ•°é‡çš„ä¸€åŠï¼Œæ‰€ä»¥ï¼Œæœ€ç»ˆä¸Šé¢å›¾ä¸­æœºæˆ¿Bæ˜¯ä¸ä¼šé€‰ä¸¾å‡ºæ–°çš„masterèŠ‚ç‚¹çš„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æˆ‘ä»¬å†æ¥çœ‹ä¸€ç§æƒ…å†µï¼šæ¯”å¦‚é›†ç¾¤ä¸­æœ‰5ä¸ªèŠ‚ç‚¹ï¼Œä¸€ä¸ªmasterå’Œ4ä¸ªslaveï¼Œåˆ†ä¸¤ä¸ªæœºæˆ¿ï¼Œå¦‚ä¸‹å›¾ï¼š&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1593419973725.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å¦‚æœå‘ç”Ÿäº†æœºæˆ¿ä¸èƒ½é€šä¿¡çš„æƒ…å†µï¼Œé‚£ä¹ˆæœºæˆ¿Bå› ä¸ºèŠ‚ç‚¹æ˜¯2ä¸ªï¼Œæ²¡æœ‰è¶…è¿‡ä¸€åŠï¼Œå°±ä¸ä¼šäº§ç”Ÿå‡ºæ–°çš„masterèŠ‚ç‚¹äº†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å†æ¥çœ‹æœ€åä¸€ç§æƒ…å†µï¼Œæ¯”å¦‚é›†ç¾¤ä¸­æœ‰5ä¸ªèŠ‚ç‚¹ï¼Œä¸€ä¸ªmasterå’Œ4ä¸ªslaveï¼Œåˆ†ä¸¤ä¸ªæœºæˆ¿ï¼Œä¸åŒçš„æ˜¯masterèŠ‚ç‚¹åœ¨æœºæˆ¿Bï¼Œå¦‚ä¸‹å›¾ï¼š&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1593420189914.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å¦‚æœå‘ç”Ÿäº†æœºæˆ¿ä¸èƒ½é€šä¿¡çš„æƒ…å†µï¼Œé‚£ä¹ˆæœºæˆ¿AèŠ‚ç‚¹æ˜¯3ä¸ªï¼Œè¶…è¿‡äº†ä¸€åŠï¼Œå°±ä¼šè¿›å…¥å´©åæ¢å¤æ¨¡å¼äº§ç”Ÿæ–°çš„masterèŠ‚ç‚¹ï¼Œé‚£ä¹ˆæ­¤æ—¶é›†ç¾¤ä¸­å°±ä¼šå‡ºç°ä¸¤ä¸ªmasterèŠ‚ç‚¹äº†ã€‚å¦‚ä¸‹å›¾æ‰€ç¤º&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1593420219104.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
é‚£ä¹ˆé‡åˆ°è¿™ç§æƒ…å†µZookeeperæ˜¯å¦‚ä½•å¤„ç†çš„ï¼Ÿç­”ï¼šæ—§çš„leaderæ‰€æœ‰çš„å†™è¯·æ±‚åŒæ­¥åˆ°å…¶ä»–followersèŠ‚ç‚¹æ˜¯ä¼šè¢«æ‹’ç»çš„ã€‚å› ä¸ºæ¯å½“æ–°leaderäº§ç”Ÿæ—¶ï¼Œä¼šç”Ÿæˆä¸€ä¸ªepochï¼Œè¿™ä¸ªepochæ˜¯é€’å¢çš„ï¼Œfollowerså¦‚æœç¡®è®¤äº†æ–°çš„leaderå­˜åœ¨ï¼ŒçŸ¥é“å…¶epochï¼Œå°±ä¼šæ‹’ç»epochå°äºç°ä»»leader epochçš„æ‰€æœ‰è¯·æ±‚ã€‚è¿™ä¸ªæ—¶å€™æ—§çš„masterè¿›å…¥æ¢å¤æ¨¡å¼è¿›è¡Œæ•°æ®åŒæ­¥ã€‚&lt;br&gt;
æ‰€ä»¥æŒ‰ç…§ä¸Šé¢çš„æƒ…å†µï¼Œæœºæˆ¿Açš„æ‰€æœ‰followersèŠ‚ç‚¹æ­£å¸¸é€šä¿¡ï¼Œæœºæˆ¿Bçš„æ‰€æœ‰èŠ‚ç‚¹é‡æ–°è¿›å…¥æ¢å¤æ¨¡å¼è¿›è¡Œæ•°æ®åŒæ­¥ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ€»ç»“ï¼šé€šè¿‡Quorumsæœºåˆ¶æ¥é˜²æ­¢è„‘è£‚ï¼Œå½“leaderæŒ‚æ‰ä¹‹åï¼Œå¯ä»¥é‡æ–°é€‰ä¸¾å‡ºæ–°çš„leaderèŠ‚ç‚¹ä½¿æ•´ä¸ªé›†ç¾¤è¾¾æˆä¸€è‡´ï¼›å½“å‡ºç°å‡æ­»ç°è±¡æ—¶ï¼Œé€šè¿‡epochå¤§å°æ¥æ‹’ç»æ—§çš„leaderå‘èµ·çš„è¯·æ±‚ï¼Œå½“å‡ºç°è¿™ç§æƒ…å†µï¼Œæ—§çš„leader è¿›å…¥æ¢å¤æ¨¡å¼è¿›è¡Œæ•°æ®åŒæ­¥ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¼•å‡ºå¥‡æ•°èŠ‚ç‚¹&#34;&gt;å¼•å‡ºå¥‡æ•°èŠ‚ç‚¹&lt;/h3&gt;
&lt;p&gt;â€ƒçŸ¥æ™“ä»¥ä¸Šåœºæ™¯åï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œ2å°æœºå™¨ä¹Ÿèƒ½é€‰ä¸¾å‡ºmasterï¼Œåªä¸è¿‡åªè¦æœ‰1ä¸ªæ­»äº†zookeeperå°±ä¸èƒ½ç”¨äº†ï¼Œå› ä¸º1æ²¡æœ‰è¿‡åŠã€‚æ‰€ä»¥2ä¸ªzookeeperçš„æ­»äº¡å®¹å¿åº¦ä¸º0ã€‚åŒç†ï¼Œè¦æ˜¯æœ‰3ä¸ªzookeeperï¼Œä¸€ä¸ªæ­»äº†ï¼Œè¿˜å‰©ä¸‹2ä¸ªæ­£å¸¸çš„ï¼Œè¿‡åŠäº†ï¼Œæ‰€ä»¥3ä¸ªzookeeperçš„å®¹å¿åº¦ä¸º1ã€‚å¦‚æœæŒ‰ç…§è¿™æ ·çš„æœºåˆ¶æ¨ç†ï¼Œé‚£ä¹ˆå¾—å‡º2-&amp;gt;0;3-&amp;gt;1;4-&amp;gt;1;5-&amp;gt;2;6-&amp;gt;2  å·¦è¾¹æ˜¯æ•°é‡ï¼Œå³è¾¹æ˜¯å®¹å¿åº¦ï¼Œæ‰€ä»¥2nå’Œ2n-1çš„å®¹å¿åº¦æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥å¯ä»¥å¾—å‡ºï¼Œé›†ç¾¤æ˜¯&lt;strong&gt;å¥‡æ•°ä¸ªèƒ½å¤ŸèŠ‚çœèµ„æº&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;!--ä¸‹é¢çš„å¥‡æ•°èŠ‚ç‚¹çš„ä½œç”¨éœ€è¦ç¡®è®¤ TODO--&gt;
&lt;h3 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h3&gt;
&lt;p&gt;ä»¥ä¸Šï¼Œç¬”è€…æ€»ç»“äº†ZABåè®®ï¼Œåˆ°Zookeeperé˜²æ­¢è„‘è£‚çš„åœºæ™¯ä»¥åŠå¦‚ä½•å¤„ç†ï¼Œä»¥åŠç»“åˆä¾‹å­ï¼ŒZookeeperé›†ç¾¤åœ¨å¥‡æ•°èŠ‚ç‚¹ä¸‹çš„ä½œç”¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ZooKeeperé›†ç¾¤çš„è„‘è£‚é—®é¢˜â€”â€”https://www.cnblogs.com/shoufeng/p/10591526.html&lt;/li&gt;
&lt;/ul&gt;
">å…³äºZookeeperå¥‡æ•°èŠ‚ç‚¹ä»¥åŠè„‘è£‚é—®é¢˜</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://zhangyaoo.github.io/post/jin-rong-ji-ye-wu-xia-fen-bu-shi-shi-wu-bao-zheng-shu-ju-yi-zhi-xing/"" data-c="
          &lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;éšç€åˆ†å¸ƒå¼æœåŠ¡æ¶æ„çš„æµè¡Œä¸æ™®åŠï¼ŒåŸæ¥åœ¨å•ä½“åº”ç”¨ä¸­æ‰§è¡Œçš„å¤šä¸ªé€»è¾‘æ“ä½œï¼Œç°åœ¨è¢«æ‹†åˆ†æˆäº†å¤šä¸ªæœåŠ¡ä¹‹é—´çš„è¿œç¨‹è°ƒç”¨ã€‚å¾®æœåŠ¡åŒ–åï¼Œéšç€å¸¦æ¥çš„æœåŠ¡ä¹‹é—´çš„åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨é‡‘èä¸šåŠ¡ä¸‹ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡æ˜¯ä¿è¯æ•°æ®ä¸€è‡´æ€§çš„é‡è¦ä¿è¯ã€‚æœ¬æ–‡ç€é‡ä¼šè®²åˆ†å¸ƒå¼äº‹åŠ¡åœºæ™¯å’Œä¸šç•Œä¸»æµçš„è§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;ä¸€-å¼•å…¥&#34;&gt;ä¸€ã€å¼•å…¥&lt;/h2&gt;
&lt;p&gt;â€ƒèµ„é‡‘è½¬è´¦åœ¨é‡‘èä¸šåŠ¡ä¸‹æ˜¯ä¸€ä¸ªéå¸¸é‡è¦è€Œä¸”å¸¸è§çš„åœºæ™¯ï¼Œå¦‚æœå› ä¸ºæŠ€æœ¯é—®é¢˜å¯¼è‡´èµ„é‡‘è½¬è´¦é”™è¯¯ï¼Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆæ— æ³•é¢„æµ‹çš„åæœã€‚&lt;br&gt;
â€ƒç¬”è€…è¿™é‡Œæ‹¿é“¶è¡Œè½¬è´¦çš„ä¾‹å­æ¥è¯´ï¼ˆè¿™é‡Œçš„è½¬è´¦æœ‰å¾ˆå¤šåœºæ™¯æ¯”å¦‚é“¶è¡Œå¡ä¹‹é—´å……å€¼æç°ã€é“¶è¡Œè´¦æˆ·ä¹‹é—´çš„è½¬è´¦ç­‰ç­‰ï¼‰ï¼Œæ¯”å¦‚ç”²é“¶è¡Œè´¦æˆ·Aå‘ä¹™é“¶è¡Œè´¦æˆ·Bè½¬è´¦1Wï¼š&lt;/p&gt;
&lt;p&gt;åŒæ­¥è°ƒç”¨ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Aé“¶è¡Œå¯¹è½¬å‡ºè´¦æˆ·æ‰§è¡Œæ£€æŸ¥æ ¡éªŒï¼Œè¿›è¡Œè´¦æˆ·é‡‘é¢æ‰£å‡ã€‚&lt;/li&gt;
&lt;li&gt;Aé“¶è¡ŒåŒæ­¥è°ƒç”¨Bé“¶è¡Œè½¬è´¦æ¥å£ã€‚&lt;/li&gt;
&lt;li&gt;Bé“¶è¡Œå¯¹è½¬å…¥è´¦æˆ·è¿›è¡Œæ£€æŸ¥æ ¡éªŒï¼Œè¿›è¡Œè´¦æˆ·é‡‘é¢å¢åŠ ã€‚&lt;/li&gt;
&lt;li&gt;Bé“¶è¡Œè¿”å›å¤„ç†ç»“æœç»™Aé“¶è¡Œã€‚&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1593745125729.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
åŒæ­¥è°ƒç”¨é—®é¢˜ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœBé“¶è¡Œå› ä¸ºç½‘ç»œåŸå› å¯¼è‡´æ¥å£ä¸é€šï¼Œé‚£ä¹ˆAè°ƒç”¨çº¿ç¨‹ä¼šé•¿æ—¶é—´é˜»å¡ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœAæ‰£å‡åï¼Œå‘é€è¯·æ±‚åï¼Œåœ¨ç½‘ç»œä¸­ä¸¢å¤±äº†ï¼ŒBé“¶è¡Œæ²¡æœ‰æ”¶åˆ°è¯·æ±‚ï¼Œå¯¼è‡´è´¦æˆ·Aæ‰£å‡äº†ï¼Œè´¦æˆ·Bæ²¡æœ‰åŠ &lt;/li&gt;
&lt;li&gt;å¦‚æœè´¦æˆ·Bæ‰£å‡æˆåŠŸäº†ï¼Œç”±äºæŸç§åŸå› æ¯”å¦‚ç½‘ç»œå¼‚å¸¸æ²¡æœ‰åŠæ—¶å›è°ƒç»™ç”²é“¶è¡Œï¼Œé‚£ä¹ˆè´¦æˆ·Aå°±è®¤ä¸ºæ˜¯å¼‚å¸¸è¯·æ±‚ï¼Œåˆ™ä¼šå›æ»šäº‹åŠ¡ï¼Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å†æ¥çœ‹ä¸€ä¸‹å¼‚æ­¥è°ƒç”¨ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Aé“¶è¡Œå¯¹è½¬å‡ºè´¦æˆ·æ‰§è¡Œæ£€æŸ¥æ ¡éªŒï¼Œè¿›è¡Œè´¦æˆ·é‡‘é¢æ‰£å‡ã€‚&lt;/li&gt;
&lt;li&gt;ä¸»çº¿ç¨‹å°†è¯·æ±‚æ•°æ®å¼‚æ­¥å†™å…¥é˜Ÿåˆ—MQ&lt;/li&gt;
&lt;li&gt;çœŸæ­£æ¶ˆè´¹è€…ç¨‹åºå¯¹Bé“¶è¡Œè¿›è¡Œè¿œç¨‹è°ƒç”¨&lt;/li&gt;
&lt;li&gt;Bé“¶è¡Œå¯¹è½¬å…¥è´¦æˆ·è¿›è¡Œæ£€æŸ¥æ ¡éªŒï¼Œè¿›è¡Œè´¦æˆ·é‡‘é¢å¢åŠ ã€‚&lt;/li&gt;
&lt;li&gt;Bé“¶è¡Œè¿”å›å¤„ç†ç»“æœç»™Aé“¶è¡Œã€‚&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1593743096206.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å¼‚æ­¥è°ƒç”¨é—®é¢˜ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœè´¦æˆ·Aæ‰£å‡æœ¬åœ°äº‹åŠ¡æˆåŠŸäº†ï¼Œä½†æ˜¯æ¶ˆæ¯å‘å‡ºåï¼Œå› ä¸ºç½‘ç»œåŸå› æˆ–è€…å…¶ä»–å®•æœºåŸå› ï¼Œå¯¼è‡´æ¶ˆæ¯æœªå‘é€æˆåŠŸï¼Œæ²¡æœ‰è¿›è¡ŒBè´¦æˆ·è¿œç¨‹è°ƒç”¨ï¼Œå¯¼è‡´æœ¬åœ°äº‹åŠ¡å’Œæ¶ˆæ¯ä¸ä¸€è‡´æ€§ã€‚&lt;/li&gt;
&lt;li&gt;MQæ¶ˆè´¹ç«¯ç¨‹åºå¦‚æœæ¶ˆè´¹æ¶ˆæ¯æˆåŠŸï¼Œè¯·æ±‚é“¶è¡ŒæˆåŠŸäº†ï¼Œä½†æ˜¯å›ä¼ ACKç»™MQå¤±è´¥äº†ï¼Œé‚£ä¹ˆå›å¯¼è‡´æ¶ˆè´¹ç«¯ç¨‹åºé‡å¤æ¶ˆè´¹é—®é¢˜ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°é‡å¤è½¬è´¦çš„é—®é¢˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¼‚æ­¥è°ƒç”¨è§£å†³äº†åŒæ­¥è°ƒç”¨çš„ä¸»çº¿ç¨‹é˜»å¡é—®é¢˜ï¼Œä½†è¿˜æ˜¯æ²¡æœ‰è§£å†³æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚è€Œä¸”å¼•å…¥MQä¸­é—´åï¼Œè¿˜è¦è€ƒè™‘åˆ°æœ¬åœ°äº‹åŠ¡å’ŒMQæ¶ˆæ¯ä¸€è‡´æ€§é—®é¢˜ï¼Œè¿˜æœ‰å…¶ä»–çš„å¼•å…¥åçš„ç»´æŠ¤å·¥ä½œï¼Œæ¯”å¦‚æ¶ˆæ¯ä¸¢å¤±ï¼Œæ¶ˆæ¯é‡å‘ç­‰ç­‰é—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;äºŒ-åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ&#34;&gt;äºŒã€åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ&lt;/h2&gt;
&lt;p&gt;â€ƒè®²åˆ°äº†åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œè‡ªç„¶ç¦»ä¸å¼€åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€äº›åŸºæœ¬åŸåˆ™å’Œå®šç†ï¼šCAPåŸåˆ™å’ŒBASEç†è®ºï¼Œç›¸ä¿¡è¯»è€…åº”è¯¥éƒ½çŸ¥é“ï¼Œè¿™é‡Œä¸åšè¿‡å¤šé˜è¿°ã€‚ä¸šç•Œæ ¹æ®è¿™äº›è§„åˆ™å’Œç†è®ºï¼Œè¡ç”Ÿå‡ºäº†å„ç§åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼šXAè§„èŒƒï¼Œ2PCï¼Œ3PCï¼Œæœ¬åœ°æ¶ˆæ¯è¡¨æ–¹æ¡ˆï¼ŒåŸºäºæ¶ˆæ¯ä¸­é—´ä»¶çš„æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆï¼ŒTCCæ–¹æ¡ˆï¼Œé˜¿é‡Œçš„SEATAï¼ŒSAGAæ–¹æ¡ˆå’Œæœ€å¤§åŠªåŠ›é€šçŸ¥ç­‰ç­‰ã€‚&lt;br&gt;
â€ƒä»¥ä¸Šæ¯ä¸ªæ–¹æ¡ˆéƒ½æœ‰è‡ªå·±çš„åº”ç”¨åœºæ™¯ï¼Œå°±æ‹¿2PCæ¥è¯´ï¼ŒMySQLçš„äº‹åŠ¡å‹æ—¥å¿—redologäºŒæ®µæäº¤ï¼ˆredolog(prepare)--ã€‹binlog--ã€‹redolog(commit)ï¼‰ä¿è¯binlogå’Œredologæ•°æ®ä¸€è‡´æ€§ï¼ŒZookeeperçš„proposaläº‹åŠ¡äºŒæ®µæäº¤ï¼ˆåŠæ•°ä»¥ä¸Šackè¿”å›æˆåŠŸè¡¨ç¤ºå†™å…¥æ•°æ®æˆåŠŸï¼‰ä¿è¯leaderå’Œfollerçš„æ•°æ®ä¸€è‡´æ€§ï¼Œè¿™äº›éƒ½æ˜¯2PCçš„åº”ç”¨ã€‚&lt;br&gt;
â€ƒé‡‘èåœºæ™¯ä¸‹ç±»ä¼¼èµ„é‡‘ä¸šåŠ¡éœ€è¦ä¿è¯æœ€ç»ˆä¸€è‡´æ€§è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œä¸éœ€è¦ä¿è¯è½¬è´¦å®æ—¶æ€§ã€‚æ‰€ä»¥æœ¬åœ°æ¶ˆæ¯è¡¨ã€åŸºäºMQä¸­é—´ä»¶çš„æœ€ç»ˆä¸€è‡´æ€§ç­‰æŸ”æ€§æ–¹æ¡ˆæ˜¯é¦–é€‰çš„æ–¹æ¡ˆã€‚è¿™äº›åŸºäºæ¶ˆæ¯çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ï¼Œæœ¬åœ°äº‹åŠ¡+ä»äº‹åŠ¡ï¼Œä»äº‹åŠ¡ä»æ¶ˆæ¯ä¸­è·å–ä¿¡æ¯è¿›è¡Œæœ¬åœ°æäº¤ï¼Œè¿™é‡Œä¿æŒ&lt;strong&gt;å¼‚æ­¥äº‹åŠ¡æœºåˆ¶ã€åªèƒ½ä¿è¯æœ€ç»ˆä¸€è‡´æ€§&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;21-åˆ©ç”¨æœ¬åœ°æ¶ˆæ¯è¡¨æ€æƒ³è§£å†³ä¸€è‡´æ€§é—®é¢˜&#34;&gt;2.1 åˆ©ç”¨æœ¬åœ°æ¶ˆæ¯è¡¨æ€æƒ³è§£å†³ä¸€è‡´æ€§é—®é¢˜&lt;/h3&gt;
&lt;p&gt;â€ƒä¸€èˆ¬æ¥è¯´ï¼Œè·¨è¡Œè½¬è´¦çš„åŸç†ï¼Œä¼šå­˜åœ¨ä¸€ä¸ªä¸­å›½äººæ°‘é“¶è¡Œçš„ä¸­é—´äººè§’è‰²æ¥æ“ä½œè½¬è´¦ï¼Œä½†ä¸åœ¨æœ¬æ¬¡è®¨è®ºçš„èŒƒå›´å†…ã€‚&lt;br&gt;
â€ƒä¸šç•Œé“¶è¡Œè½¬è´¦å¤§éƒ¨åˆ†éƒ½æ˜¯åŒæ­¥è½¬è´¦ï¼Œå¼‚æ­¥è·å–è½¬è´¦ç»“æœï¼ŒåŒ…æ‹¬ç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°å¯¹æ¥é“¶è¡Œéƒ½æ˜¯è¿™æ ·ç©çš„ã€‚è¿™é‡Œç¬”è€…å°±åˆ©ç”¨æœ¬åœ°æ¶ˆæ¯è¡¨æ€æƒ³æ¥å…·ä½“å™è¿°æ•°æ®ä¸€è‡´æ€§æ˜¯å¦‚ä½•ä¿è¯çš„ï¼Œè€è§„çŸ©å…ˆæ”¾å›¾ï¼š&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1603274563955.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å…¶ä¸­äº¤æ˜“è®°å½•è¡¨å¤§æ¦‚é•¿è¿™ä¸ªæ ·å­ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;å­—æ®µ&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;id&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;è‡ªå¢IDï¼Œæ²¡æœ‰ä¸šåŠ¡æ„ä¹‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;trade_order_num&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;äº¤æ˜“è®¢å•å·ï¼Œä½œä¸ºè½¬è´¦è®°å½•å”¯ä¸€æ ‡è¯†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;source_account_num&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;äº¤æ˜“è½¬å‡ºæ–¹è´¦æˆ·ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;target_account_num&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;äº¤æ˜“æ”¶æ¬¾æ–¹è´¦æˆ·ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;status&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;çŠ¶æ€æœºï¼Œ0=é¢„åˆ›å»ºï¼Œ1=è½¬è´¦ä¸­ï¼Œ2=è½¬è´¦æˆåŠŸï¼Œ3=è½¬è´¦å¤±è´¥&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;pay_success_time&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;è®°å½•è½¬è´¦æˆåŠŸæ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;create_time&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;è®°å½•åˆ›å»ºæ—¶é—´ï¼Œå¯ä½œä¸ºçª—å£æ—¶é—´å†…åˆ¤æ–­æ ‡å‡†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;update_time&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;è®°å½• æ›´æ–°æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è´¦æˆ·è¡¨å¤§æ¦‚é•¿è¿™ä¸ªæ ·å­ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;å­—æ®µ&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;id&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;è‡ªå¢IDï¼Œæ²¡æœ‰ä¸šåŠ¡æ„ä¹‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;account_num&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;è´¦æˆ·ID&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;current_amt&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;å½“å‰è´¦æˆ·ä½™é¢&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;lock_amt&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;å†»ç»“é‡‘é¢ï¼Œç”¨æ¥è®°å½•ä¸´æ—¶çŠ¶æ€çš„æ ¸å¿ƒè½¬è´¦æ•°æ® ã€‚çœŸå®ä½™é¢=current_amt-lock_amt&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å›¾ä¸­çš„æ­¥éª¤å¤§è‡´åˆ†ä¸º8æ­¥ï¼Œè¿™é‡Œç»†è‡´è®²ä¸€ä¸‹æ¯ä¸€æ­¥çš„è¯¦ç»†æ­¥éª¤ï¼Œåˆ†åˆ«æ˜¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ’å…¥åˆå§‹çŠ¶æ€çš„äº¤æ˜“æ•°æ®ã€‚ è¿™ä¸€æ­¥éª¤çš„ç›®çš„æ˜¯ä¿è¯å‘èµ·åŒæ­¥è½¬è´¦è¯·æ±‚å’Œæœ¬åœ°åˆå§‹äº‹åŠ¡ä¸€è‡´æ€§ï¼Œè¿˜æœ‰ä¸€ä¸ªç›®çš„å°±æ˜¯ç”Ÿæˆè½¬è´¦è®°å½•å”¯ä¸€æ ‡è¯†ï¼Œç”¨æ¥æ ‡è¯†æœ¬æ¬¡è½¬è´¦&lt;/li&gt;
&lt;li&gt;åŒæ­¥å‘èµ·è½¬è´¦è¯·æ±‚ï¼Œå¸¦ä¸Šå”¯ä¸€æ ‡è¯†ä»¥åŠå…¶ä»–çš„ä¸šåŠ¡å‚æ•°&lt;/li&gt;
&lt;li&gt;é“¶è¡Œä¹™ä¼šæ ¡éªŒå‚æ•°ä¿¡æ¯ï¼Œå¹¶ä¸”åŒæ­¥è¿”å›è½¬è´¦é€šçŸ¥ï¼Œç±»ä¼¼â€œæˆ‘æ¥æ”¶åˆ°äº†ä½ çš„è¯·æ±‚äº†ï¼Œæˆ‘è¿˜æœ‰å…¶ä»–äº‹æƒ…ï¼Œæˆ‘ç­‰ä¼šè¿”å›ç»“æœç»™ä½ â€&lt;/li&gt;
&lt;li&gt;ä¼šæ ¹æ®åŒæ­¥çš„è½¬è´¦é€šçŸ¥æ¥åˆ¤æ–­è¿™æ¬¡äº¤æ˜“æ˜¯å¦åˆæ³•ï¼Œç„¶åä¼šè®°å½•ç»“æœåˆ°äº¤æ˜“è¡¨ä¸­ã€‚è¿™é‡Œå¹¶ä¸”éœ€è¦å†»ç»“è´¦æˆ·çš„ä¸€éƒ¨åˆ†é‡‘é¢ï¼Œä½œä¸ºä¸´æ—¶ä¸­é—´æ€æ•°æ®ã€‚å¹¶ä¸”éœ€è¦æ›´æ–°æœ¬åœ°äº¤æ˜“è¡¨çŠ¶æ€ä¸ºè½¬è´¦ä¸­&lt;/li&gt;
&lt;li&gt;é“¶è¡Œä¹™éœ€è¦è®°å½•æœ¬æ¬¡äº¤æ˜“è®°å½•ï¼Œæ’å…¥ä¸€æ¡äº¤æ˜“ä¸­çš„æ•°æ®ï¼Œç›´è‡³å›è°ƒè½¬è´¦ç»“æœç»™é“¶è¡Œç”²ï¼Œå°†è¿™æ¡è®°å½•ç½®ä¸ºè½¬è´¦æˆåŠŸã€‚å¹¶ä¸”é“¶è¡Œä¹™è‡ªå·±ç”Ÿæˆçš„æ”¶æ¬¾äº¤æ˜“æµå·ï¼Œç„¶åæ”¾å…¥åˆ°å›è°ƒç»“æœä¸­ï¼Œä¼ ç»™é“¶è¡Œç”²&lt;/li&gt;
&lt;li&gt;å¼‚æ­¥å›è°ƒç»“æœç»™é“¶è¡Œç”²ï¼Œå…¶ä¸­å›è°ƒå‚æ•°é‡è¦çš„æœ‰é“¶è¡Œç”²çš„å”¯ä¸€çš„è½¬è´¦æ ‡è¯†ï¼Œè¿˜æœ‰é“¶è¡Œä¹™è‡ªå·±ç”Ÿæˆçš„æ”¶æ¬¾äº¤æ˜“æµå·&lt;/li&gt;
&lt;li&gt;æ ¹æ®å¼‚æ­¥å›è°ƒçš„çŠ¶æ€ï¼Œæ›´æ–°äº¤æ˜“çŠ¶æ€æ•°æ®ï¼Œå¦‚æœæˆåŠŸï¼Œé‚£ä¹ˆä¼šæ‰£å‡è´¦ä½™é¢ï¼Œå¹¶ä¸”é‡Šæ”¾å†»ç»“é‡‘é¢ï¼Œå¦‚æœå¤±è´¥ï¼Œç›´æ¥é‡Šæ”¾å†»ç»“é‡‘é¢ã€‚æ­¤æ—¶ç®—æ˜¯æ­£å¸¸çš„ä¸€æ¡&lt;strong&gt;æµç¨‹é—­ç¯&lt;/strong&gt;èµ°å®Œ&lt;/li&gt;
&lt;li&gt;å½“ç„¶ä¸æ˜¯æ‰€æœ‰çš„ä¸šåŠ¡èƒ½å¤Ÿæ­£å¸¸èµ°å®Œæµç¨‹é—­ç¯ï¼Œä¹Ÿä¼šå‡ºç°å„ç§åŸå› å¯¼è‡´ä¸èƒ½èµ°å®Œã€‚ä¸ºäº†ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œä¼šå¢åŠ ä¸€ä¸ªè¡¥å¿ç¨‹åºï¼Œå®šæ—¶å»æ‹‰å–å¼‚å¸¸æ•°æ®ï¼Œå¼‚å¸¸æ•°æ®æŒ‡çš„æ˜¯äº¤æ˜“çŠ¶æ€ä¸º0å’Œ1å¹¶ä¸”&lt;strong&gt;ä¸åœ¨æ­£å¸¸çª—å£ä¸šåŠ¡&lt;/strong&gt;æ—¶é—´å†…çš„æ•°æ®ï¼ˆ0å’Œ1å±äºä¸­é—´æ€ï¼Œè€Œ2æˆ–è€…3æ•°æ®ç»ˆæ€ï¼‰ï¼Œçª—å£æ—¶é—´æŒ‡çš„æ˜¯æ­£å¸¸ä¸šåŠ¡ä»å¼€å§‹åˆ°ç»“æŸçš„æ—¶é—´ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœå¼‚å¸¸æ•°æ®çŠ¶æ€æ˜¯0ï¼Œé‚£ä¹ˆè¡¨ç¤ºæœ‰å¯èƒ½æ˜¯æœ¬åœ°æ›´æ–°äº‹åŠ¡å¤±è´¥äº†ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯è¯·æ±‚æˆ–è€…è¿”å›åœ¨ç½‘ç»œä¸­ä¸¢å¤±äº†ï¼Œè¡¥å¿ç¨‹åºé‡Œé¢ä¼šæ ¹æ®æœ¬åœ°çš„è¡¨æ•°æ®åˆ¤æ–­æ˜¯å“ªä¸ªæ­¥éª¤é™¤é—®é¢˜äº†ï¼Œå°±æ¯”å¦‚è¯´æœ¬åœ°æ•°æ®æ²¡æœ‰é“¶è¡Œä¹™çš„äº¤æ˜“æµæ°´å·ï¼Œé‚£ä¹ˆå°±æ˜¯ç½‘ç»œå‡ºé—®é¢˜äº†ï¼Œåé¢å°±å¯ä»¥è¿›è¡Œè¡¥å¿æ“ä½œ&lt;/li&gt;
&lt;li&gt;å¦‚æœå¼‚å¸¸æ•°æ®çŠ¶æ€æ˜¯1ï¼Œé‚£ä¹ˆè¡¨ç¤ºå¯èƒ½æ˜¯é“¶è¡Œä¹™æ¥å£æœ‰é—®é¢˜æˆ–è€…ç½‘ç»œæœ‰é—®é¢˜åŸå› å¯¼è‡´æ²¡æœ‰åŠæ—¶å›è°ƒï¼Œè¿™ä¸ªæ—¶å€™è¡¥å¿ç¨‹åºå°±ç”¨é“¶è¡Œä¹™çš„äº¤æ˜“æµæ°´å·æ˜¯å»æŸ¥è¯¢äº¤æ˜“æ˜¯å¦å®Œæˆï¼Œç„¶åæ›´æ–°è‡ªå·±æœ¬åœ°çš„æ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸Šæµç¨‹æ˜¯ä¸€æ¬¡æ­£å¸¸çš„äº¤æ˜“è¿‡ç¨‹ï¼Œå½“ç„¶ä¸æ˜¯æ‰€æœ‰çš„äº¤æ˜“æµç¨‹éƒ½æ˜¯è¿™æ ·èµ°çš„ï¼Œä¸è¿‡å¤§éƒ¨åˆ†è½¬è´¦æµç¨‹å’Œä¸Šè¿°æ­¥éª¤ç›¸ç±»ä¼¼ï¼Œå…¶ä¸­çš„ç»†è‡´æ­¥éª¤åœ¨æ¯ä¸ªäº¤æ˜“ç³»ç»Ÿä¸­ç•¥æœ‰ä¸åŒã€‚&lt;/p&gt;
&lt;p&gt;æ€»ç»“èµ·æ¥ï¼Œåˆ©ç”¨æœ¬åœ°æ¶ˆæ¯è¡¨æ€æƒ³èƒ½å¤Ÿè§£å†³ä¸Šé¢ç¬¬ä¸€éƒ¨åˆ†æ–‡ç« çš„åŒæ­¥è°ƒç”¨çš„ç¼ºç‚¹ï¼Œèƒ½å¤Ÿè§£å†³ç¬¬äºŒä¸ªç¬¬ä¸‰ ä¸ªé—®é¢˜ï¼Œä½†æ˜¯ç¬¬ä¸€ä¸ªé—®é¢˜å°±æ— æ³•è§£å†³äº†ï¼Œåªè¦æ˜¯åŒæ­¥è°ƒç”¨éƒ½ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œä¸è¿‡æœ‰å…¶ä»–æ–¹å¼å»è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä»¥ç¬”è€…è®¤çŸ¥æ¥è¯´ï¼Œé“¶è¡Œè½¬è´¦çš„ä¸šåŠ¡éƒ½æ˜¯åŒæ­¥è°ƒç”¨çš„ã€‚å‡ºç°æ¥å£é˜»å¡è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œå¦‚æœè¶…è¿‡è¶…æ—¶æ—¶é—´ï¼Œå°±è®°å½•ä¸‹è¿™æ¡äº¤æ˜“ï¼Œå¼‚æ­¥æ”¾å…¥&lt;strong&gt;é‡è¯•é˜Ÿåˆ—&lt;/strong&gt;ï¼Œä¸€æ®µæ—¶é—´åè¿›è¡Œ&lt;strong&gt;é‡è¯•&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;22-äº‹åŠ¡æ¶ˆæ¯è§£å†³æœ¬åœ°äº‹åŠ¡å’Œmqæ¶ˆæ¯ä¸€è‡´æ€§é—®é¢˜&#34;&gt;2.2 äº‹åŠ¡æ¶ˆæ¯è§£å†³æœ¬åœ°äº‹åŠ¡å’ŒMQæ¶ˆæ¯ä¸€è‡´æ€§é—®é¢˜&lt;/h3&gt;
&lt;p&gt;â€ƒè½¬è´¦ä¸šåŠ¡ï¼Œå¦‚æœç”¨å¼‚æ­¥çš„è¯ï¼Œå½“å‡ºç°MQé—®é¢˜æˆ–è€…æ¶ˆè´¹ä¹Ÿè€…ç¨‹åºå‡ºç°æ¶ˆæ¯æŒ¤å‹æˆ–è€…æ¶ˆè´¹è€…ç«¯å‡ºç°é—®é¢˜ çš„è¯ï¼Œé‚£ä¹ˆæ•´ä¸ªä¸šåŠ¡æ—¶é—´çº¿ä¼šæ‹‰çš„éå¸¸é•¿ã€‚æ‰€ä»¥ç¬”è€…è®¤ä¸ºå¼‚æ­¥ä¸é€‚åˆè¿™ç§ä¸šåŠ¡ï¼Œå¼‚æ­¥&lt;strong&gt;æœ¬è´¨ä¸Š&lt;/strong&gt;æ˜¯å¯¹ä¸‹æ¸¸æœåŠ¡çš„ä¸€ä¸ªç¼“å†²ï¼Œé€‚åˆåœ¨è‡ªå·±ç³»ç»Ÿä¸­ä½¿ç”¨ï¼Œä¸é€‚åˆè·¨ç³»ç»Ÿæˆ–è€…ä¸‰æ–¹è°ƒç”¨ã€‚å½“ç„¶ä¸æ˜¯æ‰€æœ‰çš„åœºæ™¯éƒ½ä¸åˆé€‚ï¼Œå¦‚æœæµé‡éå¸¸å¤§è¯ï¼Œå¯¹æ–¹ç³»ç»Ÿæœ‰é™æµæœºåˆ¶ï¼Œä½¿ç”¨MQä¹Ÿç®—æ˜¯ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œè¿™è¿˜æ˜¯çœ‹å…·ä½“ä¸šåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;â€ƒä»€ä¹ˆæ ·çš„åœºæ™¯é€‚åˆä½¿ç”¨MQï¼Ÿä¸€èˆ¬æ¥è¯´åœ¨éœ€è¦é™æµå‰Šå³°ã€å¼‚æ­¥è§£è€¦ç­‰åœºæ™¯ä½¿ç”¨ï¼Œæ‰€ä»¥è¿˜æ˜¯æ‹¿ä¸Šé¢çš„å›¾ï¼Œå›¾ä¸­æ ‡æ¡†çš„éƒ¨åˆ†ä¸šåŠ¡é€‚åˆç”¨MQæ¥è§£å†³&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1603790962781.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;p&gt;â€ƒå¦‚æœç”¨MQæ¥åšçš„è¯ï¼Œé‚£ä¹ˆä¼šæœ‰å¦‚ä¸‹å›¾æ­¥éª¤ï¼š&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1603792233049.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å›¾ä¸­çš„æ­¥éª¤å¤§è‡´åˆ†ä¸º6æ­¥ï¼Œè¿™é‡Œç»†è‡´è®²ä¸€ä¸‹æ¯ä¸€æ­¥çš„è¯¦ç»†æ­¥éª¤ï¼Œåˆ†åˆ«æ˜¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ¶ˆæ¯ç”Ÿæˆè€…å‘é€æ¶ˆæ¯ï¼Œbrokeræ¥å—æ¶ˆæ¯&lt;/li&gt;
&lt;li&gt;MQ brokeræ”¶åˆ°æ¶ˆæ¯ï¼Œéšå³å°†æ¶ˆæ¯è¿›è¡ŒæŒä¹…åŒ–ï¼Œå¹¶ä¸”å­˜å…¥åº“ã€‚è¿™ä¸€æ­¥æ˜¯é˜²æ­¢MQå› ä¸ºç‰©ç†åŸå› å®•æœºå¯¼è‡´çš„æ¶ˆæ¯ä¸¢å¤±ï¼Œå¹¶ä¸”å…¥åº“çš„æ—¶å€™è¦åˆ¤æ–­å¹‚ç­‰ï¼Œé˜²æ­¢æ²¡æœ‰åŠæ—¶è¿”å›ackï¼Œå¯¼è‡´ç”Ÿäº§è€…é‡å‘æ¶ˆæ¯ã€‚&lt;/li&gt;
&lt;li&gt;è¿”å›ACKç»™ç”Ÿäº§è€…ã€‚å¦‚æœä¸åŠæ—¶è¿”å›æˆ–è€…é•¿æ—¶é—´æ²¡æœ‰è¿”å›ï¼Œç”Ÿäº§è€…ä¼šè®¤ä¸ºè¿™æ¡æ¶ˆæ¯å‘é€å¤±è´¥ï¼Œä¼šé‡æ–°å‘é€ã€‚&lt;/li&gt;
&lt;li&gt;MQ pushæ¶ˆæ¯ç»™å¯¹åº”çš„æ¶ˆè´¹è€…æˆ–è€…æ¶ˆè´¹è€…ä¸»åŠ¨æ¥pullæ¶ˆæ¯ï¼Œç„¶åç­‰å¾…æ¶ˆè´¹è€…è¿”å›ACK&lt;/li&gt;
&lt;li&gt;å¦‚æœæ¶ˆæ¯æ¶ˆè´¹è€…åœ¨æŒ‡å®šæ—¶é—´å†…æˆåŠŸè¿”å›ackï¼Œé‚£ä¹ˆMQè®¤ä¸ºæ¶ˆæ¯æ¶ˆè´¹æˆåŠŸï¼Œåœ¨å­˜å‚¨ä¸­åˆ é™¤æ¶ˆæ¯ï¼Œå³æ‰§è¡Œç¬¬6æ­¥ï¼›å¦‚æœMQåœ¨æŒ‡å®šæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°ACKï¼Œåˆ™è®¤ä¸ºæ¶ˆæ¯æ¶ˆè´¹å¤±è´¥ï¼Œä¼šå°è¯•é‡æ–°pushæˆ–è€…pullæ¶ˆæ¯,é‡å¤æ‰§è¡Œ4ã€5ã€6æ­¥éª¤&lt;/li&gt;
&lt;li&gt;MQåˆ é™¤æ¶ˆæ¯&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;â€ƒä»¥ä¸Šä¸ºä¸€æ¡æ­£å¸¸çš„æ¶ˆæ¯ä»ç”Ÿäº§åˆ°æ¶ˆè´¹çš„è¿‡ç¨‹ï¼Œæ¯ä¸€æ­¥éƒ½æ˜¯ä¸å¯æˆ–ç¼ºçš„ã€‚è€Œä¸”æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå½“å¼•å…¥ä¸­é—´ä»¶MQåï¼Œæ¶ˆè´¹ç«¯ä¸šåŠ¡éœ€è¦ä¿æŒå¹‚ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;â€ƒå›åˆ°ä¸Šé¢æ–‡ç« æœ€å¼€å§‹çš„éƒ¨åˆ†ï¼Œå¹¶æ²¡æœ‰è§£å†³å¼‚æ­¥è°ƒç”¨é—®é¢˜ä¸€ã€‚æ²¡æœ‰å½»åº•è§£å†³æœ¬åœ°äº‹åŠ¡å’Œæ¶ˆæ¯ä¸ä¸€è‡´æ€§ã€‚æ‰€ä»¥è¿™ä¸ªæ—¶å€™ï¼Œå°±éœ€è¦äº‹åŠ¡æ¶ˆæ¯è§£å†³æœ¬åœ°äº‹åŠ¡å’ŒMQæ¶ˆæ¯ä¸€è‡´æ€§é—®é¢˜äº†ï¼Œç¬”è€…é‡æ–°ç”»äº†ä¸€å¼ å›¾æ¥è¯´æ˜ä¸€ä¸‹äº‹åŠ¡æ¶ˆæ¯æ˜¯å¦‚ä½•åšçš„ï¼š&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1603873494446.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å›¾ä¸­çš„æ­¥éª¤å¤§è‡´åˆ†ä¸ºå‡ æ­¥ï¼Œåˆ†åˆ«æ˜¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç”Ÿäº§è€…å‘é€ä¸€æ¡prepareæ¶ˆæ¯&lt;/li&gt;
&lt;li&gt;MQæ¥å—åˆ°æ¶ˆæ¯åï¼Œå…ˆè¿›è¡ŒæŒä¹…åŒ–,çŠ¶æ€ä¸ºå¾…ç¡®è®¤çš„æ¶ˆæ¯&lt;/li&gt;
&lt;li&gt;è¿”å›ACKç»™æ¶ˆæ¯ç”Ÿäº§è€…&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼šæ‰£å‡è´¦æˆ·ä½™é¢ï¼Œæ’å…¥äº¤æ˜“æµæ°´ã€‚å¦‚æœè¿™ä¸ªäº‹åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œé‚£ä¹ˆç›¸å½“äºä¸šåŠ¡æ‰§è¡Œå¤±è´¥ï¼ŒæŠ›ç»™ç”¨æˆ·äº¤æ˜“å¤±è´¥&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œå®Œæˆåï¼Œå°†ç»“æœå‘é€æ‰§è¡Œç»“æœç»™MQ&lt;/li&gt;
&lt;li&gt;æ ¹æ®ç»“æœå°†æ¶ˆæ¯commitæˆ–è€…rollback  commitï¼šå°†æ¶ˆæ¯çŠ¶æ€ç½®ä¸ºå·²ç¡®è®¤  rollbackï¼šå°†æ¶ˆæ¯åˆ é™¤&lt;/li&gt;
&lt;li&gt;é‡‡ç”¨pullæˆ–è€…pushæ¶ˆè´¹å·²ç¡®è®¤çš„æ¶ˆæ¯ ï¼Œåé¢æµç¨‹å¤§è‡´å’Œæ™®é€šçš„æµç¨‹éƒ½ä¸€æ ·&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;â€ƒè¿™é‡Œè¿˜æ²¡æœ‰ä½“ç°å¦å¤–ä¸€ä¸ªæµç¨‹ï¼Œå°±æ˜¯å¦‚æœæ¶ˆæ¯å¾…ç¡®è®¤çŠ¶æ€åœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰è½¬æ¢ä¸ºå·²ç¡®è®¤ï¼Œé‚£ä¹ˆMQä¼šå›æŸ¥æœ¬åœ°äº‹åŠ¡æ‰§è¡ŒçŠ¶æ€æ˜¯å¦æˆåŠŸã€‚è¿™ä¸ªæ˜¯ä¸ºäº†ä¿è¯åœ¨ç¬¬äº”æ­¥å‘é€çš„æ¶ˆæ¯åœ¨ç½‘ç»œä¸­ä¸¢å¤±æˆ–è€…æ¶ˆè´¹è€…å®•æœºç­‰æƒ…å†µä¸‹ï¼Œèƒ½å¤Ÿå›æ»šã€‚&lt;br&gt;
â€ƒä»¥ä¸Šæ˜¯äº‹åŠ¡æ¶ˆæ¯å¤§è‡´çš„æµç¨‹ï¼Œèƒ½å¤Ÿè§£å†³æœ¬åœ°äº‹åŠ¡å’ŒMQæ¶ˆæ¯ä¸€è‡´æ€§é—®é¢˜ï¼Œè¿™é‡Œå¼ºè°ƒçš„æ˜¯ï¼Œä¸ç®¡æ˜¯æ˜¯äº‹åŠ¡æ¶ˆæ¯è¿˜æ˜¯æ™®é€šçš„æ¶ˆæ¯ï¼Œæ¶ˆè´¹ç«¯éƒ½éœ€è¦åšå¹‚ç­‰å¤„ç†ã€‚&lt;br&gt;
â€ƒæ€»ç»“æ¥è¯´ï¼Œ&lt;strong&gt;ack+è¡¥å¿+é‡è¯•+å¹‚ç­‰&lt;/strong&gt;æ˜¯ä¿è¯ä¸€è‡´æ€§çš„å…³é”®ã€‚&lt;/p&gt;
&lt;h4 id=&#34;221-äº‹åŠ¡æ¶ˆæ¯å¸¸è§é—®é¢˜&#34;&gt;2.2.1 äº‹åŠ¡æ¶ˆæ¯å¸¸è§é—®é¢˜&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;å¦‚æœconsumeræ¶ˆè´¹å¤±è´¥ï¼Œæ˜¯å¦éœ€è¦produceråšå›æ»šå‘¢ï¼Ÿ&lt;br&gt;
ä¸éœ€è¦ï¼ŒMQä½œç”¨è¦ä¿è¯çš„å°±æ˜¯&lt;strong&gt;æœ€ç»ˆä¸€è‡´æ€§&lt;/strong&gt;ï¼Œå¦‚æœconsumeræ¶ˆè´¹å¤±è´¥ï¼Œå°±è®©å®ƒè¿›è¡Œé‡è¯•ç›´è‡³æˆåŠŸã€‚å¦‚æœé‡è¯•è¶…è¿‡ä¸€å®šæ¬¡æ•°çš„è¯ï¼Œé‚£ä¹ˆå°±äººå·¥ä»‹å…¥ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;ä¸‰-å…¶ä»–æ–¹å¼ä¿è¯æ•°æ®ä¸€è‡´æ€§&#34;&gt;ä¸‰ã€ å…¶ä»–æ–¹å¼ä¿è¯æ•°æ®ä¸€è‡´æ€§&lt;/h2&gt;
&lt;p&gt;â€ƒå½“ç„¶ï¼Œä¿æŒæ•°æ®ä¸€è‡´æ€§ä¸å…‰æ˜¯åˆ†å¸ƒå¼äº‹åŠ¡æ¥ä¿è¯ï¼Œä¸šåŠ¡ä¸Šè¿˜è¦é…åˆå…¶ä»–çš„è¾…åŠ©æ¥ä¿è¯ï¼Œè¿™é‡Œç¬”è€…å°±åˆ—ä¸¾å‡ ç§&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å…¨é“¾è·¯å¹‚ç­‰&lt;br&gt;
å…¨é“¾è·¯å¹‚ç­‰ä¿è¯ä¸äº§ç”Ÿè„æ•°æ®ï¼Œä¿æŠ¤æ ¸å¿ƒæµç¨‹æ­£å¸¸æ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;é‡è¯•æœºåˆ¶&lt;br&gt;
å¯¹å¼‚å¸¸ä¸šåŠ¡è¿›è¡Œé‡è¯•ï¼Œè¶…è¿‡æŒ‡å®šé‡è¯•æ¬¡æ•°ä»å¤±è´¥çš„è¿›è¡Œäººå·¥ä»‹å…¥ã€‚&lt;/li&gt;
&lt;li&gt;ä¸šåŠ¡å¯¹è´¦&lt;br&gt;
ä¸šåŠ¡å†…éƒ¨å‡†å®æ—¶å¯¹è´¦ï¼Œæ¯”å¦‚ä¸šåŠ¡å‘ç”Ÿåå……å€¼æç°ï¼Œå¯¹æ¯”ç”¨æˆ·ä½™é¢æ˜¯å¦æ­£ç¡®ï¼Œç”¨æˆ·ä¸šåŠ¡æµæ°´æ˜¯å¦æ­£ç¡®ã€‚&lt;br&gt;
T+1æ—¥å¯¹è´¦ï¼Œç¨‹åºæˆ–è€…äººå·¥å®šæ—¶æ‰«ææ ¸å¿ƒä¸šåŠ¡æ•°æ®ï¼Œä¿è¯å½“æ—¥æ•°æ®å‡†ç¡®ã€‚å¯¹è´¦åè‡ªåŠ¨æ£€æµ‹å¹¶ä¸”ä¿®å¤é‡è¯•ä¸šåŠ¡&lt;/li&gt;
&lt;li&gt;ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§&lt;br&gt;
ç›‘æ§æ•°æ®åº“ä¸­çš„è®¢å•é¢„å èµ„é‡‘æ²¡æœ‰é‡Šæ”¾ï¼ŒçŠ¶æ€æœºæ˜¯ä¸æ˜¯æœ€ç»ˆæ€ç›‘æ§ï¼Œå•ä½çª—å£æ—¶é—´å†…ä¸šåŠ¡çŠ¶æ€æ˜¯å¦å¼‚å¸¸ï¼Œè´¦æˆ·ä¸­çš„é¢„æ‰£å‡é‡‘é¢æ˜¯å¦é‡Šæ”¾ï¼Œä¸šåŠ¡é‡è¯•æ¬¡æ•°æ˜¯å¦è¶…è¿‡é˜ˆå€¼ç­‰ç­‰ä¸šåŠ¡ç›‘æ§ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;å››-æ€»ç»“&#34;&gt;å››ã€æ€»ç»“&lt;/h2&gt;
&lt;p&gt;â€ƒåˆ†å¸ƒå¼åœºæ™¯ï¼Œè¦ç”¨åˆ†å¸ƒå¼çš„æ€ç»´å»æ€è€ƒé—®é¢˜ã€‚è¦è€ƒè™‘ä»»ä½•çš„è¶…æ—¶ï¼Œæ–­ç”µï¼Œç»´æŠ¤ä¸åŒç‰©ç†å­˜å‚¨çš„æ•°æ®çš„å¯èƒ½å­˜åœ¨çš„çŠ¶æ€ä¸ä¸€è‡´çš„åœºæ™¯ï¼Œè¯´ç™½äº†è¦é¢å‘å¤±è´¥ç¼–ç¨‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;äº”-å‚è€ƒ&#34;&gt;äº”ã€å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;æœ‰èµå‡ºé‡‘ç³»ç»Ÿâ€”â€”https://tech.youzan.com/build-a-withdraw-sys/&lt;/li&gt;
&lt;li&gt;åˆ†å¸ƒå¼äº‹åŠ¡çš„æ€è€ƒâ€”â€”https://www.cnblogs.com/sujing/p/11006424.html&lt;/li&gt;
&lt;li&gt;é˜¿é‡Œäº‘RocketMQæ–‡æ¡£â€”â€”https://help.aliyun.com/document_detail/43348.html&lt;/li&gt;
&lt;/ul&gt;
">é‡‘èçº§ä¸šåŠ¡ä¸‹åˆ†å¸ƒå¼äº‹åŠ¡ä¿è¯æ•°æ®ä¸€è‡´æ€§</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://zhangyaoo.github.io/post/er-jin-zhi-fan-zhuan/"" data-c="
          &lt;h4 id=&#34;é¢˜ç›®æè¿°&#34;&gt;é¢˜ç›®æè¿°&lt;/h4&gt;
&lt;p&gt;ç»™å®šä¸€ä¸ª32ä½æ•´æ•° . è¾“å‡ºäºŒè¿›åˆ¶è¡¨ç¤ºåè½¬åçš„å€¼.&lt;br&gt;
ä¾‹å¦‚ input 43261596ï¼ˆäºŒè¿›åˆ¶ 00000010100101000001111010011100ï¼‰&lt;br&gt;
è¿”å› output 964176192ï¼ˆäºŒè¿›åˆ¶ 00111001011110000010100101000000ï¼‰&lt;/p&gt;
&lt;p&gt;ç›®å‰ç¬”è€…å°±æƒ³åˆ°äº†æ—¶é—´å¤æ‚åº¦åœ¨O(N)çš„è§£å†³æ€è·¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¾ªç¯åˆ¤æ–­è¾“å…¥æ•°æ®çš„ä½ä½æ˜¯0è¿˜æ˜¯1ï¼Œå…·ä½“åˆ¤æ–­æ–¹æ³•æ˜¯å’Œ1è¿›è¡Œä¸æ“ä½œ&lt;/li&gt;
&lt;li&gt;å¦‚æœåˆ¤æ–­æ˜¯ï¼Œè¿”å›çš„ç»“æœ+1ï¼Œä¸æ˜¯1é‚£ä¹ˆä¸åšä»»ä½•å¤„ç†&lt;/li&gt;
&lt;li&gt;æ¯æ¬¡å¾ªç¯ï¼Œinputçš„æ•°æ®å‘å·¦ç§»ä¸€ä½ï¼Œoutputæ•°æ®å‘å³ç§»åŠ¨ä¸€ä½&lt;/li&gt;
&lt;li&gt;å¾ªç¯32æ¬¡ï¼Œè¿”å›ç»“æœ&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;/**
    *  äºŒè¿›åˆ¶æ•°æ®åè½¬
    */
public class BitReverse {

    public static int reverse(int n) {
        int result = 0;
        for (int i = 0; i &amp;lt; 32; i++) {
            result = result &amp;lt;&amp;lt; 1;
            if ((n &amp;amp; 1) == 1) {
                result++;
            }
            n = n &amp;gt;&amp;gt; 1;
        }
        return result;
    }

    public static void main(String[] args){
        System.out.println(reverse(1&amp;lt;&amp;lt;30));
        System.out.println(1&amp;lt;&amp;lt;30);
    }
}
&lt;/code&gt;&lt;/pre&gt;
">O(N)æ—¶é—´å¤æ‚åº¦ä¸‹ï¼ŒäºŒè¿›åˆ¶åè½¬</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://zhangyaoo.github.io/post/guan-yu-xi-tong-xing-neng-ping-jing-yu-ce-he-xi-tong-xing-neng-you-hua/"" data-c="
          &lt;h3 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;å¯¹äºä»»ä½•ç³»ç»Ÿï¼Œéƒ½ä¼šå­˜åœ¨ç³»ç»Ÿæ€§èƒ½ç“¶é¢ˆï¼Œè¿™é‡Œç¬”è€…ä½œä¸ºä¸€åJavaå·¥ç¨‹å¸ˆåˆ—å‡ºäº†è‡ªå·±åœ¨å·¥ä½œä¸­çš„ä¼˜åŒ–æ€è·¯ï¼Œä»…ä¾›å‚è€ƒã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;ä¸€-ç³»ç»Ÿæ€§èƒ½é¢„æµ‹&#34;&gt;ä¸€ã€ç³»ç»Ÿæ€§èƒ½é¢„æµ‹&lt;/h2&gt;
&lt;p&gt;â€ƒä»»ä½•ä¸€ä¸ªç³»ç»Ÿéƒ½æ˜¯ä»0åˆ°1æ…¢æ…¢å‘å±•çš„ï¼Œå½“ç³»ç»Ÿä¸šåŠ¡éšç€æ—¶é—´çš„æ¨ç§»ï¼Œä¸šåŠ¡é‡å’Œæµé‡éšä¹‹å¢å¤§ï¼Œç³»ç»Ÿæ€§èƒ½å°±éšç€å‡¸æ˜¾å‡ºæ¥ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå¼€å‘äººå‘˜å’Œæ¶æ„å¸ˆè¦ä»æ¶æ„å±‚é¢ã€ä»£ç å±‚é¢ã€äº§å“ä¸šåŠ¡å±‚é¢ç­‰ä¸€ä¸€å»æ¼”è¿›ä¸šåŠ¡ç³»ç»Ÿæ¥ç»´æŒé«˜æµé‡ä¸‹ç³»ç»Ÿç¨³å®šæ€§ã€‚&lt;/p&gt;
&lt;p&gt;â€ƒç°åœ¨æœåŠ¡éƒ½æ˜¯å¾®æœåŠ¡éƒ¨ç½²å¼€å‘ï¼Œå¦‚æœè¦æ¨¡æ‹ŸæœåŠ¡å‹æµ‹çš„è¯è¦åœ¨æœ¬åœ°å¼€å¯ç›¸åŒçš„æœåŠ¡ï¼Œå‰ææ˜¯æœºå™¨é…ç½®æ˜¯ä¸€æ ·çš„ã€‚è€Œä¸”éœ€è¦å°†çº¿ä¸Šçš„æŒä¹…åŒ–æ•°æ®åŒæ ·copyåˆ°æœ¬åœ°æ•°æ®åº“ä¸­ï¼Œè¿™æ ·æ‰èƒ½çœŸæ­£æ¨¡æ‹Ÿçº¿ä¸Šçš„ç¯å¢ƒã€‚æ‹¿å•å°æœºå™¨è¿›è¡Œå‹æµ‹ï¼Œå‹æµ‹çš„å¯¹è±¡å¯ä»¥æ˜¯æŸä¸ªæ ¸å¿ƒçš„æ¥å£æˆ–è€…ä¸šåŠ¡æ¨¡å—ï¼ˆè¿™ä¸ªæ¥å£å¯ä»¥æ˜¯æ—¥å¿—æœåŠ¡ä¸­ç»Ÿè®¡çš„è®¿é—®é‡æ¯”è¾ƒé«˜çš„å…·ä½“çš„æ¥å£APIï¼‰ï¼Œå‹æµ‹çš„æŒ‡æ ‡å¯ä»¥æ˜¯ååé‡ï¼Œå¹³å‡å“åº”æ—¶é—´ï¼Œæœ€å¤§å“åº”æ—¶é—´ï¼ŒTPSï¼ŒQPSç­‰ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;â€ƒé€šè¿‡æ€§èƒ½æŒ‡æ ‡å¯ä»¥åº¦é‡ç›®å‰å­˜åœ¨çš„æ€§èƒ½é—®é¢˜ï¼ŒåŒæ—¶ä½œä¸ºæ€§èƒ½ä¼˜åŒ–çš„è¯„ä¼°ä¾æ®ã€‚å…·ä½“çš„æŒ‡æ ‡ä¸»è¦æ˜¯è¦åˆ†æç³»ç»Ÿçš„QPSã€TPSã€å¹³å‡å“åº”æ—¶é—´ä»¥åŠæœ€å¤§å“åº”æ—¶é—´ï¼Œæˆ‘ä»¬é¢„æµ‹ä¸€ä¸ªå•ä½“çš„åº”ç”¨èƒ½å¤Ÿæ‰¿å—å¤šå°‘çš„å¹¶å‘é‡ï¼Œçœ‹è¿™è¿™äº›æŒ‡æ ‡æ˜¯å¦èƒ½å¤Ÿè¾¾åˆ°æˆ‘ä»¬é¢„æœŸçš„å€¼ï¼Œæ¯”å¦‚ä½œä¸ºä¸€ä¸ªå¥åº·çš„ç³»ç»Ÿï¼Œæœ€å¤§å“åº”æ—¶é—´ä¸è¶…è¿‡1sã€‚åé¢è¿›è¡Œå‹æµ‹æ—¶å€™ï¼Œè§‚å¯Ÿæµé‡å·…å³°æ—¶åˆ»è§‚å¯Ÿç³»ç»Ÿçš„è¿è¡Œæƒ…å†µã€‚ä»¥ä¸‹å°±æ€§èƒ½åˆ†æä¼˜åŒ–å±•å¼€æ€»ç»“ã€‚&lt;br&gt;
&lt;br&gt;&lt;/p&gt;
&lt;h2 id=&#34;äºŒ-ç³»ç»Ÿæ€§èƒ½åˆ†æä¼˜åŒ–&#34;&gt;äºŒã€ç³»ç»Ÿæ€§èƒ½åˆ†æä¼˜åŒ–&lt;/h2&gt;
&lt;h3 id=&#34;1-ç¡¬ä»¶æ–¹é¢&#34;&gt;1ã€ç¡¬ä»¶æ–¹é¢ï¼š&lt;/h3&gt;
&lt;h5 id=&#34;cpu&#34;&gt;CPUï¼š&lt;/h5&gt;
&lt;p&gt;â€ƒåœ¨å‹æµ‹çš„æ—¶å€™è§‚å¯ŸCPUçš„å ç”¨æƒ…å†µï¼Œæ˜¯å¦é•¿æœŸå¤„äº100%çŠ¶æ€ï¼Œæ­£å¸¸æ¥è¯´80%ä»¥ä¸‹æ˜¯æ­£å¸¸çš„ã€‚å¦‚æœéå¸¸ä½ï¼Œé‚£ä¹ˆè¯´æ˜ç³»ç»Ÿä¸æ˜¯åœ¨åšIOå¯†é›†å‹è¿ç®—åŠ¨ä½œï¼Œæ€§èƒ½ç“¶é¢ˆæ˜¯åœ¨å…¶ä»–æ–¹é¢ï¼Œä¸æ˜¯åœ¨CPUä¸Šé¢ï¼Œå…·ä½“çš„æ“ä½œæ–¹æ³•å¯ä»¥ç”¨topå‘½ä»¤æŸ¥çœ‹ã€‚&lt;br&gt;
â€ƒä»¥ç¬”è€…ç»éªŒæ¥çœ‹ï¼Œä¸€èˆ¬CPUé£™é«˜çš„åŸå› æ— éä¸‰ç§ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç¬¬ä¸€ç§å°±æ˜¯ä»£ç ä¸­å­˜åœ¨æ­»å¾ªç¯ï¼Œå¹¶ä¸”å¾ªç¯ä¸­æœ‰å¤§é‡çš„CPUè®¡ç®—æ“ä½œï¼›&lt;/li&gt;
&lt;li&gt;ç¬¬äºŒç§å°±æ˜¯å¤šçº¿ç¨‹å¹¶å‘ä¸‹ï¼Œç«äº‰ç›¸åŒçš„èµ„æºå¯¼è‡´å¤§é‡çº¿ç¨‹è·å–ä¸åˆ°èµ„æºï¼Œå¦‚æœæ­¤æ—¶çº¿ç¨‹è¿›è¡Œè‡ªæ—‹æ“ä½œï¼Œä¸é‡Šæ”¾CPUèµ„æºï¼Œé‚£å°±å¯¼è‡´CPUé£™å‡ï¼›&lt;/li&gt;
&lt;li&gt;ç¬¬ä¸‰ç§å°±æ˜¯ä»£ç ä¸­æœ‰å†…å­˜æ³„æ¼ï¼Œå¯¼è‡´å†…å­˜ä¸€ç›´å¤„äºé˜ˆå€¼çŠ¶æ€ï¼ŒGCçº¿ç¨‹ä¼šæŒç»­GCï¼Œå¯¼è‡´CPUé£™é«˜ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;â€ƒä¸Šé¢ä¸‰ç§æƒ…å†µä¸­ç¬¬äºŒç§å’Œç¬¬ä¸‰ç§æƒ…å†µåœ¨æ—¥å¸¸å¼€å‘å·¥ä½œä¸­ä¼šé‡åˆ°ï¼Œå¯¹äºç¬¬äºŒç§æƒ…å†µå¯¹äºè‡ªæ—‹é”æƒ…å†µï¼Œä¸€èˆ¬ä¼šç”¨CASä¹è§‚é”å»å®ç°ï¼Œå¹¶ä¸”è®¾ç½®ä¸€å®šçš„è¶…æ—¶æ—¶é—´å’Œé‡è¯•æ¬¡æ•°ï¼Œç„¶åè¿”å›å¤±è´¥æˆ–è€…è¿›å…¥é˜»å¡é˜Ÿåˆ—é‡Šæ”¾CPUåˆ†ç‰‡ï¼Œé˜²æ­¢çº¿ç¨‹ä¸€ç›´å ç”¨CPUèµ„æºã€‚&lt;br&gt;
â€ƒå¯¹äºç¬¬ä¸‰ç§æƒ…å†µï¼Œå°±æ˜¯ä»£ç çš„BUGï¼Œå¼€å‘è¿‡ç¨‹ä¸­è¦æ³¨æ„æ³„æ¼çš„é—®é¢˜ï¼Œå°±æ¯”å¦‚å¤šçº¿ç¨‹æ“ä½œé“¾è¡¨ï¼Œå¦‚æœæ²¡æœ‰åšåŒæ­¥çš„é”ï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½å¯¼è‡´é“¾è¡¨çš„å¼•ç”¨æŒ‡é’ˆæ··ä¹±ï¼Œå¼•èµ·å†…å­˜æ³„æ¼ã€‚&lt;br&gt;
â€ƒä»¥ä¸Šï¼Œå¦‚æœæˆ‘ä»¬å¼€å‘å·¥ä½œä¸­é¿å…äº†ä¸Šè¿°å‡ ç§æƒ…å†µï¼ŒCPUå°±èƒ½å¤Ÿå‘æŒ¥å®ƒåº”è¯¥æœ‰çš„èƒ½åŠ›ï¼Œæå‡ç³»ç»Ÿæ€§èƒ½ã€‚åŒæ—¶ï¼Œå¼€å‘äººå‘˜åšå¥½ç¡¬ä»¶CPUç›‘æ§æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚&lt;/p&gt;
&lt;h5 id=&#34;å†…å­˜&#34;&gt;å†…å­˜ï¼š&lt;/h5&gt;
&lt;p&gt;â€ƒ åœ¨Javaä¸­ï¼Œå†…å­˜JVMæ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„æŒ‡æ ‡ï¼Œè¿™ä¸ªå…³ä¹åˆ°ç³»ç»Ÿæ˜¯å¦å¯ä»¥ç¨³å®šè¿è¡Œã€‚æˆ‘ä»¬å¯ä»¥å€ŸåŠ©ä¸‰æ–¹å·¥å…·å¯ä»¥æŸ¥çœ‹ç³»ç»Ÿçš„JVMå†…å­˜çš„è¿è¡Œæƒ…å†µï¼Œç¬”è€…æä¾›å‡ ä¸ªé€šç”¨çš„é¢„æµ‹å†…å­˜çš„è¿è¡Œæƒ…å†µçš„æ€è·¯ï¼š&lt;br&gt;
- æ¯ç§’å ç”¨å¤šå°‘å†…å­˜ï¼Ÿ&lt;br&gt;
- å¤šé•¿æ—¶é—´è§¦å‘ä¸€æ¬¡Minor GCï¼Ÿ&lt;br&gt;
- å¤šé•¿æ—¶é—´è§¦å‘ä¸€æ¬¡Major GCï¼Ÿ&lt;br&gt;
- Minor  GCè€—æ—¶å¤šä¹…ï¼ŸMajor  GCè€—æ—¶å¤šä¹…ï¼Ÿ&lt;br&gt;
- ä¼šä¸ä¼šé¢‘ç¹å› ä¸ºSurvivoræ”¾ä¸ä¸‹å¯¼è‡´å¯¹è±¡è¿›å…¥è€å¹´ä»£ï¼Ÿ&lt;/p&gt;
&lt;p&gt;åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œå¼€å‘äººå‘˜éœ€è¦å…³æ³¨çš„å°±æ˜¯ï¼Œåˆ¤æ–­ç³»ç»ŸJVMæ˜¯å¦æœ‰é¢‘ç¹FULL GCå’Œé¢‘ç¹YOUNG GCï¼Œå¦‚æœæœ‰ï¼Œé‚£ä¹ˆä¼šä¸¥é‡å½±å“ç³»ç»Ÿæ€§èƒ½ã€‚ç¬”è€…å°±è¿™ä¸¤ä¸ªæ–¹é¢å»åˆ†æä¸€ä¸‹&lt;br&gt;
â€ƒâ€ƒ 1ã€&lt;strong&gt;é¢‘ç¹FULL GC&lt;/strong&gt; ï¼šé¦–å…ˆæˆ‘ä»¬åº”è¯¥è¦äº†è§£åˆ°é¢‘ç¹FULL GCå±å®³ï¼Œä¸€èˆ¬çš„ä¸­å¤§å‹ç³»ç»Ÿï¼Œç³»ç»Ÿçš„JVMä¼šè®¾ç½®å¾ˆå¤§ï¼Œæ¯”å¦‚ä¼šç»™å †å†…å­˜åˆ†é…4~8Gçš„ç©ºé—´ï¼Œå› ä¸ºéå†å¯¹è±¡å›¾çš„è¿‡ç¨‹ä¸­å †è¶Šå¤§ï¼Œéå†æ—¶é—´å°±ä¼šé•¿ï¼Œè€Œä¸”å¦‚æœåƒåœ¾è¶Šå¤šï¼Œåƒåœ¾å›æ”¶ä¹Ÿä¼šæ‹‰é•¿æ•´ä¸ªGCçš„æ—¶é—´ï¼Œè¿™å°±å¯¼è‡´æ¯ä¸€æ¬¡FULL GCä¼šæœ‰é•¿æ—¶é—´çš„STWï¼Œå½±å“ç³»ç»Ÿç¨³å®šæ€§ã€‚ç„¶åæˆ‘ä»¬è¦æ¸…æ¥šå¯¼è‡´è§¦å‘Full GCçš„åœºæ™¯ï¼Œè¿™é‡Œåˆ—å‡ºäº†å¯èƒ½ä¼šå¯¼è‡´çš„å‡ ä¸ªåœºæ™¯ï¼š&lt;br&gt;
â€ƒâ€ƒ1ï¼‰å¤§å¯¹è±¡&lt;br&gt;
â€ƒâ€ƒ2ï¼‰æ–¹æ³•åŒºmeta spaceç©ºé—´å æ»¡&lt;br&gt;
â€ƒâ€ƒ3ï¼‰å¹´è½»ä»£çš„å­˜æ´»çš„ç”Ÿå‘½å‘¨æœŸé•¿å¯¹è±¡ä¸€ç›´æ±‡å…¥è€å¹´ä»£ï¼Œå¯¼è‡´GC&lt;br&gt;
â€ƒâ€ƒ4ï¼‰å†…å­˜æ³„æ¼å¯¼è‡´ç©ºé—´ä¸è¶³è¿›è€ŒGC&lt;br&gt;
è¿™é‡Œç¬”è€…å°±æ‹¿å†…å­˜æ³„æ¼ï¼ˆå†…å­˜æ³„æ¼æŒ‡çš„æ˜¯æœ‰å¼•ç”¨æ— æ³•è¢«å›æ”¶ä½†æ˜¯æ²¡æœ‰ç”¨çš„å¯¹è±¡æŒç»­å¢é•¿ï¼‰æ¥è¯´ï¼Œä¸€èˆ¬å¦‚æœæœ‰å†…å­˜æ³„æ¼ã€‚å¤§æ¦‚çš„å†…å­˜ç›‘æ§å›¾é•¿è¿™ä¸ªæ ·å­&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1592463486063.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
è¿™æ ·å¯¼è‡´çš„åæœå°±æ˜¯ï¼Œé¢‘ç¹çš„FULL GCï¼Œæœ€åå†…å­˜ä¸€ç›´æŒç»­å¢é•¿åˆ°çˆ†æ»¡ï¼Œç„¶åFULL GCæ‰§è¡Œé—´éš”ç¼©çŸ­ï¼Œæœ€ç»ˆä¼šå¯¼è‡´GCçº¿ç¨‹æŒç»­GCï¼ŒCPUä½¿ç”¨ç‡ä¼šç›´çº¿é£™å‡ï¼Œå¯¼è‡´ç³»ç»Ÿç˜«ç—ªã€‚&lt;br&gt;
â€ƒâ€ƒ  2ã€ &lt;strong&gt;é¢‘ç¹ YOUNG GC&lt;/strong&gt;  ï¼šYOUNG GCå¦‚æœè¿‡äºé¢‘ç¹çš„è¯ï¼Œä¸€èˆ¬æ˜¯çŸ­å‘¨æœŸå°å¯¹è±¡è¾ƒå¤šï¼Œè¿™æ—¶å€™å¯ä»¥ä» Eden åŒº/æ–°ç”Ÿä»£è®¾ç½®çš„å¤ªå°äº†è¿™ä¸ªæ–¹é¢è€ƒè™‘ï¼Œçœ‹èƒ½å¦é€šè¿‡è°ƒæ•´-Xmnã€-XX:SurvivorRatio ç­‰å‚æ•°è®¾ç½®æ¥è§£å†³é—®é¢˜&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¿™é‡Œç¬”è€…ä»¥è‡ªå·±å¼€å‘ç»éªŒï¼Œæä¾›ä¸€äº›â€œç®€å•çš„â€JVMä¼˜åŒ–æ‹™è§&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å°½é‡å°†æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶æ‰ï¼Œä¸è®©å­˜æ´»å¯¹è±¡è¿›å…¥è€å¹´ä»£ï¼Œå› ä¸ºè€å¹´ä»£çš„GCä»£ä»·æ¯”å¹´è½»ä»£é«˜ï¼Œè¿™é‡Œå¯ä»¥è®¾ç½®åˆ†ä»£å¹´é¾„-XX:MaxTenuringThreshold=XX&lt;br&gt;
â€ƒ ä¾‹å­1ï¼šæ¯”å¦‚è¯´ä¸šåŠ¡ä¸Šä¸€åˆ†é’Ÿäº§ç”Ÿå‡ ç™¾å…†çš„æ•°æ®ï¼Œè€Œä¸”éœ€è¦å­˜æ´»ä¸€åˆ†é’Ÿï¼Œå¦‚æœä¸€åˆ†é’ŸYGCçš„æ¬¡æ•°å°‘äºé»˜è®¤åˆ†ä»£å¹´é¾„ï¼Œé‚£ä¹ˆå¯¹è±¡ä¼šè¿›å»è€å¹´ä»£å¼•å‘FGCï¼ŒFGCä¼šå¼•èµ·æ›´å¤§çš„åœé¡¿æ—¶é—´&lt;br&gt;
â€ƒ ä¾‹å­2ï¼šå¦‚æœè¯´å¯¹è±¡éƒ½æ˜¯ä¸€äº›çŸ­æœŸå¯¹è±¡ï¼Œé‚£ä¹ˆå¯ä»¥è®¾ç½®åˆ†ä»£å¹´é¾„æ›´å°ï¼Œå› ä¸ºé•¿æœŸå¯¹è±¡è‚¯å®šæ˜¯å¤§å¯¹è±¡æˆ–è€…å•ä¾‹å¯¹è±¡æ°¸é©»å†…å­˜çš„ï¼Œè¿™æ ·å¯ä»¥è…¾å‡ºç©ºé—´ç»™æ–°ç”Ÿä»£GCï¼Œé¿å…æ–°ç”Ÿä»£é¢‘ç¹GC&lt;/li&gt;
&lt;li&gt;å¢åŠ æ–°ç”Ÿä»£å†…å­˜çš„å¤§å°ï¼Œé˜²æ­¢å¯¼è‡´é¢‘ç¹çš„minor GCï¼Œè¿™æ ·è€å¹´ä»£çš„Major GCé¢‘ç‡ä¹Ÿä¼šé™ä½&lt;/li&gt;
&lt;li&gt;å°½é‡å°†å¤§å†…å­˜çš„æœåŠ¡ï¼Œæ‹†åˆ†æˆå‡ ä¸ªç›¸åŒæœåŠ¡ï¼Œä¹Ÿå°±æ˜¯å¤šå®ä¾‹éƒ¨ç½²ï¼Œåˆ†æ•£å †å†…å­˜èµ„æºï¼Œé¿å…å †å¤§å†…å­˜å¯¼è‡´GCæ—¶é—´è¿‡é•¿ï¼ˆè¿™ä¸ªå’ŒG1åˆ†åŒºå›æ”¶æ€æƒ³ç›¸ä¼¼ï¼‰&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªçº¿ç¨‹å ç”¨çš„å†…å­˜ä¸åº”è¿‡å¤§æˆ–è€…è¿‡å°ï¼Œä¸ç„¶ä¼šå¯¼è‡´OOM&lt;br&gt;
â€ƒ å¦‚æœçº¿ç¨‹å†…å­˜è¿‡å°ï¼Œä¼šå¯¼è‡´çº¿ç¨‹é‡Œé¢çš„æ ˆå†…å­˜å°ï¼Œä¸´æ—¶å˜é‡å¦‚æœè¶…å‡ºè¿™ä¸ªé˜ˆå€¼å°±ä¼šæ— æ³•åˆ†é…æ ˆï¼Œå¯¼è‡´æ ˆæº¢å‡ºï¼Œå‡ºç°stackoverflow&lt;br&gt;
â€ƒ å¦‚æœçº¿ç¨‹å†…å­˜è¿‡å¤§ï¼Œåœ¨å¤šçº¿ç¨‹å¹¶å‘ä¸‹ï¼Œå¦‚æœçº¿ç¨‹æ•°é‡è¿‡å¤šï¼Œä¼šå ç”¨éå¸¸å¤šJVMå†…å­˜ï¼Œæœ‰å†…å­˜æº¢å‡ºçš„é£é™©&lt;/li&gt;
&lt;li&gt;åˆç†è®¾ç½®åƒåœ¾å›æ”¶å™¨ï¼Œåœ¨å¤§å†…å­˜æˆ–è€…åœ¨å†…å­˜ç¢ç‰‡åŒ–ç¯å¢ƒä¸‹ï¼ŒG1åƒåœ¾å›æ”¶å™¨ä¼šæœ‰å¾ˆå¥½çš„æ•ˆæœ&lt;br&gt;
â€ƒ G1åƒåœ¾å›æ”¶å™¨æ˜¯Java9é»˜è®¤å›æ”¶å™¨ï¼ŒG1èƒ½å¤Ÿåœ¨æŒ‡å®šçš„åœé¡¿æ—¶é—´å†…ï¼Œæ ¹æ®æ¯ä¸ªregionçš„å›æ”¶ä»·å€¼ï¼Œé€‰æ‹©å¯ä»¥å»å›æ”¶çš„regionï¼Œå¹¶ä¸”å­˜æ´»å¯¹è±¡ç§»åŠ¨å¤åˆ¶æ˜¯å¤šçº¿ç¨‹è¿›è¡Œçš„ã€‚è¿™é‡Œè¦æ³¨æ„å¦‚æœè®¾ç½®åœé¡¿æ—¶é—´çš„è¯ï¼Œä¸èƒ½è®¾ç½®å¤ªå°ï¼Œå› ä¸ºå¤ªå°ä¼šå¯¼è‡´æ¯æ¬¡è¿›è¡Œå›æ”¶çš„regionå¤ªå°‘ï¼Œå¯¼è‡´åƒåœ¾å›æ”¶é€Ÿåº¦æ›´ä¸ä¸Šåƒåœ¾ç”Ÿäº§çš„é€Ÿåº¦ï¼Œè¿™æ ·éšç€æ—¶é—´æ¨ç§»ï¼Œç³»ç»Ÿåƒåœ¾å¯¹è±¡ä¼šè¶Šæ¥è¶Šå¤šï¼Œå æ»¡JVM&lt;/li&gt;
&lt;li&gt;å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„åˆ†å¸ƒæƒ…å†µï¼šå¦‚æœåº”ç”¨å­˜åœ¨å¤§é‡çš„çŸ­æœŸå¯¹è±¡ï¼Œåº”è¯¥é€‚å½“å¢å¤§å¹´è½»ä»£ -Xmnï¼›å¦‚æœå­˜åœ¨ç›¸å¯¹è¾ƒå¤šçš„æŒä¹…å¯¹è±¡ï¼Œè€å¹´ä»£åº”è¯¥é€‚å½“å¢å¤§ã€‚-Xms -Xmx&lt;/li&gt;
&lt;li&gt;Xmså’ŒXmxä¹Ÿè®¾ç½®ä¸ºç›¸åŒï¼Œè¿™æ ·å¯ä»¥å‡å°‘å†…å­˜è‡ªåŠ¨æ‰©å®¹å’Œæ”¶ç¼©å¸¦æ¥çš„æ€§èƒ½æŸå¤±&lt;/li&gt;
&lt;li&gt;è®¾ç½®å¤§å¯¹è±¡å¯¹è±¡çš„å¤§å°ï¼Œä¸€èˆ¬ç³»ç»Ÿä¸­å¤§å¯¹è±¡å¤§éƒ¨åˆ†éƒ½æ˜¯ä¸€äº›ç³»ç»Ÿçš„ç¼“å­˜ï¼Œåƒè¿™äº›å¯¹è±¡å°½æ—©è®©å®ƒä»¬çš„è¿›å…¥è€å¹´ä»£ï¼Œé¿å…å ç”¨æ–°ç”Ÿä»£çš„ç©ºé—´ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä»¥ä¸Šï¼Œåˆç†åˆ†é…JVMå†…å­˜èµ„æºä»¥åŠåšå¥½ç³»ç»Ÿå†…å­˜çš„ç›‘æ§æœºåˆ¶æ˜¯æˆ‘ä»¬ç³»ç»Ÿç¨³å®šæ€§è¿è¡Œçš„ä¿éšœã€‚&lt;/p&gt;
&lt;h5 id=&#34;ç½‘ç»œè´Ÿè½½å’Œio&#34;&gt;ç½‘ç»œè´Ÿè½½å’ŒIO&lt;/h5&gt;
&lt;p&gt;æ¥ä¸€å¼ IOå‘ç”Ÿåœºæ™¯å›¾ç‰‡ï¼š&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1593333928024.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
â€ƒå¯¹äºç£ç›˜IOï¼Œæˆ‘ä»¬å¯ä»¥ç”¨Linuxä¸‹çš„iostatå‘½ä»¤å»æŸ¥çœ‹å½“å‰IOè´Ÿè½½çš„æƒ…å†µï¼Œæ¯”å¦‚r_waitå’Œw_waitæŒ‡æ ‡ï¼Œè¿™äº›æŒ‡æ ‡è¾ƒå¤§åˆ™è¯´æ˜I/Oè´Ÿè½½è¾ƒå¤§ï¼ŒI/Oç­‰å¾…æ¯”è¾ƒä¸¥é‡ï¼Œç£ç›˜è¯»å†™é‡åˆ°ç“¶é¢ˆã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¦çœ‹å‹æµ‹çš„æ¥å£æ˜¯å¦æœ‰æ–‡ä»¶è¯»å–å’Œå†™å…¥çš„æ“ä½œï¼Œå¦‚æœæœ‰è¯´æ˜æ¥å£æ€§èƒ½ç“¶é¢ˆåœ¨äºæ–‡ä»¶è¯»å†™ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥åˆ©ç”¨æ–‡ä»¶bufferç¼“å­˜APIç­‰åŠŸèƒ½è¿›è¡Œä¼˜åŒ–ï¼Œæˆ–è€…å¯ä»¥ç”¨å¼‚æ­¥çš„æ–¹å¼è¿›è¡Œæ–‡ä»¶è¯»å†™ã€‚&lt;br&gt;
â€ƒç¬”è€…åœ¨å¼€å‘ä¸­å°±é‡åˆ°å› ä¸ºIOé—®é¢˜å¸¦æ¥çš„çº¿ç¨‹èµ„æºè€—å°½çš„çº¿ä¸Šé—®é¢˜ï¼šæˆ‘ä»¬ç³»ç»Ÿä¸šåŠ¡åœ¨å€Ÿè´·ä¸šåŠ¡æˆåŠŸåï¼Œè¦ç”Ÿæˆå€Ÿæ¬¾åè®®ï¼Œåè®®æ˜¯ä¸€ä¸ªPDFæ–‡ä»¶ï¼Œå½“æ—¶ä¸»ä¸šåŠ¡é€»è¾‘å®ŒæˆååŒæ­¥è°ƒç”¨ç”ŸæˆPDFçš„é€»è¾‘ï¼Œå› ä¸ºå½“æ—¶å¤§æµé‡å¹¶å‘ï¼Œå¯¼è‡´æ•´ä¸ªå€Ÿè´·ä¸šåŠ¡æ€§èƒ½ç“¶é¢ˆå°±åœ¨ç£ç›˜IOä¸Šï¼ŒCPUå¤„äºç©ºé—²çŠ¶æ€ï¼Œå€Ÿç”¨ç½‘ä¸Šçš„ä¸€ä¸ªå›¾ï¼ŒTOPå‘½ä»¤å¯ä»¥çœ‹å‡ºIOèŠ±è´¹çš„æ—¶é—´åœ¨76.6%ï¼Œåé¢ä¼˜åŒ–åå°±å¤šçº¿ç¨‹å¼‚æ­¥å¤„ç†ã€‚&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1593334249512.webp&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;p&gt;â€ƒå¯¹äºç½‘ç»œè´Ÿè½½ï¼Œå› ä¸ºç½‘ç»œè´Ÿè½½æˆ–è€…ç½‘ç»œå µå¡æ˜¯ä¸å—æ§åˆ¶çš„ï¼Œè¿™ä¸ªæ¶‰åŠåˆ°åº•å±‚çš„TCPé€šä¿¡çš„ä¼˜åŒ–ï¼ˆæ¯”å¦‚åˆ©ç”¨æ»‘åŠ¨çª—å£å’Œæ‹¥å¡æ§åˆ¶ï¼‰ï¼Œè¿™ä¸ªå°±ä¸å±•å¼€è®¨è®ºã€‚å·¥ç¨‹å¸ˆå¯æ§èŒƒå›´å¯ä»¥æ˜¯é€‰æ‹©IOè¯»å†™é«˜æ•ˆç‡çš„ä¸­é—´ä»¶ï¼Œæ¯”å¦‚redisã€tomcatã€activeMqã€nginxã€dubboã€nettyç­‰ï¼Œè¿™äº›ä¸­é—´ä»¶çš„åº•å±‚IOæ¨¡å‹çš„æ˜¯å¤šè·¯å¤ç”¨IOï¼Œå¤šè·¯å¤ç”¨IOæŒ‡çš„æ˜¯ä¸€ä¸ªIOçº¿ç¨‹èƒ½å¤ŸæœåŠ¡äºå¤šä¸ªsocketè¿æ¥ï¼Œçº¿ç¨‹ç›‘å¬æ¯ä¸ªè¿æ¥çš„èµ„æºæè¿°ç¬¦ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1593334346151.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;p&gt;â€ƒåˆ†å¸ƒå¼å¾®æœåŠ¡ç¯å¢ƒä¸‹ï¼ŒæœåŠ¡ä¹‹é—´çš„RPCåŒæ­¥è°ƒç”¨ä¼šéå¸¸é¢‘ç¹ï¼Œéšä¹‹æœåŠ¡ä¹‹é—´çš„ç½‘ç»œè´Ÿè½½ä¼šå½±å“åˆ°æ•´ä¸ªç³»ç»Ÿçš„æœåŠ¡æ€§èƒ½ï¼Œå› æ­¤ï¼Œæ¯ä¸ªæœåŠ¡çš„æœºå™¨æ”¾ç½®åˆ°åŒä¸€ä¸ªå±€åŸŸç½‘ä¸‹æ€§èƒ½æ•ˆæœä¼šå¾ˆå¥½ã€‚è€Œä¸”ï¼Œå¯¹äºæœåŠ¡ä¹‹é—´çš„è°ƒç”¨ï¼Œæœ€å¥½åˆ©ç”¨è‡ªç ”æˆ–è€…ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶å»ç›‘æ§æœåŠ¡é“¾è·¯è°ƒç”¨çš„æ•´ä½“æƒ…å†µï¼ˆæ¯”å¦‚Zipkinæˆ–è€…SkyWalking ï¼‰,å¹¶ä¸”è¦åˆç†è®¾ç½®æœåŠ¡ä¸æœåŠ¡ä¹‹é—´çš„è¶…æ—¶æ—¶é—´ï¼Œé¿å…å› ä¸ºç½‘ç»œåŸå› å¯¼è‡´æœåŠ¡çº¿ç¨‹æ± è€—å°½ï¼Œå¯¼è‡´OOMã€‚&lt;/p&gt;
&lt;h3 id=&#34;2-ä¸­é—´ä»¶å±‚&#34;&gt;2ã€ä¸­é—´ä»¶å±‚&lt;/h3&gt;
&lt;p&gt;â€ƒ è¿™é‡Œä¸­é—´ä»¶ï¼Œæ³›æŒ‡æ•°æ®å­˜å‚¨å±‚ï¼Œä»¥ç¬”è€…ç»éªŒæ¥çœ‹ï¼Œå¤§å¤šæ•°ç³»ç»Ÿæ€§èƒ½é—®é¢˜å’Œç“¶é¢ˆéƒ½æ˜¯ä¸æ•°æ®å­˜å‚¨ç›¸å…³ï¼Œè¿™é‡Œç¬”è€…å°±æ‹¿è¿™æ–¹é¢å±•å¼€è®¨è®ºæ€»ç»“ã€‚&lt;/p&gt;
&lt;h5 id=&#34;mysql&#34;&gt;MySQL&lt;/h5&gt;
&lt;p&gt;ä¸€èˆ¬æ¥è¯´MySQLåœ¨å¾ˆå¤šçº¿ç¨‹æ›´æ–°åŒä¸€è¡Œçš„åœºæ™¯ä¸‹ï¼ŒTPSæ€§èƒ½æ›²çº¿å¦‚å›¾æ‰€ç¤ºï¼Œå‚è€ƒä¸å¥‡çš„ã€Šç§’æ€åœºæ™¯ä¸‹MySQLçš„ä½æ•ˆã€‹&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1592893242022.png&#34; alt=&#34;ç§’æ€åœºæ™¯ä¸‹MySQLçš„ä½æ•ˆ&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œçº¿ç¨‹æ•°åœ¨6çš„æ—¶å€™TPSè¾¾åˆ°å·…å³°2Wï¼Œéšç€çº¿ç¨‹æ•°çš„å¢é•¿ï¼ŒTPSä¼šéšä¹‹é™ä½ã€‚åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œå¯ä»¥æ ¹æ®è¿™ä¸ªç»“è®ºæ¥è¿›è¡Œä¼˜åŒ–ï¼Œæ¯”å¦‚ï¼Œå½“æœ‰ç¬é—´å¤§æµé‡å†²å‡»æ•°æ®åº“æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œæ•°æ®ç¼“å†²ï¼Œæ¯”å¦‚ç”¨é˜Ÿåˆ—å‰Šå³°ï¼Œå¼€å¯6ä¸ªçº¿ç¨‹æ¶ˆè´¹ï¼Œç„¶åè®¿é—®æ•°æ®åº“ã€‚&lt;br&gt;
å½“ç„¶è¿™ä¸ªçœ‹ä¸šåŠ¡åœºæ™¯ï¼Œå¦‚æœæ˜¯å¯¹åŒä¸€ä¸ªèµ„æºè¿›è¡Œç«äº‰çš„è¯ï¼Œè¿™ä¸ªè¯å‰Šå³°æ˜¯å¯è¡Œçš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœåœºæ™¯æ˜¯æ¯ä¸€ä¸ªçº¿ç¨‹å¯¹ä¸åŒèµ„æºè¿›è¡Œè®¿é—®ä¿®æ”¹æ—¶å€™ï¼Œä¸æ¶‰åŠèµ„æºç«äº‰çš„è¯ï¼Œé‚£ä¹ˆå°±ä¸è¦è¿›è¡Œå‰Šå³°å¤„ç†ï¼Œç›´æ¥è®¿é—®æ•°æ®åº“å³å¯ï¼Œå½“ç„¶è¿™ä¸ªä¹Ÿè¦è€ƒè™‘åˆ°MySQLçš„æ€§èƒ½é—®é¢˜ã€‚&lt;br&gt;
ä¸¾ä¸ªä¾‹å­ï¼Œå°±æ‹¿å…‰æ’å…¥æ•°æ®çš„æ€§èƒ½æµ‹è¯•æ¥è¯´ï¼ˆæ²¡æœ‰å»ºå”¯ä¸€ç´¢å¼•ï¼‰ï¼Œ4æ ¸4Gçš„7200è½¬çš„æœºæ¢°ç¡¬ç›˜æœºå™¨é…ç½®ï¼Œæœ€é«˜èƒ½å¤Ÿæ‰¿å—7500çš„å¹¶å‘æ’å…¥æ•°ã€‚[å‚è€ƒMySQLæ€§èƒ½å‹æµ‹]&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šç®—æ˜¯ä¸€ç§åœ¨ç‰¹å®šåœºæ™¯ä¸‹çš„ä¼˜åŒ–çš„æ€è·¯ï¼Œä¸‹é¢ç¬”è€…è®¨è®ºä¸€ä¸‹æ—¥å¸¸å¼€å‘ä¸­é€šç”¨çš„MySQLä¼˜åŒ–ï¼š&lt;br&gt;
1ã€é¿å…é•¿æœŸçš„äº‹åŠ¡é”å ç”¨ï¼Œé¿å…é”èŒƒå›´è¿‡å¤§ï¼Œé¿å…å•ä¸ªèµ„æºçš„å¹¶å‘ç«äº‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¦–å…ˆæˆ‘ä»¬çŸ¥é“æ•°æ®åº“Innodbå­˜å‚¨å¼•æ“çš„RRå’ŒRCéš”ç¦»çº§åˆ«ä¸‹ï¼Œç±»ä¼¼updateè¯­å¥ï¼Œé”çš„é‡Šæ”¾æ—¶æœºæ˜¯åœ¨äº‹åŠ¡æäº¤ä¹‹åï¼Œè¿™ä¸ªå«åšä¸¤é˜¶æ®µé”åè®®ã€‚æ‰€ä»¥ä¸ºäº†é¿å…äº‹åŠ¡ä¹‹é—´é”åŒä¸€è¡Œæ•°æ®å‡ºç°é•¿æ—¶é—´çš„äº’ç›¸ç­‰å¾…çš„åœºæ™¯ï¼Œ&lt;strong&gt;è¦æŠŠæœ€å¯èƒ½é€ æˆé”å†²çªã€æœ€å¯èƒ½å½±å“å¹¶å‘åº¦çš„é”å°½é‡å¾€åæ”¾&lt;/strong&gt;ã€‚&lt;br&gt;
ä¸¾ä¸ªä¾‹å­ï¼Œä¸ªäººè´¦æˆ·Aè½¬è´¦ç»™å…¬å…±è´¦æˆ·Bï¼Œæµç¨‹æ˜¯ï¼šå¼€å¯äº‹åŠ¡â€”â€”ã€‹ç»™ B çš„è´¦æˆ·ä½™é¢å¢åŠ é’±ï¼›ä»è´¦æˆ· A è´¦æˆ·ä½™é¢ä¸­æ‰£é™¤é’±ï¼›è®°å½•ä¸€æ¡äº¤æ˜“æ—¥å¿—â€”â€”ã€‹ç»“æŸäº‹åŠ¡ã€‚å› ä¸ºå…¬å…±è´¦æˆ·Bå¯èƒ½è¢«å¤šä¸ªçº¿ç¨‹ä¿®æ”¹ï¼Œæ‰€ä»¥å¯ä»¥ä¼˜åŒ–ä¸ºï¼šä»è´¦æˆ· A è´¦æˆ·ä½™é¢ä¸­æ‰£é™¤é’±ï¼›è®°å½•ä¸€æ¡äº¤æ˜“æ—¥å¿—ï¼›ç»™ B çš„è´¦æˆ·ä½™é¢å¢åŠ é’±ã€‚&lt;/li&gt;
&lt;li&gt;ç„¶åï¼Œè¦å°½é‡å°†é”ç»†åŒ–ï¼Œä¸€ä¸ªå¤§é”å¯ä»¥åˆ†å‰²ä¸ºå¤šä¸ªé”ï¼Œç±»ä¼¼&lt;strong&gt;åˆ†æ®µé”æœºåˆ¶&lt;/strong&gt;ã€‚æ‹¿ç¬”è€…å…¬å¸ä¸šåŠ¡æ¥è¯´ï¼Œæ¯”å¦‚APPä¸ŠæŠ•èµ„æŸä¸€ä¸ªäº§å“æ ‡ï¼ˆåŒ…å«äº†æ ‡çš„å¼€å§‹å‹Ÿé›†æ—¶é—´ã€ç»“æŸæ—¶é—´ã€å¯æŠ•é‡‘é¢ã€å¹´åˆ©ç‡ç­‰ç­‰ï¼‰ï¼Œåœ¨åˆ°è¾¾å¼€å§‹å‹Ÿé›†æ—¶é—´ä¼šæœ‰ä¸€æ®µæ—¶é—´çš„é«˜å¹¶å‘æŠ•æ ‡ï¼Œè¿™ä¸ªæ—¶å€™ä¼šå¯¹å…·ä½“æ ‡çš„è¡Œæ•°æ®è¿›è¡Œé¢‘ç¹çš„æ›´æ–°æ“ä½œï¼Œå°±æ˜¯æ‰£å‡å‰©ä½™å¯æŠ•é‡‘é¢ï¼Œå¦‚æœå…¶ä»–è€—æ—¶æ“ä½œä¸­æœ‰å¯¹åŒä¸€èµ„æºè¿›è¡Œç«äº‰çš„è¯ï¼Œé‚£ä¹ˆäº§å“é”æŒæœ‰æ—¶é—´è¿‡é•¿ï¼Œå¯¼è‡´æ€§èƒ½ä½ã€‚å¦‚æœæœ‰é«˜å¹¶å‘ç§’æ€ä¸‹å•ç­‰åŠ¨ä½œï¼Œä¼šé€ æˆè¡Œé”æŠ¢å é—®é¢˜ã€‚&lt;br&gt;
è¿™ä¸ªæ—¶å€™ï¼Œä¼˜åŒ–æ€è·¯æ˜¯ï¼Œå°†è¿™ä¸ªäº§å“æ ‡åœ¨æ•°æ®åº“åˆ†ä¸º10ä»½ï¼Œæ¯ä¸€ä»½çš„å¯æŠ•é‡‘é¢å‡å°‘10å€ï¼Œæ¯ä¸€ä¸ªæŠ•æ ‡è¯·æ±‚è¿›è¡Œéšæœºè·¯ç”±åˆ†é…åˆ°è¿™10ä¸ªå°çš„äº§å“æ ‡ä¸­ã€‚è¿™æ ·å°±å‡å°‘é”çš„å¹¶å‘ç«äº‰é—®é¢˜ï¼Œä¼˜åŒ–æ€§èƒ½ã€‚&lt;br&gt;
ä½†æ˜¯ç¬”è€…å› ä¸ºé‡åˆ°è¿™ç§åˆ†æ®µé”çš„é—®é¢˜å¯¼è‡´çš„&lt;strong&gt;æ­»é”&lt;/strong&gt;é—®é¢˜ï¼Œåœºæ™¯æ˜¯è¿™æ ·çš„ï¼Œå½“ä¸€ä»½æŠ•æ ‡çš„é‡‘é¢å¤§äºå…¶ä¸­ä¸€ä»½äº§å“é‡‘é¢çš„è¯ï¼Œä¼šæŒæœ‰è¿™ä»½äº§å“çš„é”ï¼Œå¹¶ä¸”å¾ªç¯è·å–ä¸‹ä¸€ä»½å°äº§å“ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœæœ‰ä¸¤ä¸ªçº¿ç¨‹éƒ½å¤§äºå°äº§å“é‡‘é¢çš„è¯ï¼Œæœ‰æ¦‚ç‡ä¼šäº§ç”Ÿæ­»é”é—®é¢˜ï¼Œç¬”è€…æœ€ç»ˆé€šè¿‡é¡ºåºåŠ é”ä»¥åŠåŠ ä¸Šé”çš„è¿‡æœŸæ—¶é—´è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;æœ€åï¼Œå¯¹åŒä¸€ä¸ªèµ„æºçš„å¹¶å‘ç«äº‰ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œåƒ12306æŠ¢ç¥¨ã€å•†åŸæ´»åŠ¨ç§’æ€ç­‰éƒ½æ˜¯å¯¹åŒä¸€ä¸ªæœ‰é™èµ„æºè¿›è¡Œç«äº‰çš„åœºæ™¯ï¼Œç¬”è€…è®¤ä¸ºï¼Œè¿™ç§åœºæ™¯æ˜¯éå¸¸éš¾å¤„ç†çš„ï¼Œéœ€è¦è€ƒè™‘åˆ°é”åŒæ­¥æ•°æ®å®‰å…¨ã€å¹¶å‘ç«äº‰æ€§èƒ½ç“¶é¢ˆã€è¶…å–ç­‰é—®é¢˜ï¼Œéƒ½æ˜¯ä¼šå½±å“Cç«¯ç”¨æˆ·å®é™…çš„ä½“éªŒçš„ã€‚&lt;br&gt;
åƒè¿™ç§åœºæ™¯ï¼Œä¼˜åŒ–çš„æ€è·¯å°±æ˜¯â€”â€”&amp;gt;&lt;strong&gt;èƒ½ç”¨åˆ†æ®µé”çš„å°±ä¸è¦ç”¨æ‚²è§‚é”ï¼Œèƒ½ç”¨ä¹è§‚é”çš„å°±ä¸è¦ç”¨æ‚²è§‚é”ï¼Œèƒ½ç”¨æ— é”ç¼–ç¨‹çš„å°±ä¸è¦ç”¨é”ï¼Œèƒ½ç”¨å¼‚æ­¥çš„åœºæ™¯å°±ä¸è¦ç”¨åŒæ­¥çš„åœºæ™¯ï¼Œèƒ½åœ¨å†…å­˜æ“ä½œçš„å°±ä¸è¦å†æ”¾åˆ°æ•°æ®åº“ç£ç›˜å±‚é¢æ“ä½œ&lt;/strong&gt;ã€‚å½“ç„¶ï¼Œæœ‰äº›å¯¹äºæ•°æ®å®‰å…¨æ€§è¦æ±‚å¾ˆé«˜çš„åœºæ™¯ï¼Œæ¯”å¦‚é‡‘èï¼ŒåŠ é”æ˜¯å¿…è¦çš„ã€‚è¿™ä¸ªå°±æ˜¯ä¸šåŠ¡ä¸€è‡´æ€§å’Œå¹¶å‘çš„æŠ˜ä¸­è€ƒè™‘ï¼Œè¿™ä¸ªéœ€è¦è€ƒè™‘å…·ä½“çš„ä¸šåŠ¡åœºæ™¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;2ã€å…³é—­æ­»é”æ£€æµ‹&lt;br&gt;
MySQLé»˜è®¤å¼€å¯æ­»é”æ£€æµ‹ï¼Œæ¦‚å¿µï¼šæ¯å½“ä¸€ä¸ªäº‹åŠ¡è¢«é”çš„æ—¶å€™ï¼Œå°±è¦çœ‹çœ‹å®ƒæ‰€ä¾èµ–çš„çº¿ç¨‹æœ‰æ²¡æœ‰è¢«åˆ«äººé”ä½ï¼Œå¦‚æ­¤å¾ªç¯ï¼Œæœ€ååˆ¤æ–­æ˜¯å¦å‡ºç°äº†å¾ªç¯ç­‰å¾…ï¼Œä¹Ÿå°±æ˜¯æ­»é”ã€‚æ­»é”æ£€æµ‹å¯¹æ•°æ®åº“æœ‰éå¸¸å¤§çš„æ€§èƒ½å½±å“ï¼Œä¼šæ¶ˆè€—CPUèµ„æºï¼Œæœ€åä¼šå‹å®æ•°æ®åº“ã€‚&lt;br&gt;
åœ¨è¿™ç§å¹¶å‘åœºæ™¯ä¸‹å¯ä»¥å…³é—­æ­»é”æ£€æµ‹åŠŸèƒ½ï¼Œä¼šæœ‰æ˜æ˜¾çš„æ€§èƒ½æå‡ã€‚å½“ç„¶å…³é—­æ­»é”æ£€æµ‹ä¹Ÿä¼šå¸¦æ¥é—®é¢˜ï¼Œæ¯”å¦‚å½“æ­»é”å‘ç”Ÿæ—¶ï¼Œä¼šä¸€ç›´æŒæœ‰é”èµ„æºï¼Œç›´è‡³åˆ°è¶…æ—¶æ—¶é—´åï¼Œé‡Šæ”¾ï¼Œè¿™æ®µç­‰å¾…çš„æ—¶å€™å¯èƒ½ä¼šé€ æˆçº¿ç¨‹æŒç»­ç­‰å¾…é€ æˆä¸¥é‡åæœã€‚æ‰€ä»¥ä¸ºäº†é¿å…æ­»é”çš„å‘ç”Ÿï¼Œå¯¹è¡Œèµ„æºè¿›è¡ŒåŠ é”çš„æ—¶å€™å¯ä»¥æ ¹æ®IDä¸»é”®ç­‰è¿›è¡Œ&lt;strong&gt;é¡ºåºåŠ é”&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;3ã€SQLä¼˜åŒ–&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;SQLé¿å…å¤šè¡¨è¿æ¥æŸ¥è¯¢ã€inå’Œexitsåˆç†åº”ç”¨ã€è€ƒè™‘ç´¢å¼•å¤±æ•ˆåœºæ™¯&lt;/li&gt;
&lt;li&gt;åœ¨ç»å¸¸æŸ¥è¯¢å’Œæ’åºçš„åˆ—ä¸ŠåŠ ç´¢å¼•ï¼Œå¯¹ç¦»æ•£åº¦ä¸é«˜çš„ä¸å»ºè®®åŠ é”ï¼Œéµå¾ªç´¢å¼•è§„èŒƒ&lt;/li&gt;
&lt;li&gt;åœ¨å†™åœºæ™¯å¤šä½™è¯»åœºæ™¯çš„ç´¢å¼•é€‰æ‹©ï¼Œå”¯ä¸€ç´¢å¼•å’Œæ™®é€šç´¢å¼•çš„é€‰æ‹©&lt;/li&gt;
&lt;li&gt;å°½é‡è¿›è¡Œè¦†ç›–ç´¢å¼•ï¼Œé¿å…å›è¡¨æŸ¥è¯¢&lt;/li&gt;
&lt;li&gt;å°½é‡å»ºç«‹è”åˆç´¢å¼•ï¼Œæ¥è¿›è¡Œç´¢å¼•å¤ç”¨&lt;/li&gt;
&lt;li&gt;å­—ç¬¦ä¸²çš„å‰ç¼€ç´¢å¼•çš„å»ºç«‹&lt;/li&gt;
&lt;li&gt;ç”¨explainåˆ†ææ•´ä¸ªSQLçš„æ‰§è¡Œæƒ…å†µï¼ŒåŒ…æ‹¬æ‰§è¡Œè®¡åˆ’ã€ç´¢å¼•åˆ†æ&lt;/li&gt;
&lt;li&gt;ä¿®æ”¹æ•°æ®æ¯”è¾ƒå¤šçš„å­—æ®µåœºæ™¯å°½é‡åŠ ç´¢å¼•ï¼Œå°½é‡ä½¿ç”¨è¡Œé”ï¼Œé¿å…è¡¨é”&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;4ã€åœ¨å¤§æ•°æ®é‡çš„æƒ…å†µä¸‹ï¼ˆä¸€èˆ¬å•è¡¨è¶…2000Wï¼‰çš„ä¼˜åŒ–æ€è·¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŠ ç¼“å­˜ï¼Œå¯¹äºé«˜å¹¶å‘è¯»åœºæ™¯ç”¨ç¼“å­˜ï¼Œä¸€çº§ç¼“å­˜Redisæˆ–è€…äºŒçº§ç¼“å­˜Cache&lt;/li&gt;
&lt;li&gt;æ¶æ„å±‚é¢MySQLå°±åšä¸»ä»å¤åˆ¶æˆ–ä¸»ä¸»å¤åˆ¶ï¼Œè¯»å†™åˆ†ç¦»ï¼Œå¯ä»¥åœ¨åº”ç”¨å±‚åšï¼Œæ•ˆç‡é«˜&lt;/li&gt;
&lt;li&gt;å‚ç›´æ‹†åˆ†ï¼Œæ ¹æ®ä½ æ¨¡å—çš„è€¦åˆåº¦ï¼Œå°†ä¸€ä¸ªå¤§çš„ç³»ç»Ÿåˆ†ä¸ºå¤šä¸ªå°çš„ç³»ç»Ÿï¼Œä¹Ÿå°±æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿï¼›&lt;/li&gt;
&lt;li&gt;æ°´å¹³åˆ‡åˆ†ï¼Œå› ä¸ºæ°´å¹³åˆ‡åˆ†ä¼šå¢åŠ ä»£ç å¼€å‘å¤æ‚åº¦ï¼Œæ‰€ä»¥èƒ½å°½é‡é¿å…å°±ä¸è¦åšã€‚é’ˆå¯¹æ•°æ®é‡å¤§çš„è¡¨ï¼Œå¯¹äºæ—¥å¿—æµæ°´ã€é…ç½®å‹ç­‰ç±»å‹æ•°æ®ï¼Œè¿›è¡Œå½’æ¡£æ“ä½œï¼›å¯¹äºçŠ¶æ€ä¸šåŠ¡æ•°æ®è¿›è¡Œåˆ†åº“åˆ†è¡¨ï¼Œè¿™é‡Œå°±ä¸å±•å¼€è®¨è®ºã€‚å…¶æ¬¡ï¼Œè¦é€‰æ‹©ä¸€ä¸ªåˆç†çš„sharding keyï¼Œä¸ºäº†æœ‰å¥½çš„æŸ¥è¯¢æ•ˆç‡ï¼Œè¡¨ç»“æ„ä¹Ÿè¦æ”¹åŠ¨ï¼Œåšä¸€å®šçš„å†—ä½™ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;redis&#34;&gt;Redis&lt;/h5&gt;
&lt;p&gt;Redisä½œä¸ºå¼€å‘äººå‘˜æ¥è§¦æœ€é¢‘ç¹çš„ä¸­é—´ä»¶ï¼Œé¦–å…ˆï¼Œç¬”è€…å…ˆæ‹¿å‡ºå®˜ç½‘ç»™å‡ºçš„Redisæ€§èƒ½æµ‹è¯•ç»“æœï¼šä»ä¸‹å›¾å¯ä»¥å¾—å‡ºç»“è®ºï¼šrediså•æœºæµ‹è¯•ç»“æœæ˜¯TPSæ˜¯7W,QPSåªèƒ½æ¯”è¿™ä¸ªæ•°æ®æ›´é«˜ã€‚&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1592983835284.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å½“ä½¿ç”¨äº†ç®¡é“piplineåæ€§èƒ½å¤§çº¦æå‡äº†6å€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1592986207480.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;p&gt;æ ¹æ®å®˜ç½‘çš„æ–‡æ¡£ï¼Œå½±å“Redisæ€§èƒ½æœ‰ä»¥ä¸‹å› ç´ ï¼Œç¬”è€…è®¤ä¸ºå¼€å‘äººå‘˜åšä¸€äº›åŸºå‡†æµ‹è¯•å‹æµ‹ä»¥åŠæ—¥å¸¸å¼€å‘ä¸­ä½¿ç”¨Redisçš„æ—¶å€™ï¼Œæ³¨æ„è¿™äº›ä¼˜åŒ–ç‚¹ï¼Œå°±èƒ½é«˜æ•ˆä½¿ç”¨Redisï¼š&lt;br&gt;
1ã€ç½‘ç»œå»¶è¿Ÿå’Œç½‘ç»œå¸¦å®½ï¼Œä½œä¸ºè¿ç»´äººå‘˜ï¼Œæœ€å¥½å°†æœåŠ¡å™¨å’ŒRedisæœåŠ¡éƒ¨ç½²åˆ°åŒä¸€ä¸ªå±€åŸŸç½‘å†…ï¼Œé™ä½ç½‘ç»œå»¶è¿Ÿã€‚ä½œä¸ºå¼€å‘äººå‘˜ï¼Œå°½é‡ä¸è¦ä½¿ç”¨å¤§keyå’Œå¤§valueï¼Œå› ä¸ºéšç€è¿™ç§æ•°æ®è¶Šæ¥è¶Šå¤šï¼Œåœ¨ç½‘ç»œä¼ è¾“çš„æ—¶å€™ä¼šå ç”¨å¤§éƒ¨åˆ†ç½‘ç»œå®½å¸¦ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä¸€ä¸ªrediså¯¹è±¡å¤§å°è¶…è¿‡1KBï¼Œå½“ä½ çš„QPSè¾¾åˆ°100ä¸‡ï¼Œä¼šæŠŠä½ çš„åƒå…†è·¯ç”±å™¨çš„å¸¦å®½æ‰“æ»¡ï¼Œå› æ­¤ç½‘ç»œå¸¦å®½å¯èƒ½å°±ä¼šæˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚&lt;br&gt;
2ã€ä½¿ç”¨piplineï¼Œå½“ä½¿ç”¨ä»¥å¤ªç½‘è®¿é—®Redisæ—¶ï¼Œä¿æ®å¤§å°ä¿æŒåœ¨ä»¥å¤ªç½‘æ•°æ®åŒ…å¤§å°ï¼ˆçº¦1500å­—èŠ‚ï¼‰ä»¥ä¸‹æ—¶ï¼Œä½¿ç”¨æµæ°´çº¿è¿›è¡Œèšåˆçš„å‘½ä»¤ç‰¹åˆ«æœ‰æ•ˆã€‚&lt;br&gt;
3ã€å»¶æ—¶åˆ é™¤ï¼Œå½“æŸä¸€ä¸ªredisObjectå¾ˆå¤§çš„æ—¶å€™ï¼Œåšåˆ é™¤æ“ä½œä¼šé•¿æ—¶é—´å æœ‰çº¿ç¨‹æŒæœ‰æ—¶é—´ï¼Œå½±å“æ€§èƒ½ï¼Œredisæ–°ç‰ˆæœ¬æœ‰å»¶è¿Ÿåˆ é™¤çš„åŠŸèƒ½ã€‚&lt;br&gt;
4ã€ä½¿ç”¨scanä»£æ›¿keysï¼Œkeysä¼šé€ æˆä¸¥é‡çš„æ€§èƒ½é—®é¢˜&lt;br&gt;
5ã€è®¾ç½®å†…å­˜çš„å¤§å°é˜ˆå€¼å¹¶ä¸”è®¾ç½®å¥½å†…å­˜ç¼“å­˜æ·˜æ±°çš„ç­–ç•¥ï¼Œçº¿ä¸Šè®¾ç½®LRUç­–ç•¥æ¥æ·˜æ±°ç¼“å­˜è¿™æ ·åšæ˜¯ä¸ºäº†é¿å…ç‰©ç†å†…å­˜ä½¿ç”¨å®Œåï¼Œé€ æˆå¡é¡¿çš„æƒ…å†µã€‚å¹¶ä¸”çº¿ä¸Šè¦é¿å…å¤§é‡keyåŒæ—¶å¤±æ•ˆçš„åœºæ™¯ï¼Œå› ä¸ºredisåˆ é™¤å¤±æ•ˆçš„keyæ˜¯å¾ªç¯åˆ é™¤çš„ï¼Œå¹¶ä¸”é¢‘ç¹çš„åˆ é™¤ä¼šä¿ƒä½¿å†…å­˜ç®¡ç†å™¨å›æ”¶å†…å­˜é¡µï¼Œè¿™æ ·ä¹Ÿä¼šå¯¼è‡´å¡é¡¿çš„ç°è±¡ã€‚&lt;br&gt;
6ã€connectionå®¢æˆ·ç«¯è¿æ¥æ•°é‡ï¼ŒRedisä½œä¸ºä¸€ä¸ªäº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼Œå› ä¸ºbase epollèƒ½å¤Ÿå®ç°O(1)æ—¶é—´å¤æ‚åº¦çš„å“åº”æ“ä½œï¼Œå› æ­¤èƒ½å¤Ÿæä¾›å¾ˆå¥½æ€§èƒ½ã€‚Rediså·²ç»ä»¥è¶…è¿‡60000ä¸ªè¿æ¥ä¸ºåŸºå‡†ï¼Œå¹¶ä¸”åœ¨è¿™äº›æ¡ä»¶ä¸‹ä»èƒ½å¤Ÿç»´æŒ50000 q / sçš„ååé‡ï¼Œè€Œä¸”å…·æœ‰30000ä¸ªè¿æ¥çš„å®ä¾‹åªèƒ½å¤„ç†100ä¸ªè¿æ¥å¯è¾¾åˆ°çš„ååé‡çš„ä¸€åŠï¼Œå¯å‚è€ƒä¸‹å›¾ï¼ˆæ¥æºå®˜ç½‘ï¼‰ï¼š&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1592991673063.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h5 id=&#34;elasticsearch&#34;&gt;ElasticSearch&lt;/h5&gt;
&lt;p&gt;ElasticSearchå¯ä»¥è§£å†³å¤§æ•°æ®é‡ä¸‹çš„æœç´¢æ…¢é—®é¢˜ï¼Œè¿™é‡Œç¬”è€…å°±æ‹¿ æ­»ç£•ElasticSearchç¤¾åŒºä½œè€…çš„ä¼˜åŒ–å»ºè®®ï¼Œç»™å‡ºå‡ ç‚¹åœ¨æ—¥å¸¸å¼€å‘ElasticSearchçš„ä¼˜åŒ–æ–¹æ¡ˆï¼š&lt;br&gt;
1ã€å°½é‡å°†æ‰€æœ‰æ•°æ®çš„ä¸€åŠéƒ½ç¼“å­˜åœ¨å†…å­˜å½“ä¸­file cache system å½“ä¸­&lt;br&gt;
2ã€å°†å°‘é‡ï¼ˆæŸ¥è¯¢å­—æ®µæ¯”è¾ƒé¢‘ç¹ï¼‰å­—æ®µæ”¾å…¥ESï¼Œå…¶ä»–å…¨é‡å­—æ®µæ”¾å…¥Hbaseä¸­ï¼Œé‡‡ç”¨ES + Hbaseæ–¹å¼æå‡æŸ¥è¯¢æ•ˆç‡ï¼ŒèŠ‚çœESå­˜å‚¨ç©ºé—´ï¼Œfile cache systemçš„æ•°æ®å°±ä¼šå­˜çš„æ›´å¤š&lt;br&gt;
3ã€ç¼“å­˜é¢„çƒ­ï¼Œå¯ä»¥åšä¸€ä¸ªç¼“å­˜é¢„çƒ­ç³»ç»Ÿï¼Œå®šæ—¶æŸ¥è¯¢çƒ­ç‚¹æ•°æ®å°†å…¶ç¼“å­˜åœ¨filesystem cache ä¸­&lt;br&gt;
4ã€å†·çƒ­åˆ†ç¦»ï¼Œå°†è®¿é—®é‡é«˜çš„å’Œå†·æ•°æ®åˆ†åˆ«æ”¾ç½®ç´¢å¼•&lt;br&gt;
5ã€ES ducomentè®¾è®¡ï¼Œå°½é‡é¿å…è¿æ¥ã€çˆ¶å­æ–‡æ¡£ç­‰è¿æ¥æ“ä½œï¼Œå°†æ•°æ®å‡†å¤‡å¥½åå†å­˜å…¥ES&lt;br&gt;
6ã€ä¸å…è®¸æ·±åº¦åˆ†é¡µï¼Œé¡µæ•°è¶Šå¤§ï¼Œæ·±åº¦è¶Šæ·±ï¼Œä»æ¯ä¸€ä¸ªshardè¿”å›çš„æ•°æ®å°±è¶Šå¤šï¼Œè€—æ—¶è¶Šä¹…ã€‚å¯ä»¥é€šè¿‡scroll apiæ¸¸æ ‡è¿›è¡ŒæŸ¥è¯¢ã€‚&lt;br&gt;
7ã€å¿…é¡»é™åˆ¶æ¨¡ç³Šæœç´¢çš„é•¿åº¦ï¼Œä¸ç„¶CPUä¼šé£™é«˜ï¼Œå¯å‚è€ƒ https://elasticsearch.cn/article/171&lt;/p&gt;
&lt;h3 id=&#34;3-ä¸šåŠ¡å±‚æ–¹é¢&#34;&gt;3ã€ä¸šåŠ¡å±‚æ–¹é¢&lt;/h3&gt;
&lt;p&gt;æ¯ä¸ªå…¬å¸ä¸šåŠ¡å±‚é¢ä¼˜åŒ–ä¸ç›¸åŒï¼Œè¦æ ¹æ®å…·ä½“ä¸šåŠ¡åœºæ™¯å»ä¼˜åŒ–ï¼Œåˆ«äººçš„æ–¹æ¡ˆåªèƒ½ä½œä¸ºå‚è€ƒã€‚&lt;br&gt;
è¿™é‡Œç¬”è€…å°±æ‹¿é‡‘èè¡Œä¸šèƒŒæ™¯ä¸‹ï¼Œåˆ—ä¸¾ä¸‰ä¸ªä¼˜åŒ–ä¾‹å­ã€‚&lt;br&gt;
1ã€èƒŒæ™¯ï¼šä¼ä¸šå€Ÿè´·ï¼Œä¼šä»ç”¨æˆ·çš„æŠ•çš„é“¶è¡ŒæŸä¸ªäº§å“çš„èµ„é‡‘æ± ä¸­åŒ¹é…æŸ¥æ‰¾åˆé€‚çš„èµ„é‡‘ï¼Œç„¶åè¿›è¡Œèµ„é‡‘å æœ‰ï¼Œé“¶è¡ŒçœŸå®è½¬è´¦åï¼Œç”Ÿæˆç»ˆæ€çš„å€ºæƒå…³ç³»ã€‚&lt;br&gt;
ä¼˜åŒ–ä¹‹å‰ï¼šä½¿ç”¨åŒæ­¥é”ï¼ŒåŒä¸€æ—¶é—´åªèƒ½åˆä¸€ä¸ªçº¿ç¨‹å»èµ„é‡‘æ± ä¸­åŒ¹é…èµ„é‡‘ï¼Œè¿™ç§æ–¹æ¡ˆæœ‰ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ï¼Œå…¶ä»–çº¿ç¨‹æ²¡æœ‰æ‹¿åˆ°é”ä¹‹å‰åªèƒ½è‡ªæ—‹å°è¯•è·å–é”ï¼ŒæŸè€—CPUèµ„æºã€‚&lt;br&gt;
ä¼˜åŒ–ä¹‹åï¼šå»æ‰åŒæ­¥é”ï¼Œæ”¹æˆä¹è§‚é”ï¼Œæ”¾åˆ°æ•°æ®åº“åšï¼Œèµ„é‡‘è¡¨çš„å­—æ®µå¢åŠ ä¸€ä¸ªæ ‡è¯†è¡¨ç¤ºæ˜¯å¦å ç”¨ï¼Œçº¿ç¨‹è¿›æ¥å°è¯•åŒ¹é…èµ„é‡‘ï¼Œä¹è§‚é”å»é¢„å èµ„é‡‘è¡¨ï¼ŒæˆåŠŸè¡¨ç¤ºåŒ¹é…æˆåŠŸã€‚è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œå°½é‡ä¸€ä¸ªå€Ÿè´·åŒ¹é…ä¸€æ¯”èµ„é‡‘ï¼Œè¿™æ ·èµ„é‡‘æ± é‡Œé¢çš„èµ„é‡‘é”è¡ŒèŒƒå›´ä¼šå‡å°‘ï¼ˆå› ä¸ºæœ‰å¤šçº¿ç¨‹æŠ¢å èµ„é‡‘èµ„æºï¼‰ï¼Œèµ„é‡‘åŒ¹é…çš„é€Ÿåº¦ä¼šåŠ å¿«ï¼Œå¹¶ä¸”è¿™æ ·ä¼˜åŒ–è¿™æ ·é“¶è¡Œè½¬è´¦çš„æ¬¡æ•°ä¼šå‡å°‘ï¼ˆå¦‚æœåŒ¹é…ä¸€æ‰¹èµ„é‡‘å°±è¦è¿›è¡Œç›¸åŒæ•°é‡è½¬è´¦æ¬¡æ•°ï¼‰ï¼Œé˜²æ­¢å¤šä¸ªæŠ•èµ„äººè´¦æˆ·è¿›è¡Œé“¶è¡Œè½¬è´¦ï¼Œå‡å°‘æ•´ä¸ªå€Ÿæ¬¾ä¸šåŠ¡çº¿çš„è€—æ—¶ï¼Œé¿å…å…¶ä¸­ä¸€ä¸ªè½¬è´¦å‡ºé”™å¯¼è‡´å…¨éƒ¨è¦å›æ»šè¿™æ ·çš„æƒ…å†µã€‚&lt;br&gt;
è¿™é‡Œå…¶å®è¿˜å¯ä»¥è¿›è¡Œä¼˜åŒ–ï¼Œæ¯”å¦‚ä¸€ç¬”ä¸€ç¬”çš„å æœ‰èµ„é‡‘ï¼Œå æœ‰å¤±è´¥çš„continueç»§ç»­ä¸‹ä¸€ç¬”èµ„é‡‘å«æœ‰ï¼Œä¸ç”¨ä¸€æ¬¡åœ¨ä¸€ä¸ªäº‹åŠ¡é‡Œé¢å æœ‰å¤§é‡èµ„é‡‘ï¼Œé˜²æ­¢å¤§äº‹åŠ¡æ‰§è¡Œå¤±è´¥ä»¥åŠå‡ºç°å…¶ä»–ä¼šæœ‰æ­»é”çš„å¯èƒ½æ€§ã€‚è¿™é‡Œä¼˜åŒ–çš„æ€æƒ³å°±æ˜¯å¤§äº‹åŠ¡æ‹†æˆå°äº‹åŠ¡ï¼Œé˜²æ­¢äº‹åŠ¡æ‰§è¡Œå¤±è´¥çš„æ¦‚ç‡ã€‚&lt;/p&gt;
&lt;p&gt;2ã€èƒŒæ™¯ï¼šä¼ä¸šå€Ÿè´·ï¼ŒåŒæ­¥è¯·æ±‚è½¬å¼‚æ­¥&lt;br&gt;
ä¼˜åŒ–ä¹‹å‰ï¼Œä¸‰æ–¹ä¼ä¸šå€Ÿè´·è¯·æ±‚ï¼Œæ˜¯åŒæ­¥è°ƒç”¨ï¼Œå› ä¸ºä¸€æ¡å®Œæ•´çš„å€Ÿè´·ä¸šåŠ¡çº¿éå¸¸é•¿ï¼Œä¸­é—´ä¼šRPCè°ƒç”¨éå¸¸å¤šçš„åº•å±‚æœåŠ¡ä»¥åŠå…¶ä»–è¿œç¨‹æ¥å£ï¼Œè¿™æ ·çš„è¯è¯·æ±‚åˆ°å“åº”æ—¶é—´ä¼šæ‹‰çš„éå¸¸é•¿ï¼Œå½±å“Cç«¯çš„ç”¨æˆ·ä½“éªŒã€‚&lt;br&gt;
ä¼˜åŒ–ä¹‹åï¼ŒåŒæ­¥æ”¹å¼‚æ­¥ï¼Œå…·ä½“åšæ³•æ˜¯ï¼Œå€Ÿè´·è¯·æ±‚è¿›å…¥ç³»ç»Ÿåï¼Œä¼šå…ˆç”Ÿæˆä¸€ä¸ªè¿›è¡Œä¸­çš„çŠ¶æ€å€Ÿè´·æ•°æ®æ’å…¥æ•°æ®åº“ï¼Œç„¶åå°†å”¯ä¸€æ ‡è¯†ä¸¢å…¥MQä¸­ï¼Œç„¶åå°±è¿”å›æˆåŠŸã€‚è¿™æ ·ååé‡ä¼šå¢åŠ ï¼Œç”¨æˆ·ç«¯ä½“éªŒä¼šéå¸¸å¥½ã€‚&lt;br&gt;
å½“ç„¶å¦‚æœè¯´è¦ä¿è¯é«˜å¯ç”¨ï¼Œå¯ä»¥åˆ©ç”¨MQçš„äº‹åŠ¡æ¶ˆæ¯åšï¼Œåˆ©ç”¨äºŒé˜¶æ®µæäº¤æ–¹å¼ä¿è¯MQèƒ½å¤Ÿæ”¶åˆ°æ¶ˆæ¯ã€‚å…·ä½“æ–¹æ¡ˆå¯ä»¥çœ‹ç¬”è€…çš„è¿™ç¯‡æ–‡ç«  &lt;a href=&#34;https://zhangyaoo.github.io/post/jin-rong-ji-ye-wu-xia-fen-bu-shi-shi-wu-bao-zheng-shu-ju-yi-zhi-xing//&#34;&gt;é‡‘èçº§ä¸šåŠ¡ä¸‹åˆ†å¸ƒå¼äº‹åŠ¡ä¿è¯æ•°æ®ä¸€è‡´æ€§&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;3ã€èƒŒæ™¯ï¼šCç«¯ç”¨æˆ·åœ¨APPä¸Šï¼ŒæŸä¸€ä¸ªæ ‡å¼€å¯å‹Ÿé›†èµ„é‡‘åè¿›è¡ŒæŠ•æ ‡ï¼Œè¿™é‡Œçš„æ ‡ç±»ä¼¼æ”¯ä»˜å®çš„ç†è´¢äº§å“ï¼Œå¼€å§‹å‹Ÿé›†çš„æ—¶å€™ä¼šæœ‰é«˜å¹¶å‘æµé‡æ¶Œå…¥ï¼Œå½“APPç«¯ç”¨æˆ·åŒæ—¶æŠ•æ ‡ï¼Œä¼šæœ‰å¤§é‡è¯·æ±‚ï¼Œè¿™å°±å½¢æˆäº†æŠ¢è´­çš„åŠ¨ä½œï¼Œå› ä¸ºä¸€ä¸ªäº§å“æ ‡çš„å¯æŠ•é‡‘é¢æ˜¯æœ‰é™çš„ï¼Œåªæœ‰å°‘æ•°äººèƒ½æŠ•æ ‡æˆåŠŸ&lt;br&gt;
ä¼˜åŒ–ä¹‹å‰ï¼šç¬”è€…åœ¨ä¸Šæ–‡ä¸­æåˆ°çš„ï¼Œå°½ç®¡è¯´é¢‘ç¹å°†æ›´æ–°è¡Œé”çš„æ•°æ®æ”¾åˆ°äº‹åŠ¡çš„æœ€åï¼Œ ä¼šæœ‰æ€§èƒ½æå‡ï¼Œä½†æ˜¯éšç€å¹¶å‘æ•°å¢é•¿ï¼ŒMySQLä¹Ÿä¼šæˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚&lt;br&gt;
ä¼˜åŒ–ä¹‹åï¼šåˆ©ç”¨redisçš„çº¯å†…å­˜æ“ä½œé«˜æ€§èƒ½çš„ä¼˜ç‚¹ï¼Œå°†äº§å“çš„å¯æŠ•é‡‘é¢æ”¾å…¥ç¼“å­˜redisï¼ˆè¿™é‡Œredisé‡Œé¢çš„é‡‘é¢æ¯”æ•°æ®åº“ä¸­å°‘ä¿è¯ä¸è¶…å–ï¼‰ï¼Œåˆ©ç”¨redisçš„decrbyå‘½ä»¤æˆ–è€…luaè„šæœ¬ï¼Œä¿è¯äº§å“æ ‡å‰©ä½™å¯æŠ•é‡‘é¢èƒ½å¤Ÿè¿›è¡ŒåŸå­å‡å°‘ï¼Œæ¯ä¸€æ¬¡å‡å°‘æˆåŠŸåï¼Œå°†ç”¨æˆ·è¿™ä¸€æ¬¡æŠ•æ ‡çš„æ•°æ®ä¸¢å…¥MQä¸­å¼‚æ­¥å¤„ç†ï¼Œæ¶ˆè´¹ç«¯åšçš„å°±æ˜¯å°†æ’å…¥é¢„çŠ¶æ€çš„å€Ÿæ¬¾æ•°æ®ã€å†»ç»“ç”¨æˆ·é‡‘é¢å’Œå‡å°‘äº§å“çš„å¯æŠ•é‡‘é¢æ”¾å…¥åŒä¸€ä¸ªäº‹åŠ¡ä¸­å¤„ç†ã€‚&lt;br&gt;
ä¸Šé¢åšçš„ä¼˜åŒ–èƒ½å¤Ÿä¿è¯Cç«¯ç”¨æˆ·çš„è‰¯å¥½ä½“éªŒï¼Œä½†æ˜¯å¼•å…¥å„ç§ä¸­é—´ä»¶çš„è¯ä¼šå‡ºç°å„ç§é—®é¢˜éœ€è¦å»è§£å†³ï¼Œæ¯”å¦‚é‡å¤æŠ•æ ‡æ€ä¹ˆåŠï¼ŒRedisæŒ‚äº†æ€ä¹ˆï¼ŸMQæŒ‚äº†æ€ä¹ˆåŠï¼Ÿæ¶ˆæ¯ä¸¢å¤±æ€ä¹ˆåŠï¼Ÿç­‰ä¸€ç³»åˆ—é—®é¢˜ã€‚&lt;br&gt;
é‡å¤æŠ•æ ‡ï¼Œå¯ä»¥åˆ©ç”¨ç”¨æˆ·æ ‡è¯†çš„å”¯ä¸€tokenåšï¼ŒçŸ­ä¿¡ç”Ÿæˆtokenï¼Œè®¾ç½®tokenå¤±æ•ˆæ—¶é—´ï¼ˆçŸ­ä¿¡å¤±æ•ˆæ—¶é—´60sï¼‰ï¼ŒæŠ•æ ‡æ—¶å€™æ ¡éªŒtokenæ˜¯å¦è¿‡æœŸå’Œä½¿ç”¨è¿‡ã€‚&lt;br&gt;
RedisæŒ‚ï¼Œè¿™æ—¶å€™å°±è¦è€ƒè™‘æŒä¹…åŒ–å’Œé›†ç¾¤å“¨å…µä¿æŒredisé«˜å¯ç”¨ã€‚&lt;br&gt;
MQæŒ‚äº†ï¼Œæ¶ˆæ¯ä¸¢å¤±ï¼Œé‡å¤æ¶ˆè´¹ç­‰ï¼Œè¿™æ—¶å€™å°±è¦è€ƒè™‘brokerçš„æŒä¹…åŒ–ï¼Œç”Ÿäº§ç«¯å’Œæ¶ˆè´¹ç«¯çš„é‡è¯•æœºåˆ¶å’Œackæœºåˆ¶ã€‚&lt;br&gt;
ä»¥ä¸Šéœ€è¦å¼€å‘äººå‘˜å»åº”å¯¹æ¯ä¸€ä¸ªå¯èƒ½å‡ºç°é—®é¢˜çš„åœºæ™¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸‰-åç»­æµé‡å¢é•¿ç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–æ€è·¯&#34;&gt;ä¸‰ã€åç»­æµé‡å¢é•¿ç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–æ€è·¯&lt;/h2&gt;
&lt;p&gt;å½“æµé‡æ¿€å¢çš„æ—¶å€™ï¼Œé¦–å…ˆè¦è€ƒè™‘åˆ°ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œé«˜å¯ç”¨ï¼Œåç»­é’ˆå¯¹ç‰¹å®šçš„åœºæ™¯ï¼Œåˆ†ææ€§èƒ½ç“¶é¢ˆï¼Œç„¶åå†å»åšå¹¶å‘çš„ä¼˜åŒ–ã€‚è¿™é‡Œç¬”è€…å°±&lt;strong&gt;ç®€å•çš„&lt;/strong&gt;åˆ—ä¸¾ä¸€ä¸‹ä¸šç•Œçš„åšæ³•ï¼Œä¸‹é¢æ¯ä¸€æ¡è¯»è€…éƒ½å¯ä»¥è‡ªè¡Œæ‰©å±•å¤§ç¯‡å¹…æ·±å…¥å»äº†è§£ã€‚&lt;/p&gt;
&lt;h4 id=&#34;é«˜å¯ç”¨&#34;&gt;é«˜å¯ç”¨&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨åå‘ä»£ç†å’Œ&lt;strong&gt;è´Ÿè½½å‡è¡¡&lt;/strong&gt;å®ç°åˆ†æµï¼Œå¹¶ä¸”å®ç°åŠ¨æ€åˆ‡æ¢ä¸»å¤‡æœºå™¨ï¼Œ ç½‘å…³è´Ÿè½½å‡è¡¡ï¼ŒDNSå¤šæœºæˆ¿è´Ÿè½½å‡è¡¡&lt;/li&gt;
&lt;li&gt;é€šè¿‡&lt;strong&gt;é™æµ&lt;/strong&gt;ä¿æŠ¤åº”ç”¨å…å—é›ªå´©ä¹‹ç¾&lt;/li&gt;
&lt;li&gt;é€šè¿‡&lt;strong&gt;é™çº§&lt;/strong&gt;å®ç°æ ¸å¿ƒæœåŠ¡æœåŠ¡å¯ç”¨ï¼Œç‰ºç‰²éæ ¸å¿ƒæœåŠ¡&lt;/li&gt;
&lt;li&gt;é€šè¿‡&lt;strong&gt;éš”ç¦»&lt;/strong&gt;å®ç°æ•…éšœéš”ç¦»å’Œèµ„æºéš”ç¦»ï¼Œæ¯”å¦‚çº¿ç¨‹éš”ç¦»ï¼Œå¯¹æ–¹æ³•æˆ–è€…ç±»å…·ä½“åˆ†é…çº¿ç¨‹æ•°é‡ï¼Œé˜²æ­¢ç›¸äº’å½±å“&lt;/li&gt;
&lt;li&gt;é€šè¿‡è®¾ç½®åˆç†çš„&lt;strong&gt;è¶…æ—¶&lt;/strong&gt;è°ƒç”¨ä¸é‡è¯•æœºåˆ¶é¿å…è¯·æ±‚å †ç§¯é€ æˆé›ªå´©&lt;/li&gt;
&lt;li&gt;é€šè¿‡&lt;strong&gt;å›æ»š&lt;/strong&gt;æœºåˆ¶å¿«é€Ÿä¿®å¤é”™è¯¯ç‰ˆæœ¬&lt;/li&gt;
&lt;li&gt;Redis&lt;strong&gt;é›†ç¾¤&lt;/strong&gt;ä¿è¯é«˜å¯ç”¨ï¼Œ&lt;strong&gt;å“¨å…µ&lt;/strong&gt;æ¨¡å¼ä¿è¯æ•…éšœè½¬ç§»&lt;/li&gt;
&lt;li&gt;Redis MQæ¶ˆæ¯ä¸­é—´ä»¶å¼€å¯&lt;strong&gt;æŒä¹…åŒ–&lt;/strong&gt;ï¼Œä¿è¯æ•°æ®ä¸ä¸¢ï¼›&lt;strong&gt;ackæœºåˆ¶&lt;/strong&gt;å’Œ&lt;strong&gt;é‡è¯•æœºåˆ¶&lt;/strong&gt;ä¿è¯æ•°æ®çš„å¯é æ€§&lt;/li&gt;
&lt;li&gt;åˆ†å¸ƒå¼æœåŠ¡ç¯å¢ƒ&lt;strong&gt;é“¾è·¯è·Ÿè¸ª&lt;/strong&gt;ï¼Œç›‘æ§æ•´ä¸ªæœåŠ¡çš„æœåŠ¡è´¨é‡&lt;/li&gt;
&lt;li&gt;ç¡¬ä»¶èµ„æº&lt;strong&gt;ç›‘æ§&lt;/strong&gt;ã€CPUã€å†…å­˜ã€è´Ÿè½½ã€IOã€å †å†…å­˜ã€JVM GCã€çº¿ç¨‹æ± ä»¥åŠå„ç§ä¸­é—´ä»¶ç›‘æ§ç­‰ç­‰&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;é«˜å¹¶å‘&#34;&gt;é«˜å¹¶å‘&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;åˆ©ç”¨MQåŒæ­¥è½¬å¼‚æ­¥ï¼Œæµé‡å‰Šå³°ï¼Œå¤šçº¿ç¨‹å¼‚æ­¥æ¶ˆè´¹&lt;/li&gt;
&lt;li&gt;è¯»åœºæ™¯æ¯”è¾ƒå¤šçš„æ¥å£å¯ä»¥åˆ©ç”¨ç¼“å­˜Redisï¼ŒåŒ…æ‹¬çƒ­ç‚¹keyç¼“å­˜é¢„çƒ­ï¼Œå¤šçº§ç¼“å­˜ï¼Œæ¯”å¦‚åˆ†å¸ƒå¼ç¼“å­˜ï¼Œæœ¬åœ°ç¼“å­˜å’ŒCDNç¼“å­˜ã€‚è¿˜å¯ä»¥åšé›†ç¾¤ã€å“¨å…µã€é«˜å¯ç”¨ä¿è¯Redisæ€§èƒ½&lt;/li&gt;
&lt;li&gt;å¯¹äºå¼ºä¸€è‡´çš„åŒæ­¥ä¸‹å•åœºæ™¯ï¼Œå¯ä»¥å°†å¯¹MySQLçš„æ“ä½œæ”¹ä¸ºRedisï¼Œç„¶ååˆ©ç”¨MQåšå¼‚æ­¥&lt;/li&gt;
&lt;li&gt;ä¼˜åŒ–JVMï¼ŒåŒ…æ‹¬æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„å¤§å°ã€GCç®—æ³•çš„é€‰æ‹©ç­‰ï¼Œå°½å¯èƒ½å‡å°‘GCé¢‘ç‡å’Œè€—æ—¶&lt;/li&gt;
&lt;li&gt;éæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€å»¶è¿Ÿä»»åŠ¡é€»è¾‘ã€ä¸‰æ–¹è°ƒç”¨é€»è¾‘ï¼Œå¯ä»¥åšå¼‚æ­¥&lt;/li&gt;
&lt;li&gt;å¯¹äºæ¶æ„æ–¹é¢ï¼Œå¯ä»¥åšè´Ÿè½½å‡è¡¡é›†ç¾¤éƒ¨ç½²ï¼ŒMySQLä¸»ä»ã€åˆ†åº“åˆ†è¡¨æˆ–è€…å½’æ¡£ã€Redisé›†ç¾¤ã€å¤šçº§ç¼“å­˜ã€åˆ†å¸ƒå¼å‚ç›´æ‹†åˆ†éƒ¨ç½²ã€æœç´¢åœºæ™¯å¼•å…¥ESç­‰å¤šä¸ªæ–¹é¢è€ƒè™‘&lt;/li&gt;
&lt;li&gt;å¯¹äºç¨‹åºæ–¹é¢ï¼Œå¯ä»¥ä»Forå¾ªç¯çš„è®¡ç®—é€»è¾‘ä¼˜åŒ–ã€æ‰¹å¤„ç†æœºåˆ¶å‡å°‘IOã€é‡‡ç”¨æ—¶é—´å¤æ‚åº¦æ›´å°çš„æ•°æ®ç»“æ„å’Œç®—æ³•ã€ä¹è§‚é”å’Œåˆ†æ®µé”å’Œæ— é”ç¼–ç¨‹å‡å°‘é”å†²çªç­‰æ–¹é¢è€ƒè™‘&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;å››-æ€»ç»“&#34;&gt;å››ã€æ€»ç»“&lt;/h2&gt;
&lt;p&gt;ä»¥ä¸Šï¼Œç¬”è€…ä»ç¡¬ä»¶å±‚ã€ä»£ç å±‚ã€ä¸­é—´ä»¶å±‚ã€ä¸šåŠ¡å±‚ç­‰ä¸åŒæ–¹å‘ï¼Œç®€å•çš„åˆ†æäº†å½±å“ç³»ç»Ÿæ€§èƒ½å„ä¸ªå› ç´ ï¼Œä»¥åŠæä¾›äº†ç®€å•çš„ä¼˜åŒ–çš„æ€è·¯å’Œä¾‹å­ã€‚å› ç¬”è€…å·¥ä½œç»éªŒèƒ½åŠ›æœ‰é™ï¼Œæ— æ³•åšåˆ°å…¨é¢çš„åˆ†æï¼Œè¿˜æœ›è¯»è€…èƒ½å¤ŸæŒ‡æ­£é”™è¯¯ä»¥åŠæä¾›å»ºè®®ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;p&gt;1ã€ç§’æ€åœºæ™¯ä¸‹MySQLçš„ä½æ•ˆâ€”â€”ä¸å¥‡&lt;br&gt;
2ã€æ­»ç£•ElasticSearchç¤¾åŒºâ€”â€”ElasticSearchä¼˜åŒ–&lt;br&gt;
3ã€MySQLæ€§èƒ½å‹æµ‹â€”â€”https://my.oschina.net/u/867417/blog/758690&lt;br&gt;
4ã€é«˜å¯ç”¨ç³»ç»Ÿæ–¹æ¡ˆâ€”â€”https://blog.csdn.net/hustspy1990/article/details/78008324&lt;br&gt;
5ã€Redisæ€§èƒ½æµ‹è¯•â€”â€”https://redis.io/topics/benchmarks&lt;/p&gt;
&lt;!--å‚è€ƒ --&gt;
">ç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–çš„æ€è€ƒå’Œæ€»ç»“</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://zhangyaoo.github.io/post/o1shi-jian-fu-za-du-xia-shuang-xiang-lian-biao-shi-xian-lru/"" data-c="
          &lt;h3 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;ç¬”è€…å…ˆä»linkedHashMapæºç ä¸­å€Ÿé‰´æ’å…¥é¡ºåºè®¿é—®çš„ä»£ç ï¼Œç„¶åç„¶åè‡ªå·±å®ç°äº†ä¸€ä¸ªLRU&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;linkedhashmapåº•å±‚çš„æ•°æ®ç»“æ„&#34;&gt;linkedHashMapåº•å±‚çš„æ•°æ®ç»“æ„&lt;/h3&gt;
&lt;p&gt;linkedHashMapåº•å±‚ç»“æ„ï¼ˆé¡ºåºè®¿é—®ï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1ã€linkedHashMapç»´æŠ¤äº†æ¯ä¸ªnodeçš„åŒå‘é“¾è¡¨ï¼Œåˆå§‹åŒ–æ—¶å€™ç»´æŠ¤äº†ç©ºçš„entry headerå¤´ï¼Œæ–°åŠ å…¥çš„èŠ‚ç‚¹æ”¾åˆ°entryçš„å¤´éƒ¨headerçš„next&lt;/li&gt;
&lt;li&gt;2ã€putè¿˜æ˜¯getéƒ½ä¼šè¿›è¡Œé‡æ’åºï¼Œget entry1 è¿˜æ˜¯put entry1éƒ½ä¼šå…ˆæŠŠEntry1ä»åŒå‘é“¾è¡¨ä¸­åˆ é™¤ï¼Œç„¶åå†æŠŠEntry1åŠ å…¥åˆ°åŒå‘é“¾è¡¨çš„è¡¨å°¾ã€‚&lt;/li&gt;
&lt;li&gt;3ã€éå†è®¿é—®çš„æ—¶å€™ï¼Œä¼šè®¿é—®headerçš„ä¸‹ä¸€ä¸ªnextèŠ‚ç‚¹ï¼Œè¿™å°±å½¢æˆäº†é¡ºåºè®¿é—®&lt;/li&gt;
&lt;/ul&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1592968145044.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h3 id=&#34;é“¾è¡¨å®ç°&#34;&gt;é“¾è¡¨å®ç°&lt;/h3&gt;
&lt;p&gt;å®ç°æ€è·¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1ã€æ•°æ®æ˜¯ç›´æ¥åˆ©ç”¨ HashMap æ¥å­˜æ”¾çš„ã€‚&lt;/li&gt;
&lt;li&gt;2ã€å†…éƒ¨ä½¿ç”¨äº†ä¸€ä¸ªåŒå‘é“¾è¡¨æ¥å­˜æ”¾æ•°æ®ï¼Œæ‰€ä»¥æœ‰ä¸€ä¸ªå¤´ç»“ç‚¹ headerï¼Œä»¥åŠå°¾ç»“ç‚¹ tailerã€‚&lt;/li&gt;
&lt;li&gt;3ã€æ¯æ¬¡å†™å…¥å¤´ç»“ç‚¹ï¼Œåˆ é™¤å°¾ç»“ç‚¹æ—¶éƒ½æ˜¯ä¾èµ–äº header tailer&lt;br&gt;
&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1592220507945.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;import com.google.common.collect.Maps;
import java.util.Map;

/**
 * çº¿ç¨‹ä¸å®‰å…¨ï¼ŒåŒæ­¥æœºåˆ¶è‡ªè¡Œæ§åˆ¶ã€‚
 */
public class LRUCacheV2 {
    /**
     * ç¼“å­˜map
     */
    private final Map&amp;lt;String, Node&amp;gt; cacheMap;

    /**
     * å¤´æŒ‡é’ˆ
     */
    private Node head;

    /**
     * å°¾æŒ‡é’ˆ
     */
    private Node tail;

    /**
     * å®¹é‡
     */
    private final int cacheSize;

    /**
     * å½“å‰å®¹é‡
     */
    private int currentCacheSize;

    LRUCacheV2(int capacity){
        cacheMap = Maps.newHashMapWithExpectedSize(capacity);
        cacheSize = capacity;
        currentCacheSize = 0;
    }

    public Object get(String key){
        Node node = cacheMap.get(key);
        if(node != null){
            // ç§»åŠ¨åˆ°å¤´æŒ‡é’ˆ
            move2head(node);
            return node.getData();
        }
        return null;
    }

    public void remove(String key){
        Node node = cacheMap.get(key);
        if(node != null){
            Node pre = node.getPre();
            Node next = node.getNext();
            if(pre != null){
                pre.setNext(next);
            }
            if(next != null){
                next.setPre(pre);
            }

            // å¦‚æœåˆ é™¤åˆšå¥½æ˜¯å¤´èŠ‚ç‚¹æˆ–è€…å°¾èŠ‚ç‚¹ï¼Œä¹Ÿè¦ç§»åŠ¨æŒ‡é’ˆ
            if(node.getKey().equals(head.getKey())){
                head = pre;
            }
            if(node.getKey().equals(tail.getKey())){
                tail = next;
            }

            cacheMap.remove(key);
        }
    }

    public void put(String key, Object value){
        Node node = cacheMap.get(key);
        if(node != null){
            // å­˜åœ¨èŠ‚ç‚¹çš„è¯ï¼Œå°±è¦†ç›–ï¼Œå¹¶ä¸”æ”¾åˆ°å¤´
            node.setData(value);
            move2head(node);
            cacheMap.put(key, node);
        }else {
            // ä¸å­˜åœ¨èŠ‚ç‚¹ï¼Œæ„é€ å¹¶ä¸”æ”¾åˆ°å¤´
            if(currentCacheSize == cacheSize){
                // åˆ é™¤å°¾node
                String delKey = tail.getKey();
                cacheMap.remove(delKey);

                // å°¾æŒ‡é’ˆç§»åŠ¨
                Node next = tail.getNext();
                if(next != null){
                    next.setPre(null);
                }
                tail.setNext(null);
                tail = next;

            }else{
                currentCacheSize++;
            }
            node = new Node();
            node.setData(value);
            node.setKey(key);
            // å¤´æŒ‡é’ˆç§»åŠ¨
            move2head(node);
        }
        cacheMap.put(key, node);
    }

    /**
     * èŠ‚ç‚¹ç§»åˆ°å¤´
     */
    private void move2head(Node node){
        if(head == null){
            // åˆå§‹åŒ–head å’Œ tail
            head = node;
            head.setNext(null);
            head.setPre(null);
            tail = node;
        }else {
            // å¦‚æœæ˜¯ç›¸åŒçš„Keyï¼Œå•¥éƒ½ä¸ç”¨åŠ¨ï¼Œnodeå°±æ˜¯æœ€æ–°çš„å¤´
            if(node.getKey().equals(head.getKey())){
                return;
            }

            // æˆªå–node
            Node pre = node.getPre();
            Node next = node.getNext();
            if(pre != null){
                pre.setNext(next);
            }
            if(next != null){
                next.setPre(pre);
            }

            // å¦‚æœè¦æˆªå–çš„èŠ‚ç‚¹æ˜¯å°¾èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå°¾èŠ‚ç‚¹æŒ‡é’ˆä¹Ÿè¦å‘å‰ç§»åŠ¨
            if(node.getKey().equals(tail.getKey())){
                tail = next;
            }

            // æ”¾åœ¨å¤´å‰é¢
            head.setNext(node);
            node.setPre(head);
            // nodeä¸‹ä¸ªæŒ‡é’ˆæŒ‡å‘null
            node.setNext(null);
            head = node;
        }
    }

    @Override
    public String toString() {
        StringBuilder sb = new StringBuilder() ;
        Node node = head;
        while (node != null){
            sb.append(node.getKey()).append(&amp;quot;:&amp;quot;)
                    .append(node.getData())
                    .append(&amp;quot;--&amp;gt;&amp;quot;) ;
            node = node.getPre();
        }
        return sb.toString();
    }

    public static void main(String[] args) {
        LRUCacheV2 lruCacheV2 = new LRUCacheV2(4);
        lruCacheV2.put(&amp;quot;1&amp;quot;,&amp;quot;1&amp;quot;);
        lruCacheV2.put(&amp;quot;2&amp;quot;,&amp;quot;2&amp;quot;);
        lruCacheV2.put(&amp;quot;3&amp;quot;,&amp;quot;3&amp;quot;);
        lruCacheV2.put(&amp;quot;4&amp;quot;,&amp;quot;4&amp;quot;);
        lruCacheV2.put(&amp;quot;5&amp;quot;,&amp;quot;5&amp;quot;);
        //lruCacheV2.get(&amp;quot;2&amp;quot;);
        //lruCacheV2.put(&amp;quot;2&amp;quot;,&amp;quot;22&amp;quot;);
        lruCacheV2.remove(&amp;quot;5&amp;quot;);
        System.out.println(lruCacheV2.toString());
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;é“¾è¡¨å®ç°v2&#34;&gt;é“¾è¡¨å®ç°V2&lt;/h3&gt;
&lt;p&gt;2021.3.15æ›´æ–°&lt;br&gt;
ä¸Šè¿°çš„é“¾è¡¨æœ‰ç‚¹å¤æ‚ï¼Œæ²¡æœ‰è€ƒè™‘åˆ°åˆ©ç”¨mapçš„sizeï¼Œæ²¡æœ‰åˆ©ç”¨å¥½å¤´å°¾èŠ‚ç‚¹åŒå‘ç‰¹æ€§ï¼Œç¬”è€…é‡æ–°å®ç°äº†ä¸‹ï¼Œå‚è€ƒleetcode146é¢˜&lt;br&gt;
å®ç°çš„å‡ ä¸ªè¦ç‚¹&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ„é€ å‡½æ•°ä¸­è¦æ„é€ å¥½å¤´å°¾èŠ‚ç‚¹ï¼Œå½¢æˆæŒ‡é’ˆé—­ç¯ï¼Œä¸ºåç»­çš„å¢åˆ ç§»åšå¥½å‡†å¤‡&lt;/li&gt;
&lt;li&gt;åˆ é™¤èŠ‚ç‚¹çš„æ—¶å€™ï¼Œå¯ä»¥æ ¹æ®mapçš„valueä¹Ÿå°±æ˜¯Nodeçš„keyï¼Œæ¥åˆ é™¤mapä¸­çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥æ ¹æ®mapçš„keyæ¥åˆ é™¤æ•°æ®ï¼Œä¹Ÿå¯ä»¥æ ¹æ®mapçš„valueä¸­çš„keyæ¥åˆ é™¤æ•°æ®&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;package com.zyblue.fastim.common.algorithm.distribute;

import java.util.HashMap;
import java.util.Map;

/**
 * @author will
 * @date 2021/3/15 10:18
 */
public class LRUCacheV3&amp;lt;K, V&amp;gt;{
    public static class Node&amp;lt;K,V&amp;gt;{
        public K key;
        public V value;
        public Node&amp;lt;K,V&amp;gt; pre;
        public Node&amp;lt;K,V&amp;gt; next;
        public Node(){}
        public Node(K key, V value) {
            this.key = key;
            this.value = value;
        }
    }

    /**
     * mapè¿™æ ·è®¾è®¡çš„åŸå› æ˜¯
     * 1ã€
     */
    private Map&amp;lt;K, Node&amp;lt;K,V&amp;gt;&amp;gt; map = new HashMap&amp;lt;&amp;gt;();

    private int capacity;

    private Node&amp;lt;K,V&amp;gt; head;

    private Node&amp;lt;K,V&amp;gt; tail;

    public LRUCacheV3(int capacity){
        this.capacity = capacity;
        this.head = new Node&amp;lt;&amp;gt;();
        this.tail = new Node&amp;lt;&amp;gt;();
        head.pre = tail;
        tail.next = head;
    }

    private void remove2Head(Node&amp;lt;K,V&amp;gt; node){
        Node&amp;lt;K, V&amp;gt; pre = node.pre;
        Node&amp;lt;K, V&amp;gt; next = node.next;
        pre.next = next;
        next.pre = pre;

        add2Head(node);
    }

    private void removeTail(){
        Node&amp;lt;K, V&amp;gt; next = tail.next.next;
        tail.next = next;
        next.pre = tail;
    }

    private void add2Head(Node&amp;lt;K,V&amp;gt; node){
        Node&amp;lt;K, V&amp;gt; pre = head.pre;
        pre.next = node;
        node.next = head;
        node.pre = pre;
        head.pre = node;
    }

    public V get(K key){
        Node&amp;lt;K,V&amp;gt; node = map.get(key);
        if(node == null){
            return null;
        }
        remove2Head(node);
        return node.value;
    }

    public void put(K key, V value){
        Node&amp;lt;K,V&amp;gt; node = map.get(key);
        if(node == null){
            // åˆ©ç”¨mapçš„size
            if(map.size() &amp;gt;= capacity){
                // å»é™¤å°¾éƒ¨èŠ‚ç‚¹
                removeTail();
                // åˆ é™¤mapçš„node
                map.remove(tail.next.key);
            }
            Node&amp;lt;K,V&amp;gt; nodeAdd = new Node&amp;lt;&amp;gt;(key, value);
            add2Head(nodeAdd);
            map.put(key, nodeAdd);
        }else {
            node.value = value;
            remove2Head(node);
        }
    }
}

&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;br&gt;
1ã€https://www.iteye.com/blog/gogole-692103&lt;br&gt;
2ã€https://crossoverjie.top/2018/04/07/algorithm/LRU-cache/&lt;/p&gt;
">O(1)æ—¶é—´å¤æ‚åº¦ä¸‹ï¼ŒåŒå‘é“¾è¡¨å®ç°LRU</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://zhangyaoo.github.io/post/2019-nian-zong-jie/"" data-c="
          &lt;p&gt;å°æç¤ºï¼šé˜…è¯»æ­¤ç¯‡æ–‡ç« å¤§çº¦éœ€è¦ä¸‰åˆ†é’Ÿæ—¶é—´ï¼Œä»¥ä¸‹éƒ½æ˜¯ä¸ªäººä¸€äº›ç”Ÿæ´»å·¥ä½œä¸Šç¢ç¢å¿µå¿µï¼Œå” å¨ç¢è¯­ï¼Œè¯·æ–Ÿé…Œé˜…è¯»~&lt;/p&gt;
&lt;p&gt;ç›®å½•&lt;br&gt;
å¼€å¤´&lt;br&gt;
å­¦ä¹ &lt;br&gt;
å·¥ä½œ&lt;br&gt;
è¿åŠ¨&lt;br&gt;
ç”Ÿæ´»&lt;br&gt;
æ¸¸æˆ&lt;br&gt;
ç¾é£Ÿ&lt;br&gt;
äº²æƒ…&lt;br&gt;
çˆ±æƒ…&lt;br&gt;
2020flag&lt;/p&gt;
&lt;p&gt;â€”â€”â€”â€”â€”â€”â€”â€”æˆ‘æ˜¯åˆ†å‰²çº¿â€”â€”â€”â€”â€”â€”&lt;/p&gt;
&lt;p&gt;å¼€å¤´&lt;br&gt;
åˆè¿‡äº†ä¸€å¹´ï¼Œè®°å¾—ä¸Šä¸€æ¬¡å†™å¹´ç»ˆæ€»ç»“è¿˜æ˜¯åœ¨æˆ‘ç‹—çª(å‡ºç§Ÿæˆ¿)é‡Œé¢å†™çš„ï¼Œè¿™ä¸€æ¬¡æ˜¯åœ¨å—äº¬å—ç«™å¼€å§‹å†™çš„ã€‚&lt;br&gt;
æ·±åœ³çš„å¤©æ°”å°±æ˜¯è¿™ä¹ˆç¥å¥‡ï¼Œä¸€å¹´åˆ°å¤´ç©¿çŸ­è¢–ï¼Œæ›¾å’Œæˆ‘æœ‹å‹ç«‹ä¸‹ä¸€ä¸ªflagï¼Œè¯´åœ¨æ·±åœ³365å¤©300å¤©ç©¿çŸ­è¢–ï¼Œä¸ç„¶å°±æ´—ä¸€ä¸ªæœˆç¢—ï¼Œä¼¼ä¹ä»Šå¹´æ¸©åº¦é™çš„æ—©ï¼Œæ—©æ—©å°±ç©¿ä¸Šäº†çŸ­è¢–ï¼Œ(flagæœç„¶å¯¹äºæˆ‘æ¥è¯´å°±æ˜¯æ‰“è„¸çš„)ï¼Œæ‰€ä»¥æ˜å¹´æ¥å°±ç»™è‡ªå·±è£…é€¼è¡Œä¸ºä»˜å‡ºä»£ä»·ï¼ˆâ•¯&#39; - &#39;)â•¯ï¸µ â”»â”â”»&lt;br&gt;
è¿™é‡Œä¸€ç›´éƒ½æ˜¯å¤å¤©ï¼Œä¸èƒ½åƒå®¶ä¹¡ä¸€æ ·èƒ½æ„Ÿå—åˆ°å››å­£çš„å˜åŒ–ï¼Œæ„Ÿè§‰æ—¶é—´è¿‡çš„ç‰¹åˆ«å¿«ï¼Œæœ‰ä¸€æ¬¡åœ¨å…¬å¸æ•²ä»£ç æ—¶å€™ï¼Œå¬åˆ°äº†é¸Ÿé¸£å£°ï¼Œç¬é—´å°±æƒ³èµ·äº†å®¶ä¹¡ç”°é‡ä¸­çš„é¸Ÿå«è™«é¸£ï¼Œè„‘æµ·é‡Œå°±æµ®ç°äº†é‚£å¹´å¤å¤©ï¼Œåƒç€å†°æ£ï¼Œå¬ç€è‰é¸£çš„æ—§æ—¶å…‰ã€‚&lt;br&gt;
è¿™ä¸€å¹´æœ‰è®¸å¤šå€¼å¾—å†™çš„ä¸œè¥¿ï¼Œç”Ÿæ´»ä¸­çš„å„ä¸ªæ–¹é¢éƒ½æœ‰ã€‚ç”¨æˆ‘è€çˆ¹ä¸€å¥è¯ï¼Œä¸€å¹´æ—¶é—´ä¸ç®¡æ˜¯è¿›æ­¥å¤šå°‘ï¼Œåªè¦ä¸æ˜¯åŸåœ°è¸æ­¥èµ°å°±å¯ä»¥ã€‚è¿™æ¬¡è¿˜æ˜¯åƒ2018å¹´æ€»ç»“ä¸€æ ·ç»™è‡ªå„åšä¸€äº›æ€»ç»“å’Œä¸€äº›ï¼ˆç»™è‡ªå·±æ‰“è„¸çš„ï¼‰flag&lt;/p&gt;
&lt;p&gt;å­¦ä¹ &lt;br&gt;
è¯´èµ·å­¦ä¹ ï¼Œè¿™é‡Œæ”¾åœ¨æœ€å¼€å§‹å†™ï¼Œè‡ªè®¤ä¸ºå­¦ä¹ æ˜¯è‡ªå·±æå‡è‡ªå·±çš„æœ€ç›´æ¥æœ€æœ‰æ•ˆçš„æ–¹å¼ã€‚ä»å°å­¦åˆ°é«˜ä¸­ä»¥è‡³äºå¤§å­¦çš„çŸ¥è¯†ï¼Œéƒ½æ˜¯çš®æ¯›ã€‚é‡è¦æ˜¯åŸ¹å…»äº†å¿«é€Ÿå­¦ä¹ èƒ½åŠ›å’Œè‡ªå­¦çš„ä¹ æƒ¯ï¼Œè¿™ä¸ªå¯ä»¥è¯´æ˜¯è‡ªå„å­¦ä¸šç”Ÿæ¶¯ä¸­è·å¾—æœ€æœ‰ä»·å€¼çš„ä¸œè¥¿äº†ã€‚ä½†æ˜¯è¿™æ˜¯ä¸å¤Ÿçš„ï¼Œå¯¹äºç”Ÿæ´»ä¸­è®¤çŸ¥å’Œå·¥ä½œçš„æ–¹é¢ï¼Œè‡ªæˆ‘ç‹¬ç«‹æ€è€ƒä¹Ÿæ˜¯å¿…ä¸å¯å°‘çš„ã€‚è‡ªå„ä¹Ÿåœ¨ç‰¹æ„å»æ³¨é‡ï¼ŒåŸ¹å…»è‡ªå„çš„ç‹¬ç«‹æ€è€ƒçš„èƒ½åŠ›ã€‚&lt;br&gt;
åœ¨è¿™æ„Ÿè°¢äº‘æ™ºæƒ IPOæ‰€æœ‰åå°åŒå­¦ï¼Œä»¥åŠ@é™ˆç§¦åœ† åŒå­¦ï¼Œè®©è‡ªå·±è®¤è¯†åˆ°ç‹¬ç«‹æ€è€ƒå’Œå›¢é˜Ÿåˆä½œçš„é‡è¦æ€§ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸€å¹´æœ‰å­¦ä¹ åˆ°ä¸œè¥¿æœ‰ï¼š&lt;br&gt;
æå®¢æ—¶é—´çš„æ•°æ®ç»“æ„å’Œç®—æ³•ä¹‹ç¾&lt;br&gt;
è®¾è®¡æ¨¡å¼ä¹‹ç¾(åªçœ‹äº†ä¸€ç« )&lt;br&gt;
ç‰›å®¢ç½‘çš„å‰‘æŒ‡offer(åªåˆ·äº†30é“)&lt;br&gt;
åŠ›æ‰£leetcode(åªåˆ·äº†60é“)&lt;br&gt;
ã€Šnettyå®æˆ˜ã€‹&lt;br&gt;
æ­å»ºå¼€æºé¡¹ç›®fast-imè„šæ‰‹æ¶&lt;br&gt;
é‡‘èä¸šåŠ¡çŸ¥è¯†&lt;br&gt;
æ²ˆå‰‘çš„æ¶æ„å¸ˆä¹‹è·¯ï¼ˆåªçœ‹äº†äºŒåç¯‡ï¼‰&lt;/p&gt;
&lt;p&gt;æ¥å¹´ç›®æ ‡ï¼š&lt;br&gt;
ç»§ç»­å®Œæˆå¼€æºé¡¹ç›®&lt;br&gt;
ç»è¥å¥½ä¸ªäººåšå®¢&lt;br&gt;
æ¶æ„å¸ˆä¹‹è·¯å­¦ä¹ &lt;br&gt;
ã€Šredisè¿›é˜¶ã€‹&lt;br&gt;
ã€Šå‰‘æŒ‡offerã€‹&lt;br&gt;
å¤§æ•°æ®ç›¸å…³çŸ¥è¯†&lt;/p&gt;
&lt;p&gt;çœ‹äº†å…¶ä»–ä¹¦ç±ï¼š&lt;br&gt;
ã€Šäº®å‰‘ã€‹&lt;br&gt;
ã€Šå¯»è·¯ä¸­å›½ã€‹&lt;/p&gt;
&lt;p&gt;ç”»å¤–éŸ³ï¼šä¸€å¹´æ—¶é—´å­¦çš„è¿™ä¹ˆå°‘ï¼Œè¿˜è´´å‡ºæ¥ï¼ˆè„¸çš®æœ‰ç‚¹åšğŸ˜‚ï¼Œæ‰‹åŠ¨ç‹—å¤´ï¼‰&lt;/p&gt;
&lt;p&gt;å·¥ä½œ&lt;br&gt;
åœ¨äº‘æ™ºæƒ çš„ä¸€å¹´åŠæ—¶é—´é‡Œï¼Œè‡ªå„å­¦ä¹ äº†è®¸å¤šå’Œå·¥ä½œç›¸å…³çš„çŸ¥è¯†ï¼Œè®¤è¯†äº†è®¸å¤šä¼˜ç§€çš„åŒå­¦ï¼Œæˆé•¿äº†å¹¶ä¸”æ”¶è·äº†è®¸å¤šï¼Œæ„Ÿè°¢äº‘æ™ºæƒ æä¾›çš„èŒåœºå¹³å°ã€‚è™½ç„¶ç°åœ¨å·²ç»å¿«è¦è§£æ•£äº†ï¼Œä½†æ˜¯è¿˜æ˜¯è¡¨ç¤ºè¡·å¿ƒæ„Ÿè°¢ã€‚æ±Ÿæ¹–å†è§ï¼&lt;/p&gt;
&lt;p&gt;è¿åŠ¨&lt;br&gt;
å”¯ä¸€ä¸€ä¸ªåœ¨2019å¹´ç«‹å¾—æ²¡æœ‰è¢«æ‰“è„¸çš„flagï¼Œå°±æ˜¯è¿åŠ¨ã€‚æ¯å‘¨ä¸€æ¬¡ç¯®çƒæˆ–è€…è·‘æ­¥ã€‚&lt;br&gt;
è·‘æ­¥å‘¢ï¼Œä¸€èˆ¬è·‘ä¸ª4å…¬é‡Œä¸€æ¬¡ã€‚å¤§æ¦‚è·‘äº†äºŒåæ¬¡ï¼Œ100å…¬é‡Œå·¦å³ï¼Œè¿™é‡Œåªè®°å½•äº†ä¸€åŠï¼Œå¦å¤–ä¸€åŠæ²¡æœ‰è®°å½•ï¼ˆè¿™å¥æ˜¯çœŸçš„ï¼‰ã€Œå“­ç¬‘:-Dã€&lt;/p&gt;
&lt;p&gt;ç¯®çƒå‘¢ï¼Œç°åœ¨æŠ•ç¯®ä¸å‡†ï¼Œè¿çƒè¾£çœ¼ç›ï¼Œå·²ç„¶ä¸€å‰¯è€å¹´ç¯®çƒçš„æ ·å­ã€‚ä½†æ˜¯è¿˜æ˜¯é˜»æŒ¡ä¸äº†æˆ‘å–œæ¬¢è¿™ä¸€é¡¹è¿åŠ¨ï¼Œå°±åƒçŒç¯®é«˜æ‰‹åŠ¨æ¼«ä¸­ä¸€å¥è¯â€œæ•™ç»ƒï¼Œæˆ‘æƒ³æ‰“ç¯®çƒâ€è¿™æ ·ï¼Œæºè‡ªäºå†…å¿ƒçš„çƒ­çˆ±ã€‚&lt;/p&gt;
&lt;p&gt;ç”Ÿæ´»&lt;br&gt;
è¿™ä¸€å¹´æˆ‘æƒ³äº†å¾ˆä¹…ï¼Œå¾—åˆ°äº†ä»€ä¹ˆå¤±å»äº†ä»€ä¹ˆã€‚ã€‚æˆ‘æƒ³äº†å¾ˆä¹…ï¼Œçªç„¶æƒ³èµ·æ¥ï¼Œ&lt;br&gt;
å¾—åˆ°çš„å½“ç„¶æ˜¯è‚šå­çš„è‚¥è‚‰èµ˜è‚‰å’¯ï¼Œï¼Œå¤±å»çš„ä½ ä»¬ä¹ŸçŸ¥é“ï¼Œè‚¯å®šæ˜¯æˆ‘ç¨€è–„çš„å¤´å‘ã€‚ã€‚&lt;/p&gt;
&lt;p&gt;å½“è‡ªå„å‘é™…çº¿è¶Šæ¥è¶Šé«˜çš„æ—¶å€™ï¼Œå°±åœ¨æ€è€ƒäººç”Ÿï¼Œä¸ºä»€ä¹ˆé•¿å¾—è¿™ä¹ˆå¸…ï¼Œåˆ°è¦æ‰å¤´å‘&lt;/p&gt;
&lt;p&gt;ä»æ­¤èŠèŠ±èŒ¶â•æ¸æå·²æ˜¯æ ‡é…ï¼Œæ—©ç¡æ—©èµ·å·²æ˜¯äººç”Ÿç®´è¨€ğŸ˜‚ï¼Œç‹—å‘½è¦ç´§&lt;/p&gt;
&lt;p&gt;æ¸¸æˆ&lt;br&gt;
å¹³å¸¸é¸­æ¢¨å¤§æ—¶å€™å¶å°”æ‰“æ‰“æ¸¸æˆæ”¾æ¾æ”¾æ¾ï¼Œ&lt;br&gt;
ä»Šå¹´å‡­å€Ÿè‡ªå·±çš„å¤©èµ‹(è£…ä¸€ä¸‹B)å’Œä¸æ‡ˆåŠªåŠ›ï¼Œæ‰“åˆ°ç™½é‡‘ä¸€ã€‚ç¦»è‡ªå·±çš„å°ç›®æ ‡åˆè¿‘äº†ä¸€æ­¥ï¼Œäº‰å–ä»Šå¹´ä¸Šç –çŸ³ï¼Œè®©æˆ‘å½“ä¸ªç –çŸ³å®ˆé—¨å‘˜ä¹Ÿè¡ŒğŸ¤ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™å†™ä¸Šæœ€å–œæ¬¢è‹±é›„çš‡å­çš„å°è¯ï¼šâ€œæ‰€åˆ°ä¹‹å¤„ï¼Œæ— äººèƒ½æŒ¡ï¼â€&lt;/p&gt;
&lt;p&gt;ç¾é£Ÿ&lt;/p&gt;
&lt;p&gt;ä»€ä¹ˆæœ€é‡è¦ï¼Œå½“ç„¶æ˜¯åƒã€‚&lt;br&gt;
æƒ³æƒ³è¿™ä¸€å¹´åšçš„ç¾é£Ÿï¼Œå’ŒåŒå­¦ä¸€èµ·åšçš„ï¼Œæ­¤å¤„@è‚‰å’Œæ¨ä¸½ä¸½ï¼Œæ„Ÿè°¢ä¸€èµ·ç›¸å¤„ä¸€å¹´ï¼Œå­¦åˆ°äº†å¾ˆå¤šç¾é£Ÿæ˜¯å¦‚ä½•åšçš„ï¼Œæˆ‘èº«è¾¹çš„éšè—å¤§å¨ğŸ˜‚ã€‚&lt;br&gt;
ä»Šå¹´å­¦åˆ°äº†æœ‰çº¢çƒ§é²«é±¼ï¼Œç³–é†‹æ’éª¨ï¼Œè‘±èŠ±é¥¼ï¼Œå¯ä¹é¸¡ç¿…ï¼Œçº¢çƒ§è‚‰ï¼Œè‡ªåˆ¶å‡‰èœï¼Œæ°´ç…®è‚‰ç‰‡ï¼Œè‡ªåˆ¶çƒ¤é±¼ï¼Œå›é”…è‚‰ç­‰ç­‰ç­‰ç­‰ï¼Œå°±æ”¾ä¸€å¼ å’ŒåŒå­¦ä¸€èµ·åšé¥ºå­çš„å›¾ç‰‡ï¼Œä¸å¤šæ”¾äº†ï¼Œå…å¾—æ™šä¸Šä¸­æ¯’å¤ªæ·±ã€‚ã€‚ã€‚&lt;/p&gt;
&lt;p&gt;ç”»å¤–éŸ³ï¼šä¸Šé¢é¥ºå­ï¼ˆçœ‹èµ·æ¥åƒï¼‰çœŸçš„ä¸æ˜¯æˆ‘åŒ…çš„&lt;/p&gt;
&lt;p&gt;äº²æƒ…&lt;br&gt;
ç‰¹åˆ«å–œæ¬¢ã€Šè¯·å›ç­”1988ã€‹é‡Œé¢å®¶åº­äº²æƒ…ï¼Œæ•´éƒ¨ç‰‡è™½ç„¶ä¸ä¹çˆ±æƒ…å‹æƒ…ç­‰ï¼Œä½†æ˜¯æˆ‘è§‰å¾—æ ¸å¿ƒæ˜¯äº²æƒ…ï¼Œæœ€æœ‰å°è±¡è¿˜æ˜¯å®æ‹‰å¦ˆå¦ˆä¸‹é›¨å¤©æŠ¤ç€å®æ‹‰é‚£æ®µã€‚&amp;quot;äººçœŸæ­£å˜å¼ºå¤§ï¼Œä¸æ˜¯å› ä¸ºå®ˆæŠ¤ç€è‡ªå°Šå¿ƒï¼Œè€Œæ˜¯æŠ›å¼€è‡ªå°Šå¿ƒçš„æ—¶å€™ï¼Œå› ä¸ºæœ‰éœ€è¦å®ˆæŠ¤çš„äºº&amp;quot;&lt;br&gt;
è¿™å¥è¯è¿˜æ˜¯éœ€è¦è‡ªå·±å»ç»å†ä½“ä¼šçš„ã€‚&lt;br&gt;
ä»¥å‰è§‰å¾—ï¼Œå‡ºçœä¸Šå­¦ï¼Œå‡ºçœå·¥ä½œï¼Œå¯ä»¥ç¦»å®¶äººè¿œä¸€ç‚¹ï¼Œå°±åƒæ˜¯æ˜¥å¤©çš„ç‡•å­ï¼Œé•¿å¤§äº†éƒ½æƒ³çœ‹çœ‹å¤–é¢çš„ä¸–ç•Œï¼Œå»é—¯è¡å»ç»å†ï¼Œå»ä¸°å¯Œè‡ªå·±çš„ç”Ÿæ´»å¢é•¿è‡ªå·±è§è¯†ã€‚å¯åˆ°äº†ä¸€å®šçš„å¹´é¾„æˆ–è€…è®¤çŸ¥ï¼Œä¼šæ„è¯†åˆ°ï¼Œæœ‰å®¶äººåœ¨çš„åœ°æ–¹ï¼Œéƒ½è§‰å¾—å¾ˆçŸ¥è¶³ã€‚ç‰¹åˆ«å–œæ¬¢ã€Šå››ä¸ªæ˜¥å¤©ã€‹çºªå½•ç‰‡é‡Œé¢ç‡•å­å½’æ¥ä¹‹æ—¶ï¼Œé‚£ç§æ„Ÿè§‰ï¼Œçºªå½•ç‰‡ä¸­çˆ¶æ¯çœ‹åˆ°ç‡•å­å½’æ¥ï¼Œå¿ƒé‡Œå¿µå¨ç€ï¼Œå’±å®¶å°ç‡•å­ä¹Ÿè¯¥å›å®¶äº†ã€‚&lt;/p&gt;
&lt;p&gt;çˆ±æƒ…&lt;br&gt;
æ„Ÿè°¢å…šæ„Ÿè°¢å›½å®¶ç»™æˆ‘å‘äº†ä¸€ä¸ªå¥³æœ‹å‹ï¼Œå…è´¹æ»´ã€‚&amp;lt;( Ë˜ Â³Ë˜)/ğŸ’¯&lt;br&gt;
ä»Šå¹´æœ€å¤§æ”¶è´§ï¼Œå½“ç„¶æ˜¯é‡åˆ°æ–¹å°çš®åŒå­¦å•¦ï¼Œï¼ˆé»˜é»˜æ’’ä¸€ä¸‹æ–°é²œç‹—ç²®ï¼‰å¸Œæœ›åœ¨ä»¥åçš„æ—¥å­é‡Œï¼Œä½ èƒ½å¤Ÿæ—©ç¡æ—©èµ·ï¼Œåƒå¥½å–å¥½ï¼Œèº«ä½“æ£’æ£’ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åè‚¯å®šæ˜¯å†™ä¸€äº›æ‰“è„¸çš„ä¸œè¥¿ã€‚ã€‚&lt;br&gt;
2020å¹´flag&lt;br&gt;
è‡ªä¿¡&lt;br&gt;
ä¸€å‘¨ä¸€æ¬¡è·‘æ­¥æˆ–è€…ç¯®çƒ&lt;br&gt;
çœ‹å®Œå‰©ä½™ä¹¦ç±&lt;br&gt;
ç»è¥å¥½ä¸ªäººåšå®¢&lt;br&gt;
æ´—è„šåŸæ´—ä¸€æ¬¡è„š(æœ‰ä»€ä¹ˆä¸œè¥¿æ¸—å…¥è¿›æ¥äº†)&lt;br&gt;
ä½“é‡ä¸è¶…130&lt;br&gt;
æ—©ç¡æ—©èµ·ï¼Œ11ç‚¹ä¹‹å‰ç¡ï¼ˆè™½ç„¶æ˜¯ä¸å¯èƒ½çš„ï¼‰&lt;br&gt;
å­¦ä¹ å¤§æ•°æ®ç›¸å…³çŸ¥è¯†&lt;br&gt;
ä¿æŠ¤çœ¼ç›&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šï¼Œå®Œ&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://zhangyaoo.github.io/post-images/1593268924481.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æœ€åè´´ä¸Šè‡ªå„æœ€å–œæ¬¢çš„ç…§ç‰‡ï¼Œ2015å¹´äºè¥¿è—æ‹&lt;/p&gt;
">2019å¹´æ€»ç»“</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://zhangyaoo.github.io/post/about/"" data-c="
          &lt;blockquote&gt;
&lt;p&gt;æ¬¢è¿æ¥åˆ°æˆ‘çš„å°ç«™å‘€ï¼Œå¾ˆé«˜å…´é‡è§ä½ ï¼ğŸ¤&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;å…³äºæœ¬ç«™&#34;&gt;ğŸ  å…³äºæœ¬ç«™&lt;/h2&gt;
&lt;p&gt;ä¸€äº›æŠ€æœ¯åšå®¢å’Œä¸€äº›é—²è¨€ç¢è¯­&lt;/p&gt;
&lt;h2 id=&#34;åšä¸»æ˜¯è°&#34;&gt;ğŸ‘¨â€ğŸ’» åšä¸»æ˜¯è°&lt;/h2&gt;
&lt;p&gt;è¿˜åœ¨æ‰“æ€ªå‡çº§çš„èœé¸Ÿ&lt;/p&gt;
&lt;h2 id=&#34;å…´è¶£çˆ±å¥½&#34;&gt;â›¹ å…´è¶£çˆ±å¥½&lt;/h2&gt;
&lt;p&gt;æ’¸ç ã€äºŒæ¬¡å…ƒã€éª‘è¡Œã€ç¯®çƒã€LOL&lt;/p&gt;
&lt;h2 id=&#34;è”ç³»æˆ‘å‘€&#34;&gt;ğŸ“¬ è”ç³»æˆ‘å‘€&lt;/h2&gt;
&lt;p&gt;æ‰‹æœºï¼ˆå¾®ä¿¡åŒï¼‰ï¼š15112342449&lt;/p&gt;
">å…³äº</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://zhangyaoo.github.io/post/2018-nian-zong-jie/"" data-c="
          &lt;h2 id=&#34;å†™ç»™è‡ªå·±çš„2018å¹´æ€»ç»“&#34;&gt;å†™ç»™è‡ªå·±çš„2018å¹´æ€»ç»“&lt;/h2&gt;
&lt;h2 id=&#34;é¢˜è®°&#34;&gt;é¢˜è®°&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://img-blog.csdnimg.cn/20181231115831927.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p5MTUxMTIzNDI0NDk=,size_16,color_FFFFFF,t_70&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
ä¸è§‰ä¸­ï¼Œ2018å¹´å°±å¿«è¿‡äº†ï¼Œåœ¨è¿™ä¹‹å‰ä»æ¥æ²¡æœ‰å†™è¿‡ä¸€äº›æ€»ç»“æ€§çš„æ–‡ç« ï¼Œä»å°å­¦åˆä¸­æ—¥å¿—ä½œä¸šï¼Œåˆ°é«˜ä¸­çš„æ—¥å¤ä¸€å¤œçš„å­¦ä¹ å†åˆ°å¤§å­¦çš„æµ‘æµ‘å™©å™©çš„åƒµç¡¬å¼çš„å­¦ä¹ ï¼Œä¸€ç›´éƒ½åœ¨è¿›è¡Œæµæ°´è´¦å¼çš„å­¦ä¹ è¾“å…¥ï¼Œä»æ²¡æœ‰å†™è¿‡å…³äºä¸€å¹´çš„è®¡åˆ’ç”šè‡³æ˜¯ä¸€ä¸ªæœˆçš„å°ç›®æ ‡ã€‚&lt;/p&gt;
&lt;p&gt;è‡³äºä¸ºä»€ä¹ˆè¦åšè¿™ä¸ªæ€»ç»“ï¼Œæˆ‘æƒ³æ˜¯å› ä¸ºï¼Œå¹´å¤ä¸€å¹´çš„åº¦è¿‡ï¼Œæœ‰æ—¶å€™è‡ªå·±éƒ½ä¸çŸ¥é“åœ¨è¿™ä¸€å¹´å¹²è¿‡ä»€ä¹ˆäº‹æƒ…ã€æ”¶è·äº†ä»€ä¹ˆå’Œå¤±å»äº†ä»€ä¹ˆï¼ŒåŒ…æ‹¬å¯¹å‹æƒ…ã€äº²æƒ…å’Œäº‹ä¸šç­‰ç­‰ã€‚æ˜¯å› ä¸ºæˆ‘è®°æ€§å¤ªå·®ï¼Œè¿˜æ˜¯è¯´åœ¨è¿™ä¸ªå¨±ä¹ä¿¡æ¯çˆ†ç‚¸çš„æ—¶ä»£ï¼Œæˆ‘æ³¨æ„åŠ›éƒ½é›†ä¸­åœ¨å¿«é¤å¼çš„çš„è®¤çŸ¥ä¸Šï¼Œå¾ˆéš¾æœ‰ç²¾åŠ›æˆ–è€…é›†ä¸­æ³¨æ„åŠ›å»æ±²å–è‡ªå·±æƒ³è¦çš„é«˜è´¨é‡çš„ä¿¡æ¯ä¸Šï¼Œä¸å¾—è€ŒçŸ¥ã€‚æ‰€ä»¥ä»Šå¹´æˆ‘è§‰å¾—æœ‰å¿…è¦å»æ€»ç»“è‡ªå·±çš„è¿™ä¸€å¹´ã€‚&lt;/p&gt;
&lt;p&gt;æ€»ç»“ç›®å½•ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å…³äºæŠ€æœ¯&lt;/li&gt;
&lt;li&gt;å…³äºè®¤çŸ¥&lt;/li&gt;
&lt;li&gt;å…³äºä¸ºäººå¤„äº‹&lt;/li&gt;
&lt;li&gt;å…³äºå‹æƒ…çˆ±æƒ…äº²æƒ…&lt;/li&gt;
&lt;li&gt;2019å±•æœ›&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;1-å…³äºæŠ€æœ¯&#34;&gt;1ã€å…³äºæŠ€æœ¯&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://img-blog.csdnimg.cn/20181231120336118.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p5MTUxMTIzNDI0NDk=,size_16,color_FFFFFF,t_70&#34; alt=&#34;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
1ã€æŠ€æœ¯ç§¯ç´¯&lt;br&gt;
å¸ˆèŒƒä¸“ä¸šæ¯•ä¸šçš„æˆ‘ä»å¤§ä¸‰å¼€å§‹æ¥è§¦è®¡ç®—æœºï¼Œå¤§ä¸‰é‚£å¹´å­¦çš„ç½‘ç»œå·¥ç¨‹ï¼Œè¿˜è€ƒäº†ä¸ªCCNAï¼Œç›®å‰å‘ç°æ²¡æœ‰ä»€ä¹ˆç”¨ï¼Œå¯¹äºç°åœ¨çš„æˆ‘æ¥è¯´ã€‚ç„¶åè¢«ä½åœ¨ä¸Šé“ºçš„å…„å¼Ÿ67ä»£å…¥å‘é‡Œå­¦ä¹ codeæ¬ç –ï¼Œä»é‚£å¼€å§‹ä¾¿ä¸€å‘ä¸å¯æ”¶æ‹¾ï¼ŒåŸ‹å¤´è‹¦å­¦ï¼Œè¿æ•™å¸ˆèµ„æ ¼è¯éƒ½ä¸è€ƒï¼Œè·‘å‡ºå»å…¬å¸é‡Œé¢å½“å°å¼Ÿå®ä¹ ã€‚è‡³æ­¤å°±å¼€å§‹æŠ€æœ¯ç§¯ç´¯ä¹‹è·¯äº†ã€‚&lt;/p&gt;
&lt;p&gt;å½“å°å¼Ÿé‚£ä¸€æ®µæ—¶é—´ï¼Œå°±åƒåˆšèŒå‘çš„ç§å­ä¸€æ ·ç–¯ç‹‚å¸æ”¶è¥å…»ï¼Œå­¦äº›äº†pythonçˆ¬è™«ã€python webå¼€å‘ã€Javaå…¬ä¼—å·å¼€å‘ï¼ŒSSM Javaå…¨å®¶æ¡¶å¼€å‘ã€‚è¿™äº›éƒ½æ˜¯åœ¨å­¦æ ¡å­¦ä¸åˆ°çš„ä¸œè¥¿ï¼Œå½“æ—¶æ„Ÿè§‰è‡ªå·±å¾ˆç‰›é€¼ï¼Œç›´åˆ°æ¯•ä¸šæ‰¾å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;æ¯•ä¸šé‚£ä¸€åˆ»èµ·ï¼Œå› ä¸ºæŠ€æœ¯å‘å±•ç“¶é¢ˆï¼Œæˆ‘åˆèƒŒä¸Šè¡Œå›Šæ¨ªè·¨å¤§åŠä¸ªä¸­å›½ä»å±±ä¸œå»å—æ–¹ä¸€çº¿åŸå¸‚æ¼‚ã€‚æ‹¿è¿™è‡ªä»¥ä¸ºé«˜å¤§ä¸Šçš„ç®€å†å»æŠ•é€’ï¼Œç„¶åé¢è¯•ï¼Œæƒ¨é­é¢è¯•å®˜çš„å•ªå•ªæ‰“è„¸ï¼Œè¿ä¸€ä¸ªhashmapçš„åº•å±‚åŸç†éƒ½ä¸çŸ¥é“ï¼Œæœ€æœ‰å°è±¡çš„æ˜¯Java å¾ªç¯åˆ é™¤listæ€ä¹ˆåˆ é™¤ï¼Œå›ç­”å®Œååˆ«é¢è¯•å®˜ä¸€è„¸å«Œå¼ƒ-ã€‚-&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åªä¼šæ‹¿ç€ç°æˆçš„æ¡†æ¶å’Œåº”ç”¨å»ç”¨ï¼Œè€Œä¸çŸ¥é“åº•å±‚çš„å®ç°æ–¹å¼å’ŒåŸç†ï¼Œé‚£ä¹ˆå·¥ä½œæ€§è´¨å°±å’Œç½‘ç®¡å·®ä¸å¤š&lt;/strong&gt;ã€‚&lt;br&gt;
ä¸ä¼šä¸¾ä¸€åä¸‰ï¼Œå¦‚æœåˆæœ‰æ–°çš„æ¡†æ¶å‡ºæ¥åˆå¿…é¡»è¦å­¦ä¹ ä¸€éï¼Œå¦‚æœè¯´æŒæ¡äº†åº•å±‚å·¥ä½œåŸç†ï¼Œé‚£ä¹ˆç”¨èµ·æ¥ä¼šèˆ’æœå¾ˆå¤šã€‚&lt;/p&gt;
&lt;p&gt;2ã€æŠ€æœ¯åˆ†äº«&lt;br&gt;
&lt;img src=&#34;https://img-blog.csdnimg.cn/20181231124820725.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p5MTUxMTIzNDI0NDk=,size_16,color_FFFFFF,t_70&#34; alt=&#34;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
&lt;strong&gt;åˆ†äº«çš„ä¹è¶£ï¼Œä»ä¸€å¼€å§‹å°±åœä¸ä¸‹æ¥ã€‚&lt;/strong&gt;&lt;br&gt;
å…¬å¸ä¼šå‘¨æœŸæ€§çš„é€‰ä¸€äº›å½“ä¸‹çƒ­é—¨çš„æŠ€æœ¯è®©æˆ‘ä»¬å»ç ”ç©¶ï¼Œç„¶åå»æŠŠè‡ªå·±ç ”ç©¶çš„å†…å®¹åˆ†äº«å‡ºæ¥ã€‚æˆ‘è®¤ä¸ºè¿™æ˜¯éå¸¸æ£’çš„ä¸€ç§å­¦ä¹ æ–¹å¼ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ã€‚å› ä¸ºè¿™ä¸ªæ˜¯éå¸¸å…·ä½“æŒ‘æˆ˜æ€§çš„ï¼Œä½ ç†è§£äº†æ˜¯ä¸€ä¸ªå±‚æ¬¡ï¼Œå¦‚æœè¯´è¦ç»™åˆ«äººå°†æ˜ç™½åˆæ˜¯å¦å¤–ä¸€ä¸ªå±‚æ¬¡ï¼Œè¿™æ˜¯ä¸¤ä¸ªä¸åŒå±‚æ¬¡çš„æ¦‚å¿µã€‚å¦‚æœè¯´ä½ çš„è¯­è¨€è¡¨è¾¾æ€§ä¸è¡Œï¼Œé‚£ä¹ˆè¿™ä¸ªå°±æ˜¯æ›´åŠ éš¾ä¸ŠåŠ éš¾äº†ã€‚&lt;/p&gt;
&lt;p&gt;åˆ†äº«çš„ä¹è¶£ä¸ä»…æ˜¯è¿™ä¸ªï¼Œå½“ä½ ç»™åˆ«äººè®²å®Œåï¼Œä½ è¿˜å¯ä»¥é€šè¿‡åˆ«äººæä¾›çš„é—®é¢˜å’Œå»ºè®®æ–¹æ¡ˆï¼Œå’Œä½ è‡ªå·±çš„ç†è§£è¿›è¡Œç¢°æ’ï¼Œç„¶åäº§ç”Ÿæ–°çš„è®¤çŸ¥å…ƒç´ ï¼Œåˆ°ä¸‹ä¸€æ¬¡åˆ†äº«å°±å¯ä»¥èå…¥ä¸Šæ¬¡åˆ†äº«çš„è®¤çŸ¥è¿›æ¥ã€‚&lt;/p&gt;
&lt;p&gt;åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘è¿˜åœ¨æƒ³ï¼Œæ€ä¹ˆåœ¨ç»™åˆ«äººè®²è§£åˆ†äº«çš„æ—¶å€™èƒ½å¤Ÿæ›´èƒ½è®©åˆ«äººå¬æ‡‚ï¼Œè€Œä¸”æ„¿æ„å»å¬ã€‚æˆ‘æœ€æ€•è¿˜æ˜¯åœ¨åˆ†äº«çš„æ—¶å€™åˆ«äººåœ¨ç©æ‰‹æœºã€‚å› ä¸ºæœ‰äº†è¿™ä¸ªç°è±¡å°±è¡¨æ˜ä½ çš„åˆ†äº«åšçš„ä¸å¤Ÿå¥½ã€‚&lt;/p&gt;
&lt;p&gt;3ã€ä¹¦ç±&lt;br&gt;
&lt;strong&gt;åœ¨è¿™ä¸ªæ‰‹æœºä¸‡èƒ½çš„æ—¶ä»£ï¼Œèƒ½å¤Ÿé™ä¸‹å¿ƒæ¥çœ‹å®Œä¸€æœ¬ä¹¦å¹¶ç†è§£æ˜¯éå¸¸ä¸å®¹æ˜“çš„&lt;/strong&gt;ã€‚&lt;br&gt;
æˆ–è®¸ä½ ä»¬éƒ½è¯´å“ªæœ‰æ—¶é—´çœ‹ä¹¦ï¼Œéƒ½å¿™å·¥ä½œä»»åŠ¡äº†ï¼Œç”šè‡³æœ‰æ—¶å€™æˆ‘è‡ªå·±éƒ½ä¸æ•¢è¯´ä¸€ä¸ªæœˆçœ‹å®Œä¸€æœ¬ä¹¦ï¼Œä¸ç®¡æ˜¯æ–‡å­¦è¿˜æ˜¯ä¸“ä¸šæŠ€æœ¯æ€§ä¹¦ç±ã€‚&lt;/p&gt;
&lt;p&gt;ä»Šå¹´ï¼Œæˆ‘çœ‹äº†ä»¥ä¸‹å‡ æœ¬ä¹¦ï¼Œæœ‰çš„åªçœ‹äº†ä¸€æœ¬ä¹¦ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯æ¶‰åŠä¸“ä¸šæŠ€æœ¯çš„ï¼šNettyæƒå¨æŒ‡å—ã€æ·±å…¥ç†è§£Javaå¤šçº¿ç¨‹ã€JavaEEäº’è”ç½‘è½»é‡çº§æŠ€æœ¯æ•´åˆå¼€å‘ã€Javaé«˜å¹¶å‘ç¨‹åºè®¾è®¡ã€‚è¿˜æœ‰å…¶ä»–çš„ä¸€äº›éæŠ€æœ¯ä¹¦å°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ã€‚ä¸€å¹´æ‰çœ‹è¿™å‡ æœ¬ä¹¦çœŸæ˜¯æœ‰ç‚¹ä¸¢äºº-ã€‚-&lt;/p&gt;
&lt;p&gt;è‡ªè®¤ä¸ºç½‘ç»œæŠ€æœ¯åšå®¢å’Œçº¸è´¨ä¹¦è¿˜æ˜¯æœ‰å„æœ‰å„è‡ªçš„å­˜åœ¨çš„æ„ä¹‰çš„ã€‚å°±æ‹¿çº¸è´¨ä¹¦æ¥è¯´ï¼Œå®ƒèƒ½å¤Ÿé€šè¿‡ä¸€ç³»åˆ—çš„ç›®å½•ï¼Œèƒ½å¤Ÿä»åŸºæœ¬æ¥æºã€åŸºæœ¬åŸç†ã€ä½¿ç”¨åœºæ™¯ã€åº•å±‚åŸç†æŠ€æœ¯ã€å·¥ä½œåº”ç”¨åœºæ™¯æ¥ä¸€ä¸€è¿›è¡Œæœ‰é¡ºåºçš„ç»™äººä»¥çœŸæ­£ç†è§£å’ŒæŒæ¡ã€‚ä¸éœ€è¦è‡ªå·±ä»ç½‘ä¸Šæœåˆ†æ•£çš„çŸ¥è¯†ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¸æ˜¯çœ‹å®Œä¹¦åå°±å®Œäº†ï¼Œè¿˜éœ€è¦è‡ªå·±é€šè¿‡å®è·µå»è¯æ˜ä½ è‡ªå·±çš„ç†è§£æ˜¯å¦æ­£ç¡®&lt;/strong&gt;ï¼Œè¿™ä¹Ÿæ˜¯ä¸ªä¸å¯æ¬ ç¼ºçš„è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆè¿˜éœ€è¦è¯»ä¹¦å‘¢ï¼Œæˆ‘è®¤ä¸ºç½‘ä¸Šä¸€å¥è¯è¿˜æ˜¯ä¸é”™çš„ï¼Œæ˜¯ã€Šç‰©æ¼”é€šè®ºã€‹ä½œè€…ç‹ä¸œå²³è¯´çš„ï¼šâ€œå› ä¸ºé€šè¿‡ç”µè§†æˆ–è€…å…¶ä»–æ–¹å¼æœé›†çš„ä¿¡æ¯ï¼Œå³é‚£ç§é€šè¿‡ç›´è§‚æ–¹å¼æ¥å—çš„çŸ¥è¯†ï¼Œæ˜¯æœ€æµ…æ˜¾ã€æœ€ç²—ç–ä¸”æ²¡æœ‰ç»è¿‡ç²¾å¯†é€»è¾‘è¯æ˜çš„ä¸œè¥¿â€ã€‚&lt;/p&gt;
&lt;p&gt;4ã€æ€è€ƒ&lt;br&gt;
&lt;img src=&#34;https://img-blog.csdnimg.cn/20181231141547586.png&#34; alt=&#34;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å…³äºç¨‹åºå‘˜æŠ€æœ¯æ·±åº¦å’Œå¹¿åº¦çš„é€‰æ‹©ï¼Œä¹Ÿæ˜¯ä»ç½‘ä¸Šçœ‹çš„ä¸€å¥è¯ï¼ŒOracleæŠ€æœ¯å¤§ç‰›æ¨æ™“å³°æŒ‡å‡ºï¼šâ€œ&lt;strong&gt;æŠ€æœ¯äººå…ä¸äº†è¦æ„å»ºå¹¿æ³›çš„çŸ¥è¯†ä½“ç³»ï¼Œä½†ç»ˆç©¶è¿˜æ˜¯è¦å…‹åˆ¶ä½è¯±æƒ‘ï¼Œå°†æŸä¸ªé¢†åŸŸåšåˆ°ç²¾æ·±&lt;/strong&gt;ã€‚æ°´æ¡¶çš„æ°´é‡å–å†³äºæœ€çŸ­æ¿ï¼Œä½†æ˜¯å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åœ¨å·¥ä½œä¸­çš„å›æŠ¥ï¼Œæ›´å¤šçš„æºè‡ªäºè‡ªèº«çš„é•¿å¤„ï¼Œç”šè‡³æŸç§ç¨‹åº¦ä¸Šè¿˜å†³å®šäº†æˆ‘ä»¬æ˜¯æ‹¥æœ‰è‡ªå·±é€‰æ‹©çš„è‡ªç”±ï¼Œè¿˜æ˜¯ç–²äºå¥”å‘½ï¼Œå¿…ç»æˆ‘ä»¬æ¯ä¸ªäººçš„ä½“åŠ›ã€ç»å†æœ‰ç°å®çš„ä¸Šé™çš„â€ã€‚&lt;br&gt;
è‡ªè®¤ä¸ºè¿˜æ˜¯å¾ˆæœ‰é“ç†çš„ï¼Œå…ˆå»ºç«‹è‡ªå·±å¹¿åº¦ç½‘ï¼Œç„¶åä¸“é—¨æ‰¾ä¸€é¡¹è‡ªå·±å–œæ¬¢çš„æ–¹å‘ï¼Œç„¶åæ”¾å¼€æ‰‹è„šå»ç ”ç©¶ã€‚è‡³å°‘è¦æœ‰ä¸€ä¸ªéå¸¸æ·±çš„é¢†åŸŸçŸ¥è¯†ï¼Œæ‰€è°“çŸ¥è¯†ä½“ç³»çš„æ­å»ºæ˜¯åŸºäºå¤šä¸ªæ‰å®çš„çŸ¥è¯†ç‚¹æ±‡é›†è€Œæˆï¼Œç‚¹ä¸æ‰å®ä¸æ·±å…¥ã€‚&lt;/p&gt;
&lt;h2 id=&#34;2-å…³äºè®¤çŸ¥&#34;&gt;2ã€å…³äºè®¤çŸ¥&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://img-blog.csdnimg.cn/20181231154812245.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p5MTUxMTIzNDI0NDk=,size_16,color_FFFFFF,t_70&#34; alt=&#34;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
1ã€&lt;strong&gt;äººä¸äººæœ€å¤§çš„ä¸åŒï¼šè®¤çŸ¥ä¸åŒ&lt;/strong&gt;&lt;br&gt;
æˆ‘è®¤ä¸ºçš„æˆé•¿å°±æ˜¯è®¤çŸ¥æˆé•¿ï¼Œæ˜¯å¯¹ä¸€é—´äº‹ç‰©çš„ç†è§£å’Œå¤„ç†æ–¹æ³•ã€‚ç”±äºæ¯ä¸ªäººçš„å‡ºç”Ÿå®¶å¢ƒä¸åŒï¼Œç”Ÿæ´»ç¯å¢ƒä¸åŒï¼Œä¹Ÿå°±å½±å“äº†æ¯ä¸ªäººçš„è®¤çŸ¥ï¼Œæ‰€ä»¥äººæ‰ä¼šæœ‰å„è‡ªçš„æƒ³æ³•ï¼Œåšäº‹å‡†åˆ™å’Œå¤„ä¸–æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;2ã€&lt;strong&gt;ä¸æ–­å­¦ä¹ ï¼Œä½¿è‡ªå·±æ›´å€¼é’±ã€‚&lt;/strong&gt;&lt;br&gt;
éƒ½è¯´2018å¹´æ˜¯äº’è”ç½‘å¯’å†¬ï¼Œä½†æ˜¯å¯¹æˆ‘ä»¬æŠ€æœ¯äººæ¥è¯´ï¼Œéš¾ä»¥æ„æˆå½±å“ï¼Œå› ä¸ºåªè¦ä½ æœ‰è¶³å¤Ÿçš„æŠ€æœ¯åº•å­ï¼Œåœ¨å“ªéƒ½å¯ä»¥å…»æ´»è‡ªå·±ã€‚ç”¨æˆ‘ä»¬å®¶ä¹¡è¯æ¥è¯´ï¼Œâ€å­¦å¥½æŠ€æœ¯ï¼Œèµ°åˆ°å¤©ä¸‹éƒ½ä¸æ€•â€œï¼Œè¿™é‡Œæˆ‘ç§è‡ªæŠŠç‰©ç†åŒ–æ”¹æˆæŠ€æœ¯ï¼Œå“ˆå“ˆã€‚&lt;br&gt;
ç»å¸¸éƒ½èƒ½åœ¨ç½‘ä¸Šçœ‹åˆ°ä¸€å¥è¯ï¼Œâ€&lt;strong&gt;äººç”Ÿæœ€é‡è¦çš„æŠ•èµ„æ˜¯è‡ªå·±ã€‚ä½¿è‡ªå·±æ›´å€¼é’±æ‰æ˜¯ç«‹èº«ä¹‹æœ¬ã€‚&lt;/strong&gt;â€œ&lt;/p&gt;
&lt;p&gt;3ã€&lt;strong&gt;é«˜è´¨é‡çš„è¾“å…¥é‡è¦ï¼Œè¾“å‡ºæ¯”è¾“å…¥æ›´é‡è¦&lt;/strong&gt;&lt;br&gt;
å°±æ‹¿çœ‹ä¹¦å†™æ–‡ç« æ¥è¯´ï¼Œå½“æˆ‘ä»¬è¦å†™ç±»ä¼¼é«˜è€ƒé‚£ç§ä½œæ–‡é¢˜ç›®æ—¶å€™ï¼Œå¦‚æœè¿™æ—¶è¯»æ­¦ä¾ å°è¯´ï¼Œé‚£ä¹ˆè‚¯å®šæ˜¯å¯¹äºå†™ä½œæ–‡æ˜¯æ— ç›Šçš„ï¼Œè¿™å°±æ˜¯ä½è´¨é‡çš„è¾“å…¥ï¼Œå¦‚æœçœ‹ä¸€äº›æ–‡å­¦æ–¹é¢çš„ä¹¦çš„è¯ï¼Œé‚£ä¹ˆå¯¹äºå†™ä½œæ˜¯éå¸¸æœ‰å¥½å¤„çš„ã€‚&lt;br&gt;
ä½†æ˜¯ä¸€å‘³çš„è¾“å…¥ï¼Œæå‡çš„æ„ä¹‰ä¸é«˜ï¼Œä¸ªäººè§‚ç‚¹ã€‚æ¯”å¦‚æˆ‘ä»å°å­¦åˆ°å¤§ï¼Œåˆ°ç°åœ¨éƒ½æ²¡å†™è¿‡æ–‡ç« çš„è¯ï¼Œä»¥å‰åœ¨é«˜ä¸­å­¦ä¹ çš„å†™æ–‡ç« çš„èƒ½åŠ›éƒ½æ²¡æœ‰äº†ã€‚æ‰€ä»¥å¦‚æœä¸å»è¾“å‡ºï¼Œé‚£ä¹ˆå­¦ä¹ åˆ°çš„ä¸œè¥¿å°†åœ¨ä»¥åæŸä¸ªæ—¶åˆ»éƒ½ä¼šå¿˜è®°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;3-å…³äºä¸ºäººå¤„äº‹&#34;&gt;3ã€å…³äºä¸ºäººå¤„äº‹&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://img-blog.csdnimg.cn/20181231150512794.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p5MTUxMTIzNDI0NDk=,size_16,color_FFFFFF,t_70&#34; alt=&#34;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æˆ‘è¿™ä¸¾ä¸¤ä¸ªä¾‹å­ï¼š&lt;br&gt;
ä¾‹1ï¼šä¸Šå­¦é‚£ä¼šï¼Œæˆ‘çˆ¸é€æˆ‘å»ç«è½¦ç«™ï¼Œåˆ°äº†é©¬è·¯ä¸Šå‡†å¤‡å«å‡ºç§Ÿè½¦ã€‚è¿™æ—¶å¯¹é¢é©¬è·¯ä¸Šæ¥äº†ä¸€è¾†ç©ºè½¦ï¼Œå¸æœºå¸ˆå‚…çœ‹åˆ°æˆ‘ä»¬æ‹›æ‰‹ï¼Œå°±å‡†å¤‡åˆ°ä¸è¿œå¤„æ‰å¤´ï¼Œç„¶åè¿™æ—¶å€™å¦å¤–ä¸€è¾†å‡ºç§Ÿè½¦å°±åˆšå¥½åœåœ¨æˆ‘ä»¬é¢å‰ï¼Œæˆ‘å‡†å¤‡ä¸Šçœ¼å‰è¿™è¾†è½¦çš„æ—¶å€™ï¼Œæˆ‘çˆ¸å°±æŠŠæˆ‘æ‹‰ä½å«æˆ‘ç­‰ä¹‹å‰é‚£ä¸€è¾†è½¦æ‰å¤´åé‚£è¾†è½¦ï¼Œè€Œä¸”é‚£è¾†è½¦å·²ç»æ‹å¼¯é©¬ä¸Šåˆ°æˆ‘ä»¬è¿™è¾¹æ¥äº†ã€‚ä¹‹åç»“æœå°±æ˜¯ï¼Œæˆ‘å’Œæˆ‘çˆ¸åä¸Šäº†ä¹‹å‰ä¸€è¾†è½¦ï¼Œè€Œä¸”å’Œåœåœ¨æˆ‘ä»¬é¢å‰çš„åä¸€è¾†è½¦å¸ˆå‚…è¯´â€œä¸å¥½æ„æ€æˆ‘ä»¬å·²ç»å«äº†é©¬è·¯å¯¹é¢é‚£ä¸€è¾†è½¦äº†â€œã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä»¶äº‹åˆ°ç°åœ¨æˆ‘è¿˜æœ‰è®°å¿†æ·±åˆ»ï¼Œè¿™é‡Œæˆ‘æƒ³è¯´çš„æ˜¯ï¼Œ&lt;strong&gt;æˆ‘ä»¬åœ¨æ–¹ä¾¿è‡ªå·±çš„åŒæ—¶ï¼Œä¹Ÿè¦æ¢ä½æ€è€ƒè€ƒè™‘åˆ«äººçš„æ„Ÿå—&lt;/strong&gt;ã€‚&lt;br&gt;
æˆ–è®¸å¯¹äºä½ æ¥è¯´æ˜¯ä¸€ä»¶å°äº‹æƒ…ï¼Œç›´æ¥å›¾æ–¹ä¾¿åä¸Šç¦»è‡ªå·±æœ€è¿‘çš„è½¦ã€‚é‚£ä¹Ÿæ— å¯åšéï¼Œæ¢ä½œä»¥å‰çš„æˆ‘ä¹Ÿæ˜¯ï¼Œæ²¡æœ‰æ¢ä½æ€è€ƒè¿‡ã€‚ä½†æ˜¯ç°åœ¨æˆ‘è§‰å¾—æ¢ä½æ€è€ƒä¹Ÿæ˜¯ä¸€ä¸ªæˆå¹´äººåº”å…·å¤‡çš„ç´ è´¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹2ï¼šä¸Šä¸€æ¬¡å…¬å¸æŠ€æœ¯è”è°ƒï¼Œæˆ‘è¿™è¾¹éœ€è¦è¿œç¨‹å’Œå¦ä¸€ä¸ªåˆ†å…¬å¸åŒäº‹è”è°ƒï¼Œæˆ‘è¿™è¾¹å®Œäº‹åéœ€è¦é€šçŸ¥ä»–é‚£è¾¹ï¼Œä»–é‚£è¾¹æ‰èƒ½ç»§ç»­å®Œæˆå·¥ä½œï¼Œç”±äºè‡ªå·±çš„åŸå› ï¼Œè¿™è¾¹åšå®Œï¼Œæ²¡æœ‰åŠæ—¶é€šçŸ¥åˆ°ä»–ä»¬ï¼Œå¯¼è‡´ä»–ä»¬é‚£è¾¹å»¶æœŸã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä»¶äº‹æˆ‘æƒ³è¯´çš„æ˜¯ï¼Œ&lt;strong&gt;æˆ‘ä»¬åœ¨åšäº‹çš„æ—¶å€™ï¼Œæ— è®ºæ˜¯å·¥ä½œè¿˜æ˜¯ç”Ÿæ´»ï¼Œéƒ½ä¸èƒ½å»å› ä¸ºè‡ªå·±è€½æåˆ«äºº&lt;/strong&gt;ï¼Œå› ä¸ºåˆ«äººçš„æ—¶é—´ä¹Ÿæ˜¯æ—¶é—´ï¼Œå’Œæˆ‘ä»¬è‡ªå·±æ˜¯ä¸€æ ·çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;4-å…³äºå‹æƒ…çˆ±æƒ…äº²æƒ…&#34;&gt;4ã€å…³äºå‹æƒ…çˆ±æƒ…äº²æƒ…&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://img-blog.csdnimg.cn/20181231151002819.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p5MTUxMTIzNDI0NDk=,size_16,color_FFFFFF,t_70&#34; alt=&#34;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å…³äºå‹æƒ…ï¼šæƒ³å¯¹è¿œæ–¹çš„æœ‹å‹è¯´ &lt;strong&gt;å½“ä½ è¾‰ç…Œæ—¶å€™ï¼Œæˆ‘ç¥è´ºä½ ï¼Œå½“ä½ è½é­„çš„æ—¶å€™ï¼Œæˆ‘éšæ—¶å¸®åŠ©ä½ &lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å…³äºçˆ±æƒ…ï¼šåˆ°ç°åœ¨æˆ‘è¿˜åœ¨æƒ³è‡ªå·±çœŸæ­£æƒ³å»æ‹¥æœ‰çš„æ˜¯ä»€ä¹ˆã€‚&lt;/p&gt;
&lt;p&gt;å…³äºäº²æƒ…ï¼šåªæœ‰åˆ«äººå…³å¿ƒä½ é£çš„é«˜ä¸é«˜ï¼Œæ²¡æœ‰äººä¼šå…³å¿ƒä½ é£çš„ç´¯ä¸ç´¯ï¼Œé™¤äº†å®¶äººã€‚&lt;/p&gt;
&lt;h2 id=&#34;5-2019å¹´å±•æœ›&#34;&gt;5ã€2019å¹´å±•æœ›&lt;/h2&gt;
&lt;p&gt;ç«‹ä¸ªflagï¼Œæ¯•ç«Ÿæ˜¯æœªæ¥çš„äº‹&lt;br&gt;
1ã€ä¸€å‘¨ä¸€æ¬¡è·‘æ­¥+ç¯®çƒ&lt;br&gt;
2ã€ä¸¤ä¸ªæœˆè‡³å°‘çœ‹å®Œä¸€æœ¬ä¹¦&lt;br&gt;
3ã€ä¿æŠ¤å¥½è§†åŠ›&lt;br&gt;
4ã€ç†Ÿæ‚‰é‡‘èæ ¸å¿ƒä¸šåŠ¡&lt;br&gt;
5ã€ä½“é‡ä¸è¶…140&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“ä¸€ä¸‹&#34;&gt;æ€»ç»“ä¸€ä¸‹&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://img-blog.csdnimg.cn/20181231162952878.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p5MTUxMTIzNDI0NDk=,size_16,color_FFFFFF,t_70&#34; alt=&#34;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
äººçš„æˆé•¿æ˜¯ä¸æ–­è®¤è¯†åˆ°ä»¥å‰çš„è‡ªå·±æ˜¯ä¸€ä¸ªå‚»Xçš„è¿‡ç¨‹ï¼Œå¸Œæœ›æ˜å¹´çš„æˆ‘è®¤ä¸ºä»Šå¹´çš„æˆ‘æ˜¯ä¸€ä¸ªå‚»Xã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;2018-12-31 äºå¼ é¥å‡ºç§Ÿå±‹å†™&lt;/em&gt;&lt;/p&gt;
">2018å¹´æ€»ç»“</a>
      </div>
      
    </div>
    <div class="page">
      <div id="page_ul"></div>
    </div>
  </div>
</div>
<script>
  !function () {
    let searchMask = document.querySelector('#search_mask');
    let result = document.querySelector('#result');
    let items = document.querySelectorAll('.item');
    let searchBox = document.querySelector('#search');
    let statCount = document.querySelector('#stat_count');
    let statTimes = document.querySelector('#stat_times');
    let pageUl = document.querySelector('#page_ul');
    let close = document.querySelector('#close');
    
    close.addEventListener('click', function() {
      searchMask.style = 'display: none;'
    })

    let finds = [];
    let contents = [];
    let pageSize = 10;
    items.forEach(item => {
      let a = item.querySelector('a');
      contents.push({
        title: a.innerText,
        details: a.dataset.c,
        link: a.href
      })
      item.remove();
    })

    function insertStr(soure, start, count) {
      let newStr = soure.substr(start, count);
      return soure.slice(0, start) + '<em>' + newStr + '</em>' + soure.slice(start + count);
    }

    pageUl.addEventListener('click', function(event) {
      let target = event.target;
      if (target.__proto__ === HTMLSpanElement.prototype) {
        appendResults(parseInt(target.dataset.i));
      }
    })

    function appendResults(index) {
      let htmlResult = '';
      let start = index || 0;
      let end = Math.min(start + pageSize, finds.length);
      for (let i = start; i < end; i++) {
        const current = finds[i];
        let html = current.title;
        let sum = 0;
        let positions = current.positions;
        positions.forEach(position => {
          html = insertStr(html, position.start + sum, position.count);
          sum += 9;
        })
        htmlResult += `<div class="item"><a class="result-title" href="${current.link}">${html}</a></div>`;
      }
      result.innerHTML = htmlResult;
      pageUl.innerHTML = '';
      let count = finds.length / pageSize;
      let lis = '';
      if (start !== 0) {
        lis += `<span class="fa fa-angle-left" data-i='${start - 1}'></span>`;
      }
      for (let i = 0; i < count; i++) {
        lis += `<span class='${i === start?'current':''}' data-i='${i}'>${i+1}</span>`;     
      }
      if (start+1 < count) {
        lis += `<span class="fa fa-angle-right" data-i='${start+1}'></span>`;  
      }
      pageUl.innerHTML = lis;
    }

    function search(delay) {
      let timer = null
      return function () {
        clearTimeout(timer)
        timer = setTimeout(() => {
          let start = Date.now();
          let segments = searchBox.value.split(' ').filter(c => c != '');
          if (segments.length <= 0) {
            return;
          }
          finds = [];
          let htmlResult = '';
          contents.forEach(content => {
            let title = content.title;
            let positions = [];
            let find = false;
            segments.forEach((segment) => {
              if (content.title.includes(segment)) {
                find = true;
                positions.push({
                  start: content.title.indexOf(segment),
                  count: segment.length
                })
              } else if (content.details.includes(segment)) {
                find = true;
              }
            });
            if (find) {
              finds.push({
                title: content.title,
                link: content.link,
                positions
              });
            }
          })
          appendResults(0);
          statCount.textContent = finds.length;
          statTimes.textContent = Date.now() - start;
        }, delay)
      }
    }
    searchBox.addEventListener('input', search(200));
  }()
</script>

<input hidden id="copy" />
<script>
  let language = '';
  if (language !== '') {
    let map = new Map();
    if (language === 'en') {
      map.set('search', 'Search');
      map.set('category', 'Categories');
      map.set('article', 'Articles');
      map.set('tag', 'Tags');
      map.set('top', 'Top');
      map.set('publish', 'published');
      map.set('minute', ' minutes');
      map.set('read-more', 'Read More');
      map.set('view', 'View');
      map.set('words', ' words');
      map.set('category-in', 'category in');
      map.set('preview', 'Meta');
      map.set('index', 'Toc');
      map.set('no-archives', "You haven't created yet");
      map.set('archives', " articles in total");
      map.set('cloud-tags', " tags in total");
      map.set('copyright', "Copyright: ");
      map.set('author', "Author: ");
      map.set('link', "Link: ");
      map.set('leave-message', "Leave a message");
      map.set('format', "Links Format");
      map.set('site-name', "Name: ");
      map.set('site-link', "Link: ");
      map.set('site-desc', "Desc: ");
      map.set('stat', " related results, taking ");
      map.set('stat-time', " ms");
      map.set('site-img', "Image: ");
    }

    if (map.size > 0) {
      let lanElems = document.querySelectorAll('.language');
      lanElems.forEach(elem => {
        let lan = elem.dataset.lan, text = map.get(lan);
        if (elem.__proto__ === HTMLInputElement.prototype) {
          elem.placeholder = text
        } else {
          if (elem.dataset.count) {
            text = elem.dataset.count + text;
          }
          elem.textContent = text;
        }
      })
    }
  }
  //æ‹¿æ¥ä¸»ä¹‰(çœŸé¦™)^_^ï¼ŒClipboard å®ç°æ‘˜è‡ªæ˜é‡‘ https://juejin.im/post/5aefeb6e6fb9a07aa43c20af
  window.Clipboard = (function (window, document, navigator) {
    var textArea,
      copy;

    // åˆ¤æ–­æ˜¯ä¸æ˜¯iosç«¯
    function isOS() {
      return navigator.userAgent.match(/ipad|iphone/i);
    }
    //åˆ›å»ºæ–‡æœ¬å…ƒç´ 
    function createTextArea(text) {
      textArea = document.createElement('textArea');
      textArea.value = text;
      textArea.style.width = 0;
      textArea.style.height = 0;
      textArea.clientHeight = 0;
      textArea.clientWidth = 0;
      document.body.appendChild(textArea);
    }
    //é€‰æ‹©å†…å®¹
    function selectText() {
      var range,
        selection;

      if (isOS()) {
        range = document.createRange();
        range.selectNodeContents(textArea);
        selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);
        textArea.setSelectionRange(0, 999999);
      } else {
        textArea.select();
      }
    }

    //å¤åˆ¶åˆ°å‰ªè´´æ¿
    function copyToClipboard() {
      try {
        document.execCommand("Copy")
      } catch (err) {
        alert("å¤åˆ¶é”™è¯¯ï¼è¯·æ‰‹åŠ¨å¤åˆ¶ï¼")
      }
      document.body.removeChild(textArea);
    }

    copy = function (text) {
      createTextArea(text);
      selectText();
      copyToClipboard();
    };

    return {
      copy: copy
    };
  })(window, document, navigator);

  function copyCode(e) {
    if (e.srcElement.tagName === 'SPAN' && e.srcElement.classList.contains('copy-code')) {
      let code = e.currentTarget.querySelector('code');
      var text = code.innerText;
      if (e.srcElement.textContent === 'å¤åˆ¶æˆåŠŸ') {
        console.log('å¤åˆ¶æ“ä½œé¢‘ç‡è¿‡é«˜');
        return;
      }
      e.srcElement.textContent = 'å¤åˆ¶æˆåŠŸ';
      (function (elem) {
        setTimeout(() => {
          if (elem.textContent === 'å¤åˆ¶æˆåŠŸ') {
            elem.textContent = 'å¤åˆ¶ä»£ç '
          }
        }, 1000);
      })(e.srcElement)
      Clipboard.copy(text);
    }
  }

  let pres = document.querySelectorAll('pre');
  pres.forEach(pre => {
    let code = pre.querySelector('code');
    let copyElem = document.createElement('span');
    copyElem.classList.add('copy-code');
    copyElem.textContent = 'å¤åˆ¶ä»£ç ';
    pre.appendChild(copyElem);
    pre.onclick = copyCode
  })

</script>
<script src="/media/js/motion.js"></script>

<script src="https://cdn.jsdelivr.net/gh/cferdinandi/smooth-scroll/dist/smooth-scroll.polyfills.min.js"></script>
<script>
  var scroll = new SmoothScroll('a[href*="#"]', {
    speed: 200
  });
</script>


<script src="/media/js/mouse/love.js"></script>


</html>